jQuery.imageBlockUtils=(function(){var $=jQuery,utils={},options,colorToVideo,captionTimeout,mainImageWidget,mainImage,unavailable,mainImageCaption;
function getAvailableWidth(){return(window.innerWidth||document.body.offsetWidth)-(options.altsOnLeft?0:1);
}function resizeCallback(){var size=utils.getStretchyGoodnessSize();
$(document).trigger("stretchy-goodness",{size:size});
}function fetchChildVideos(color){var obj=options.colorToAsin[color];
if(!(obj&&obj.asin)){return;
}$.ajax({url:"/gp/product/features/apparel-main-image/videos.html",data:{asin:obj.asin,productGroupID:options.productGroupID,useChromelessVideoPlayer:options.useChromelessVideoPlayer},dataType:"json",timeout:4000,success:function(data){if(data){colorToVideo[color]=data;
$.imageBlock.changeColor(color);
}}});
}function getImageTypeAndIndex(color,index){var type="unknown";
var numAlts=colorImages[color].length;
if(index<numAlts){type="image";
}else{index=index-numAlts;
var numVids=utils.getVideos(color).length;
if(index<numVids){type="video";
}else{index=index-numVids;
var numCIU=options.customerImages.length;
if(index<numCIU){type="ciu";
}}}return{type:type,index:index};
}utils.isArray=function(obj){return Object.prototype.toString.call(obj)==="[object Array]";
};
utils.resizeCallback=resizeCallback;
utils.getImageTypeAndIndex=getImageTypeAndIndex;
utils.getStretchyGoodnessSize=function(){var w=getAvailableWidth();
if(options.stretchyGoodnessWidth){var sz=0;
var widthLimit=options.stretchyGoodnessWidth.length;
for(;
sz<widthLimit&&w>=options.stretchyGoodnessWidth[sz];
sz++){}return sz;
}return 0;
};
utils.getVideos=function(color){if(options.useChildVideos){if(!colorToVideo[color]){colorToVideo[color]=[];
fetchChildVideos(color);
}return colorToVideo[color];
}return options.videos;
};
utils.clientScreenData=function(){var h=(typeof window.innerHeight!="undefined"?window.innerHeight:document.body.offsetHeight);
var w=(typeof window.innerWidth!="undefined"?window.innerWidth:document.body.offsetWidth);
return{browserHeight:h,browserWidth:w};
};
utils.getSlateImage=function(color,size){return options.useChildVideos&&options.colorToAsin[color].slate[size];
};
utils.getThumbnailIndex=function(thumb,thumbnails){if(options.alwaysIncludeVideo){var jqThumb=$(thumb);
var index=jqThumb.data("index");
if(index!=null){return index;
}index=jqThumb.attr("data-index");
if(index!=null){return parseInt(index);
}}else{return $.inArray(thumb,thumbnails);
}return null;
};
utils.splitByType=function(color,index,imageCallback,videoCallback,ciuCallback){var obj=getImageTypeAndIndex(color,index);
var type=obj.type,i=obj.index;
switch(type){case"image":return imageCallback(color,i);
case"video":return videoCallback(color,i);
case"ciu":return ciuCallback(i);
default:return{};
}};
utils.getColorFromState=function(variationsState){if(!variationsState){return;
}var colorName="";
var variationLabels=DetailPage.StateController.getState()["variation_display_labels"];
$.each(options.visualDimensions,function(i,dim){var label=(options.gIsNewTwister==1)?dim:variationLabels[dim];
if(variationsState[label]){colorName+=" "+variationsState[label];
}});
return colorName&&colorName.substring(1);
};
utils.isBuyableVariation=function(dpState){if(!dpState.current_hovered_asin){var numDims=dpState.num_variation_dimensions;
return dpState.num_dimensions_selected!=numDims&&dpState.num_dimensions_hovered!=numDims;
}return true;
};
utils.showUnavailable=function(color){if(options.numColors>1&&color&&color!=""){unavailable.show();
unavailable.find(".text-no-color").hide();
unavailable.find(".text-color").show();
unavailable.find(".color").html(color);
}else{if(options.numColors<=0){unavailable.show();
unavailable.find(".text-no-color").show();
unavailable.find(".text-color").hide();
}}unavailable.removeClass("item-not-buyable");
unavailable.find(".wrapper").removeClass("not-buyable");
unavailable.find(".item-not-available").hide();
};
utils.hideUnavailable=function(){unavailable.hide();
unavailable.find(".text-no-color,.text-color").hide();
unavailable.removeClass("item-not-buyable");
unavailable.find(".wrapper").removeClass("not-buyable");
unavailable.find(".item-not-available").hide();
};
utils.showItemUnavailable=function(allVariations){unavailable.addClass("item-not-buyable").show();
unavailable.find(".wrapper").addClass("not-buyable");
unavailable.find(".text-no-color,.text-color").hide();
unavailable.find(".item-not-available").show();
var allVariationsHtml="<br>";
for(var key in allVariations){allVariationsHtml+=key+": "+allVariations[key]+"<br>";
}unavailable.find(".all-variations").html(allVariationsHtml);
};
utils.setImageCaption=function(color,index,timeout){if(captionTimeout){clearTimeout(captionTimeout);
}captionTimeout=null;
if(timeout){captionTimeout=setTimeout(function(){utils.setImageCaption(color,index);
},timeout);
}function imageCallback(c,i){if(magnifier){if(magnifier.isEngaged()&&options.useIV){return options.staticStrings["clickToExpand"];
}else{if(options.useIV&&!options.useHoverZoom){return options.staticStrings["clickToExpand"];
}else{if(colorImages[c][i].hiRes&&options.useHoverZoom){if(options.hoverZoomIndicator&&options.useHoverZoomIpad){return"<img src='"+options.staticImages.hoverZoomIcon+"'/>&nbsp;"+options.staticStrings["touchToZoom"];
}else{if(options.useHoverZoomIpad){return options.staticStrings["touchToZoom"];
}else{if(options.hoverZoomIndicator){return"<img src='"+options.staticImages.hoverZoomIcon+"'/>&nbsp;"+options.staticStrings["rollOverToZoom"];
}else{return options.staticStrings["rollOverToZoom"];
}}}}}}}}function videoCallback(c,i){if(!options.useChromelessVideoPlayer){return options.staticStrings["playVideo"];
}}function ciuCallback(i){return options.customerImages[i].caption;
}var caption=utils.splitByType(color,index,imageCallback,videoCallback,ciuCallback)||"&nbsp;";
mainImageCaption.html(caption);
};
utils.fixIE=function(){if($.browser.msie){mainImage.get(0).className=mainImage.get(0).className;
}};
utils.init=function(opts){utils.options=options=opts;
if(options.stretchyGoodnessWidth){if(window.imageBlockSize&&window.imageBlockSize>options.stretchyGoodnessWidth.length){options.stretchyGoodnessWidth=options.widths;
}resizeCallback();
if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe&&options.useHoverZoomIpad){$(window).bind("orientationchange",resizeCallback);
}else{$(window).resize(resizeCallback);
}}colorToVideo={};
colorToVideo[options.defaultColor]=options.videos;
mainImageWidget=$("#main-image-widget");
mainImage=mainImageWidget.find("#main-image");
unavailable=mainImageWidget.find("#main-image-unavailable");
mainImageCaption=mainImageWidget.find("#main-image-caption");
return utils;
};
return utils;
})();
amznJQ.declareAvailable("imageBlockUtils");
if(!window.Softlines){window.Softlines={};
}window.Softlines.ClientLogger=function(feature,forceUpload){var self=this,data={},vips={"www.amazon.com":"fls-na","devo":"fls-devo.vipinteg"};
self.logSingleton=function(key){data[key]=1;
};
self.logHit=function(key){if(!data[key]){data[key]=1;
}else{data[key]++;
}};
self.logKeyValuePair=function(key,value){data[key]=value;
};
self.deleteKey=function(key){if(data[key]){delete data[key];
}};
self.startTimer=function(key){data[key]=+new Date();
};
self.endTimer=function(key){if(data[key]){data[key]=+new Date()-data[key];
}};
self.upload=function(){var protocol=location.protocol=="https:"?"https://":"http://",vip=vips[location.host]||vips.devo,url=protocol+vip+".amazon.com/1/softlines/1/OP/"+feature+"?"+jQuery.param(data)+"&_="+(+new Date());
(new Image()).src=url;
};
if(forceUpload){jQuery(window).unload(function(){self.upload();
});
}};
amznJQ.declareAvailable("SoftlinesClientLogger");
amznJQ.available("imageBlockUtils",function(){amznJQ.available("SoftlinesClientLogger",function(){function ImageBlock(options){var $=jQuery,self=this,utils=$.imageBlockUtils.init(options),color=options.defaultColor,variant=0,size=utils.getStretchyGoodnessSize(),mainImageWidget=$("#main-image-widget"),mainImageWrapper=mainImageWidget.find("#main-image-wrapper"),imageHolder=mainImageWrapper.find("#holderMainImage"),mainImage=mainImageWidget.find("#main-image").removeAttr("width").removeAttr("height"),thumbnails=mainImageWidget.find(".thumbs .border"),currentHolder=imageHolder,isIVAvailable=false,isMagnifierLoaded=false,flashNotInstalled=false,videoPlayers={},videoSizes=options.videoSizes,defaultColor=options.defaultColor,useIV=options.useIV,useChromelessVideoPlayer=options.useChromelessVideoPlayer,isIpad=navigator.userAgent.match(/ipad/i),isAndroid=navigator.userAgent.match(/cloud9|android|silk-accelerated/i),thumbMouseOverTriggered=0,logMetrics=options.logMetrics?true:false,immersiveView,videoAvailLogged={},changeColorCall={},clientScreen=utils.clientScreenData(),colorClickedLogged={},videoDownloadedTriggered=0,videoPlaying=0,cfEndTimer=options.cfEndTimer,videoReadyTriggered=0,srcLogged={};
numAlts=0;
function updateMainImage(c,index){var imageHash=colorImages[c][index];
var src;
if(imageHash.main[size]){src=imageHash.main[size];
}else{src=imageHash.main[imageHash.main.length-1];
}mainImage.attr("src",src);
utils.fixIE();
}function previewColor(c,index){if(index<colorImages[c].length){hideNoFlashContent();
updateMainImage(c,index);
hideAllHolders();
imageHolder.show();
}else{magnifier.disengageMagnifier();
hideAllHolders();
if(currentHolder.hasClass("image")||currentHolder.hasClass("ciu")){currentHolder.show();
}else{var id=currentHolder.attr("id").replace("holder","");
var holderVideos=utils.getVideos(c);
$.each(holderVideos,function(i,vid){if(vid.mediaObjectId==id){changeVideoVariant(c,i);
return false;
}});
}}utils.setImageCaption(c,index);
}self.shakeIt=function(){var overflow=mainImageWrapper.css("overflow");
mainImageWrapper.css("overflow","hidden");
var position=imageHolder.css("position");
imageHolder.css("position","relative");
imageHolder.animate({left:"-=50px"},800,function(){imageHolder.animate({left:"+=50px"},800,function(){mainImageWrapper.css("overflow",overflow);
imageHolder.css("position",position);
});
});
};
self.showImage=function(move){if(!thumbnails.length||!(move=="next"||move=="previous")){return;
}var cst=jQuery("#thumbs-image .border.selected");
if(typeof cst==="undefined"||(cst&&cst.length==0)){return;
}var csti=$.inArray(cst[0],thumbnails);
if(csti==-1){return;
}var nsti=0;
if(move=="next"){nsti=(csti+1)%thumbnails.length;
}if(move=="previous"){nsti=(csti-1+thumbnails.length)%thumbnails.length;
}if(typeof thumbnails[nsti]!=="undefined"){$("#main-image-wrapper").animate({opacity:0},300,function(){$(thumbnails[nsti]).trigger("mouseover");
$("#main-image-wrapper").animate({opacity:1},300);
});
}};
self.changeColor=function(c){var selectedVariant=0;
if(options.autoplayVideo&&!isAndroid){c=defaultColor;
selectedVariant=colorImages[c].length;
}else{if(c==color){selectedVariant=variant;
}}if(c&&(!colorImages[c]||colorImages[c]<=0)){utils.showUnavailable(c);
color=defaultColor;
}else{utils.hideUnavailable();
color=c;
}var thumbs=mainImageWidget.find(".thumbs").empty();
var numAlts=0;
var videoSet=utils.getVideos(color);
if(logMetrics&&options.useChromelessVideoPlayer&&options.useChildVideos&&changeColorCall[color]){var obj=options.colorToAsin[color];
if(obj&&obj.asin&&!videoAvailLogged[obj.asin]){var videoStatus=(videoSet.length>0)?"videoFound":"videoMissing";
logger.logHit(videoStatus);
logger.logHit("totalVideoAsin");
if(videoSet.length>0){if(isIpad){logger.logHit("ipadVideoFound");
colorClickedLogged={};
}else{if(isAndroid){logger.logHit("andVideoFound");
colorClickedLogged={};
}}}videoAvailLogged[obj.asin]=1;
}}changeColorCall[color]=1;
if(options.alwaysIncludeVideo){var offset=0;
$.each([colorImages[color],videoSet,options.customerImages],function(i){var reservedSlots=(i<1&&videoSet.length>0?1:0);
$.each(this,function(j){var thumb=$("<img alt=''>");
thumb.load(function(){thumb.removeClass("load");
}).attr("src",this.thumb);
thumb.addClass("border load thumb"+(offset+j));
thumb.removeClass("load");
thumb.data("index",offset+j);
thumbs.append(thumb);
if(this.imageLink&&!(isIpad&&window.ImageBlockWeblabs&&window.ImageBlockWeblabs.consolidated)){thumb.wrap("<a href='"+this.imageLink+"'></a>");
}return ++numAlts<options.maxAlts-reservedSlots;
});
offset+=this.length;
return numAlts<options.maxAlts;
});
thumbnails=thumbs.find(".border").unbind("mouseover",thumbMouseOver).unbind("mouseout",thumbMouseOut).unbind("click",thumbOnClick);
thumbnails.mouseover(thumbMouseOver).mouseout(thumbMouseOut).click(thumbOnClick);
}else{$.each([colorImages[color],videoSet,options.customerImages],function(i,arr){$.each(arr,function(j,imageHash){var thumb=$("<img class='border load' alt=''>");
thumbs.append(thumb);
if(imageHash.imageLink&&!(isIpad&&window.ImageBlockWeblabs&&window.ImageBlockWeblabs.consolidated)){thumb.wrap("<a href='"+imageHash.imageLink+"'></a>");
}thumb.load(function(){thumb.removeClass("load");
});
var src=(imageHash.isVideo&&options.useChromelessVideoPlayer&&options.useChildVideos)?options.staticImages.videoThumbIcon:imageHash.thumb;
thumb.attr("src",src);
return ++numAlts<options.maxAlts;
});
return numAlts<options.maxAlts;
});
thumbnails=thumbs.find("img").unbind("mouseover",thumbMouseOver).unbind("mouseout",thumbMouseOut).unbind("click",thumbOnClick);
thumbnails.mouseover(thumbMouseOver).mouseout(thumbMouseOut).click(thumbOnClick);
}if(selectedVariant>=numAlts){selectedVariant=0;
}changeVariant(color,selectedVariant);
};
function changeVariant(c,index){variant=index;
var config=utils.splitByType(c,index,changeMainImageVariant,changeVideoVariant,changeCustomerImageVariant);
if(config){thumbnails.removeClass("selected");
var target=options.alwaysIncludeVideo?thumbnails.filter(".thumb"+variant):thumbnails.eq(variant);
target.addClass("selected").css("cursor",config.showHandCursor?"pointer":"default");
utils.setImageCaption(c,variant);
utils.fixIE();
}}function changeMainImageVariant(c,imageIndex){var imageHash=colorImages[c][imageIndex];
var imageUnavailable=mainImageWidget.find("#main-image-unavailable").is(":visible");
var src;
if(imageHash.main[size]){src=imageHash.main[size];
}else{src=imageHash.main[imageHash.main.length-1];
}hideNoFlashContent();
hideAllHolders();
currentHolder=imageHolder.show();
if(logMetrics&&(!srcLogged[src])){srcLogged[src]=1;
logger.logHit("imgRequest");
if(imageUnavailable){logger.logHit("imgMissing");
}else{logger.logHit("imgFound");
if(imageHash.hiRes){logger.logHit("hiResFound");
}}}try{magnifier.suppressMagnifier(false);
magnifier.changeImage(src,imageUnavailable?null:imageHash.hiRes);
}catch(err){loadMagnifier();
}return{showHandCursor:!imageUnavailable&&useIV};
}function changeCustomerImageVariant(ciuIndex){var ciuImageHash=options.customerImages[ciuIndex];
var holderId=ciuImageHash.holderId;
var imageLink=ciuImageHash.imageLink;
hideNoFlashContent();
hideAllHolders();
currentHolder=mainImageWrapper.find("#"+holderId);
if(currentHolder.length==0){var imageId="ciu_"+ciuImageHash.id;
var imageHTML="<img id='"+imageId+"'>";
if(!isIpad&&window.ImageBlockWeblabs&&(window.ImageBlockWeblabs.consolidated||window.ImageBlockWeblabs.bookLargeImage)){imageHTML="<a href='"+imageLink+"'>"+imageHTML+"</a>";
}currentHolder=$("<div id='"+holderId+"' class='holder ciu'>"+imageHTML+"</div>").appendTo(mainImageWrapper);
}currentHolder.find("img").attr("src",ciuImageHash.main[size]);
mostRecentLoadCallback=null;
magnifier&&magnifier.disengageMagnifier();
currentHolder.show();
return{showHandCursor:ciuImageHash.imageLink};
}function changeVideoVariant(c,videoIndex){if(useChromelessVideoPlayer){return changeVideoVariant_Chromeless(c,videoIndex);
}var videoHash=utils.getVideos(c)[videoIndex];
createVideoHolder(videoIndex);
hideAllHolders();
var previousHolder=currentHolder;
currentHolder=$("#"+videoHash.holderId);
if(videoHash.flashShowing){var f=function(){hideAllHolders();
var playerSize=options.mainImageSizes[size][0];
videoHash.player.resizeVideo(playerSize,playerSize);
videoHash.player.showFlash();
if(previousHolder.get(0)==currentHolder.get(0)&&currentHolder.hasClass("resized")){currentHolder.removeClass("resized");
videoHash.player.play();
}else{videoHash.player.pause();
}};
f();
setTimeout(f,10);
}else{if(currentHolder.hasClass("resized")){currentHolder.remove();
videoHash.player=null;
return changeVideoVariant(c,videoIndex);
}else{videoHash.player.showPreplay();
}}return{showHandCursor:useIV};
}function changeVideoVariant_Chromeless(c,videoIndex){if(flashNotInstalled){showNoFlashContent();
}var slateSrc=utils.getSlateImage(c,size);
try{if(slateSrc){if(!(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe)){magnifier.changeImage(slateSrc,null,videoSizes[size][0]+"px",videoSizes[size][1]+"px");
}if(logMetrics&&isAndroid&&!colorClickedLogged[c]){logger.logHit("andVideoClicked");
colorClickedLogged[c]=1;
}magnifier.suppressMagnifier(true);
if(!(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe)){magnifier.changeImage(slateSrc,null,videoSizes[size][0]+"px",videoSizes[size][1]+"px");
}}}catch(err){if(isIpad&&c!=defaultColor){loadMagnifier();
}}ipadVideoHash={};
amznJQ.available("videoPlayer",function(){var videoHash=utils.getVideos(c)[videoIndex];
if(isIpad){ipadVideoHash=videoHash;
}createVideoHolder(videoIndex);
hideAllHolders();
currentHolder=$("#"+videoHash.holderId);
if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){currentHolder.show();
}else{imageHolder.show();
}videoHash.player.play(videoHash.url);
if(videoPlaying!=1&&!isAndroid&&!isIpad&&logMetrics){logger.logHit("videoPlayed");
videoPlaying=1;
}});
return{showHandCursor:0};
}function createVideoHolder(index){if(useChromelessVideoPlayer){return createVideoHolder_Chromeless(index);
}if(!window.AmznVideoPlayer){return;
}var videoHash=utils.getVideos(color)[index];
if(videoHash&&!videoHash.player){var playerSize=options.mainImageSizes[size][0];
var holder=$("<div id='"+videoHash.holderId+"' class='holder video' ></div>");
if(!($("#"+videoHash.holderId).length)){if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe&&!$.browser.msie){holder=holder.prependTo("#main-image-wrapper");
}else{holder=holder.prependTo("#main-image-content");
}}videoHash.slateImageUrl=videoHash.main[size];
videoHash.player=new AmznVideoPlayer(videoHash,videoHash.holderId,playerSize,playerSize);
videoHash.player.writePreplayHtml();
videoHash.player.hidePreplay();
if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){amznJQ.available("swipe-gesture",function(){$("#"+videoHash.player.preplayDivId).tap({tapAction:function(){videoHash.player.preplayClick();
}});
});
}holder.click(function(){return false;
});
}}function createVideoHolder_Chromeless(index){var videoHash=utils.getVideos(color)[index];
if(videoHash&&!videoHash.player){if(!videoPlayers[videoHash.holderId]){var holder;
if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){holder=$("<div id='"+videoHash.holderId+"' class='holder video' style='position:static;margin:0px;'></div>").prependTo("#main-image-wrapper");
}else{holder=$("<div id='"+videoHash.holderId+"' class='holder video'></div>").prependTo("#main-image-content");
}holder.click(function(){return false;
});
var slateImageSrc=utils.getSlateImage(color,size);
videoPlayers[videoHash.holderId]=new VideoPlayer({id:videoHash.holderId,width:videoSizes[size][0],height:videoSizes[size][1],swf:options.staticImages.videoSWFPath,slateImageSrc:slateImageSrc});
videoPlayers[videoHash.holderId].load(videoHash.url);
}videoHash.player=videoPlayers[videoHash.holderId];
}}function hideAllHolders(holder){if(useChromelessVideoPlayer){return hideAllHolders_Chromeless(holder);
}mainImageWrapper.find(".ciu").hide();
imageHolder.hide();
if(typeof AmznVideoPlayer!="undefined"){var videoSet=utils.getVideos(color);
if(!utils.isArray(videoSet)){videoSet=[];
}$.each(videoSet,function(){if(this.player){this.player.pause();
if(currentHolder.get(0)==document.getElementById(this.holderId)){this.flashShowing=!$("#"+this.player.preplayDivId).is(":visible");
}}});
AmznVideoPlayer.hideAll();
}}function hideAllHolders_Chromeless(holder){mainImageWrapper.find(".ciu").hide();
imageHolder.hide();
$.each(videoPlayers,function(id,player){if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){$("#"+player.id()).hide();
}player.hide();
});
}function thumbMouseOver(){var index=utils.getThumbnailIndex(this,thumbnails);
changeVariant(color,index);
thumbMouseOverTriggered=1;
var mainImageCaption=mainImageWidget.find("#main-image-caption");
if(index<colorImages[color].length){if(useIV){mainImageCaption.html(options.staticStrings["clickToExpand"]);
}else{if(colorImages[color][index].hiRes&&options.useHoverZoom){if(options.hoverZoomIndicator&&options.useHoverZoomIpad){mainImageCaption.html("<img src='"+options.staticImages.hoverZoomIcon+"'/>&nbsp;"+options.staticStrings["touchToZoom"]);
}else{if(options.useHoverZoomIpad){mainImageCaption.html(options.staticStrings["touchToZoom"]);
}else{if(options.hoverZoomIndicator){mainImageCaption.html("<img src='"+options.staticImages.hoverZoomIcon+"'/>&nbsp;"+options.staticStrings["rollOverToZoom"]);
}else{mainImageCaption.html(options.staticStrings["rollOverToZoom"]);
}}}}}}}function thumbMouseOut(){utils.setImageCaption(color,variant,100);
}function thumbOnClick(e){var index=utils.getThumbnailIndex(this,thumbnails);
var numColors=colorImages[color].length;
var numVideos=utils.getVideos(color).length;
var totalThumbs=numColors+numVideos-1;
if(index<=totalThumbs){if(useChromelessVideoPlayer&&options.useChildVideos&&numVideos&&index==totalThumbs){if(isIpad){changeVariant(color,index);
currentHolder=$("#"+ipadVideoHash.holderId);
var myVideoObj=currentHolder.find("video");
var myVideoElem=myVideoObj.get(0);
if(logMetrics){if(!colorClickedLogged[color]){logger.logHit("ipadVideoClicked");
colorClickedLogged[color]=1;
}if(videoPlaying!=1){logger.logHit("videoPlayed");
if(color=="initial"&&videoReadyTriggered!=1&&videoDownloadedTriggered!=1){logger.startTimer("ipadVideoReady");
logger.startTimer("ipadVideoDownloaded");
}videoPlaying=1;
}}myVideoElem.play();
}if(isAndroid&&!thumbMouseOverTriggered){changeVariant(color,index);
}thumbMouseOverTriggered=0;
}if(index<numColors||!useChromelessVideoPlayer){showIV(e);
}if(!(colorImages[color][index]&&colorImages[color][index].imageLink)){return false;
}}}function mainOnClick(e){if(options.showLITBOnClick){if(typeof(SitbReader)!="undefined"){SitbReader.LightboxActions.openReader(options.sitbReftag);
}}else{showIV(e);
}return false;
}function bindTwisterEvents(){new function(){var func=this;
func.name="Magnifiable Image Block";
func.notify=function(event,state){var c=event=="swatch_hover"?utils.getColorFromState(state.hovered_variations):utils.getColorFromState(state.selected_variations);
if(event=="swatch_hover"){var index=0;
if(!c){color==defaultColor?utils.hideUnavailable():utils.showUnavailable();
c=defaultColor;
}else{if(!colorImages[c]||colorImages[c].length<=0){var colorName=state["variation_display_labels"]["color_name"];
utils.showUnavailable(state.hovered_variations[colorName]&&c);
c=defaultColor;
}else{if(!utils.isBuyableVariation(state)){utils.showItemUnavailable(state["hovered_variations"]);
}else{utils.hideUnavailable();
}}}var isAndroidVideoIndex=isAndroid&&useChromelessVideoPlayer&&useChildVideos&&variant==colorImages[color].length;
if(!isAndroidVideoIndex){previewColor(c,c==color?variant:index);
}}else{if(event=="initial"){self.changeColor(defaultColor);
}else{self.changeColor(c||defaultColor);
}}utils.fixIE();
};
if(typeof gIsNewTwister=="undefined"||gIsNewTwister==0){self.changeColor(color);
}amznJQ.available("dpf",function(){func.notify("initial",DetailPage.StateController.getState());
var highPriority=1;
DetailPageFramework.registerFeature(func,["child_deselect","child_select","swatch_hover"],highPriority);
});
amznJQ.available("newTwister",function(){if(typeof DetailPage!="undefined"&&DetailPage.StateController){func.notify("initial",DetailPage.StateController.getState());
}});
};
}function loadMagnifier(){if(isMagnifierLoaded){return;
}isMagnifierLoaded=true;
options.autoplayVideo=false;
if(options.showLITBOnClick){imageHolder.click(mainOnClick);
}amznJQ.available("imageMagnifier",function(){var opts={adjustment:[0,0,1,1],generalImageUrls:options.staticImages,location:"over",locationElement:".hoverZoom, .buying .brandLink, #handleBuy .dkBlueBox, #btAsinTitle, #product-title-divider,"+"#jsSwatches, #testevent, #scarcity_feature_div, #fast-track_feature_div,.qpDivTop .cBoxInner, #ob-replacement_feature_div",minHeightElement:"#main-image-widget",preload:"ready",zIndex:990,useHoverZoomIpad:options.useHoverZoomIpad,useHoverZoom:options.useHoverZoom,logMetrics:logMetrics};
if(options.isQuickview){$.extend(opts,{adjustment:[0,0,0,0],locationElement:"#quickview_ppd_layout_table td.right",minHeightElement:null,zIndex:202});
}window.magnifier=mainImage.amazonMagnifier(opts);
$(document).bind("stretchy-goodness",stretchyGoodnessCallback);
utils.resizeCallback();
if(useIV){amznJQ.available("DonsBoxJS",function(){});
amznJQ.available("immersiveView",onIVLoaded);
}else{utils.setImageCaption(color,variant);
}});
}function stretchyGoodnessCallback(e,data){var newsize=data.size;
if(useChromelessVideoPlayer){if(size!=newsize){size=newsize;
$.each(videoPlayers,function(id,player){player.resizeVideo(videoSizes[size][0],videoSizes[size][1]);
});
changeVariant(color,variant);
mainImageWidget.attr("class",mainImageWidget.attr("class").replace(/size[0-9]+/,"size"+size));
}}else{size=newsize;
mainImageWidget.find(".video").addClass("resized");
changeVariant(color,variant);
mainImageWidget.attr("class",mainImageWidget.attr("class").replace(/size[0-9]+/,"size"+size));
}}function onIVLoaded(){if(!useChromelessVideoPlayer){var videoSet=utils.getVideos(color);
if(!utils.isArray(videoSet)){videoSet=[];
}$.each(videoSet,function(i,videoHash){createVideoHolder(i);
});
}mainImage.css("cursor","pointer");
thumbnails.unbind("click",thumbOnClick).unbind("mouseout",thumbMouseOut);
thumbnails.click(thumbOnClick).mouseout(thumbMouseOut);
imageHolder.click(mainOnClick);
utils.setImageCaption(color,variant);
$(document).bind("engaged.magnifier disengaged.magnifier",function(){utils.setImageCaption(color,variant);
});
isIVAvailable=true;
if(!useChromelessVideoPlayer){$(document).bind("closed.IV",function(){var playerSize=options.mainImageSizes[size][0];
var videoSet=utils.getVideos(color);
if(!utils.isArray(videoSet)){videoSet=[];
}$.each(videoSet,function(i,videoHash){videoHash.player&&videoHash.player.resizeVideo(playerSize,playerSize);
});
});
}}function buildIVVideos(){var ivVideoSet={mediaIDs:[],slateImages:[],titles:[],durations:[]};
var videoSet=utils.getVideos(color);
if(!utils.isArray(videoSet)){videoSet=[];
}var length=videoSet.length;
for(var i=0;
i<length;
i++){var videoHash=videoSet[i];
ivVideoSet.mediaIDs[i]=videoHash.mediaObjectId;
ivVideoSet.slateImages[i]=videoHash.slateImageUrl;
ivVideoSet.titles[i]=videoHash.title;
ivVideoSet.durations[i]=videoHash.duration;
}return[{videos:ivVideoSet}];
}function createIV(e,colorIndex,variantIndex,isImage){var imageSet={};
$.each(options.ivImageSetKeys,function(index){if(colorImages[index]){imageSet[options.ivImageSetKeys[index]]={images:{thumbnails:$.map(colorImages[index],function(image){return image.thumb;
}),zoomImages:$.map(colorImages[index],function(image){return image.hiRes||image.large||image.main[image.main.length-1];
})}};
}});
window.isIvWeblab=true;
window.setImmersiveViewContext=function(){};
if(!useChromelessVideoPlayer){window.videoStateChange=function(arg){if(!immersiveView.isIVOpen()){var playerSize=options.mainImageSizes[size][0];
var videoSet=utils.getVideos(color);
if(!utils.isArray(videoSet)){videoSet=[];
}$.each(videoSet,function(){this.player&&this.player.resizeVideo(playerSize,playerSize);
});
}};
window.getCurrentMediaId=function(){if(currentHolder.hasClass("video")){return currentHolder.attr("id").replace("holder","");
}};
}window.ivStrings=options.staticStrings;
immersiveView=$.fn.amazonImmersiveView();
var isCssLoaded=immersiveView.loadCSS();
if(!isCssLoaded){immersiveView=undefined;
return;
}if(useChromelessVideoPlayer){immersiveView.disableVideo();
}else{immersiveView.changeVideoSet(buildIVVideos());
}immersiveView.setTitle(options.title);
immersiveView.setProductGroupID(options.productGroupID);
immersiveView.setMediaUrls(options.staticImages);
immersiveView.changeImageSet(imageSet);
var isTwisterDP=false;
if((typeof gIsNewTwister!="undefined"&&gIsNewTwister!=0)||(typeof goTwisterCore!="undefined"&&goTwisterCore.selectionItems)){isTwisterDP=true;
window.swatches={};
var regExp=new RegExp(amznJQ.chars.BACKSLASH+"d+");
var imgTag=$("<img/>").css("height","20px");
$(".swatchOuter").each(function(){var swatchIndex=Number($(this).children().eq(0).attr("id").match(regExp))+1;
var swatchImageContainer=$(this).find(".swatchInnerImage");
if(swatchImageContainer.length>0){var url=swatchImageContainer.css("background-image").slice(4,-1);
if(url.charAt(0)==amznJQ.chars.DQUOTE){url=url.slice(1,-1);
}swatches["color_name-"+options.indexToColor[swatchIndex]]=$("<div/>").append(imgTag.attr("src",url).removeAttr("width")).html();
}});
$(".swatches li").each(function(){var swatchIndex=Number($(this).attr("id").match(regExp))+1;
var swatchImageContainer=$(this).find("img");
if(swatchImageContainer.length>0){var url=swatchImageContainer.attr("src");
if(url.charAt(0)==amznJQ.chars.DQUOTE){url=url.slice(1,-1);
}swatches["color_name-"+options.indexToColor[swatchIndex]]=$("<div/>").append(imgTag.attr("src",url).removeAttr("width")).html();
}});
immersiveView.setVariationProperties(options.visualDimensions,swatches);
if(typeof gIsNewTwister!="undefined"&&gIsNewTwister!=0){immersiveView.setItems(options.colorToAsin);
immersiveView.setIVRepresentativeAsin(options.ivRepresentativeAsin,options.gPreferChildVideos);
}else{immersiveView.setItems(goTwisterCore.selectionItems);
}}immersiveView.setInitialIDs(colorIndex,variantIndex,isImage);
immersiveView.createImmersiveView(e,isTwisterDP);
$(window).ready(function(){$.get("/gp/product/ajax-handlers/reftag.html/ref=dp_imgs_iv");
});
}function showIV(e){if(!useIV||!isIVAvailable){return;
}var currentSelectedVariation=null;
if(typeof DetailPage!="undefined"&&DetailPage.StateController){currentSelectedVariation=utils.getColorFromState(DetailPage.StateController.getState()["selected_variations"]);
}var currentSelectedColor=currentSelectedVariation||color;
var length=colorImages[currentSelectedColor].length;
var isImage=variant<length;
var colorIndex=options.ivImageSetKeys[currentSelectedColor]||0;
var variantIndex=isImage?variant:variant-length;
if(useChromelessVideoPlayer&&!isImage){isImage=true;
variantIndex=0;
}if(!immersiveView){createIV(e,colorIndex,variantIndex,isImage);
}immersiveView.setInitialIDs(colorIndex,variantIndex,isImage);
$.AmazonPopover.displayPopover(immersiveView.getIVPopoverOptions());
}function onVideoPlayerLoaded(){VideoPlayer.bindEnded(function(videoPlayer){if(logMetrics){logger.logHit("videoSuccess");
videoPlaying=0;
}if(videoPlayers[videoPlayer.id()]){updateMainImage(color,0);
loadMagnifier();
changeVariant(color,0);
if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){$("#"+videoPlayer.id()).hide();
}}});
VideoPlayer.bindPlay(function(videoPlayer){if(videoPlayers[videoPlayer.id()]){updateMainImage(color,0);
loadMagnifier();
}});
if(logMetrics){VideoPlayer.bindFlashReady(function(){if(color=="initial"){logger.endTimer("flashVideoReady");
logger.deleteKey("html5VideoReady");
}});
VideoPlayer.bindHtml5Ready(function(){if(color=="initial"&&videoReadyTriggered!=1){if(isIpad){logger.endTimer("ipadVideoReady");
logger.deleteKey("html5VideoReady");
}else{if(!isAndroid){logger.endTimer("html5VideoReady");
}}videoReadyTriggered=1;
}logger.deleteKey("flashVideoReady");
logger.deleteKey("playerLoaded");
});
VideoPlayer.bindPlayerLoaded(function(){if(color=="initial"){logger.endTimer("playerLoaded");
}});
}VideoPlayer.bindFinishedDownload(function(){if(logMetrics&&color=="initial"&&videoDownloadedTriggered!=1){if(isIpad){logger.endTimer("ipadVideoDownloaded");
logger.deleteKey("videoDownloaded");
}else{logger.endTimer("videoDownloaded");
}videoDownloadedTriggered=1;
}updateMainImage(color,0);
loadMagnifier();
});
VideoPlayer.bindNoFlashError(function(){flashNotInstalled=1;
showNoFlashContent();
loadMagnifier();
});
VideoPlayer.bindError(function(){if(logMetrics){logger.logHit("videoError");
videoPlaying=0;
}loadMagnifier();
updateMainImage(color,0);
changeVariant(color,0);
});
}function showNoFlashContent(){if(flashNotInstalled){mainImageWidget.addClass("noflash");
}}function hideNoFlashContent(){if(flashNotInstalled){mainImageWidget.removeClass("noflash");
}}var getDataHash=function(noRefresh,id,html){var data={};
data[id]=html;
var markupHash={};
markupHash["noRefresh"]=noRefresh;
markupHash["content"]=data;
return markupHash;
};
var updateMainImageMarkup=function(c){var selectedVariant=0;
if(options.autoplayVideo&&!isAndroid){selectedVariant=colorImages[c].length;
}else{if(c==color){selectedVariant=variant;
}}if(c&&(!colorImages[c]||colorImages[c]<=0)){utils.showUnavailable(c);
c=defaultColor;
}else{utils.hideUnavailable();
}if(selectedVariant>=numAlts){selectedVariant=0;
}changeVariant(c,selectedVariant);
};
var getMainImageMarkup=function(id,dpState){var c=utils.getColorFromState(dpState.getState()["hovered_variations"]);
c=c&&c!=""?c:defaultColor;
var noRefresh=false;
var html='<div><script> ImageBlock.TwisterReArchModule.updateMainImageMarkup("'+c.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"); <\/script></div>';
return getDataHash(noRefresh,"twister-main-image",html);
};
var initializeThumbnails=function(thumb){thumbnails=thumb;
variant=index=0;
var typeAndIndex=utils.getImageTypeAndIndex(color,index);
var config=null;
switch(typeAndIndex.type){case"image":config={"showHandCursor":"showHandCursor"};
break;
case"video":config={"showHandCursor":"useIV"};
break;
case"ciu":config={"showHandCursor":ciuImageHash.imageLink};
break;
}if(config){thumbnails.removeClass("selected");
if(options.alwaysIncludeVideo){thumbnails.filter(".thumb"+variant).addClass("selected").css("cursor",config.showHandCursor?"pointer":"default");
}else{thumbnails.eq(variant).addClass("selected").css("cursor",config.showHandCursor?"pointer":"default");
}utils.setImageCaption(color,index);
if(jQuery.browser.msie){mainImage.get(0).className=mainImage.get(0).className;
}}};
var getAltsMarkup=function(c){var numAlts=0;
var thumbs=mainImageWidget.find(".thumbs");
var videoSet=utils.getVideos(c);
var thumbMarkup=jQuery("<div></div>");
if(logMetrics&&options.useChromelessVideoPlayer&&options.useChildVideos&&changeColorCall[c]){var obj=options.colorToAsin[c];
if(obj&&obj.asin&&!videoAvailLogged[obj.asin]){var videoStatus=(videoSet.length>0)?"videoFound":"videoMissing";
logger.logHit(videoStatus);
logger.logHit("totalVideoAsin");
if(videoSet.length>0){if(isIpad){logger.logHit("ipadVideoFound");
colorClickedLogged={};
}else{if(isAndroid){logger.logHit("andVideoFound");
colorClickedLogged={};
}}}videoAvailLogged[obj.asin]=1;
}}if(options.alwaysIncludeVideo){var offset=0;
jQuery.each([colorImages[c],videoSet,options.customerImages],function(i){var reservedSlots=(i<1&&videoSet.length>0?1:0);
jQuery.each(this,function(j){var thumb=jQuery("<img alt=''>");
thumb.attr("src",this.thumb);
thumb.addClass("border thumb"+(offset+j));
thumb.data("index",offset+j);
thumb.attr("data-index",offset+j);
thumbMarkup.append(thumb);
if(this.imageLink&&!(isIpad&&window.ImageBlockWeblabs&&window.ImageBlockWeblabs.consolidated)){thumb.wrap("<a href='"+this.imageLink+"'></a>");
}return ++numAlts<options.maxAlts-reservedSlots;
});
offset+=this.length;
return numAlts<options.maxAlts;
});
}else{jQuery.each([colorImages[c],videoSet,options.customerImages],function(i,arr){jQuery.each(arr,function(j,imageHash){var thumb=jQuery("<img class='border' alt='' />");
thumbMarkup.append(thumb);
if(imageHash.imageLink&&!(isIpad&&window.ImageBlockWeblabs&&window.ImageBlockWeblabs.consolidated)){thumb.wrap("<a href='"+imageHash.imageLink+"'></a>");
}var src=(imageHash.isVideo&&options.useChromelessVideoPlayer&&options.useChildVideos)?options.staticImages.videoThumbIcon:imageHash.thumb;
thumb.attr("src",src);
return ++numAlts<options.maxAlts;
});
return numAlts<options.maxAlts;
});
}var script="<div> <script> ImageBlock.TwisterReArchModule.updateAltsImageMarkup("+options.alwaysIncludeVideo+"); <\/script></div>";
var markup=thumbMarkup.html()+script;
return markup;
};
var updateAltsImageMarkup=function(){var thumbnails;
if(options.alwaysIncludeVideo){thumbnails=jQuery(".thumbs").find(".border").mouseover(thumbMouseOver).mouseout(thumbMouseOut).click(thumbOnClick);
}else{thumbnails=jQuery(".thumbs").find("img").mouseover(thumbMouseOver).mouseout(thumbMouseOut).click(thumbOnClick);
}initializeThumbnails(thumbnails);
};
var getAltsImageMarkup=function(id,dpState){var c=utils.getColorFromState(dpState.getState()["selected_variations"]);
var noRefresh=false;
var html="";
if(c!=""&&c!=color){if(c&&(!colorImages[c]||colorImages[c]<=0)){c=defaultColor;
}color=c;
html=getAltsMarkup(c);
}else{noRefresh=true;
}return getDataHash(noRefresh,"thumbs-image",html);
};
self.getTwisterReArchApis=function(){return{getAltsImageMarkup:getAltsImageMarkup,updateAltsImageMarkup:updateAltsImageMarkup,updateMainImageMarkup:updateMainImageMarkup,getMainImageMarkup:getMainImageMarkup};
};
if(logMetrics){var logger=self.logger=new window.Softlines.ClientLogger("imageBlock",true);
logger.logKeyValuePair("BHeight",clientScreen.browserHeight);
logger.logKeyValuePair("BWidth",clientScreen.browserWidth);
var imageSize="size"+size;
logger.logSingleton(imageSize);
logger.logSingleton("imageSizeRequest");
if(options.autoplayVideo&&options.useChildVideos){var obj=options.colorToAsin[color];
if(obj&&obj.asin){videoAvailLogged[obj.asin]=1;
}logger.logHit("totalVideoAsin");
if(options.newVideoMissing){logger.logHit("videoMissing");
}else{logger.logHit("videoFound");
if(isIpad){logger.logHit("ipadVideoFound");
}else{if(isAndroid){logger.logHit("andVideoFound");
}}}var videoSet=utils.getVideos(color);
if(!utils.isArray(videoSet)){videoSet=[];
}if(videoSet.length>0){if(!isIpad&&!isAndroid){logger.logKeyValuePair("flashVideoReady",cfEndTimer);
logger.logKeyValuePair("playerLoaded",cfEndTimer);
logger.logKeyValuePair("html5VideoReady",cfEndTimer);
logger.logKeyValuePair("videoDownloaded",cfEndTimer);
}}}}if(!options.autoplayVideo&&colorImages[color][0].hiRes){var hiResImage=new Image();
hiResImage.src=colorImages[color][0].hiRes;
}if(typeof(magnifier)!="undefined"&&magnifier){magnifier.destroy();
}window.magnifier=null;
thumbnails.mouseover(thumbMouseOver);
if(isIpad){videoSizes=options.ipadVideoSizes;
}bindTwisterEvents();
if(options.useChromelessVideoPlayer){amznJQ.available("videoPlayer",onVideoPlayerLoaded);
}if(!options.autoplayVideo){updateMainImage(color,0);
loadMagnifier();
}}window.ImageBlock=ImageBlock;
amznJQ.declareAvailable("imageBlock");
});
});
var swfobject=function(){var D="undefined",r="object",S="Shockwave Flash",W="ShockwaveFlash.ShockwaveFlash",q="application/x-shockwave-flash",R="SWFObjectExprInst",x="onreadystatechange",O=window,j=document,t=navigator,T=false,U=[h],o=[],N=[],I=[],l,Q,E,B,J=false,a=false,n,G,m=true,M=function(){var aa=typeof j.getElementById!=D&&typeof j.getElementsByTagName!=D&&typeof j.createElement!=D,ah=t.userAgent.toLowerCase(),Y=t.platform.toLowerCase(),ae=Y?/win/.test(Y):/win/.test(ah),ac=Y?/mac/.test(Y):/mac/.test(ah),af=/webkit/.test(ah)?parseFloat(ah.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,X=!+"\v1",ag=[0,0,0],ab=null;
if(typeof t.plugins!=D&&typeof t.plugins[S]==r){ab=t.plugins[S].description;
if(ab&&!(typeof t.mimeTypes!=D&&t.mimeTypes[q]&&!t.mimeTypes[q].enabledPlugin)){T=true;
X=false;
ab=ab.replace(/^.*\s+(\S+\s+\S+$)/,"$1");
ag[0]=parseInt(ab.replace(/^(.*)\..*$/,"$1"),10);
ag[1]=parseInt(ab.replace(/^.*\.(.*)\s.*$/,"$1"),10);
ag[2]=/[a-zA-Z]/.test(ab)?parseInt(ab.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;
}}else{if(typeof O.ActiveXObject!=D){try{var ad=new ActiveXObject(W);
if(ad){ab=ad.GetVariable("$version");
if(ab){X=true;
ab=ab.split(" ")[1].split(",");
ag=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)];
}}}catch(Z){}}}return{w3:aa,pv:ag,wk:af,ie:X,win:ae,mac:ac};
}(),k=function(){if(!M.w3){return;
}if((typeof j.readyState!=D&&j.readyState=="complete")||(typeof j.readyState==D&&(j.getElementsByTagName("body")[0]||j.body))){f();
}if(!J){if(typeof j.addEventListener!=D){j.addEventListener("DOMContentLoaded",f,false);
}if(M.ie&&M.win){j.attachEvent(x,function(){if(j.readyState=="complete"){j.detachEvent(x,arguments.callee);
f();
}});
if(O==top){(function(){if(J){return;
}try{j.documentElement.doScroll("left");
}catch(X){setTimeout(arguments.callee,0);
return;
}f();
})();
}}if(M.wk){(function(){if(J){return;
}if(!/loaded|complete/.test(j.readyState)){setTimeout(arguments.callee,0);
return;
}f();
})();
}s(f);
}}();
function f(){if(J){return;
}try{var Z=j.getElementsByTagName("body")[0].appendChild(C("span"));
Z.parentNode.removeChild(Z);
}catch(aa){return;
}J=true;
var X=U.length;
for(var Y=0;
Y<X;
Y++){U[Y]();
}}function K(X){if(J){X();
}else{U[U.length]=X;
}}function s(Y){if(typeof O.addEventListener!=D){O.addEventListener("load",Y,false);
}else{if(typeof j.addEventListener!=D){j.addEventListener("load",Y,false);
}else{if(typeof O.attachEvent!=D){i(O,"onload",Y);
}else{if(typeof O.onload=="function"){var X=O.onload;
O.onload=function(){X();
Y();
};
}else{O.onload=Y;
}}}}}function h(){if(T){V();
}else{H();
}}function V(){var X=j.getElementsByTagName("body")[0];
var aa=C(r);
aa.setAttribute("type",q);
var Z=X.appendChild(aa);
if(Z){var Y=0;
(function(){if(typeof Z.GetVariable!=D){var ab=Z.GetVariable("$version");
if(ab){ab=ab.split(" ")[1].split(",");
M.pv=[parseInt(ab[0],10),parseInt(ab[1],10),parseInt(ab[2],10)];
}}else{if(Y<10){Y++;
setTimeout(arguments.callee,10);
return;
}}X.removeChild(aa);
Z=null;
H();
})();
}else{H();
}}function H(){var ag=o.length;
if(ag>0){for(var af=0;
af<ag;
af++){var Y=o[af].id;
var ab=o[af].callbackFn;
var aa={success:false,id:Y};
if(M.pv[0]>0){var ae=c(Y);
if(ae){if(F(o[af].swfVersion)&&!(M.wk&&M.wk<312)){w(Y,true);
if(ab){aa.success=true;
aa.ref=z(Y);
ab(aa);
}}else{if(o[af].expressInstall&&A()){var ai={};
ai.data=o[af].expressInstall;
ai.width=ae.getAttribute("width")||"0";
ai.height=ae.getAttribute("height")||"0";
if(ae.getAttribute("class")){ai.styleclass=ae.getAttribute("class");
}if(ae.getAttribute("align")){ai.align=ae.getAttribute("align");
}var ah={};
var X=ae.getElementsByTagName("param");
var ac=X.length;
for(var ad=0;
ad<ac;
ad++){if(X[ad].getAttribute("name").toLowerCase()!="movie"){ah[X[ad].getAttribute("name")]=X[ad].getAttribute("value");
}}P(ai,ah,Y,ab);
}else{p(ae);
if(ab){ab(aa);
}}}}}else{w(Y,true);
if(ab){var Z=z(Y);
if(Z&&typeof Z.SetVariable!=D){aa.success=true;
aa.ref=Z;
}ab(aa);
}}}}}function z(aa){var X=null;
var Y=c(aa);
if(Y&&Y.nodeName=="OBJECT"){if(typeof Y.SetVariable!=D){X=Y;
}else{var Z=Y.getElementsByTagName(r)[0];
if(Z){X=Z;
}}}return X;
}function A(){return !a&&F("6.0.65")&&(M.win||M.mac)&&!(M.wk&&M.wk<312);
}function P(aa,ab,X,Z){a=true;
E=Z||null;
B={success:false,id:X};
var ae=c(X);
if(ae){if(ae.nodeName=="OBJECT"){l=g(ae);
Q=null;
}else{l=ae;
Q=X;
}aa.id=R;
if(typeof aa.width==D||(!/%$/.test(aa.width)&&parseInt(aa.width,10)<310)){aa.width="310";
}if(typeof aa.height==D||(!/%$/.test(aa.height)&&parseInt(aa.height,10)<137)){aa.height="137";
}j.title=j.title.slice(0,47)+" - Flash Player Installation";
var ad=M.ie&&M.win?"ActiveX":"PlugIn",ac="MMredirectURL="+O.location.toString().replace(/&/g,"%26")+"&MMplayerType="+ad+"&MMdoctitle="+j.title;
if(typeof ab.flashvars!=D){ab.flashvars+="&"+ac;
}else{ab.flashvars=ac;
}if(M.ie&&M.win&&ae.readyState!=4){var Y=C("div");
X+="SWFObjectNew";
Y.setAttribute("id",X);
ae.parentNode.insertBefore(Y,ae);
ae.style.display="none";
(function(){if(ae.readyState==4){ae.parentNode.removeChild(ae);
}else{setTimeout(arguments.callee,10);
}})();
}u(aa,ab,X);
}}function p(Y){if(M.ie&&M.win&&Y.readyState!=4){var X=C("div");
Y.parentNode.insertBefore(X,Y);
X.parentNode.replaceChild(g(Y),X);
Y.style.display="none";
(function(){if(Y.readyState==4){Y.parentNode.removeChild(Y);
}else{setTimeout(arguments.callee,10);
}})();
}else{Y.parentNode.replaceChild(g(Y),Y);
}}function g(ab){var aa=C("div");
if(M.win&&M.ie){aa.innerHTML=ab.innerHTML;
}else{var Y=ab.getElementsByTagName(r)[0];
if(Y){var ad=Y.childNodes;
if(ad){var X=ad.length;
for(var Z=0;
Z<X;
Z++){if(!(ad[Z].nodeType==1&&ad[Z].nodeName=="PARAM")&&!(ad[Z].nodeType==8)){aa.appendChild(ad[Z].cloneNode(true));
}}}}}return aa;
}function u(ai,ag,Y){var X,aa=c(Y);
if(M.wk&&M.wk<312){return X;
}if(aa){if(typeof ai.id==D){ai.id=Y;
}if(M.ie&&M.win){var ah="";
for(var ae in ai){if(ai[ae]!=Object.prototype[ae]){if(ae.toLowerCase()=="data"){ag.movie=ai[ae];
}else{if(ae.toLowerCase()=="styleclass"){ah+=' class="'+ai[ae]+'"';
}else{if(ae.toLowerCase()!="classid"){ah+=" "+ae+'="'+ai[ae]+'"';
}}}}}var af="";
for(var ad in ag){if(ag[ad]!=Object.prototype[ad]){af+='<param name="'+ad+'" value="'+ag[ad]+'" />';
}}aa.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+ah+">"+af+"</object>";
N[N.length]=ai.id;
X=c(ai.id);
}else{var Z=C(r);
Z.setAttribute("type",q);
for(var ac in ai){if(ai[ac]!=Object.prototype[ac]){if(ac.toLowerCase()=="styleclass"){Z.setAttribute("class",ai[ac]);
}else{if(ac.toLowerCase()!="classid"){Z.setAttribute(ac,ai[ac]);
}}}}for(var ab in ag){if(ag[ab]!=Object.prototype[ab]&&ab.toLowerCase()!="movie"){e(Z,ab,ag[ab]);
}}aa.parentNode.replaceChild(Z,aa);
X=Z;
}}return X;
}function e(Z,X,Y){var aa=C("param");
aa.setAttribute("name",X);
aa.setAttribute("value",Y);
Z.appendChild(aa);
}function y(Y){var X=c(Y);
if(X&&X.nodeName=="OBJECT"){if(M.ie&&M.win){X.style.display="none";
(function(){if(X.readyState==4){b(Y);
}else{setTimeout(arguments.callee,10);
}})();
}else{X.parentNode.removeChild(X);
}}}function b(Z){var Y=c(Z);
if(Y){for(var X in Y){if(typeof Y[X]=="function"){Y[X]=null;
}}Y.parentNode.removeChild(Y);
}}function c(Z){var X=null;
try{X=j.getElementById(Z);
}catch(Y){}return X;
}function C(X){return j.createElement(X);
}function i(Z,X,Y){Z.attachEvent(X,Y);
I[I.length]=[Z,X,Y];
}function F(Z){var Y=M.pv,X=Z.split(".");
X[0]=parseInt(X[0],10);
X[1]=parseInt(X[1],10)||0;
X[2]=parseInt(X[2],10)||0;
return(Y[0]>X[0]||(Y[0]==X[0]&&Y[1]>X[1])||(Y[0]==X[0]&&Y[1]==X[1]&&Y[2]>=X[2]))?true:false;
}function v(ac,Y,ad,ab){if(M.ie&&M.mac){return;
}var aa=j.getElementsByTagName("head")[0];
if(!aa){return;
}var X=(ad&&typeof ad=="string")?ad:"screen";
if(ab){n=null;
G=null;
}if(!n||G!=X){var Z=C("style");
Z.setAttribute("type","text/css");
Z.setAttribute("media",X);
n=aa.appendChild(Z);
if(M.ie&&M.win&&typeof j.styleSheets!=D&&j.styleSheets.length>0){n=j.styleSheets[j.styleSheets.length-1];
}G=X;
}if(M.ie&&M.win){if(n&&typeof n.addRule==r){n.addRule(ac,Y);
}}else{if(n&&typeof j.createTextNode!=D){n.appendChild(j.createTextNode(ac+" {"+Y+"}"));
}}}function w(Z,X){if(!m){return;
}var Y=X?"visible":"hidden";
if(J&&c(Z)){c(Z).style.visibility=Y;
}else{v("#"+Z,"visibility:"+Y);
}}function L(Y){var Z=/[\\\"<>\.;]/;
var X=Z.exec(Y)!=null;
return X&&typeof encodeURIComponent!=D?encodeURIComponent(Y):Y;
}var d=function(){if(M.ie&&M.win){window.attachEvent("onunload",function(){var ac=I.length;
for(var ab=0;
ab<ac;
ab++){I[ab][0].detachEvent(I[ab][1],I[ab][2]);
}var Z=N.length;
for(var aa=0;
aa<Z;
aa++){y(N[aa]);
}for(var Y in M){M[Y]=null;
}M=null;
for(var X in swfobject){swfobject[X]=null;
}swfobject=null;
});
}}();
return{registerObject:function(ab,X,aa,Z){if(M.w3&&ab&&X){var Y={};
Y.id=ab;
Y.swfVersion=X;
Y.expressInstall=aa;
Y.callbackFn=Z;
o[o.length]=Y;
w(ab,false);
}else{if(Z){Z({success:false,id:ab});
}}},getObjectById:function(X){if(M.w3){return z(X);
}},embedSWF:function(ab,ah,ae,ag,Y,aa,Z,ad,af,ac){var X={success:false,id:ah};
if(M.w3&&!(M.wk&&M.wk<312)&&ab&&ah&&ae&&ag&&Y){w(ah,false);
K(function(){ae+="";
ag+="";
var aj={};
if(af&&typeof af===r){for(var al in af){aj[al]=af[al];
}}aj.data=ab;
aj.width=ae;
aj.height=ag;
var am={};
if(ad&&typeof ad===r){for(var ak in ad){am[ak]=ad[ak];
}}if(Z&&typeof Z===r){for(var ai in Z){if(typeof am.flashvars!=D){am.flashvars+="&"+ai+"="+Z[ai];
}else{am.flashvars=ai+"="+Z[ai];
}}}if(F(Y)){var an=u(aj,am,ah);
if(aj.id==ah){w(ah,true);
}X.success=true;
X.ref=an;
}else{if(aa&&A()){aj.data=aa;
P(aj,am,ah,ac);
return;
}else{w(ah,true);
}}if(ac){ac(X);
}});
}else{if(ac){ac(X);
}}},switchOffAutoHideShow:function(){m=false;
},ua:M,getFlashPlayerVersion:function(){return{major:M.pv[0],minor:M.pv[1],release:M.pv[2]};
},hasFlashPlayerVersion:F,createSWF:function(Z,Y,X){if(M.w3){return u(Z,Y,X);
}else{return undefined;
}},showExpressInstall:function(Z,aa,X,Y){if(M.w3&&A()){P(Z,aa,X,Y);
}},removeSWF:function(X){if(M.w3){y(X);
}},createCSS:function(aa,Z,Y,X){if(M.w3){v(aa,Z,Y,X);
}},addDomLoadEvent:K,addLoadEvent:s,getQueryParamValue:function(aa){var Z=j.location.search||j.location.hash;
if(Z){if(/\?/.test(Z)){Z=Z.split("?")[1];
}if(aa==null){return L(Z);
}var Y=Z.split("&");
for(var X=0;
X<Y.length;
X++){if(Y[X].substring(0,Y[X].indexOf("="))==aa){return L(Y[X].substring((Y[X].indexOf("=")+1)));
}}}return"";
},expressInstallCallback:function(){if(a){var X=c(R);
if(X&&l){X.parentNode.replaceChild(l,X);
if(Q){w(Q,true);
if(M.ie&&M.win){l.style.display="block";
}}if(E){E(B);
}}a=false;
}}};
}();
amznJQ.available("jQuery",function(){var $=jQuery;
var ALMOST_DONE_FRAC_LIMIT=0.99;
var BUFFER_DONE_FRAC_LIMIT=0.2;
var MIN_FLASH_VERSION="9.0.0";
var player_callbacks={};
var VideoBuffered="VideoPlayer.VideoBuffered";
var VideoEnded="VideoPlayer.VideoEnded";
var VideoPlay="VideoPlayer.VideoPlay";
var VideoFinishedDownload="VideoPlayer.VideoFinishedDownload";
var VideoError="VideoPlayer.VideoError";
var Html5VideoReadyMetrics="VideoPlayer.Html5VideoReadyMetrics";
var FlashVideoReadyMetrics="VideoPlayer.FlashVideoReadyMetrics";
var FlashPlayerLoadedMetrics="VideoPlayer.FlashPlayerLoadedMetrics";
var VideoNoFlashError="VideoPlayer.VideoNoFlashError";
var isMobile=navigator.userAgent.match(/Mobile/i);
var isIpad=navigator.userAgent.match(/ipad/i);
var isAndroid=navigator.userAgent.match(/cloud9|android|silk-accelerated/i);
var isIE=navigator.userAgent.match(/msie/i);
var videoReadyMetricsDone=0;
var boundHandlers={};
function bind(eventName,callback){var handlers=boundHandlers[eventName];
if(!handlers){handlers=boundHandlers[eventName]=[];
}handlers.push(callback);
}function trigger(eventName,videoPlayer){var handlers=boundHandlers[eventName];
if(!handlers){return;
}$.each(handlers,function(){this(videoPlayer);
});
}window.VideoPlayer=function(options){var defaults={loopVideo:false};
options=$.extend(defaults,options);
var self=this;
var loaded=false;
var useVideoTag=false;
var loading=null;
var container=null;
var innerVideoContainer=null;
var flash_object=null;
var videoObj=null;
var onload=null;
var loaded_url=null;
var isFadingOut=false;
var videoIsReady=false;
var videoLoaded=0;
var userWmode="opaque";
this.id=function(){return options.id;
};
this.load=function(url){onload=function(){self.load(url);
};
if(!loaded){return;
}handleLoad(url);
};
this.play=function(url){onload=function(){self.play(url);
};
if(!loaded){return;
}handleLoad(url);
if(useVideoTag){$(videoObj).show();
if(isAndroid){videoObj.load();
videoObj.play();
}$(videoObj).bind("canplaythrough",function(){if(isIpad){if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){innerVideoContainer.css("z-index",8);
}else{container.removeClass("hide");
}}videoObj.play();
window.videoReady(options.id);
});
$(videoObj).bind("loadeddata",function(){$(videoObj).css("opacity","");
});
if(videoObj.readyState<videoObj.HAVE_CURRENT_DATA){$(videoObj).css("opacity",0);
}if(videoObj.readyState>=videoObj.HAVE_ENOUGH_DATA){if(isIpad){if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){innerVideoContainer.css("z-index",8);
}else{container.removeClass("hide");
}}videoObj.play();
window.videoReady(options.id);
}}else{if(typeof flash_object.playVideo=="function"){try{flash_object.playVideo();
}catch(e){}}}};
this.resizeVideo=function(width,height){options.width=width;
options.height=height;
container.css({width:width+"px",height:height+"px"});
if(videoObj){$(videoObj).attr({width:options.width});
if(!isIE){$(videoObj).attr({height:options.height});
}}};
this.writePreplayHtml=function(){loading=$('<div class="loading">').appendTo(container);
slateImage=$('<div class="slateImage" style="z-index:5" ><img src="'+options.slateImageSrc+'" /></div>').appendTo(container);
innerVideoContainer=$("<div class='innerVideoContainer' style='height:100%;width:100%;position:absolute;top:0;left:0;z-index:8;'></div>").appendTo(container);
};
this.hide=function(){if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){innerVideoContainer.css("z-index",2);
}else{container.addClass("hide");
}if(!loaded){return;
}if(useVideoTag){videoObj.pause();
$(videoObj).stop(true,true);
isFadingOut=false;
}else{if(typeof flash_object.pauseVideo=="function"){try{flash_object.pauseVideo();
}catch(e){}}}};
player_callbacks[options.id]={videoPlayerLoaded:function(){if(flash_object&&!flash_object.playVideo){$(flash_object).remove();
load_flash_player();
return;
}loaded=true;
loaded_url=null;
videoIsReady=false;
if(onload){onload();
}},videoReady:function(){if(videoReadyMetricsDone==0){if(useVideoTag){trigger(Html5VideoReadyMetrics,self);
}else{trigger(FlashVideoReadyMetrics,self);
}videoReadyMetricsDone=1;
}loading.hide();
if(userWmode=="direct"||videoLoaded){if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){innerVideoContainer.css("z-index",8);
}else{container.removeClass("hide");
}}if(videoIsReady){return;
}videoIsReady=true;
trigger(VideoBuffered,self);
},videoPlay:function(){trigger(VideoPlay,self);
},videoComplete:function(){loaded_url=null;
trigger(VideoEnded,self);
},videoLoadingProgress:function(loadedFraction){if(loadedFraction>ALMOST_DONE_FRAC_LIMIT){trigger(VideoFinishedDownload,self);
}if(!videoLoaded&&loadedFraction>BUFFER_DONE_FRAC_LIMIT){if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){innerVideoContainer.css("z-index",8);
}else{container.removeClass("hide");
}videoLoaded=1;
}}};
function handleLoad(url){if(loaded_url!=url){videoIsReady=false;
if(useVideoTag){if(!/\.(mp4|m4v)$/.test(url)){loaded_url=url;
$(videoObj).trigger("error");
return;
}$(videoObj).unbind("loadeddata");
$(videoObj).unbind("canplaythrough");
if(videoObj.src==url&&videoObj.ended){videoIsReady=true;
videoObj.currentTime=0.01;
}else{videoObj.src=url;
videoObj.load();
}}else{if(typeof flash_object.loadVideo=="function"){try{flash_object.loadVideo(url);
}catch(e){}}}loaded_url=url;
}if(videoIsReady){videoIsReady=false;
window.videoReady(options.id);
}else{loading.show();
}}function load_flash_player(){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){var ffversion=new Number(RegExp.$1);
if(ffversion<4&&ffversion>=3){userWmode="direct";
}}if(swfobject.hasFlashPlayerVersion(MIN_FLASH_VERSION)){var flashvars={loop:options.loopVideo,buffer:4,player_id:options.id};
var params={allowScriptAccess:"always",wmode:userWmode,quality:"high",bgcolor:"#FFFFFF",menu:"false",allowfullscreen:"false"};
var attributes={id:"video_swf_"+options.id,name:"video_swf_"+options.id};
var placeholderID=options.id+"-placeholder";
if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){$("<div>").appendTo(innerVideoContainer).attr({id:placeholderID});
}else{$("<div>").appendTo(container).attr({id:placeholderID});
}swfobject.embedSWF(options.swf,placeholderID,"100%","100%",MIN_FLASH_VERSION,null,flashvars,params,attributes,function(e){if(e.success){flash_object=e.ref;
if($.browser.msie){setTimeout(function(){trigger(FlashPlayerLoadedMetrics,self);
},10);
}else{trigger(FlashPlayerLoadedMetrics,self);
}}else{trigger(VideoError,self);
}});
self.enabled=true;
}else{trigger(VideoNoFlashError,self);
}}function isChromeBrowser(){return navigator.userAgent.search(/chrome/i)!=-1;
}function initialize(){container=$("#"+options.id);
self.resizeVideo(options.width,options.height);
if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){self.writePreplayHtml();
innerVideoContainer.css("z-index",2);
}else{container.addClass("hide");
loading=$('<div class="loading">').appendTo(container);
}var videoElem=$("<video>");
if((true==isChromeBrowser())||(!videoElem.get(0).play)){load_flash_player();
return;
}useVideoTag=true;
videoObj=videoElem.get(0);
videoElem.attr({width:options.width});
if(!isIE){videoElem.attr({height:options.height});
}videoElem.bind("error",function(){useVideoTag=false;
loaded=false;
loaded_url=null;
videoElem.unbind("error ended waiting timeupdate loadeddata canplaythrough").remove();
load_flash_player();
});
videoElem.bind("progress",function(){var ranges=videoObj.buffered;
var loaded=0;
if(ranges.length>0&&ranges.start(0)==0){loaded=ranges.end(0);
}window.videoLoadingProgress(options.id,loaded,videoObj.duration);
});
videoElem.bind("play",function(){window.videoPlay(options.id);
});
videoElem.bind("ended",function(){window.videoComplete(options.id);
});
if(!isMobile){videoElem.bind("timeupdate",function(){if(isFadingOut){return;
}var fadeOutTime=0.75;
var timeRemaining=this.duration-this.currentTime;
if(timeRemaining<fadeOutTime){isFadingOut=true;
videoElem.fadeOut(timeRemaining*1000,function(){isFadingOut=false;
});
}});
}if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){innerVideoContainer.append(videoElem);
}else{container.append(videoElem);
}self.enabled=true;
if(isMobile){VideoPlayer.videoOnLanding=false;
}window.videoPlayerLoaded(options.id);
}initialize();
};
window.VideoPlayer.bindBuffered=function(callback){bind(VideoBuffered,callback);
};
window.VideoPlayer.bindEnded=function(callback){bind(VideoEnded,callback);
};
window.VideoPlayer.bindPlay=function(callback){bind(VideoPlay,callback);
};
window.VideoPlayer.bindFinishedDownload=function(callback){bind(VideoFinishedDownload,callback);
};
window.VideoPlayer.bindError=function(callback){bind(VideoError,callback);
};
window.VideoPlayer.bindNoFlashError=function(callback){bind(VideoNoFlashError,callback);
};
window.VideoPlayer.bindHtml5Ready=function(callback){bind(Html5VideoReadyMetrics,callback);
};
window.VideoPlayer.bindFlashReady=function(callback){bind(FlashVideoReadyMetrics,callback);
};
window.VideoPlayer.bindPlayerLoaded=function(callback){bind(FlashPlayerLoadedMetrics,callback);
};
window.VideoPlayer.videoOnLanding=true;
window.videoPlayerLoaded=function(id){player_callbacks[id].videoPlayerLoaded();
};
window.videoReady=function(id){player_callbacks[id].videoReady();
};
window.videoComplete=function(id){player_callbacks[id].videoComplete();
};
window.videoPlay=function(id){player_callbacks[id].videoPlay();
};
window.videoLoadingProgress=function(id,bytesLoaded,bytesTotal){player_callbacks[id].videoLoadingProgress(bytesLoaded/bytesTotal);
};
amznJQ.declareAvailable("videoPlayer");
});
(function($){function hoverZoomBoundInDPX(){var b={left:Infinity,top:Infinity,right:-Infinity,bottom:-Infinity};
b.top=$("#centerCol").offset().top;
b.left=$("#centerCol").offset().left;
b.right=b.left+$("#centerCol").outerWidth();
b.bottom=$("#centerCol").outerHeight()+b.top;
return b;
}function hoverZoomBound(){var b={left:Infinity,top:Infinity,right:-Infinity,bottom:-Infinity};
b.top=$("#handleBuy").offset().top;
b.left=$(".productImageGrid").offset().left+$(".productImageGrid").outerWidth()+parseInt($(".productImageGrid").css("marginRight"));
b.right=$(".buyingDetailsGrid").offset().left-parseInt($(".buyingDetailsGrid").css("marginLeft"))+10;
b.bottom=$("hr.bucketDivider").offset().top-5;
return b;
}function parseMediaServerCodes(url){var m=url.match(/\._((\w|,|\.)+)_\.(gif|jpg|png)$/i);
var codes={};
if(m){var mediaServerCodes=m[1].split("_");
for(var i=0;
i<mediaServerCodes.length;
i++){var m2=mediaServerCodes[i].match(/^([A-Z]+)(\d+(\.\d+)?)$/);
if(m2){codes[m2[1]]=Number(m2[2]);
}}}return codes;
}$.fn.amazonMagnifier=function(options){var navImage=this;
var defaultOptions={adjustment:[0,0,0,0],detailImageUrl:navImage.attr("rel"),location:"over",locationElement:navImage,prelaod:"ready",zIndex:50};
options=$.extend(defaultOptions,options);
var zoomWindow=null;
var lens=null;
var cursorAt=null;
var navImageRect=null;
var preloaded={"null":1,"":1,"undefined":1};
var engaged=false;
var magnifierSuppressed=false;
var currentDetailImageUrl=options.detailImageUrl;
var isIE6=jQuery.browser.msie&&parseInt(jQuery.browser.version)<=6;
var hiddenSelects;
var hoverZoomIpad=options.useHoverZoomIpad||0;
var hoverOnLoad=0;
var urlsLogged={};
var Lens=function(){var self=this;
var size=[0,0];
var zoomRatio=(zoomWindow.detailSize&&zoomWindow.detailSize[0]||500000000)/navImageRect[2];
var zoomHtRatio=(zoomWindow.detailSize&&zoomWindow.detailSize[1]||500000000)/navImageRect[3];
if(zoomHtRatio>zoomRatio){zoomRatio=zoomHtRatio;
}var jq=$("<div id='magnifierLens' />").css({backgroundImage:"url("+options.generalImageUrls.zoomLensBackground+")",position:"absolute",cursor:"pointer"});
function updateSize(ratio){var width=Math.round(Math.min(navImage.width(),zoomWindow.rect.width/ratio));
var height=Math.round(Math.min(navImage.height(),zoomWindow.rect.height/ratio));
jq.css({width:width,height:height});
size=[width,height];
}self.updatePosition=function(){var range=[navImageRect[2]-size[0],navImageRect[3]-size[1]];
var u=range[0]<=0?0.5:Math.max(0,Math.min(1,(cursorAt[0]-size[0]/2-navImageRect[0]-self.offset.left)/range[0]));
var v=range[1]<=0?0.5:Math.max(0,Math.min(1,(cursorAt[1]-size[1]/2-navImageRect[1]-self.offset.top)/range[1]));
var x=navImageRect[0]+Math.round(u*range[0]);
var y=navImageRect[1]+Math.round(v*range[1]);
jq.get(0).style.left=x+"px";
jq.get(0).style.top=y+"px";
return[u,v];
};
self.destroy=function(){jq.remove();
};
self.offset=navImage.offsetParent().offset();
updateSize(zoomRatio);
self.updatePosition();
jq.appendTo(navImage.parent());
if(!zoomWindow.detailImage[0].complete){zoomWindow.detailImage.load(function(){var zoomRatio=zoomWindow.detailImage.width()/navImageRect[2];
updateSize(zoomRatio);
self.updatePosition();
});
}};
Lens.preload=function(){navImage.preload(options.generalImageUrls.lensBackgroundUrl);
};
var ZoomWindow=function(){var zw=this;
var adjustment=options.adjustment;
var cropWindow=$("<div id='zoomWindow' />").css({overflow:"hidden",position:"absolute",backgroundColor:"white",zIndex:options.zIndex});
function fit(){var rect=null;
if(options.location=="over"){if($("#ppd #centerCol").length>0){rect=hoverZoomBoundInDPX();
}else{if($(".productImageGrid").length>0){rect=hoverZoomBound();
}else{rect.left=0;
rect.right=0;
}}}else{if(options.location=="right"){var o=navImage.offset();
rect={left:o.left+navImage.outerWidth(),top:o.top,right:o.left+navImage.outerWidth()+400,bottom:o.top+400};
}}if(options.minHeightElement){rect.bottom=Math.max(rect.bottom,rect.top+$(options.minHeightElement).outerHeight());
}rect.bottom=Math.min(rect.bottom,$(window).scrollTop()+$(window).height());
rect.left+=adjustment[0];
rect.top+=adjustment[1];
rect.right+=adjustment[2];
rect.bottom+=adjustment[3];
rect.width=rect.right-rect.left;
rect.height=rect.bottom-rect.top;
cropWindow.css({left:rect.left,top:rect.top,width:rect.width,height:rect.height});
zw.rect=rect;
return zw;
}function updateDetailSize(img){var imageObj=new Image();
imageObj.src=img.attr("src");
if(imageObj.complete&&imageObj.width>0&&imageObj.height>0){zw.detailSize=[imageObj.width,imageObj.height];
return;
}else{if(options.detailImageSize){zw.detailSize=options.detailImageSize;
return;
}}var codes=parseMediaServerCodes(imageObj.src);
var aspectRatio=navImageRect[2]/navImageRect[3];
if(codes["SS"]||codes["AA"]){var size=codes["SS"]||codes["AA"];
zw.detailSize=[size,size];
}else{if(codes["SX"]){zw.detailSize=[codes["SX"],Math.round(codes["SX"]/aspectRatio)];
}else{if(codes["SY"]){zw.detailSize=[Math.round(codes["SY"]*aspectRatio),codes["SY"]];
}else{if(codes["SL"]){if(aspectRatio>=1){zw.detailSize=[codes["SL"],Math.round(codes["SL"]/aspectRatio)];
}else{zw.detailSize=[Math.round(codes["SL"]*aspectRatio),codes["SL"]];
}}else{zw.detailSize=[0,0];
imageObj.onload=function(){zw.detailSize=[imageObj.width,imageObj.height];
updateDetailPosition();
$(window).resize();
};
}}}}}zw.updateImage=function(src){var img=$("<img id='detailImg' src='"+src+"'/>").css("position","absolute");
zw.detailImage&&zw.detailImage.remove();
cropWindow.append(img);
$(document).trigger("updated.magnifier");
zw.detailImage=img;
updateDetailSize(zw.detailImage);
};
zw.refit=function(){fit();
updateDetailSize(zw.detailImage);
return zw;
};
zw.show=function(){cropWindow.show();
return zw;
};
zw.hide=function(){cropWindow.hide();
return zw;
};
zw.destroy=function(){cropWindow.remove();
return zw;
};
zw.updateImage(currentDetailImageUrl);
fit();
cropWindow.appendTo(document.body);
};
function updateDetailPosition(){var pos=lens&&lens.updatePosition();
if(pos&&zoomWindow.detailSize){var range=[zoomWindow.detailSize[0]-zoomWindow.rect.width,zoomWindow.detailSize[1]-zoomWindow.rect.height];
zoomWindow.detailImage.get(0).style.left=-(pos[0]*range[0])+"px";
zoomWindow.detailImage.get(0).style.top=-(pos[1]*range[1])+"px";
}}function locateCursor(e){var touch=hoverZoomIpad?(e.originalEvent.touches[0]||e.originalEvent.changedTouches[0]):"";
cursorAt=hoverZoomIpad?[touch.pageX,touch.pageY]:[e.pageX,e.pageY];
}function onMouseMove(e){if(hoverZoomIpad){e.preventDefault();
}locateCursor(e);
var offset=lens?lens.offset:navImage.offsetParent().offset();
if(cursorAt[0]<navImageRect[0]+offset.left||cursorAt[1]<navImageRect[1]+offset.top||cursorAt[0]>=navImageRect[0]+navImageRect[2]+offset.left||cursorAt[1]>=navImageRect[1]+navImageRect[3]+offset.top){disengage();
}updateDetailPosition();
}function hideSelects(){var selects=jQuery(options.locationElement).find("select:visible");
if(isIE6||jQuery.browser.safari){hiddenSelects=selects.hide();
}else{selects.blur();
}}function showSelects(){hiddenSelects&&hiddenSelects.show();
}function disengage(){if(!engaged){return;
}if($.browser.msie){$("#main-image-widget .holder.video").show();
}showSelects();
zoomWindow&&zoomWindow.hide();
if(lens){lens.destroy();
lens=null;
}engaged=false;
bindEvents();
if(hoverZoomIpad){if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){navImage.unbind("touchmove.magnifier touchend.magnifier");
}else{navImage.unbind("touchmove.magnifier touchstart.magnifier touchend.magnifier");
}$(document).trigger("disengaged.magnifier");
}else{$(document).unbind("mousemove.magnifier").trigger("disengaged.magnifier");
}}function engage(e){if(engaged||magnifierSuppressed){return;
}if(options.logMetrics){if(hoverOnLoad==0){if(window.ue){var hoverEngageTime=new Date();
var timeDiff=hoverEngageTime-window.ue.t0;
jQuery.imageBlock.logger.logKeyValuePair("hoverTime",timeDiff);
}hoverOnLoad=1;
}if(!urlsLogged[currentDetailImageUrl]){jQuery.imageBlock.logger.logHit("hoverMain");
urlsLogged[currentDetailImageUrl]=1;
}}navImageRect=[navImage.position().left,navImage.position().top,navImage.width(),navImage.height()];
if($.browser.msie){$("#main-image-widget .holder.video").hide();
}if(currentDetailImageUrl){if($.browser.msie&&!$.isReady){$("#main-image-widget .holder.video").show();
return;
}hideSelects();
locateCursor(e);
if(zoomWindow){zoomWindow.refit().show();
}else{zoomWindow=new ZoomWindow();
}lens=lens||new Lens();
updateDetailPosition();
}engaged=true;
if(hoverZoomIpad){if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){navImage.unbind("touchmove.magnifier").bind("touchmove.magnifier",onMouseMove);
}else{navImage.unbind("touchstart.magnifier touchmove.magnifier").bind("touchmove.magnifier",onMouseMove);
}$(document).trigger("engaged.magnifier");
}else{navImage.unbind("mousemove.magnifier");
$(document).trigger("engaged.magnifier").bind("mousemove.magnifier",onMouseMove);
}}function bindEvents(){if(options.useHoverZoom){if(hoverZoomIpad){if(window.ImageBlockWeblabs&&window.ImageBlockWeblabs.swipe){amznJQ.available("swipe-gesture",function(){navImage.unbind("touchstart");
disengage();
navImage.taphold(function(e){engage(e);
navImage.bind("touchmove.magnifier",engage);
navImage.bind("touchend.magnifier",disengage);
},200);
});
}else{navImage.bind("touchstart.magnifier touchmove.magnifier",engage);
}}else{navImage.bind("mousemove.magnifier",engage);
}}}navImage.preload=function(urls){var urlArray=$.makeArray(urls);
var length=urlArray.length;
for(var i=0;
i<length;
i++){if(urlArray[i] instanceof Array){navImage.preload(urlArray[i]);
}else{if(typeof urlArray[i]=="string"&&urlArray[i]&&!preloaded[urlArray[i]]){preloaded[urlArray[i]]=new Image();
preloaded[urlArray[i]].src=urlArray[i];
}}}};
navImage.changeImage=function(navImageUrl,detailImageUrl,width,height){if(engaged){disengage();
}currentDetailImageUrl=detailImageUrl;
navImage.attr("src",navImageUrl);
if(typeof width==="undefined"){width="";
}if(typeof height==="undefined"){height="";
}navImage.css("width",width);
navImage.css("height",height);
if($.browser.msie){navImage.get(0).className=navImage.get(0).className;
}navImage.preload(navImageUrl);
navImageRect=[navImage.position().left,navImage.position().top,navImage.width(),navImage.height()];
if(detailImageUrl){if(options.preload=="immediately"){navImage.preload(detailImageUrl,true);
}else{$(window).ready(function(){navImage.preload(detailImageUrl);
});
}if(zoomWindow){zoomWindow.updateImage(detailImageUrl);
}else{navImage.attr("rel",detailImageUrl);
}}};
navImage.destroy=function(){lens&&lens.destroy();
lens=null;
zoomWindow&&zoomWindow.destroy();
zoomWindow=null;
};
navImage.detailImage=function(){return zoomWindow.detailImage;
};
navImage.suppressMagnifier=function(suppress){magnifierSuppressed=suppress;
};
navImage.isEngaged=function(){return engaged;
};
navImage.engageMagnifier=engage;
navImage.disengageMagnifier=disengage;
navImage[0].complete?bindEvents():navImage.one("load",bindEvents);
navImage.preload(this.attr("src"));
if(options.preload){var url=options.detailImageUrl;
var preloadMagnifier=function(){navImage.preload(url,true);
Lens.preload();
};
var eventNames=options.preload;
if(eventNames.constructor!=Array){eventNames=[eventNames];
}for(var i=0;
i<eventNames.length;
i++){if(eventNames[i]=="immediately"){preloadMagnifier();
}else{if($(window)[eventNames[i]]){$(window)[eventNames[i]](preloadMagnifier);
}else{$(window).bind(eventNames[i],preloadMagnifier);
}}}}if(!hoverZoomIpad){$(window).bind("resize.magnifier",navImage.destroy);
}return navImage;
};
amznJQ.declareAvailable("imageMagnifier");
})(jQuery);
