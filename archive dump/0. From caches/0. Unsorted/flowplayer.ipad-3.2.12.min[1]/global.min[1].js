;var Kinetic={};(function(){Kinetic={version:"4.7.2",stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:undefined,UA:function(){var a=navigator.userAgent.toLowerCase(),b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}}(),Filters:{},Node:function(a){this._init(a)},Shape:function(a){this.__init(a)},Container:function(a){this.__init(a)},Stage:function(a){this.___init(a)},Layer:function(a){this.___init(a)},Group:function(a){this.___init(a)},isDragging:function(){var a=Kinetic.DD;return a?a.isDragging:!1},isDragReady:function(){var a=Kinetic.DD;return a?!!a.node:!1},_addId:function(a,b){b!==undefined&&(this.ids[b]=a)},_removeId:function(a){a!==undefined&&delete this.ids[a]},_addName:function(a,b){b!==undefined&&(this.names[b]===undefined&&(this.names[b]=[]),this.names[b].push(a))},_removeName:function(a,b){if(a!==undefined){var c=this.names[a];if(c!==undefined){for(var d=0;d<c.length;d++){var e=c[d];e._id===b&&c.splice(d,1)}c.length===0&&delete this.names[a]}}}}})(),function(a,b){typeof exports=="object"?module.exports=b():typeof define=="function"&&define.amd?define(b):a.returnExports=b()}(this,function(){return Kinetic}),function(){Kinetic.Collection=function(){var a=[].slice.call(arguments),b=a.length,c=0;this.length=b;for(;c<b;c++)this[c]=a[c];return this},Kinetic.Collection.prototype=[],Kinetic.Collection.prototype.each=function(a){for(var b=0;b<this.length;b++)a(this[b],b)},Kinetic.Collection.prototype.toArray=function(){var a=[],b=this.length,c;for(c=0;c<b;c++)a.push(this[c]);return a},Kinetic.Collection.toCollection=function(a){var b=new Kinetic.Collection,c=a.length,d;for(d=0;d<c;d++)b.push(a[d]);return b},Kinetic.Collection.mapMethods=function(a){var b=a.length,c;for(c=0;c<b;c++)(function(b){var c=a[b];Kinetic.Collection.prototype[c]=function(){var a=this.length,b;args=[].slice.call(arguments);for(b=0;b<a;b++)this[b][c].apply(this[b],args)}})(c)},Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]},Kinetic.Transform.prototype={translate:function(a,b){this.m[4]+=this.m[0]*a+this.m[2]*b,this.m[5]+=this.m[1]*a+this.m[3]*b},scale:function(a,b){this.m[0]*=a,this.m[1]*=a,this.m[2]*=b,this.m[3]*=b},rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=this.m[0]*b+this.m[2]*c,e=this.m[1]*b+this.m[3]*c,f=this.m[0]*-c+this.m[2]*b,g=this.m[1]*-c+this.m[3]*b;this.m[0]=d,this.m[1]=e,this.m[2]=f,this.m[3]=g},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},skew:function(a,b){var c=this.m[0]+this.m[2]*b,d=this.m[1]+this.m[3]*b,e=this.m[2]+this.m[0]*a,f=this.m[3]+this.m[1]*a;this.m[0]=c,this.m[1]=d,this.m[2]=e,this.m[3]=f},multiply:function(a){var b=this.m[0]*a.m[0]+this.m[2]*a.m[1],c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],e=this.m[1]*a.m[2]+this.m[3]*a.m[3],f=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],g=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},invert:function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=this.m[3]*a,c=-this.m[1]*a,d=-this.m[2]*a,e=this.m[0]*a,f=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),g=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g},getMatrix:function(){return this.m},setAbsolutePosition:function(a,b){var c=this.m[0],d=this.m[1],e=this.m[2],f=this.m[3],g=this.m[4],h=this.m[5],i=(c*(b-h)-d*(a-g))/(c*f-d*e),j=(a-g-e*i)/c;this.translate(j,i)}};var a="canvas",b="2d",c="[object Array]",d="[object Number]",e="[object String]",f=Math.PI/180,g=180/Math.PI,h="#",i="",j="0",k="Kinetic warning: ",l="Kinetic error: ",m="rgb(",n={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},o=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(a){return!!a&&a.nodeType==1},_isFunction:function(a){return!!(a&&a.constructor&&a.call&&a.apply)},_isObject:function(a){return!!a&&a.constructor==Object},_isArray:function(a){return Object.prototype.toString.call(a)==c},_isNumber:function(a){return Object.prototype.toString.call(a)==d},_isString:function(a){return Object.prototype.toString.call(a)==e},_hasMethods:function(a){var b=[],c;for(c in a)this._isFunction(a[c])&&b.push(c);return b.length>0},_isInDocument:function(a){while(a=a.parentNode)if(a==document)return!0;return!1},_simplifyArray:function(a){var b=[],c=a.length,d=Kinetic.Util,e,f;for(e=0;e<c;e++)f=a[e],d._isNumber(f)?f=Math.round(f*1e3)/1e3:d._isString(f)||(f=f.toString()),b.push(f);return b},_getXY:function(a){if(this._isNumber(a))return{x:a,y:a};if(this._isArray(a)){if(a.length===1){var b=a[0];if(this._isNumber(b))return{x:b,y:b};if(this._isArray(b))return{x:b[0],y:b[1]};if(this._isObject(b))return b}else if(a.length>=2)return{x:a[0],y:a[1]}}else if(this._isObject(a))return a;return null},_getSize:function(a){if(this._isNumber(a))return{width:a,height:a};if(this._isArray(a))if(a.length===1){var b=a[0];if(this._isNumber(b))return{width:b,height:b};if(this._isArray(b)){if(b.length>=4)return{width:b[2],height:b[3]};if(b.length>=2)return{width:b[0],height:b[1]}}else if(this._isObject(b))return b}else{if(a.length>=4)return{width:a[2],height:a[3]};if(a.length>=2)return{width:a[0],height:a[1]}}else if(this._isObject(a))return a;return null},_getPoints:function(a){var b=[],c,d;if(a===undefined)return[];d=a.length;if(this._isArray(a[0])){for(c=0;c<d;c++)b.push({x:a[c][0],y:a[c][1]});return b}if(this._isObject(a[0]))return a;for(c=0;c<d;c+=2)b.push({x:a[c],y:a[c+1]});return b},_getImage:function(c,d){var e,f,g,h;c?this._isElement(c)?d(c):this._isString(c)?(e=new Image,e.onload=function(){d(e)},e.src=c):c.data?(f=document.createElement(a),f.width=c.width,f.height=c.height,_context=f.getContext(b),_context.putImageData(c,0,0),h=f.toDataURL(),e=new Image,e.onload=function(){d(e)},e.src=h):d(null):d(null)},_rgbToHex:function(a,b,c){return((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)},_hexToRgb:function(a){a=a.replace(h,i);var b=parseInt(a,16);return{r:b>>16&255,g:b>>8&255,b:b&255}},getRandomColor:function(){var a=(Math.random()*16777215<<0).toString(16);while(a.length<6)a=j+a;return h+a},get:function(a,b){return a===undefined?b:a},getRGB:function(a){var b;return a in n?(b=n[a],{r:b[0],g:b[1],b:b[2]}):a[0]===h?this._hexToRgb(a.substring(1)):a.substr(0,4)===m?(b=o.exec(a.replace(/ /g,"")),{r:parseInt(b[1],10),g:parseInt(b[2],10),b:parseInt(b[3],10)}):{r:0,g:0,b:0}},_merge:function(a,b){var c=this._clone(b);for(var d in a)this._isObject(a[d])?c[d]=this._merge(a[d],c[d]):c[d]=a[d];return c},_clone:function(a){var b={};for(var c in a)this._isObject(a[c])?b[c]=this._clone(a[c]):b[c]=a[c];return b},_degToRad:function(a){return a*f},_radToDeg:function(a){return a*g},_capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},error:function(a){throw new Error(l+a)},warn:function(a){window.console&&console.warn&&console.warn(k+a)},extend:function(a,b){for(var c in b.prototype)c in a.prototype||(a.prototype[c]=b.prototype[c])},addMethods:function(a,b){var c;for(c in b)a.prototype[c]=b[c]},_getControlPoints:function(a,b,c,d){var e=a.x,f=a.y,g=b.x,h=b.y,i=c.x,j=c.y,k=Math.sqrt(Math.pow(g-e,2)+Math.pow(h-f,2)),l=Math.sqrt(Math.pow(i-g,2)+Math.pow(j-h,2)),m=d*k/(k+l),n=d*l/(k+l),o=g-m*(i-e),p=h-m*(j-f),q=g+n*(i-e),r=h+n*(j-f);return[{x:o,y:p},{x:q,y:r}]},_expandPoints:function(a,b){var c=a.length,d=[],e,f;for(e=1;e<c-1;e++)f=Kinetic.Util._getControlPoints(a[e-1],a[e],a[e+1],b),d.push(f[0]),d.push(a[e]),d.push(f[1]);return d},_removeLastLetter:function(a){return a.substring(0,a.length-1)}}}(),function(){var a=document.createElement("canvas"),b=a.getContext("2d"),c=window.devicePixelRatio||1,d=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1,e=1;Kinetic.Canvas=function(a){this.init(a)},Kinetic.Canvas.prototype={init:function(a){a=a||{};var b=a.pixelRatio||Kinetic.pixelRatio||e;this.pixelRatio=b,this._canvas=document.createElement("canvas"),this._canvas.style.padding=0,this._canvas.style.margin=0,this._canvas.style.border=0,this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top=0,this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(a){this.pixelRatio=a,this.setSize(this.getWidth(),this.getHeight())},setWidth:function(a){this.width=this._canvas.width=a*this.pixelRatio,this._canvas.style.width=a+"px"},setHeight:function(a){this.height=this._canvas.height=a*this.pixelRatio,this._canvas.style.height=a+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(a,b){this.setWidth(a),this.setHeight(b)},toDataURL:function(a,b){try{return this._canvas.toDataURL(a,b)}catch(c){try{return this._canvas.toDataURL()}catch(d){return Kinetic.Util.warn("Unable to get data URL. "+d.message),""}}}},Kinetic.SceneCanvas=function(a){a=a||{};var b=a.width||0,c=a.height||0;Kinetic.Canvas.call(this,a),this.context=new Kinetic.SceneContext(this),this.setSize(b,c)},Kinetic.SceneCanvas.prototype={setWidth:function(a){var b=this.pixelRatio,c=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,a),c.scale(b,b)},setHeight:function(a){var b=this.pixelRatio,c=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,a),c.scale(b,b)}},Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas),Kinetic.HitCanvas=function(a){a=a||{};var b=a.width||0,c=a.height||0;Kinetic.Canvas.call(this,a),this.context=new Kinetic.HitContext(this),this.setSize(b,c)},Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)}(),function(){var a=",",b="(",c=")",d="([",e="])",f=";",g="()",h="",i="=",j="set",k=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","fill","fillText","getImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"];Kinetic.Context=function(a){this.init(a)},Kinetic.Context.prototype={init:function(a){this.canvas=a,this._context=a._canvas.getContext("2d"),Kinetic.enableTrace&&(this.traceArr=[],this._enableTrace())},fillShape:function(a){a.getFillEnabled()&&this._fill(a)},strokeShape:function(a){a.getStrokeEnabled()&&this._stroke(a)},fillStrokeShape:function(a){var b=a.getFillEnabled();b&&this._fill(a),a.getStrokeEnabled()&&this._stroke(a)},getTrace:function(h){var j=this.traceArr,k=j.length,l="",m,n,o,p;for(m=0;m<k;m++)n=j[m],o=n.method,o?(p=n.args,l+=o,h?l+=g:Kinetic.Util._isArray(p[0])?l+=d+p.join(a)+e:l+=b+p.join(a)+c):(l+=n.property,h||(l+=i+n.val)),l+=f;return l},clearTrace:function(){this.traceArr=[]},_trace:function(a){var b=this.traceArr,c;b.push(a),c=b.length,c>=Kinetic.traceArrMax&&b.shift()},reset:function(){var a=this.getCanvas().getPixelRatio();this.setTransform(1*a,0,0,1*a,0,0)},getCanvas:function(){return this.canvas},clear:function(){var a=[].slice.call(arguments),b=this.getCanvas(),c,d;a.length?(c=Kinetic.Util._getXY(a),d=Kinetic.Util._getSize(a),this.clearRect(c.x||0,c.y||0,d.width,d.height)):this.clearRect(0,0,b.getWidth(),b.getHeight())},_applyLineCap:function(a){var b=a.getLineCap();b&&this.setAttr("lineCap",b)},_applyOpacity:function(a){var b=a.getAbsoluteOpacity();b!==1&&this.setAttr("globalAlpha",b)},_applyLineJoin:function(a){var b=a.getLineJoin();b&&this.setAttr("lineJoin",b)},_applyAncestorTransforms:function(a){var b=a.getAbsoluteTransform().getMatrix();this.transform(b[0],b[1],b[2],b[3],b[4],b[5])},_clip:function(a){var b=a.getClipX()||0,c=a.getClipY()||0,d=a.getClipWidth(),e=a.getClipHeight();this.save(),this._applyAncestorTransforms(a),this.beginPath(),this.rect(b,c,d,e),this.clip(),this.reset(),a._drawChildren(this.getCanvas()),this.restore()},setAttr:function(a,b){this._context[a]=b},arc:function(){var a=arguments;this._context.arc(a[0],a[1],a[2],a[3],a[4],a[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var a=arguments;this._context.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])},clearRect:function(){var a=arguments;this._context.clearRect(a[0],a[1],a[2],a[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createLinearGradient:function(){var a=arguments;return this._context.createLinearGradient(a[0],a[1],a[2],a[3])},createPattern:function(){var a=arguments;return this._context.createPattern(a[0],a[1])},createRadialGradient:function(){var a=arguments;return this._context.createRadialGradient(a[0],a[1],a[2],a[3],a[4],a[5])},drawImage:function(){var a=arguments,b=this._context;a.length===3?b.drawImage(a[0],a[1],a[2]):a.length===5?b.drawImage(a[0],a[1],a[2],a[3],a[4]):a.length===9&&b.drawImage(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},fill:function(){this._context.fill()},fillText:function(){var a=arguments;this._context.fillText(a[0],a[1],a[2])},getImageData:function(){var a=arguments;return this._context.getImageData(a[0],a[1],a[2],a[3])},lineTo:function(){var a=arguments;this._context.lineTo(a[0],a[1])},moveTo:function(){var a=arguments;this._context.moveTo(a[0],a[1])},rect:function(){var a=arguments;this._context.rect(a[0],a[1],a[2],a[3])},putImageData:function(){var a=arguments;this._context.putImageData(a[0],a[1],a[2])},quadraticCurveTo:function(){var a=arguments;this._context.quadraticCurveTo(a[0],a[1],a[2],a[3])},restore:function(){this._context.restore()},rotate:function(){var a=arguments;this._context.rotate(a[0])},save:function(){this._context.save()},scale:function(){var a=arguments;this._context.scale(a[0],a[1])},setLineDash:function(){var a=arguments,b=this._context;this._context.setLineDash?b.setLineDash(a[0]):"mozDash"in b?b.mozDash=a[0]:"webkitLineDash"in b&&(b.webkitLineDash=a[0])},setTransform:function(){var a=arguments;this._context.setTransform(a[0],a[1],a[2],a[3],a[4],a[5])},stroke:function(){this._context.stroke()},strokeText:function(){var a=arguments;this._context.strokeText(a[0],a[1],a[2])},transform:function(){var a=arguments;this._context.transform(a[0],a[1],a[2],a[3],a[4],a[5])},translate:function(){var a=arguments;this._context.translate(a[0],a[1])},_enableTrace:function(){var a=this,b=k.length,c=Kinetic.Util._simplifyArray,d=this.setAttr,e,f;for(e=0;e<b;e++)(function(b){var d=a[b],e;a[b]=function(){return f=c(Array.prototype.slice.call(arguments,0)),e=d.apply(a,arguments),a._trace({method:b,args:f}),e}})(k[e]);a.setAttr=function(){d.apply(a,arguments),a._trace({property:arguments[0],val:arguments[1]})}}},Kinetic.SceneContext=function(a){Kinetic.Context.call(this,a)},Kinetic.SceneContext.prototype={_fillColor:function(a){var b=a.getFill();this.setAttr("fillStyle",b),a._fillFunc(this)},_fillPattern:function(a){var b=a.getFillPatternImage(),c=a.getFillPatternX(),d=a.getFillPatternY(),e=a.getFillPatternScale(),f=a.getFillPatternRotation(),g=a.getFillPatternOffset(),h=a.getFillPatternRepeat();(c||d)&&this.translate(c||0,d||0),f&&this.rotate(f),e&&this.scale(e.x,e.y),g&&this.translate(-1*g.x,-1*g.y),this.setAttr("fillStyle",this.createPattern(b,h||"repeat")),this.fill()},_fillLinearGradient:function(a){var b=a.getFillLinearGradientStartPoint(),c=a.getFillLinearGradientEndPoint(),d=a.getFillLinearGradientColorStops(),e=this.createLinearGradient(b.x,b.y,c.x,c.y);if(d){for(var f=0;f<d.length;f+=2)e.addColorStop(d[f],d[f+1]);this.setAttr("fillStyle",e),this.fill()}},_fillRadialGradient:function(a){var b=a.getFillRadialGradientStartPoint(),c=a.getFillRadialGradientEndPoint(),d=a.getFillRadialGradientStartRadius(),e=a.getFillRadialGradientEndRadius(),f=a.getFillRadialGradientColorStops(),g=this.createRadialGradient(b.x,b.y,d,c.x,c.y,e);for(var h=0;h<f.length;h+=2)g.addColorStop(f[h],f[h+1]);this.setAttr("fillStyle",g),this.fill()},_fill:function(a){var b=a.getFill(),c=a.getFillPatternImage(),d=a.getFillLinearGradientColorStops(),e=a.getFillRadialGradientColorStops(),f=a.getFillPriority();b&&f==="color"?this._fillColor(a):c&&f==="pattern"?this._fillPattern(a):d&&f==="linear-gradient"?this._fillLinearGradient(a):e&&f==="radial-gradient"?this._fillRadialGradient(a):b?this._fillColor(a):c?this._fillPattern(a):d?this._fillLinearGradient(a):e&&this._fillRadialGradient(a)},_stroke:function(a){var b=a.getStroke(),c=a.getStrokeWidth(),d=a.getDashArray(),e=a.getStrokeScaleEnabled();a.hasStroke()&&(e||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(a),d&&a.getDashArrayEnabled()&&this.setLineDash(d),this.setAttr("lineWidth",c||2),this.setAttr("strokeStyle",b||"black"),a._strokeFunc(this),e||this.restore())},_applyShadow:function(a){var b=Kinetic.Util,c=a.getAbsoluteOpacity(),d=b.get(a.getShadowColor(),"black"),e=b.get(a.getShadowBlur(),5),f=b.get(a.getShadowOpacity(),0),g=b.get(a.getShadowOffset(),{x:0,y:0});f&&this.setAttr("globalAlpha",f*c),this.setAttr("shadowColor",d),this.setAttr("shadowBlur",e),this.setAttr("shadowOffsetX",g.x),this.setAttr("shadowOffsetY",g.y)}},Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context),Kinetic.HitContext=function(a){Kinetic.Context.call(this,a)},Kinetic.HitContext.prototype={_fill:function(a){this.save(),this.setAttr("fillStyle",a.colorKey),a._fillFuncHit(this),this.restore()},_stroke:function(a){var b=a.getStroke(),c=a.getStrokeWidth();if(b||c)this._applyLineCap(a),this.setAttr("lineWidth",c||2),this.setAttr("strokeStyle",a.colorKey),a._strokeFuncHit(this)}},Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)}(),function(){var a="absoluteOpacity",b="absoluteTransform",c="add",d="b",e="before",f="black",g="Change",h="children",i="Deg",j=".",k="",l="g",m="get",n="#",o="id",p="kinetic",q="listening",r="mouseenter",s="mouseleave",t="name",u="off",v="on",w="_get",x="r",y="RGB",z="set",A="Shape",B=" ",C="Stage",D="transform",E="B",F="G",G="Height",H="R",I="Width",J="X",K="Y",L="visible",M="x",N="y";Kinetic.Factory={addGetterSetter:function(a,b,c){this.addGetter(a,b,c),this.addSetter(a,b)},addPointGetterSetter:function(a,b,c){this.addPointGetter(a,b,c),this.addPointSetter(a,b),this.addGetter(a,b+J,c),this.addGetter(a,b+K,c),this.addSetter(a,b+J),this.addSetter(a,b+K)},addBoxGetterSetter:function(a,b,c){this.addBoxGetter(a,b,c),this.addBoxSetter(a,b),this.addGetter(a,b+J,c),this.addGetter(a,b+K,c),this.addGetter(a,b+I,c),this.addGetter(a,b+G,c),this.addSetter(a,b+J),this.addSetter(a,b+K),this.addSetter(a,b+I),this.addSetter(a,b+G)},addPointsGetterSetter:function(a,b){this.addPointsGetter(a,b),this.addPointsSetter(a,b),this.addPointAdder(a,b)},addRotationGetterSetter:function(a,b,c){this.addRotationGetter(a,b,c),this.addRotationSetter(a,b)},addColorGetterSetter:function(a,b){this.addGetter(a,b),this.addSetter(a,b),this.addColorRGBGetter(a,b),this.addColorComponentGetter(a,b,x),this.addColorComponentGetter(a,b,l),this.addColorComponentGetter(a,b,d),this.addColorRGBSetter(a,b),this.addColorComponentSetter(a,b,x),this.addColorComponentSetter(a,b,l),this.addColorComponentSetter(a,b,d)},addColorRGBGetter:function(a,b){var c=m+Kinetic.Util._capitalize(b)+y;a.prototype[c]=function(){return Kinetic.Util.getRGB(this.attrs[b])}},addColorComponentGetter:function(a,b,c){var d=m+Kinetic.Util._capitalize(b),e=d+Kinetic.Util._capitalize(c);a.prototype[e]=function(){return this[d+y]()[c]}},addPointsGetter:function(a,b){var c=this,d=m+Kinetic.Util._capitalize(b);a.prototype[d]=function(){var a=this.attrs[b];return a===undefined?[]:a}},addGetter:function(a,b,c){var d=this,e=m+Kinetic.Util._capitalize(b);a.prototype[e]=function(){var a=this.attrs[b];return a===undefined?c:a}},addPointGetter:function(a,b){var c=this,d=m+Kinetic.Util._capitalize(b);a.prototype[d]=function(){var a=this;return{x:a[d+J](),y:a[d+K]()}}},addBoxGetter:function(a,b){var c=this,d=m+Kinetic.Util._capitalize(b);a.prototype[d]=function(){var a=this;return{x:a[d+J](),y:a[d+K](),width:a[d+I](),height:a[d+G]()}}},addRotationGetter:function(a,b,c){var d=this,e=m+Kinetic.Util._capitalize(b);a.prototype[e]=function(){var a=this.attrs[b];return a===undefined&&(a=c),a},a.prototype[e+i]=function(){var a=this.attrs[b];return a===undefined&&(a=c),Kinetic.Util._radToDeg(a)}},addColorRGBSetter:function(a,b){var c=z+Kinetic.Util._capitalize(b)+y;a.prototype[c]=function(a){var c=a&&a.r!==undefined?a.r|0:this.getAttr(b+H),d=a&&a.g!==undefined?a.g|0:this.getAttr(b+F),e=a&&a.b!==undefined?a.b|0:this.getAttr(b+E);this._setAttr(b,n+Kinetic.Util._rgbToHex(c,d,e))}},addColorComponentSetter:function(a,b,c){var d=z+Kinetic.Util._capitalize(b),e=d+Kinetic.Util._capitalize(c);a.prototype[e]=function(a){var b={};b[c]=a,this[d+y](b)}},addPointsSetter:function(a,b){var c=z+Kinetic.Util._capitalize(b);a.prototype[c]=function(a){var b=Kinetic.Util._getPoints(a);this._setAttr("points",b)}},addSetter:function(a,b){var c=z+Kinetic.Util._capitalize(b);a.prototype[c]=function(a){this._setAttr(b,a)}},addPointSetter:function(a,b){var c=this,d=z+Kinetic.Util._capitalize(b);a.prototype[d]=function(){var a=Kinetic.Util._getXY([].slice.call(arguments)),c=this.attrs[b],e=0,f=0;a&&(e=a.x,f=a.y,this._fireBeforeChangeEvent(b,c,a),e!==undefined&&this[d+J](e),f!==undefined&&this[d+K](f),this._fireChangeEvent(b,c,a))}},addBoxSetter:function(a,b){var c=this,d=z+Kinetic.Util._capitalize(b);a.prototype[d]=function(){var a=[].slice.call(arguments),c=Kinetic.Util._getXY(a),e=Kinetic.Util._getSize(a),f=Kinetic.Util._merge(c,e),g=this.attrs[b],h,i,j,k;f&&(h=f.x,i=f.y,j=f.width,k=f.height,this._fireBeforeChangeEvent(b,g,f),h!==undefined&&this[d+J](h),i!==undefined&&this[d+K](i),j!==undefined&&this[d+I](j),k!==undefined&&this[d+G](k),this._fireChangeEvent(b,g,f))}},addRotationSetter:function(a,b){var c=this,d=z+Kinetic.Util._capitalize(b);a.prototype[d]=function(a){this._setAttr(b,a)},a.prototype[d+i]=function(a){this._setAttr(b,Kinetic.Util._degToRad(a))}},addPointAdder:function(a,b){var d=this,e=c+Kinetic.Util._removeLastLetter(Kinetic.Util._capitalize(b));a.prototype[e]=function(){var a=Kinetic.Util._getXY([].slice.call(arguments)),c=this.attrs[b];a&&(this._fireBeforeChangeEvent(b,c,a),this.attrs[b].push(a),this._fireChangeEvent(b,c,a))}}}}(),function(){var a="absoluteOpacity",b="absoluteTransform",c="add",d="b",e="before",f="black",g="Change",h="children",i="Deg",j=".",k="",l="g",m="get",n="#",o="id",p="kinetic",q="listening",r="mouseenter",s="mouseleave",t="name",u="off",v="on",w="_get",x="r",y="RGB",z="set",A="Shape",B=" ",C="stage",D="transform",E="B",F="G",G="Height",H="R",I="Stage",J="Width",K="X",L="Y",M="visible",N="x",O="y",P=["xChange.kinetic","yChange.kinetic","scaleXChange.kinetic","scaleYChange.kinetic","skewXChange.kinetic","skewYChange.kinetic","rotationChange.kinetic","offsetXChange.kinetic","offsetYChange.kinetic"].join(B);Kinetic.Util.addMethods(Kinetic.Node,{_init:function(c){var d=this;this._id=Kinetic.idCounter++,this.eventListeners={},this.attrs={},this.cache={},this.setAttrs(c),this.on(P,function(){this._clearCache(D),d._clearSelfAndChildrenCache(b)}),this.on("visibleChange.kinetic",function(){d._clearSelfAndChildrenCache(M)}),this.on("listeningChange.kinetic",function(){d._clearSelfAndChildrenCache(q)}),this.on("opacityChange.kinetic",function(){d._clearSelfAndChildrenCache(a)})},clearCache:function(){this.cache={}},_clearCache:function(a){delete this.cache[a]},_getCache:function(a,b){var c=this.cache[a];return c===undefined&&(this.cache[a]=b.call(this)),this.cache[a]},_clearSelfAndChildrenCache:function(a){var b=this;this._clearCache(a),this.children&&this.getChildren().each(function(b){b._clearSelfAndChildrenCache(a)})},on:function(a,b){var c=a.split(B),d=c.length,e,f,g,h,i;for(e=0;e<d;e++)f=c[e],g=f.split(j),h=g[0],i=g[1]||k,this.eventListeners[h]||(this.eventListeners[h]=[]),this.eventListeners[h].push({name:i,handler:b});return this},off:function(a){var b=a.split(B),c=b.length,d,e,f,g,h,i,k;for(d=0;d<c;d++){g=b[d],h=g.split(j),i=h[0],k=h[1];if(i)this.eventListeners[i]&&this._off(i,k);else for(f in this.eventListeners)this._off(f,k)}return this},remove:function(){var c=this.getParent();return c&&c.children&&(c.children.splice(this.index,1),c._setChildrenIndices(),delete this.parent),this._clearSelfAndChildrenCache(C),this._clearSelfAndChildrenCache(b),this._clearSelfAndChildrenCache(M),this._clearSelfAndChildrenCache(q),this._clearSelfAndChildrenCache(a),this},destroy:function(){Kinetic._removeId(this.getId()),Kinetic._removeName(this.getName(),this._id),this.remove()},getAttr:function(a){var b=m+Kinetic.Util._capitalize(a);return Kinetic.Util._isFunction(this[b])?this[b]():this.attrs[a]},getAncestors:function(){var a=this.getParent(),b=new Kinetic.Collection;while(a)b.push(a),a=a.getParent();return b},setAttr:function(){var a=Array.prototype.slice.call(arguments),b=a[0],c=z+Kinetic.Util._capitalize(b),d=this[c];return a.shift(),Kinetic.Util._isFunction(d)?d.apply(this,a):this.attrs[b]=a[0],this},getAttrs:function(){return this.attrs||{}},setAttrs:function(a){var b,c;if(a)for(b in a)b!==h&&(c=z+Kinetic.Util._capitalize(b),Kinetic.Util._isFunction(this[c])?this[c](a[b]):this._setAttr(b,a[b]));return this},isListening:function(){return this._getCache(q,this._isListening)},_isListening:function(){var a=this.getListening(),b=this.getParent();return a&&b&&!b.isListening()?!1:a},isVisible:function(){return this._getCache(M,this._isVisible)},_isVisible:function(){var a=this.getVisible(),b=this.getParent();return a&&b&&!b.isVisible()?!1:a},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function h(i){d=[],e=i.length;for(f=0;f<e;f++)g=i[f],c++,g.nodeType!==A&&(d=d.concat(g.getChildren().toArray())),g._id===b._id&&(f=e);d.length>0&&d[0].getLevel()<=a&&h(d)}var a=this.getLevel(),b=this,c=0,d,e,f,g;return b.nodeType!==I&&h(b.getStage().getChildren()),c},getLevel:function(){var a=0,b=this.parent;while(b)a++,b=b.parent;return a},setPosition:function(){var a=Kinetic.Util._getXY([].slice.call(arguments));return this.setX(a.x),this.setY(a.y),this},getPosition:function(){return{x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var a=this.getAbsoluteTransform().getMatrix(),b=new Kinetic.Transform,c=this.getOffset();return b.m=a.slice(),b.translate(c.x,c.y),b.getTranslation()},setAbsolutePosition:function(){var a=Kinetic.Util._getXY([].slice.call(arguments)),b=this._clearTransform(),c;return this.attrs.x=b.x,this.attrs.y=b.y,delete b.x,delete b.y,c=this.getAbsoluteTransform(),c.invert(),c.translate(a.x,a.y),a={x:this.attrs.x+c.getTranslation().x,y:this.attrs.y+c.getTranslation().y},this.setPosition(a.x,a.y),this._setTransform(b),this},_setTransform:function(a){var c;for(c in a)this.attrs[c]=a[c];this._clearCache(D),this._clearSelfAndChildrenCache(b)},_clearTransform:function(){var a={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(D),this._clearSelfAndChildrenCache(b),a},move:function(){var a=Kinetic.Util._getXY([].slice.call(arguments)),b=this.getX(),c=this.getY();return a.x!==undefined&&(b+=a.x),a.y!==undefined&&(c+=a.y),this.setPosition(b,c),this},_eachAncestorReverse:function(a,b){var c=[],d=this.getParent(),e,f;b&&c.unshift(this);while(d)c.unshift(d),d=d.parent;e=c.length;for(f=0;f<e;f++)a(c[f])},rotate:function(a){return this.setRotation(this.getRotation()+a),this},rotateDeg:function(a){return this.setRotation(this.getRotation()+Kinetic.Util._degToRad(a)),this},moveToTop:function(){var a=this.index;return this.parent.children.splice(a,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){var a=this.index,b=this.parent.getChildren().length;return a<b-1?(this.parent.children.splice(a,1),this.parent.children.splice(a+1,0,this),this.parent._setChildrenIndices(),!0):!1},moveDown:function(){var a=this.index;return a>0?(this.parent.children.splice(a,1),this.parent.children.splice(a-1,0,this),this.parent._setChildrenIndices(),!0):!1},moveToBottom:function(){var a=this.index;return a>0?(this.parent.children.splice(a,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1},setZIndex:function(a){var b=this.index;return this.parent.children.splice(b,1),this.parent.children.splice(a,0,this),this.parent._setChildrenIndices(),this},getAbsoluteOpacity:function(){return this._getCache(a,this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var a=this.getOpacity();return this.getParent()&&(a*=this.getParent().getAbsoluteOpacity()),a},moveTo:function(a){return Kinetic.Node.prototype.remove.call(this),a.add(this),this},toObject:function(){var a=Kinetic.Util,b={},c=this.getAttrs(),d,e;b.attrs={};for(d in c)e=c[d],!a._isFunction(e)&&!a._isElement(e)&&(!a._isObject(e)||!a._hasMethods(e))&&(b.attrs[d]=e);return b.className=this.getClassName(),b},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){return this.getParent().getLayer()},getStage:function(){return this._getCache(C,this._getStage)},_getStage:function(){var a=this.getParent();return a?a.getStage():undefined},fire:function(a,b,c){return c?this._fireAndBubble(a,b||{}):this._fire(a,b||{}),this},getAbsoluteTransform:function(){return this._getCache(b,this._getAbsoluteTransform)},_getAbsoluteTransform:function(){var a=new Kinetic.Transform,b;return this._eachAncestorReverse(function(c){b=c.getTransform(),a.multiply(b)},!0),a},_getTransform:function(){var a=new Kinetic.Transform,b=this.getX(),c=this.getY(),d=this.getRotation(),e=this.getScaleX(),f=this.getScaleY(),g=this.getSkewX(),h=this.getSkewY(),i=this.getOffsetX(),j=this.getOffsetY();return(b!==0||c!==0)&&a.translate(b,c),d!==0&&a.rotate(d),(g!==0||h!==0)&&a.skew(g,h),(e!==1||f!==1)&&a.scale(e,f),(i!==0||j!==0)&&a.translate(-1*i,-1*j),a},clone:function(a){var b=this.getClassName(),c=new Kinetic[b](this.attrs),d,e,f,g,h;for(d in this.eventListeners){e=this.eventListeners[d],f=e.length;for(g=0;g<f;g++)h=e[g],h.name.indexOf(p)<0&&(c.eventListeners[d]||(c.eventListeners[d]=[]),c.eventListeners[d].push(h))}return c.setAttrs(a),c},toDataURL:function(a){a=a||{};var b=a.mimeType||null,c=a.quality||null,d=this.getStage(),e=a.x||0,f=a.y||0,g=new Kinetic.SceneCanvas({width:a.width||d.getWidth(),height:a.height||d.getHeight(),pixelRatio:1}),h=g.getContext();return h.save(),(e||f)&&h.translate(-1*e,-1*f),this.drawScene(g),h.restore(),g.toDataURL(b,c)},toImage:function(a){Kinetic.Util._getImage(this.toDataURL(a),function(b){a.callback(b)})},setSize:function(){var a=Kinetic.Util._getSize(Array.prototype.slice.call(arguments));return this.setWidth(a.width),this.setHeight(a.height),this},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},_get:function(a){return this.nodeType===a?[this]:[]},_off:function(a,b){var c=this.eventListeners[a],d,e;for(d=0;d<c.length;d++){e=c[d].name;if((e!=="kinetic"||b==="kinetic")&&(!b||e===b)){c.splice(d,1);if(c.length===0){delete this.eventListeners[a];break}d--}}},_fireBeforeChangeEvent:function(a,b,c){this._fire(e+Kinetic.Util._capitalize(a)+g,{oldVal:b,newVal:c})},_fireChangeEvent:function(a,b,c){this._fire(a+g,{oldVal:b,newVal:c})},setId:function(a){var b=this.getId();return Kinetic._removeId(b),Kinetic._addId(this,a),this._setAttr(o,a),this},setName:function(a){var b=this.getName();return Kinetic._removeName(b,this._id),Kinetic._addName(this,a),this._setAttr(t,a),this},_setAttr:function(a,b){var c;b!==undefined&&(c=this.attrs[a],this._fireBeforeChangeEvent(a,c,b),this.attrs[a]=b,this._fireChangeEvent(a,c,b))},_fireAndBubble:function(a,b,c){var d=!0;b&&this.nodeType===A&&(b.targetNode=this),a===r&&c&&this._id===c._id?d=!1:a===s&&c&&this._id===c._id&&(d=!1),d&&(this._fire(a,b),b&&!b.cancelBubble&&this.parent&&(c&&c.parent?this._fireAndBubble.call(this.parent,a,b,c.parent):this._fireAndBubble.call(this.parent,a,b)))},_fire:function(a,b){var c=this.eventListeners[a],d,e;if(c){d=c.length;for(e=0;e<d;e++)c[e].handler.call(this,b)}},draw:function(){return this.drawScene(),this.drawHit(),this},shouldDrawHit:function(){return this.isListening()&&this.isVisible()&&!Kinetic.isDragging()},isDraggable:function(){return!1},getTransform:function(){return this._getCache(D,this._getTransform)}}),Kinetic.Node.create=function(a,b){return this._createNode(JSON.parse(a),b)},Kinetic.Node._createNode=function(a,b){var c=Kinetic.Node.prototype.getClassName.call(a),d=a.children,e,f,g;b&&(a.attrs.container=b),e=new Kinetic[c](a.attrs);if(d){f=d.length;for(g=0;g<f;g++)e.add(this._createNode(d[g]))}return e},Kinetic.Factory.addGetterSetter(Kinetic.Node,"x",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"y",0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"opacity",1),Kinetic.Factory.addGetter(Kinetic.Node,"name"),Kinetic.Factory.addGetter(Kinetic.Node,"id"),Kinetic.Factory.addRotationGetterSetter(Kinetic.Node,"rotation",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Node,"scale",1),Kinetic.Factory.addPointGetterSetter(Kinetic.Node,"skew",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Node,"offset",0),Kinetic.Factory.addSetter(Kinetic.Node,"width"),Kinetic.Factory.addSetter(Kinetic.Node,"height"),Kinetic.Factory.addGetterSetter(Kinetic.Node,"listening",!0),Kinetic.Factory.addGetterSetter(Kinetic.Node,"visible",!0),Kinetic.Collection.mapMethods(["on","off","remove","destroy","show","hide","move","rotate","moveToTop","moveUp","moveDown","moveToBottom","moveTo","fire","draw"])}(),function(){function b(a){window.setTimeout(a,1e3/60)}var a=500;Kinetic.Animation=function(a,b){this.func=a,this.setLayers(b),this.id=Kinetic.Animation.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:(new Date).getTime()}},Kinetic.Animation.prototype={setLayers:function(a){var b=[];a?a.length>0?b=a:b=[a]:b=[],this.layers=b},getLayers:function(){return this.layers},addLayer:function(a){var b=this.layers,c,d;if(b){c=b.length;for(d=0;d<c;d++)if(b[d]._id===a._id)return!1}else this.layers=[];return this.layers.push(a),!0},isRunning:function(){var a=Kinetic.Animation,b=a.animations;for(var c=0;c<b.length;c++)if(b[c].id===this.id)return!0;return!1},start:function(){this.stop(),this.frame.timeDiff=0,this.frame.lastTime=(new Date).getTime(),Kinetic.Animation._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(a){this.frame.timeDiff=a-this.frame.lastTime,this.frame.lastTime=a,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation._addAnimation=function(a){this.animations.push(a),this._handleAnimation()},Kinetic.Animation._removeAnimation=function(a){var b=a.id,c=this.animations,d=c.length;for(var e=0;e<d;e++)if(c[e].id===b){this.animations.splice(e,1);break}},Kinetic.Animation._runFrames=function(){var a={},b=this.animations,c,d,e,f,g,h,i,j;for(f=0;f<b.length;f++){c=b[f],d=c.layers,e=c.func,c._updateFrameObject((new Date).getTime()),h=d.length;for(g=0;g<h;g++)i=d[g],i._id!==undefined&&(a[i._id]=i);e&&e.call(c,c.frame)}for(j in a)a[j].draw()},Kinetic.Animation._animationLoop=function(){var a=this;this.animations.length>0?(this._runFrames(),Kinetic.Animation.requestAnimFrame(function(){a._animationLoop()})):this.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var a=this;this.animRunning||(this.animRunning=!0,a._animationLoop())},RAF=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||b}(),Kinetic.Animation.requestAnimFrame=function(a){var c=Kinetic.DD&&Kinetic.DD.isDragging?b:RAF;c(a)};var c=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(a){c.call(this,a)},Kinetic.Layer.prototype.batchDraw=function(){var b=this;this.batchAnim||(this.batchAnim=new Kinetic.Animation(function(){b.lastBatchDrawTime&&(new Date).getTime()-b.lastBatchDrawTime>a&&b.batchAnim.stop()},this)),this.lastBatchDrawTime=(new Date).getTime(),this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())},Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(a){a.batchDraw()})}}(),function(){var a={node:1,duration:1,easing:1,onFinish:1,yoyo:1},b=1,c=2,d=3,e=0;Kinetic.Tween=function(b){var c=this,d=b.node,g=d._id,h=b.duration||1,i=b.easing||Kinetic.Easings.Linear,j=!!b.yoyo,k,l,m,n;this.node=d,this._id=e++,this.anim=new Kinetic.Animation(function(){c.tween.onEnterFrame()},d.getLayer()||d.getLayers()),this.tween=new f(k,function(a){c._tweenFunc(a)},i,0,1,h*1e3,j),this._addListeners(),Kinetic.Tween.attrs[g]||(Kinetic.Tween.attrs[g]={}),Kinetic.Tween.attrs[g][this._id]||(Kinetic.Tween.attrs[g][this._id]={}),Kinetic.Tween.tweens[g]||(Kinetic.Tween.tweens[g]={});for(k in b)a[k]===undefined&&this._addAttr(k,b[k]);this.reset(),this.onFinish=b.onFinish,this.onReset=b.onReset},Kinetic.Tween.attrs={},Kinetic.Tween.tweens={},Kinetic.Tween.prototype={_addAttr:function(a,b){var c=this.node,d=c._id,e,f,g,h,i,j,k;g=Kinetic.Tween.tweens[d][a],g&&delete Kinetic.Tween.attrs[d][g][a],e=c.getAttr(a);if(Kinetic.Util._isArray(b)){b=Kinetic.Util._getPoints(b),f=[],i=b.length;for(h=0;h<i;h++)j=e[h],k=b[h],f.push({x:k.x-j.x,y:k.y-j.y})}else f=b-e;Kinetic.Tween.attrs[d][this._id][a]={start:e,diff:f},Kinetic.Tween.tweens[d][a]=this._id},_tweenFunc:function(a){var b=this.node,c=Kinetic.Tween.attrs[b._id][this._id],d,e,f,g,h,i,j,k,l;for(d in c){e=c[d],f=e.start,g=e.diff;if(Kinetic.Util._isArray(f)){h=[],j=f.length;for(i=0;i<j;i++)k=f[i],l=g[i],h.push({x:k.x+l.x*a,y:k.y+l.y*a})}else h=f+g*a;b.setAttr(d,h)}},_addListeners:function(){var a=this;this.tween.onPlay=function(){a.anim.start()},this.tween.onReverse=function(){a.anim.start()},this.tween.onPause=function(){a.anim.stop()},this.tween.onFinish=function(){a.onFinish&&a.onFinish()},this.tween.onReset=function(){a.onReset&&a.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){var a=this.node;return this.tween.reset(),(a.getLayer()||a.getLayers()).draw(),this},seek:function(a){var b=this.node;return this.tween.seek(a*1e3),(b.getLayer()||b.getLayers()).draw(),this},pause:function(){return this.tween.pause(),this},finish:function(){var a=this.node;return this.tween.finish(),(a.getLayer()||a.getLayers()).draw(),this},destroy:function(){var a=this.node._id,b=this._id,c=Kinetic.Tween.tweens[a],d;this.pause();for(d in c)delete Kinetic.Tween.tweens[a][d];delete Kinetic.Tween.attrs[a][b]}};var f=function(a,b,c,d,e,f,g){this.prop=a,this.propFunc=b,this.begin=d,this._pos=d,this.duration=f,this._change=0,this.prevPos=0,this.yoyo=g,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=c,this._change=e-this.begin,this.pause()};f.prototype={fire:function(a){var b=this[a];b&&b()},setTime:function(a){a>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():a<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=a,this.update())},getTime:function(){return this._time},setPosition:function(a){this.prevPos=this._pos,this.propFunc(a),this._pos=a},getPosition:function(a){return a===undefined&&(a=this._time),this.func(a,this.begin,this._change,this.duration)},play:function(){this.state=c,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")},reverse:function(){this.state=d,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")},seek:function(a){this.pause(),this._time=a,this.update(),this.fire("onSeek")},reset:function(){this.pause(),this._time=0,this.update(),this.fire("onReset")},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var a=this.getTimer()-this._startTime;this.state===c?this.setTime(a):this.state===d&&this.setTime(this.duration-a)},pause:function(){this.state=b,this.fire("onPause")},getTimer:function(){return(new Date).getTime()}},Kinetic.Easings={BackEaseIn:function(a,b,c,d,e,f){var g=1.70158;return c*(a/=d)*a*((g+1)*a-g)+b},BackEaseOut:function(a,b,c,d,e,f){var g=1.70158;return c*((a=a/d-1)*a*((g+1)*a+g)+1)+b},BackEaseInOut:function(a,b,c,d,e,f){var g=1.70158;return(a/=d/2)<1?c/2*a*a*(((g*=1.525)+1)*a-g)+b:c/2*((a-=2)*a*(((g*=1.525)+1)*a+g)+2)+b},ElasticEaseIn:function(a,b,c,d,e,f){var g=0;return a===0?b:(a/=d)==1?b+c:(f||(f=d*.3),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),-(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f))+b)},ElasticEaseOut:function(a,b,c,d,e,f){var g=0;return a===0?b:(a/=d)==1?b+c:(f||(f=d*.3),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),e*Math.pow(2,-10*a)*Math.sin((a*d-g)*2*Math.PI/f)+c+b)},ElasticEaseInOut:function(a,b,c,d,e,f){var g=0;return a===0?b:(a/=d/2)==2?b+c:(f||(f=d*.3*1.5),!e||e<Math.abs(c)?(e=c,g=f/4):g=f/(2*Math.PI)*Math.asin(c/e),a<1?-0.5*e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)+b:e*Math.pow(2,-10*(a-=1))*Math.sin((a*d-g)*2*Math.PI/f)*.5+c+b)},BounceEaseOut:function(a,b,c,d){return(a/=d)<1/2.75?c*7.5625*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},BounceEaseIn:function(a,b,c,d){return c-Kinetic.Easings.BounceEaseOut(d-a,0,c,d)+b},BounceEaseInOut:function(a,b,c,d){return a<d/2?Kinetic.Easings.BounceEaseIn(a*2,0,c,d)*.5+b:Kinetic.Easings.BounceEaseOut(a*2-d,0,c,d)*.5+c*.5+b},EaseIn:function(a,b,c,d){return c*(a/=d)*a+b},EaseOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},EaseInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},StrongEaseIn:function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},StrongEaseOut:function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},StrongEaseInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},Linear:function(a,b,c,d){return c*a/d+b}}}(),function(){Kinetic.DD={anim:new Kinetic.Animation,isDragging:!1,offset:{x:0,y:0},node:null,_drag:function(a){var b=Kinetic.DD,c=b.node;c&&(c._setDragPosition(a),b.isDragging||(b.isDragging=!0,c.fire("dragstart",a,!0)),c.fire("dragmove",a,!0))},_endDragBefore:function(a){var b=Kinetic.DD,c=b.node,d,e;c&&(d=c.nodeType,e=c.getLayer(),b.anim.stop(),b.isDragging&&(b.isDragging=!1,Kinetic.listenClickTap=!1,a&&(a.dragEndNode=c)),delete b.node,(e||c).draw())},_endDragAfter:function(a){a=a||{};var b=a.dragEndNode;a&&b&&b.fire("dragend",a,!0)}},Kinetic.Node.prototype.startDrag=function(){var a=Kinetic.DD,b=this.getStage(),c=this.getLayer(),d=b.getPointerPosition(),e=this.getAbsolutePosition();d&&(a.node&&a.node.stopDrag(),a.node=this,a.offset.x=d.x-e.x,a.offset.y=d.y-e.y,a.anim.setLayers(c||this.getLayers()),a.anim.start(),this._setDragPosition())},Kinetic.Node.prototype._setDragPosition=function(a){var b=Kinetic.DD,c=this.getStage().getPointerPosition(),d=this.getDragBoundFunc(),e={x:c.x-b.offset.x,y:c.y-b.offset.y};d!==undefined&&(e=d.call(this,e,a)),this.setAbsolutePosition(e)},Kinetic.Node.prototype.stopDrag=function(){var a=Kinetic.DD,b={};a._endDragBefore(b),a._endDragAfter(b)},Kinetic.Node.prototype.setDraggable=function(a){this._setAttr("draggable",a),this._dragChange()};var a=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var b=Kinetic.DD;b.node&&b.node._id===this._id&&this.stopDrag(),a.call(this)},Kinetic.Node.prototype.isDragging=function(){var a=Kinetic.DD;return a.node&&a.node._id===this._id&&a.isDragging},Kinetic.Node.prototype._listenDrag=function(){var a=this;this._dragCleanup(),this.getClassName()==="Stage"?this.on("contentMousedown.kinetic contentTouchstart.kinetic",function(b){Kinetic.DD.node||a.startDrag(b)}):this.on("mousedown.kinetic touchstart.kinetic",function(b){Kinetic.DD.node||a.startDrag(b)})},Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var a=this.getStage(),b=Kinetic.DD;a&&b.node&&b.node._id===this._id&&b.node.stopDrag()}},Kinetic.Node.prototype._dragCleanup=function(){this.off("mousedown.kinetic"),this.off("touchstart.kinetic")},Kinetic.Factory.addGetterSetter(Kinetic.Node,"dragBoundFunc"),Kinetic.Factory.addGetter(Kinetic.Node,"draggable",!1),Kinetic.Node.prototype.isDraggable=Kinetic.Node.prototype.getDraggable;var b=document.getElementsByTagName("html")[0];b.addEventListener("mouseup",Kinetic.DD._endDragBefore,!0),b.addEventListener("touchend",Kinetic.DD._endDragBefore,!0),b.addEventListener("mouseup",Kinetic.DD._endDragAfter,!1),b.addEventListener("touchend",Kinetic.DD._endDragAfter,!1)}(),function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(a){this.children=new Kinetic.Collection,Kinetic.Node.call(this,a)},getChildren:function(){return this.children},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){var a=this.children,b;while(a.length>0)b=a[0],b.hasChildren()&&b.removeChildren(),b.remove();return this},destroyChildren:function(){var a=this.children;while(a.length>0)a[0].destroy();return this},add:function(a){var b=this.children;return this._validateAdd(a),a.index=b.length,a.parent=this,b.push(a),this._fire("add",{child:a}),this},destroy:function(){this.hasChildren()&&this.destroyChildren(),Kinetic.Node.prototype.destroy.call(this)},find:function(a){var b=[],c=a.replace(/ /g,"").split(","),d=c.length,e,f,g,h,i,j,k;for(e=0;e<d;e++){g=c[e];if(g.charAt(0)==="#")i=this._getNodeById(g.slice(1)),i&&b.push(i);else if(g.charAt(0)===".")h=this._getNodesByName(g.slice(1)),b=b.concat(h);else{j=this.getChildren(),k=j.length;for(f=0;f<k;f++)b=b.concat(j[f]._get(g))}}return Kinetic.Collection.toCollection(b)},_getNodeById:function(a){var b=Kinetic.ids[a];return b!==undefined&&this.isAncestorOf(b)?b:null},_getNodesByName:function(a){var b=Kinetic.names[a]||[];return this._getDescendants(b)},_get:function(a){var b=Kinetic.Node.prototype._get.call(this,a),c=this.getChildren(),d=c.length;for(var e=0;e<d;e++)b=b.concat(c[e]._get(a));return b},toObject:function(){var a=Kinetic.Node.prototype.toObject.call(this);a.children=[];var b=this.getChildren(),c=b.length;for(var d=0;d<c;d++){var e=b[d];a.children.push(e.toObject())}return a},_getDescendants:function(a){var b=[],c=a.length;for(var d=0;d<c;d++){var e=a[d];this.isAncestorOf(e)&&b.push(e)}return b},isAncestorOf:function(a){var b=a.getParent();while(b){if(b._id===this._id)return!0;b=b.getParent()}return!1},clone:function(a){var b=Kinetic.Node.prototype.clone.call(this,a);return this.getChildren().each(function(a){b.add(a.clone())}),b},getAllIntersections:function(){var a=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),b=[],c=this.find("Shape"),d=c.length;for(var e=0;e<d;e++){var f=c[e];f.isVisible()&&f.intersects(a)&&b.push(f)}return b},_setChildrenIndices:function(){this.children.each(function(a,b){a.index=b})},drawScene:function(a){var b=this.getLayer(),c=this.getClipWidth()&&this.getClipHeight(),d,e,f;return!a&&b&&(a=b.getCanvas()),this.isVisible()&&(c?a.getContext()._clip(this):this._drawChildren(a)),this},_drawChildren:function(a){this.children.each(function(b){b.drawScene(a)})},drawHit:function(){var a=this.getClipWidth()&&this.getClipHeight()&&this.nodeType!=="Stage",b=0,c=0,d=[],e;if(this.shouldDrawHit()){a&&(e=this.getLayer().hitCanvas,e.getContext()._clip(this)),d=this.children,c=d.length;for(b=0;b<c;b++)d[b].drawHit();a&&e.getContext()._context.restore()}return this}}),Kinetic.Util.extend(Kinetic.Container,Kinetic.Node),Kinetic.Container.prototype.get=Kinetic.Container.prototype.find,Kinetic.Factory.addBoxGetterSetter(Kinetic.Container,"clip")}(),function(){function b(a){a.fill()}function c(a){a.stroke()}function d(a){a.fill()}function e(a){a.stroke()}function f(){this._clearCache(a)}var a="hasShadow";Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(a){this.nodeType="Shape",this._fillFunc=b,this._strokeFunc=c,this._fillFuncHit=d,this._strokeFuncHit=e;var g=Kinetic.shapes,h;for(;;){h=Kinetic.Util.getRandomColor();if(h&&!(h in g))break}this.colorKey=h,g[h]=this,Kinetic.Node.call(this,a),this._setDrawFuncs(),this.on("shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic",f)},hasChildren:function(){return!1},getChildren:function(){return[]},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(a,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&this.getShadowOpacity()!==0&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return!!this.getStroke()||!!this.getStrokeWidth()},_get:function(a){return this.className===a||this.nodeType===a?[this]:[]},intersects:function(){var a=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),b=this.getStage(),c=b.bufferHitCanvas,d;return c.getContext().clear(),this.drawScene(c),d=c.context.getImageData(a.x|0,a.y|0,1,1).data,d[3]>0},enableFill:function(){return this._setAttr("fillEnabled",!0),this},disableFill:function(){return this._setAttr("fillEnabled",!1),this},enableStroke:function(){return this._setAttr("strokeEnabled",!0),this},disableStroke:function(){return this._setAttr("strokeEnabled",!1),this},enableStrokeScale:function(){return this._setAttr("strokeScaleEnabled",!0),this},disableStrokeScale:function(){return this._setAttr("strokeScaleEnabled",!1),this},enableShadow:function(){return this._setAttr("shadowEnabled",!0),this},disableShadow:function(){return this._setAttr("shadowEnabled",!1),this},enableDashArray:function(){return this._setAttr("dashArrayEnabled",!0),this},disableDashArray:function(){return this._setAttr("dashArrayEnabled",!1),this},destroy:function(){return Kinetic.Node.prototype.destroy.call(this),delete Kinetic.shapes[this.colorKey],this},_useBufferCanvas:function(){return(this.hasShadow()||this.getAbsoluteOpacity()!==1)&&this.hasFill()&&this.hasStroke()},drawScene:function(a){var b=a||this.getLayer().getCanvas(),c=b.getContext(),d=this.getDrawFunc(),e=this.hasShadow(),f,g,h;return d&&this.isVisible()&&(this._useBufferCanvas()?(f=this.getStage(),g=f.bufferCanvas,h=g.getContext(),h.clear(),h.save(),h._applyLineJoin(this),h._applyAncestorTransforms(this),d.call(this,h),h.restore(),c.save(),e&&(c.save(),c._applyShadow(this),c.drawImage(g._canvas,0,0),c.restore()),c._applyOpacity(this),c.drawImage(g._canvas,0,0),c.restore()):(c.save(),c._applyLineJoin(this),c._applyAncestorTransforms(this),e&&(c.save(),c._applyShadow(this),d.call(this,c),c.restore()),c._applyOpacity(this),d.call(this,c),c.restore())),this},drawHit:function(){var a=this.getAttrs(),b=a.drawHitFunc||a.drawFunc,c=this.getLayer().hitCanvas,d=c.getContext();return b&&this.shouldDrawHit()&&(d.save(),d._applyLineJoin(this),d._applyAncestorTransforms(this),b.call(this,d),d.restore()),this},_setDrawFuncs:function(){!this.attrs.drawFunc&&this.drawFunc&&this.setDrawFunc(this.drawFunc),!this.attrs.drawHitFunc&&this.drawHitFunc&&this.setDrawHitFunc(this.drawHitFunc)}}),Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Factory.addColorGetterSetter(Kinetic.Shape,"stroke"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineJoin"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"lineCap"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeWidth"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"drawFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"drawHitFunc"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashArray"),Kinetic.Factory.addColorGetterSetter(Kinetic.Shape,"shadowColor"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowBlur"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowOpacity"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternImage"),Kinetic.Factory.addColorGetterSetter(Kinetic.Shape,"fill"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternX"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternY"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillLinearGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientStartRadius"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientEndRadius"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillRadialGradientColorStops"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPatternRepeat"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"shadowEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"dashArrayEnabled",!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"fillPriority","color"),Kinetic.Factory.addGetterSetter(Kinetic.Shape,"strokeScaleEnabled",!0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillPatternOffset",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillPatternScale",1),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientStartPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillLinearGradientEndPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientStartPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"fillRadialGradientEndPoint",0),Kinetic.Factory.addPointGetterSetter(Kinetic.Shape,"shadowOffset",0),Kinetic.Factory.addRotationGetterSetter(Kinetic.Shape,"fillPatternRotation",0)}(),function(){function P(a,b){a.content.addEventListener(b,function(c){a[K+b](c)},!1)}var a="Stage",b="string",c="px",d="mouseout",e="mouseleave",f="mouseover",g="mouseenter",h="mousemove",i="mousedown",j="mouseup",k="click",l="dblclick",m="touchstart",n="touchend",o="tap",p="dbltap",q="touchmove",r="contentMouseout",s="contentMouseleave",t="contentMouseover",u="contentMouseenter",v="contentMousemove",w="contentMousedown",x="contentMouseup",y="contentClick",z="contentDblclick",A="contentTouchstart",B="contentTouchend",C="contentTap",D="contentDbltap",E="contentTouchmove",F="div",G="relative",H="inline-block",I="kineticjs-content",J=" ",K="_",L="container",M="",N=[i,h,j,d,m,q,n,f],O=N.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(b){this.nodeType=a,Kinetic.Container.call(this,b),this._id=Kinetic.idCounter++,this._buildDOM(),this._bindContentEvents(),Kinetic.stages.push(this)},_validateAdd:function(a){a.getType()!=="Layer"&&Kinetic.Util.error("You may only add layers to the stage.")},setContainer:function(a){return typeof a===b&&(a=document.getElementById(a)),this._setAttr(L,a),this},draw:function(){return Kinetic.Node.prototype.draw.call(this),this},setHeight:function(a){return Kinetic.Node.prototype.setHeight.call(this,a),this._resizeDOM(),this},setWidth:function(a){return Kinetic.Node.prototype.setWidth.call(this,a),this._resizeDOM(),this},clear:function(){var a=this.children,b=a.length,c;for(c=0;c<b;c++)a[c].clear();return this},destroy:function(){var a=this.content;Kinetic.Container.prototype.destroy.call(this),a&&Kinetic.Util._isInDocument(a)&&this.getContainer().removeChild(a)},getMousePosition:function(){return this.mousePos},getTouchPosition:function(){return this.touchPos},getPointerPosition:function(){return this.getTouchPosition()||this.getMousePosition()},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(a){function i(d){var e=h[d],j=e.toDataURL(),k=new Image;k.onload=function(){g.drawImage(k,0,0),d<h.length-1?i(d+1):a.callback(f.toDataURL(b,c))},k.src=j}a=a||{};var b=a.mimeType||null,c=a.quality||null,d=a.x||0,e=a.y||0,f=new Kinetic.SceneCanvas({width:a.width||this.getWidth(),height:a.height||this.getHeight(),pixelRatio:1}),g=f.getContext()._context,h=this.children;(d||e)&&g.translate(-1*d,-1*e),i(0)},toImage:function(a){var b=a.callback;a.callback=function(a){Kinetic.Util._getImage(a,function(a){b(a)})},this.toDataURL(a)},getIntersection:function(){var a=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),b=this.getChildren(),c=b.length,d=c-1,e,f;for(e=d;e>=0;e--){f=b[e].getIntersection(a);if(f)return f}return null},_resizeDOM:function(){if(this.content){var a=this.getWidth(),b=this.getHeight(),d=this.getChildren(),e=d.length,f,g;this.content.style.width=a+c,this.content.style.height=b+c,this.bufferCanvas.setSize(a,b),this.bufferHitCanvas.setSize(a,b);for(f=0;f<e;f++)g=d[f],g.getCanvas().setSize(a,b),g.hitCanvas.setSize(a,b),g.draw()}},add:function(a){return Kinetic.Container.prototype.add.call(this,a),a.canvas.setSize(this.attrs.width,this.attrs.height),a.hitCanvas.setSize(this.attrs.width,this.attrs.height),a.draw(),this.content.appendChild(a.canvas._canvas),this},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_setPointerPosition:function(a){a||(a=window.event),this._setMousePosition(a),this._setTouchPosition(a)},_bindContentEvents:function(){var a=this,b;for(b=0;b<O;b++)P(this,N[b])},_mouseover:function(a){this._fire(t,a)},_mouseout:function(a){this._setPointerPosition(a);var b=this.targetShape;b&&!Kinetic.isDragging()&&(b._fireAndBubble(d,a),b._fireAndBubble(e,a),this.targetShape=null),this.mousePos=undefined,this._fire(r,a)},_mousemove:function(a){this._setPointerPosition(a);var b=Kinetic.DD,c=this.getIntersection(this.getPointerPosition()),i=c&&c.shape?c.shape:undefined;i?!Kinetic.isDragging()&&c.pixel[3]===255&&(!this.targetShape||this.targetShape._id!==i._id)?(this.targetShape&&(this.targetShape._fireAndBubble(d,a,i),this.targetShape._fireAndBubble(e,a,i)),i._fireAndBubble(f,a,this.targetShape),i._fireAndBubble(g,a,this.targetShape),this.targetShape=i):i._fireAndBubble(h,a):this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble(d,a),this.targetShape._fireAndBubble(e,a),this.targetShape=null),this._fire(v,a),b&&b._drag(a),a.preventDefault&&a.preventDefault()},_mousedown:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),c=b&&b.shape?b.shape:undefined;Kinetic.listenClickTap=!0,c&&(this.clickStartShape=c,c._fireAndBubble(i,a)),this._fire(w),a.preventDefault&&a.preventDefault()},_mouseup:function(a){this._setPointerPosition(a);var b=this,c=this.getIntersection(this.getPointerPosition()),d=c&&c.shape?c.shape:undefined,e=!1;Kinetic.inDblClickWindow?(e=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),d&&(d._fireAndBubble(j,a),Kinetic.listenClickTap&&d._id===this.clickStartShape._id&&(d._fireAndBubble(k,a),e&&d._fireAndBubble(l,a))),this._fire(x),Kinetic.listenClickTap&&(this._fire(y,a),e&&this._fire(z,a)),Kinetic.listenClickTap=!1,a.preventDefault&&a.preventDefault()},_touchstart:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),c=b&&b.shape?b.shape:undefined;Kinetic.listenClickTap=!0,c&&(this.tapStartShape=c,c._fireAndBubble(m,a),c.isListening()&&a.preventDefault&&a.preventDefault()),this._fire(A,a)},_touchend:function(a){this._setPointerPosition(a);var b=this,c=this.getIntersection(this.getPointerPosition()),d=c&&c.shape?c.shape:undefined,e=!1;Kinetic.inDblClickWindow?(e=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),d&&(d._fireAndBubble(n,a),Kinetic.listenClickTap&&d._id===this.tapStartShape._id&&(d._fireAndBubble(o,a),e&&d._fireAndBubble(p,a)),d.isListening()&&a.preventDefault&&a.preventDefault()),Kinetic.listenClickTap&&(this._fire(B,a),e&&this._fire(D,a)),Kinetic.listenClickTap=!1},_touchmove:function(a){this._setPointerPosition(a);var b=Kinetic.DD,c=this.getIntersection(this.getPointerPosition()),d=c&&c.shape?c.shape:undefined;d&&(d._fireAndBubble(q,a),d.isListening()&&a.preventDefault&&a.preventDefault()),this._fire(E,a),b&&b._drag(a)},_setMousePosition:function(a){var b=this._getContentPosition(),c=a.offsetX,d=a.clientX,e=0,f=0;c!==undefined?(e=c,f=a.offsetY):Kinetic.UA.browser==="mozilla"?(e=a.layerX,f=a.layerY):d!==undefined&&b&&(e=d-b.left,f=a.clientY-b.top),this.mousePos={x:e,y:f}},_setTouchPosition:function(a){var b=this._getContentPosition(),c,d,e;a.touches!==undefined&&a.touches.length===1&&(c=a.touches[0],d=c.clientX-b.left,e=c.clientY-b.top,this.touchPos={x:d,y:e})},_getContentPosition:function(){var a=this.content.getBoundingClientRect();return{top:a.top,left:a.left}},_buildDOM:function(){var a=this.getContainer();a.innerHTML=M,this.content=document.createElement(F),this.content.style.position=G,this.content.style.display=H,this.content.className=I,a.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas,this.bufferHitCanvas=new Kinetic.HitCanvas,this._resizeDOM()},_onContent:function(a,b){var c=a.split(J),d=c.length,e,f;for(e=0;e<d;e++)f=c[e],this.content.addEventListener(f,b,!1)}}),Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Factory.addGetter(Kinetic.Stage,"container")}(),function(){var a="#",b="beforeDraw",c="draw";Kinetic.Util.addMethods(Kinetic.Layer,{___init:function(a){this.nodeType="Layer",this.canvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,Kinetic.Container.call(this,a)},_validateAdd:function(a){var b=a.getType();b!=="Group"&&b!=="Shape"&&Kinetic.Util.error("You may only add groups and shapes to a layer.")},getIntersection:function(){var b=Kinetic.Util._getXY(Array.prototype.slice.call(arguments)),c,d,e;if(this.isVisible()&&this.isListening()){c=this.hitCanvas.context._context.getImageData(b.x|0,b.y|0,1,1).data;if(c[3]===255)return d=Kinetic.Util._rgbToHex(c[0],c[1],c[2]),e=Kinetic.shapes[a+d],{shape:e,pixel:c};if(c[0]>0||c[1]>0||c[2]>0||c[3]>0)return{pixel:c}}return null},drawScene:function(a){return a=a||this.getCanvas(),this._fire(b,{node:this}),this.getClearBeforeDraw()&&a.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,a),this._fire(c,{node:this}),this},drawHit:function(){var a=this.getLayer();return a&&a.getClearBeforeDraw()&&a.getHitCanvas().getContext().clear(),Kinetic.Container.prototype.drawHit.call(this),this},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(){var a=this.getContext(),b=this.getHitCanvas().getContext();return a.clear.apply(a,arguments),b.clear.apply(b,arguments),this},setVisible:function(a){return Kinetic.Node.prototype.setVisible.call(this,a),a?(this.getCanvas()._canvas.style.display="block",this.hitCanvas._canvas.style.display="block"):(this.getCanvas()._canvas.style.display="none",this.hitCanvas._canvas.style.display="none"),this},setZIndex:function(a){Kinetic.Node.prototype.setZIndex.call(this,a);var b=this.getStage();return b&&(b.content.removeChild(this.getCanvas()._canvas),a<b.getChildren().length-1?b.content.insertBefore(this.getCanvas()._canvas,b.getChildren()[a+1].getCanvas()._canvas):b.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),a.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),this.index<a.getChildren().length-1?a.content.insertBefore(this.getCanvas()._canvas,a.getChildren()[this.index+1].getCanvas()._canvas):a.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas),a.content.insertBefore(this.getCanvas()._canvas,b[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas),a.content.insertBefore(this.getCanvas()._canvas,b[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var a=this.getStage(),b=this.getCanvas(),c=b._canvas;return Kinetic.Node.prototype.remove.call(this),a&&c&&Kinetic.Util._isInDocument(c)&&a.content.removeChild(c),this},getStage:function(){return this.parent}}),Kinetic.Util.extend(Kinetic.Layer,Kinetic.Container),Kinetic.Factory.addGetterSetter(Kinetic.Layer,"clearBeforeDraw",!0)}(),function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(a){this.nodeType="Group",Kinetic.Container.call(this,a)},_validateAdd:function(a){var b=a.getType();b!=="Group"&&b!=="Shape"&&Kinetic.Util.error("You may only add groups and shapes to groups.")}}),Kinetic.Util.extend(Kinetic.Group,Kinetic.Container)}(),function(){Kinetic.Rect=function(a){this.___init(a)},Kinetic.Rect.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Rect"},drawFunc:function(a){var b=this.getCornerRadius(),c=this.getWidth(),d=this.getHeight();a.beginPath(),b?(a.moveTo(b,0),a.lineTo(c-b,0),a.arc(c-b,b,b,Math.PI*3/2,0,!1),a.lineTo(c,d-b),a.arc(c-b,d-b,b,0,Math.PI/2,!1),a.lineTo(b,d),a.arc(b,d-b,b,Math.PI/2,Math.PI,!1),a.lineTo(0,b),a.arc(b,b,b,Math.PI,Math.PI*3/2,!1)):a.rect(0,0,c,d),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Rect,"cornerRadius",0)}(),function(){var a=Math.PI*2-1e-4,b="Circle";Kinetic.Circle=function(a){this.___init(a)},Kinetic.Circle.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className=b},drawFunc:function(b){b.beginPath(),b.arc(0,0,this.getRadius(),0,a,!1),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return this.getRadius()*2},getHeight:function(){return this.getRadius()*2},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a),this.setRadius(a/2)},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a),this.setRadius(a/2)}},Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Circle,"radius",0)}(),function(){var a=Math.PI*2-1e-4,b="Ellipse";Kinetic.Ellipse=function(a){this.___init(a)},Kinetic.Ellipse.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className=b},drawFunc:function(b){var c=this.getRadius();b.beginPath(),b.save(),c.x!==c.y&&b.scale(1,c.y/c.x),b.arc(0,0,c.x,0,a,!1),b.restore(),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return this.getRadius().x*2},getHeight:function(){return this.getRadius().y*2},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a),this.setRadius({x:a/2})},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a),this.setRadius({y:a/2})}},Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Factory.addPointGetterSetter(Kinetic.Ellipse,"radius",0)}(),function(){Kinetic.Wedge=function(a){this.___init(a)},Kinetic.Wedge.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Wedge"},drawFunc:function(a){a.beginPath(),a.arc(0,0,this.getRadius(),0,this.getAngle(),this.getClockwise()),a.lineTo(0,0),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"radius",0),Kinetic.Factory.addRotationGetterSetter(Kinetic.Wedge,"angle",0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,"clockwise",!1)}(),function(){var a="Image",b="crop",c="set";Kinetic.Image=function(a){this.___init(a)},Kinetic.Image.prototype={___init:function(b){var c=this;Kinetic.Shape.call(this,b),this.className=a},_useBufferCanvas:function(){return(this.hasShadow()||this.getAbsoluteOpacity()!==1)&&this.hasStroke()},drawFunc:function(a){var b=this.getWidth(),c=this.getHeight(),d=this,e,f,g;this.getFilter()&&this._applyFilter&&(this.applyFilter(),this._applyFilter=!1),this.filterCanvas?(g=this.filterCanvas._canvas,f=[g,0,0,b,c]):(g=this.getImage(),g&&(e=this.getCrop(),e?(e.x=e.x||0,e.y=e.y||0,e.width=e.width||g.width-e.x,e.height=e.height||g.height-e.y,f=[g,e.x,e.y,e.width,e.height,0,0,b,c]):f=[g,0,0,b,c])),a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this),g&&a.drawImage.apply(a,f)},drawHitFunc:function(a){var b=this.getWidth(),c=this.getHeight(),d=this.imageHitRegion;d?(a.drawImage(d,0,0,b,c),a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.strokeShape(this)):(a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this))},applyFilter:function(){var a=this.getImage(),b=this,c=this.getWidth(),d=this.getHeight(),e=this.getFilter(),f=this.getCrop()||{},g,h,i;f.x=f.x||0,f.y=f.y||0,f.width=f.width||a.width-f.x,f.height=f.height||a.height-f.y,this.filterCanvas&&this.filterCanvas.getWidth()===f.width&&this.filterCanvas.getHeight()===f.height?(g=this.filterCanvas,g.getContext().clear()):g=this.filterCanvas=new Kinetic.SceneCanvas({width:f.width,height:f.height,pixelRatio:1}),h=g.getContext();try{h.drawImage(a,f.x,f.y,f.width,f.height,0,0,f.width,f.height),i=h.getImageData(0,0,f.width,f.height),e.call(this,i),h.putImageData(i,0,0)}catch(j){this.clearFilter(),Kinetic.Util.warn("Unable to apply filter. "+j.message)}},clearFilter:function(){this.filterCanvas=null,this._applyFilter=!1},createImageHitRegion:function(a){var b=this,c=this.getWidth(),d=this.getHeight(),e=new Kinetic.SceneCanvas({width:c,height:d}),f=e.getContext()._context,g=this.getImage(),h,i,j,k,l;f.drawImage(g,0,0);try{h=f.getImageData(0,0,c,d),i=h.data,l=i.length,j=Kinetic.Util._hexToRgb(this.colorKey);for(k=0;k<l;k+=4)i[k+3]>0&&(i[k]=j.r,i[k+1]=j.g,i[k+2]=j.b);Kinetic.Util._getImage(h,function(c){b.imageHitRegion=c,a&&a()})}catch(m){Kinetic.Util.warn("Unable to create image hit region. "+m.message)}},clearImageHitRegion:function(){delete this.imageHitRegion},getWidth:function(){var a=this.getImage();return this.attrs.width||(a?a.width:0)},getHeight:function(){var a=this.getImage();return this.attrs.height||(a?a.height:0)}},Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Factory.addFilterGetterSetter=function(a,b,c){this.addGetter(a,b,c),this.addFilterSetter(a,b)},Kinetic.Factory.addFilterSetter=function(a,b){var d=this,e=c+Kinetic.Util._capitalize(b);a.prototype[e]=function(a){this._setAttr(b,a),this._applyFilter=!0}},Kinetic.Factory.addGetterSetter(Kinetic.Image,"image"),Kinetic.Factory.addBoxGetterSetter(Kinetic.Image,"crop"),Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filter")}(),function(){Kinetic.Polygon=function(a){this.___init(a)},Kinetic.Polygon.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Polygon"},drawFunc:function(a){var b=this.getPoints(),c=b.length;a.beginPath(),a.moveTo(b[0].x,b[0].y);for(var d=1;d<c;d++)a.lineTo(b[d].x,b[d].y);a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Polygon,Kinetic.Shape),Kinetic.Factory.addPointsGetterSetter(Kinetic.Polygon,"points")}(),function(){function y(a){a.fillText(this.partialText,0,0)}function z(a){a.strokeText(this.partialText,0,0)}var a="auto",b="Calibri",c="canvas",d="center",e="Change.kinetic",f="2d",g="-",h="",i="left",j="\n",k="text",l="Text",m="top",n="middle",o="normal",p="px ",q=" ",r="right",s="word",t="char",u="none",v=["fontFamily","fontSize","fontStyle","padding","align","lineHeight","text","width","height","wrap"],w=v.length,x=document.createElement(c).getContext(f);Kinetic.Text=function(a){this.___init(a)},Kinetic.Text.prototype={___init:function(b){var c=this;b.width===undefined&&(b.width=a),b.height===undefined&&(b.height=a),Kinetic.Shape.call(this,b),this._fillFunc=y,this._strokeFunc=z,this.className=l;for(var d=0;d<w;d++)this.on(v[d]+e,c._setTextData);this._setTextData()},drawFunc:function(a){var b=this.getPadding(),c=this.getFontStyle(),e=this.getFontSize(),f=this.getFontFamily(),g=this.getTextHeight(),h=this.getLineHeight()*g,j=this.textArr,k=j.length,l=this.getWidth();a.setAttr("font",this._getContextFont()),a.setAttr("textBaseline",n),a.setAttr("textAlign",i),a.save(),a.translate(b,0),a.translate(0,b+g/2);for(var m=0;m<k;m++){var o=j[m],p=o.text,q=o.width;a.save(),this.getAlign()===r?a.translate(l-q-b*2,0):this.getAlign()===d&&a.translate((l-q-b*2)/2,0),this.partialText=p,a.fillStrokeShape(this),a.restore(),a.translate(0,h)}a.restore()},drawHitFunc:function(a){var b=this.getWidth(),c=this.getHeight();a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this)},setText:function(a){var b=Kinetic.Util._isString(a)?a:a.toString();this._setAttr(k,b)},getWidth:function(){return this.attrs.width===a?this.getTextWidth()+this.getPadding()*2:this.attrs.width},getHeight:function(){return this.attrs.height===a?this.getTextHeight()*this.textArr.length*this.getLineHeight()+this.getPadding()*2:this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(a){var b=x,c=this.getFontSize(),d;return b.save(),b.font=this._getContextFont(),d=b.measureText(a),b.restore(),{width:d.width,height:parseInt(c,10)}},_getContextFont:function(){return this.getFontStyle()+q+this.getFontSize()+p+this.getFontFamily()},_addTextLine:function(a,b,c){return this.textArr.push({text:a,width:b})},_getTextWidth:function(a){return x.measureText(a).width},_setTextData:function(){var b=this.getText().split("\n"),c=+this.getFontSize(),d=0,e=this.getLineHeight()*c,f=this.attrs.width,h=this.attrs.height,i=f!==a,j=h!==a,k=this.getPadding(),l=f-k*2,m=h-k*2,n=0,o=this.getWrap(),r=o!==u,s=o!==t&&r;this.textArr=[],x.save(),x.font=this.getFontStyle()+q+c+p+this.getFontFamily();for(var v=0,w=b.length;v<w;++v){var y=b[v],z=this._getTextWidth(y);if(i&&z>l)while(y.length>0){var A=0,B=y.length,C="",D=0;while(A<B){var E=A+B>>>1,F=y.slice(0,E+1),G=this._getTextWidth(F);G<=l?(A=E+1,C=F,D=G):B=E}if(!C)break;if(s){var H=Math.max(C.lastIndexOf(q),C.lastIndexOf(g))+1;H>0&&(A=H,C=C.slice(0,A),D=this._getTextWidth(C))}this._addTextLine(C,D),n+=e;if(!r||j&&n+e>m)break;y=y.slice(A);if(y.length>0){z=this._getTextWidth(y);if(z<=l){this._addTextLine(y,z),n+=e;break}}}else this._addTextLine(y,z),n+=e,d=Math.max(d,z);if(j&&n+e>m)break}x.restore(),this.textHeight=c,this.textWidth=d}},Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontFamily",b),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.Text,"fontStyle",o),Kinetic.Factory.addGetterSetter(Kinetic.Text,"padding",0),Kinetic.Factory.addGetterSetter(Kinetic.Text,"align",i),Kinetic.Factory.addGetterSetter(Kinetic.Text,"lineHeight",1),Kinetic.Factory.addGetterSetter(Kinetic.Text,"wrap",s),Kinetic.Factory.addGetter(Kinetic.Text,k,h),Kinetic.Factory.addSetter(Kinetic.Text,"width"),Kinetic.Factory.addSetter(Kinetic.Text,"height")}(),function(){Kinetic.Line=function(a){this.___init(a)},Kinetic.Line.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Line"},drawFunc:function(a){var b=this.getPoints(),c=b.length,d,e;a.beginPath(),a.moveTo(b[0].x,b[0].y);for(d=1;d<c;d++)e=b[d],a.lineTo(e.x,e.y);a.strokeShape(this)}},Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Factory.addPointsGetterSetter(Kinetic.Line,"points")}(),function(){Kinetic.Spline=function(a){this.___init(a)},Kinetic.Spline.prototype={___init:function(a){var b=this;Kinetic.Shape.call(this,a),this.className="Spline",this.on("pointsChange.kinetic tensionChange.kinetic",function(){b._setAllPoints()}),this._setAllPoints()},drawFunc:function(a){var b=this.getPoints(),c=b.length,d=this.getTension(),e,f,g,h;a.beginPath(),a.moveTo(b[0].x,b[0].y);if(d!==0&&c>2){e=this.allPoints,f=e.length,g=2,a.quadraticCurveTo(e[0].x,e[0].y,e[1].x,e[1].y);while(g<f-1)a.bezierCurveTo(e[g].x,e[g++].y,e[g].x,e[g++].y,e[g].x,e[g++].y);a.quadraticCurveTo(e[f-1].x,e[f-1].y,b[c-1].x,b[c-1].y)}else for(g=1;g<c;g++)h=b[g],a.lineTo(h.x,h.y);a.strokeShape(this)},_setAllPoints:function(){this.allPoints=Kinetic.Util._expandPoints(this.getPoints(),this.getTension())}},Kinetic.Util.extend(Kinetic.Spline,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Spline,"tension",1),Kinetic.Factory.addPointsGetterSetter(Kinetic.Spline,"points")}(),function(){Kinetic.Blob=function(a){this.___init(a)},Kinetic.Blob.prototype={___init:function(a){var b=this;Kinetic.Shape.call(this,a),this.className="Blob",this.on("pointsChange.kinetic tensionChange.kinetic",function(){b._setAllPoints()}),this._setAllPoints()},drawFunc:function(a){var b=this.getPoints(),c=b.length,d=this.getTension(),e,f,g,h;a.beginPath(),a.moveTo(b[0].x,b[0].y);if(d!==0&&c>2){e=this.allPoints,f=e.length,g=0;while(g<f-1)a.bezierCurveTo(e[g].x,e[g++].y,e[g].x,e[g++].y,e[g].x,e[g++].y)}else for(g=1;g<c;g++)h=b[g],a.lineTo(h.x,h.y);a.closePath(),a.fillStrokeShape(this)},_setAllPoints:function(){var a=this.getPoints(),b=a.length,c=this.getTension(),d=Kinetic.Util,e=d._getControlPoints(a[b-1],a[0],a[1],c),f=d._getControlPoints(a[b-2],a[b-1],a[0],c);this.allPoints=Kinetic.Util._expandPoints(this.getPoints(),this.getTension()),this.allPoints.unshift(e[1]),this.allPoints.push(f[0]),this.allPoints.push(a[b-1]),this.allPoints.push(f[1]),this.allPoints.push(e[0]),this.allPoints.push(a[0])}},Kinetic.Util.extend(Kinetic.Blob,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Blob,"tension",1),Kinetic.Factory.addPointsGetterSetter(Kinetic.Blob,"points")}(),function(){Kinetic.Sprite=function(a){this.___init(a)},Kinetic.Sprite.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Sprite",this.anim=new Kinetic.Animation;var b=this;this.on("animationChange.kinetic",function(){b.setIndex(0)})},drawFunc:function(a){var b=this.getAnimation(),c=this.getIndex(),d=this.getAnimations()[b][c],e=this.getImage();e&&a.drawImage(e,d.x,d.y,d.width,d.height,0,0,d.width,d.height)},drawHitFunc:function(a){var b=this.getAnimation(),c=this.getIndex(),d=this.getAnimations()[b][c];a.beginPath(),a.rect(0,0,d.width,d.height),a.closePath(),a.fillShape(this)},_useBufferCanvas:function(){return(this.hasShadow()||this.getAbsoluteOpacity()!==1)&&this.hasStroke()},start:function(){var a=this,b=this.getLayer();this.anim.setLayers(b),this.interval=setInterval(function(){var b=a.getIndex();a._updateIndex(),a.afterFrameFunc&&b===a.afterFrameIndex&&(a.afterFrameFunc(),delete a.afterFrameFunc,delete a.afterFrameIndex)},1e3/this.getFrameRate()),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},afterFrame:function(a,b){this.afterFrameIndex=a,this.afterFrameFunc=b},_updateIndex:function(){var a=this.getIndex(),b=this.getAnimation(),c=this.getAnimations(),d=c[b],e=d.length;a<e-1?this.setIndex(a+1):this.setIndex(0)}},Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animation"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"animations"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"image"),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"index",0),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,"frameRate",17)}(),function(){Kinetic.Path=function(a){this.___init(a)},Kinetic.Path.prototype={___init:function(a){this.dataArray=[];var b=this;Kinetic.Shape.call(this,a),this.className="Path",this.dataArray=Kinetic.Path.parsePathData(this.getData()),this.on("dataChange.kinetic",function(){b.dataArray=Kinetic.Path.parsePathData(this.getData())})},drawFunc:function(a){var b=this.dataArray,c=!1;a.beginPath();for(var d=0;d<b.length;d++){var e=b[d].command,f=b[d].points;switch(e){case"L":a.lineTo(f[0],f[1]);break;case"M":a.moveTo(f[0],f[1]);break;case"C":a.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5]);break;case"Q":a.quadraticCurveTo(f[0],f[1],f[2],f[3]);break;case"A":var g=f[0],h=f[1],i=f[2],j=f[3],k=f[4],l=f[5],m=f[6],n=f[7],o=i>j?i:j,p=i>j?1:i/j,q=i>j?j/i:1;a.translate(g,h),a.rotate(m),a.scale(p,q),a.arc(0,0,o,k,k+l,1-n),a.scale(1/p,1/q),a.rotate(-m),a.translate(-g,-h);break;case"z":a.closePath(),c=!0}}c?a.fillStrokeShape(this):a.strokeShape(this)}},Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))},Kinetic.Path.getPointOnLine=function(a,b,c,d,e,f,g){f===undefined&&(f=b),g===undefined&&(g=c);var h=(e-c)/(d-b+1e-8),i=Math.sqrt(a*a/(1+h*h));d<b&&(i*=-1);var j=h*i,k;if(d===b)k={x:f,y:g+j};else if((g-c)/(f-b+1e-8)===h)k={x:f+i,y:g+j};else{var l,m,n=this.getLineLength(b,c,d,e);if(n<1e-8)return undefined;var o=(f-b)*(d-b)+(g-c)*(e-c);o/=n*n,l=b+o*(d-b),m=c+o*(e-c);var p=this.getLineLength(f,g,l,m),q=Math.sqrt(a*a-p*p);i=Math.sqrt(q*q/(1+h*h)),d<b&&(i*=-1),j=h*i,k={x:l+i,y:m+j}}return k},Kinetic.Path.getPointOnCubicBezier=function(a,b,c,d,e,f,g,h,i){function j(a){return a*a*a}function k(a){return 3*a*a*(1-a)}function l(a){return 3*a*(1-a)*(1-a)}function m(a){return(1-a)*(1-a)*(1-a)}var n=h*j(a)+f*k(a)+d*l(a)+b*m(a),o=i*j(a)+g*k(a)+e*l(a)+c*m(a);return{x:n,y:o}},Kinetic.Path.getPointOnQuadraticBezier=function(a,b,c,d,e,f,g){function h(a){return a*a}function i(a){return 2*a*(1-a)}function j(a){return(1-a)*(1-a)}var k=f*h(a)+d*i(a)+b*j(a),l=g*h(a)+e*i(a)+c*j(a);return{x:k,y:l}},Kinetic.Path.getPointOnEllipticalArc=function(a,b,c,d,e,f){var g=Math.cos(f),h=Math.sin(f),i={x:c*Math.cos(e),y:d*Math.sin(e)};return{x:a+(i.x*g-i.y*h),y:b+(i.x*h+i.y*g)}},Kinetic.Path.parsePathData=function(a){if(!a)return[];var b=a,c=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];b=b.replace(new RegExp(" ","g"),",");for(var d=0;d<c.length;d++)b=b.replace(new RegExp(c[d],"g"),"|"+c[d]);var e=b.split("|"),f=[],g=0,h=0;for(d=1;d<e.length;d++){var i=e[d],j=i.charAt(0);i=i.slice(1),i=i.replace(new RegExp(",-","g"),"-"),i=i.replace(new RegExp("-","g"),",-"),i=i.replace(new RegExp("e,-","g"),"e-");var k=i.split(",");k.length>0&&k[0]===""&&k.shift();for(var l=0;l<k.length;l++)k[l]=parseFloat(k[l]);while(k.length>0){if(isNaN(k[0]))break;var m=null,n=[],o=g,p=h,q,r,s,t,u,v,w,x,y,z;switch(j){case"l":g+=k.shift(),h+=k.shift(),m="L",n.push(g,h);break;case"L":g=k.shift(),h=k.shift(),n.push(g,h);break;case"m":g+=k.shift(),h+=k.shift(),m="M",n.push(g,h),j="l";break;case"M":g=k.shift(),h=k.shift(),m="M",n.push(g,h),j="L";break;case"h":g+=k.shift(),m="L",n.push(g,h);break;case"H":g=k.shift(),m="L",n.push(g,h);break;case"v":h+=k.shift(),m="L",n.push(g,h);break;case"V":h=k.shift(),m="L",n.push(g,h);break;case"C":n.push(k.shift(),k.shift(),k.shift(),k.shift()),g=k.shift(),h=k.shift(),n.push(g,h);break;case"c":n.push(g+k.shift(),h+k.shift(),g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),m="C",n.push(g,h);break;case"S":r=g,s=h,q=f[f.length-1],q.command==="C"&&(r=g+(g-q.points[2]),s=h+(h-q.points[3])),n.push(r,s,k.shift(),k.shift()),g=k.shift(),h=k.shift(),m="C",n.push(g,h);break;case"s":r=g,s=h,q=f[f.length-1],q.command==="C"&&(r=g+(g-q.points[2]),s=h+(h-q.points[3])),n.push(r,s,g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),m="C",n.push(g,h);break;case"Q":n.push(k.shift(),k.shift()),g=k.shift(),h=k.shift(),n.push(g,h);break;case"q":n.push(g+k.shift(),h+k.shift()),g+=k.shift(),h+=k.shift(),m="Q",n.push(g,h);break;case"T":r=g,s=h,q=f[f.length-1],q.command==="Q"&&(r=g+(g-q.points[0]),s=h+(h-q.points[1])),g=k.shift(),h=k.shift(),m="Q",n.push(r,s,g,h);break;case"t":r=g,s=h,q=f[f.length-1],q.command==="Q"&&(r=g+(g-q.points[0]),s=h+(h-q.points[1])),g+=k.shift(),h+=k.shift(),m="Q",n.push(r,s,g,h);break;case"A":t=k.shift(),u=k.shift(),v=k.shift(),w=k.shift(),x=k.shift(),y=g,z=h,g=k.shift(),h=k.shift(),m="A",n=this.convertEndpointToCenterParameterization(y,z,g,h,w,x,t,u,v);break;case"a":t=k.shift(),u=k.shift(),v=k.shift(),w=k.shift(),x=k.shift(),y=g,z=h,g+=k.shift(),h+=k.shift(),m="A",n=this.convertEndpointToCenterParameterization(y,z,g,h,w,x,t,u,v)}f.push({command:m||j,points:n,start:{x:o,y:p},pathLength:this.calcLength(o,p,m||j,n)})}(j==="z"||j==="Z")&&f.push({command:"z",points:[],start:undefined,pathLength:0})}return f},Kinetic.Path.calcLength=function(a,b,c,d){var e,f,g,h=Kinetic.Path;switch(c){case"L":return h.getLineLength(a,b,d[0],d[1]);case"C":e=0,f=h.getPointOnCubicBezier(0,a,b,d[0],d[1],d[2],d[3],d[4],d[5]);for(t=.01;t<=1;t+=.01)g=h.getPointOnCubicBezier(t,a,b,d[0],d[1],d[2],d[3],d[4],d[5]),e+=h.getLineLength(f.x,f.y,g.x,g.y),f=g;return e;case"Q":e=0,f=h.getPointOnQuadraticBezier(0,a,b,d[0],d[1],d[2],d[3]);for(t=.01;t<=1;t+=.01)g=h.getPointOnQuadraticBezier(t,a,b,d[0],d[1],d[2],d[3]),e+=h.getLineLength(f.x,f.y,g.x,g.y),f=g;return e;case"A":e=0;var i=d[4],j=d[5],k=d[4]+j,l=Math.PI/180;Math.abs(i-k)<l&&(l=Math.abs(i-k)),f=h.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],i,0);if(j<0)for(t=i-l;t>k;t-=l)g=h.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],t,0),e+=h.getLineLength(f.x,f.y,g.x,g.y),f=g;else for(t=i+l;t<k;t+=l)g=h.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],t,0),e+=h.getLineLength(f.x,f.y,g.x,g.y),f=g;return g=h.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],k,0),e+=h.getLineLength(f.x,f.y,g.x,g.y),e}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(a,b,c,d,e,f,g,h,i){var j=i*(Math.PI/180),k=Math.cos(j)*(a-c)/2+Math.sin(j)*(b-d)/2,l=-1*Math.sin(j)*(a-c)/2+Math.cos(j)*(b-d)/2,m=k*k/(g*g)+l*l/(h*h);m>1&&(g*=Math.sqrt(m),h*=Math.sqrt(m));var n=Math.sqrt((g*g*h*h-g*g*l*l-h*h*k*k)/(g*g*l*l+h*h*k*k));e==f&&(n*=-1),isNaN(n)&&(n=0);var o=n*g*l/h,p=n*-h*k/g,q=(a+c)/2+Math.cos(j)*o-Math.sin(j)*p,r=(b+d)/2+Math.sin(j)*o+Math.cos(j)*p,s=function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])},t=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(s(a)*s(b))},u=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(t(a,b))},v=u([1,0],[(k-o)/g,(l-p)/h]),w=[(k-o)/g,(l-p)/h],x=[(-1*k-o)/g,(-1*l-p)/h],y=u(w,x);return t(w,x)<=-1&&(y=Math.PI),t(w,x)>=1&&(y=0),f===0&&y>0&&(y-=2*Math.PI),f==1&&y<0&&(y+=2*Math.PI),[q,r,g,h,v,y,j,f]},Kinetic.Factory.addGetterSetter(Kinetic.Path,"data")}(),function(){function d(a){a.fillText(this.partialText,0,0)}function e(a){a.strokeText(this.partialText,0,0)}var a="",b="Calibri",c="normal";Kinetic.TextPath=function(a){this.___init(a)},Kinetic.TextPath.prototype={___init:function(a){var b=this;this.dummyCanvas=document.createElement("canvas"),this.dataArray=[],Kinetic.Shape.call(this,a),this._fillFunc=d,this._strokeFunc=e,this.className="TextPath",this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on("dataChange.kinetic",function(){b.dataArray=Kinetic.Path.parsePathData(this.attrs.data)}),this.on("textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic",b._setTextData),b._setTextData()},drawFunc:function(a){var b=this.charArr;a.setAttr("font",this._getContextFont()),a.setAttr("textBaseline","middle"),a.setAttr("textAlign","left"),a.save();var c=this.glyphInfo;for(var d=0;d<c.length;d++){a.save();var e=c[d].p0,f=c[d].p1,g=parseFloat(this.attrs.fontSize);a.translate(e.x,e.y),a.rotate(c[d].rotation),this.partialText=c[d].text,a.fillStrokeShape(this),a.restore()}a.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(a){Kinetic.Text.prototype.setText.call(this,a)},_getTextSize:function(a){var b=this.dummyCanvas,c=b.getContext("2d");c.save(),c.font=this._getContextFont();var d=c.measureText(a);return c.restore(),{width:d.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var a=this,b=this._getTextSize(this.attrs.text);this.textWidth=b.width,this.textHeight=b.height,this.glyphInfo=[];var c=this.attrs.text.split(""),d,e,f,g=-1,h=0,i=function(){h=0;var b=a.dataArray;for(var c=g+1;c<b.length;c++){if(b[c].pathLength>0)return g=c,b[c];b[c].command=="M"&&(d={x:b[c].points[0],y:b[c].points[1]})}return{}},j=function(b,c){var g=a._getTextSize(b).width,j=0,k=0,l=!1;e=undefined;while(Math.abs(g-j)/g>.01&&k<25){k++;var m=j;while(f===undefined)f=i(),f&&m+f.pathLength<g&&(m+=f.pathLength,f=undefined);if(f==={}||d===undefined)return undefined;var n=!1;switch(f.command){case"L":Kinetic.Path.getLineLength(d.x,d.y,f.points[0],f.points[1])>g?e=Kinetic.Path.getPointOnLine(g,d.x,d.y,f.points[0],f.points[1],d.x,d.y):f=undefined;break;case"A":var o=f.points[4],p=f.points[5],q=f.points[4]+p;h===0?h=o+1e-8:g>j?h+=Math.PI/180*p/Math.abs(p):h-=Math.PI/360*p/Math.abs(p);if(p<0&&h<q||p>=0&&h>q)h=q,n=!0;e=Kinetic.Path.getPointOnEllipticalArc(f.points[0],f.points[1],f.points[2],f.points[3],h,f.points[6]);break;case"C":h===0?g>f.pathLength?h=1e-8:h=g/f.pathLength:g>j?h+=(g-j)/f.pathLength:h-=(j-g)/f.pathLength,h>1&&(h=1,n=!0),e=Kinetic.Path.getPointOnCubicBezier(h,f.start.x,f.start.y,f.points[0],f.points[1],f.points[2],f.points[3],f.points[4],f.points[5]);break;case"Q":h===0?h=g/f.pathLength:g>j?h+=(g-j)/f.pathLength:h-=(j-g)/f.pathLength,h>1&&(h=1,n=!0),e=Kinetic.Path.getPointOnQuadraticBezier(h,f.start.x,f.start.y,f.points[0],f.points[1],f.points[2],f.points[3])}e!==undefined&&(j=Kinetic.Path.getLineLength(d.x,d.y,e.x,e.y)),n&&(n=!1,f=undefined)}};for(var k=0;k<c.length;k++){j(c[k]);if(d===undefined||e===undefined)break;var l=Kinetic.Path.getLineLength(d.x,d.y,e.x,e.y),m=0,n=Kinetic.Path.getPointOnLine(m+l/2,d.x,d.y,e.x,e.y),o=Math.atan2(e.y-d.y,e.x-d.x);this.glyphInfo.push({transposeX:n.x,transposeY:n.y,text:c[k],rotation:o,p0:d,p1:e}),d=e}}},Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont,Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontFamily",b),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontSize",12),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,"fontStyle",c),Kinetic.Factory.addGetter(Kinetic.TextPath,"text",a)}(),function(){Kinetic.RegularPolygon=function(a){this.___init(a)},Kinetic.RegularPolygon.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="RegularPolygon"},drawFunc:function(a){var b=this.attrs.sides,c=this.attrs.radius,d,e,f;a.beginPath(),a.moveTo(0,0-c);for(d=1;d<b;d++)e=c*Math.sin(d*2*Math.PI/b),f=-1*c*Math.cos(d*2*Math.PI/b),a.lineTo(e,f);a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"radius",0),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,"sides",0)}(),function(){Kinetic.Star=function(a){this.___init(a)},Kinetic.Star.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Star"},drawFunc:function(a){var b=a._context,c=this.attrs.innerRadius,d=this.attrs.outerRadius,e=this.attrs.numPoints;b.beginPath(),b.moveTo(0,0-this.attrs.outerRadius);for(var f=1;f<e*2;f++){var g=f%2===0?d:c,h=g*Math.sin(f*Math.PI/e),i=-1*g*Math.cos(f*Math.PI/e);b.lineTo(h,i)}b.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Star,"numPoints",0),Kinetic.Factory.addGetterSetter(Kinetic.Star,"innerRadius",0),Kinetic.Factory.addGetterSetter(Kinetic.Star,"outerRadius",0)}(),function(){var a=["fontFamily","fontSize","fontStyle","padding","lineHeight","text"],b="Change.kinetic",c="none",d="up",e="right",f="down",g="left",h="Label",i=a.length;Kinetic.Label=function(a){this.____init(a)},Kinetic.Label.prototype={____init:function(a){var b=this;this.className=h,Kinetic.Group.call(this,a),this.on("add.kinetic",function(a){b._addListeners(a.child),b._sync()})},getText:function(){return this.find("Text")[0]},getTag:function(){return this.find("Tag")[0]},_addListeners:function(c){var d=this,e,f=function(){d._sync()};for(e=0;e<i;e++)c.on(a[e]+b,f)},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var a=this.getText(),b=this.getTag(),c,h,i,j,k,l;if(a&&b){c=a.getWidth(),h=a.getHeight(),i=b.getPointerDirection(),j=b.getPointerWidth(),pointerHeight=b.getPointerHeight(),k=0,l=0;switch(i){case d:k=c/2,l=-1*pointerHeight;break;case e:k=c+j,l=h/2;break;case f:k=c/2,l=h+pointerHeight;break;case g:k=-1*j,l=h/2}b.setAttrs({x:-1*k,y:-1*l,width:c,height:h}),a.setAttrs({x:-1*k,y:-1*l})}}},Kinetic.Util.extend(Kinetic.Label,Kinetic.Group),Kinetic.Tag=function(a){this.___init(a)},Kinetic.Tag.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className="Tag"},drawFunc:function(a){var b=this.getWidth(),c=this.getHeight(),h=this.getPointerDirection(),i=this.getPointerWidth(),j=this.getPointerHeight(),k=this.getCornerRadius();a.beginPath(),a.moveTo(0,0),h===d&&(a.lineTo((b-i)/2,0),a.lineTo(b/2,-1*j),a.lineTo((b+i)/2,0)),a.lineTo(b,0),h===e&&(a.lineTo(b,(c-j)/2),a.lineTo(b+i,c/2),a.lineTo(b,(c+j)/2)),a.lineTo(b,c),h===f&&(a.lineTo((b+i)/2,c),a.lineTo(b/2,c+j),a.lineTo((b-i)/2,c)),a.lineTo(0,c),h===g&&(a.lineTo(0,(c+j)/2),a.lineTo(-1*i,c/2),a.lineTo(0,(c-j)/2)),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerDirection",c),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerWidth",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"pointerHeight",0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,"cornerRadius",0)}(),function(){Kinetic.Filters.Grayscale=function(a){var b=a.data;for(var c=0;c<b.length;c+=4){var d=.34*b[c]+.5*b[c+1]+.16*b[c+2];b[c]=d,b[c+1]=d,b[c+2]=d}}}(),function(){Kinetic.Filters.Brighten=function(a){var b=this.getFilterBrightness(),c=a.data;for(var d=0;d<c.length;d+=4)c[d]+=b,c[d+1]+=b,c[d+2]+=b},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterBrightness",0)}(),function(){Kinetic.Filters.Invert=function(a){var b=a.data;for(var c=0;c<b.length;c+=4)b[c]=255-b[c],b[c+1]=255-b[c+1],b[c+2]=255-b[c+2]}}(),function(){function a(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function d(d,e){var f=d.data,g=d.width,h=d.height,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G=e+e+1,H=g-1,I=h-1,J=e+1,K=J*(J+1)/2,L=new a,M=null,N=L,O=null,P=null,Q=b[e],R=c[e];for(k=1;k<G;k++)N=N.next=new a,k==J&&(M=N);N.next=L,o=n=0;for(j=0;j<h;j++){x=y=z=A=p=q=r=s=0,t=J*(B=f[n]),u=J*(C=f[n+1]),v=J*(D=f[n+2]),w=J*(E=f[n+3]),p+=K*B,q+=K*C,r+=K*D,s+=K*E,N=L;for(k=0;k<J;k++)N.r=B,N.g=C,N.b=D,N.a=E,N=N.next;for(k=1;k<J;k++)l=n+((H<k?H:k)<<2),p+=(N.r=B=f[l])*(F=J-k),q+=(N.g=C=f[l+1])*F,r+=(N.b=D=f[l+2])*F,s+=(N.a=E=f[l+3])*F,x+=B,y+=C,z+=D,A+=E,N=N.next;O=L,P=M;for(i=0;i<g;i++)f[n+3]=E=s*Q>>R,E!==0?(E=255/E,f[n]=(p*Q>>R)*E,f[n+1]=(q*Q>>R)*E,f[n+2]=(r*Q>>R)*E):f[n]=f[n+1]=f[n+2]=0,p-=t,q-=u,r-=v,s-=w,t-=O.r,u-=O.g,v-=O.b,w-=O.a,l=o+((l=i+e+1)<H?l:H)<<2,x+=O.r=f[l],y+=O.g=f[l+1],z+=O.b=f[l+2],A+=O.a=f[l+3],p+=x,q+=y,r+=z,s+=A,O=O.next,t+=B=P.r,u+=C=P.g,v+=D=P.b,w+=E=P.a,x-=B,y-=C,z-=D,A-=E,P=P.next,n+=4;o+=g}for(i=0;i<g;i++){y=z=A=x=q=r=s=p=0,n=i<<2,t=J*(B=f[n]),u=J*(C=f[n+1]),v=J*(D=f[n+2]),w=J*(E=f[n+3]),p+=K*B,q+=K*C,r+=K*D,s+=K*E,N=L;for(k=0;k<J;k++)N.r=B,N.g=C,N.b=D,N.a=E,N=N.next;m=g;for(k=1;k<=e;k++)n=m+i<<2,p+=(N.r=B=f[n])*(F=J-k),q+=(N.g=C=f[n+1])*F,r+=(N.b=D=f[n+2])*F,s+=(N.a=E=f[n+3])*F,x+=B,y+=C,z+=D,A+=E,N=N.next,k<I&&(m+=g);n=i,O=L,P=M;for(j=0;j<h;j++)l=n<<2,f[l+3]=E=s*Q>>R,E>0?(E=255/E,f[l]=(p*Q>>R)*E,f[l+1]=(q*Q>>R)*E,f[l+2]=(r*Q>>R)*E):f[l]=f[l+1]=f[l+2]=0,p-=t,q-=u,r-=v,s-=w,t-=O.r,u-=O.g,v-=O.b,w-=O.a,l=i+((l=j+J)<I?l:I)*g<<2,p+=x+=O.r=f[l],q+=y+=O.g=f[l+1],r+=z+=O.b=f[l+2],s+=A+=O.a=f[l+3],O=O.next,t+=B=P.r,u+=C=P.g,v+=D=P.b,w+=E=P.a,x-=B,y-=C,z-=D,A-=E,P=P.next,n+=g}}var b=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],c=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(a){var b=this.getFilterRadius()|0;b>0&&d(a,b)},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterRadius",0)}(),function(){function a(a,b,c){var d=(c*a.width+b)*4,e=[];return e.push(a.data[d++],a.data[d++],a.data[d++],a.data[d++]),e}function b(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))}function c(a){var b=[0,0,0];for(var c=0;c<a.length;c++)b[0]+=a[c][0],b[1]+=a[c][1],b[2]+=a[c][2];return b[0]/=a.length,b[1]/=a.length,b[2]/=a.length,b}function d(d,e){var f=a(d,0,0),g=a(d,d.width-1,0),h=a(d,0,d.height-1),i=a(d,d.width-1,d.height-1),j=e||10;if(b(f,g)<j&&b(g,i)<j&&b(i,h)<j&&b(h,f)<j){var k=c([g,f,i,h]),l=[];for(var m=0;m<d.width*d.height;m++){var n=b(k,[d.data[m*4],d.data[m*4+1],d.data[m*4+2]]);l[m]=n<j?0:255}return l}}function e(a,b){for(var c=0;c<a.width*a.height;c++)a.data[4*c+3]=b[c]}function f(a,b,c){var d=[1,1,1,1,0,1,1,1,1],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[];for(var h=0;h<c;h++)for(var i=0;i<b;i++){var j=h*b+i,k=0;for(var l=0;l<e;l++)for(var m=0;m<e;m++){var n=h+l-f,o=i+m-f;if(n>=0&&n<c&&o>=0&&o<b){var p=n*b+o,q=d[l*e+m];k+=a[p]*q}}g[j]=k===2040?255:0}return g}function g(a,b,c){var d=[1,1,1,1,1,1,1,1,1],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[];for(var h=0;h<c;h++)for(var i=0;i<b;i++){var j=h*b+i,k=0;for(var l=0;l<e;l++)for(var m=0;m<e;m++){var n=h+l-f,o=i+m-f;if(n>=0&&n<c&&o>=0&&o<b){var p=n*b+o,q=d[l*e+m];k+=a[p]*q}}g[j]=k>=1020?255:0}return g}function h(a,b,c){var d=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],e=Math.round(Math.sqrt(d.length)),f=Math.floor(e/2),g=[];for(var h=0;h<c;h++)for(var i=0;i<b;i++){var j=h*b+i,k=0;for(var l=0;l<e;l++)for(var m=0;m<e;m++){var n=h+l-f,o=i+m-f;if(n>=0&&n<c&&o>=0&&o<b){var p=n*b+o,q=d[l*e+m];k+=a[p]*q}}g[j]=k}return g}Kinetic.Filters.Mask=function(a){var b=this.getFilterThreshold(),c=d(a,b);return c&&(c=f(c,a.width,a.height),c=g(c,a.width,a.height),c=h(c,a.width,a.height),e(a,c)),a},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterThreshold",0)}(),function(){var a=function(a,b,c){a/=255,b/=255,c/=255;var d=Math.max(a,b,c),e=Math.min(a,b,c),f=d-e,g=f/2,h=f/(1-Math.abs(2*g-1)),i=0;return d==a?i=(b-c)/f%6:d==b?i=(c-a)/f+2:d==c&&(i=(a-b)/f+4),[(i*60+360)%360,h,g]},b=function(a,b,c,d){a/=255,b/=255,c/=255;var e=Math.max(a,b,c),f=Math.min(a,b,c),g=e-f,h=g/2,i=g/(1-Math.abs(2*h-1)),j=0;e==a?j=(b-c)/g%6:e==b?j=(c-a)/g+2:e==c&&(j=(a-b)/g+4),j*=60,j%=360,j+=d,j%=360,j/=60;var k=0,l=0,m=0,n=g*(1-Math.abs(j%2-1)),o=h-g/2;return 0<=j&&j<1?(k=g,l=n):1<=j&&j<2?(l=g,k=n):2<=j&&j<3?(l=g,m=n):3<=j&&j<4?(m=g,l=n):4<=j&&j<5?(m=g,k=n):5<=j&&j<6&&(k=g,m=n),k+=o,l+=o,m+=o,k=255*k,l=255*l,m=255*m,[k,l,m]},c=function(a,c){var d=a.data,e;for(var f=0;f<d.length;f+=4)e=b(d[f+0],d[f+1],d[f+2],c),d[f+0]=e[0],d[f+1]=e[1],d[f+2]=e[2]};Kinetic.Filters.ShiftHue=function(a){c(a,this.getFilterHueShiftDeg()%360)},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterHueShiftDeg",0),Kinetic.Filters.Colorize=function(b){var d=b.data,e=this.getFilterColorizeColor(),f=a(e[0],e[1],e[2]),g=f[0];for(var h=0;h<d.length;h+=4)d[h+1]=0,d[h+2]=0;c(b,g)},Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterColorizeColor",[255,0,0])}(),function(){var a=function(a,b){var c=a.data,d=a.width,e=a.height,f=d*e,g,h=[];h.length=d*e*4;var i=b.length,j=b[0].length,k=Math.floor(b.length/2),l=Math.floor(b[0].length/2),m,n,o,p,q,r,s,t,u,v,w;for(r=0;r<e;r+=1)for(q=0;q<d;q+=1){m=0,n=0,o=0,p=0;for(v=0;v<i;v+=1)for(w=0;w<j;w+=1)s=(q+v-k)%d,s=s>0?s:-s,t=(r+v-l)%e,t=t>0?t:-t,u=(t*d+s)*4,m+=b[w][v]*c[u+0],n+=b[w][v]*c[u+1],o+=b[w][v]*c[u+2];u=(r*d+q)*4,h[u+0]=m,h[u+1]=n,h[u+2]=o}var x=f*4;for(u=0;u<x;u+=4)c[u+0]=h[u+0],c[u+1]=h[u+1],c[u+2]=h[u+2]},b=function(a,b,c){var d=a-b;return Math.pow(Math.E,-d*d/(2*c*c))},c=function(a,c,d){a%2===0&&(a+=1);var e=[],f,g,h;for(f=0;f<a;f+=1){h=[];for(g=0;g<a;g+=1)h.push(c*b(f,a/2,d)*b(g,a/2,d));e.push(h)}return e},d=function(a,c,d){a%2===0&&(a+=1);var e=[],f,g,h,i;for(f=0;f<a;f+=1){h=[];for(g=0;g<a;g+=1)g1=b(f,a/2,d)*b(g,a/2,d),g2=b(f,a/2,d*1.6)*b(g,a/2,d*1.6),h.push(c*(g2-g1));e.push(h)}return e},e=function(a,b){var d=c(a,b,1),e=Math.floor(a/2);return d[e][e]+=1-b,d},f=function(a,b){var d=c(a,-b,1),e=Math.floor(a/2);return d[e][e]+=1+b,d};Kinetic.Factory.addFilterGetterSetter(Kinetic.Image,"filterAmount",50),Kinetic.Filters.UnsharpMask=function(b){a(b,f(5,this.getFilterAmount()/100))},Kinetic.Filters.SoftBlur=function(b){a(b,e(5,this.getFilterAmount()/100))},Kinetic.Filters.Edge=function(b){var c=this.getFilterAmount()/100;if(c===0)return;a(b,[[0,-1*c,0],[-1*c,1-c+4*c,-1*c],[0,-1*c,0]])},Kinetic.Filters.Emboss=function(b){var c=this.getFilterAmount()/100;if(c===0)return;a(b,[[-1*c,-0.5*c,0],[-0.5*c,1+.5*c,.5*c],[0,.5*c,1*c]])}}()
;(function(a){function J(c){function bt(a){return a&&typeof a=="object"&&!bH(a)&&bb.call(a,"__wrapped__")?a:new bB(a)}function bv(a){var b=a.length,c=b>=i;if(c){var d={},e=-1;while(++e<b){var f=h+a[e];(d[f]||(d[f]=[])).push(a[e])}}return function(b){if(c){var e=h+b;return d[e]&&cP(d[e],b)>-1}return cP(a,b)>-1}}function bw(a){return a.charCodeAt(0)}function bx(a,b){var c=a.index,d=b.index;a=a.criteria,b=b.criteria;if(a!==b){if(a>b||typeof a=="undefined")return 1;if(a<b||typeof b=="undefined")return-1}return c<d?-1:1}function by(a,b,c,d){function i(){var d=arguments,j=f?this:b;e||(a=b[g]),c.length&&(d=d.length?(d=bp.call(d),h?d.concat(c):c.concat(d)):c);if(this instanceof i){bC.prototype=a.prototype,j=new bC,bC.prototype=null;var k=a.apply(j,d);return cb(k)?k:j}return a.apply(j,d)}var e=ca(a),f=!c,g=b;if(f){var h=d;c=b}else if(!e){if(!d)throw new S;b=a}return i}function bz(a){return"\\"+I[a]}function bA(a){return bK[a]}function bB(a){this.__wrapped__=a}function bC(){}function bD(a){var b=!1;if(!a||bf.call(a)!=D)return b;var c=a.constructor;return(ca(c)?c instanceof c:!0)?(bR(a,function(a,c){b=c}),b===!1||bb.call(a,b)):b}function bE(a,b,c){b||(b=0),typeof c=="undefined"&&(c=a?a.length:0);var d=-1,f=c-b||0,g=e(f<0?0:f);while(++d<f)g[d]=a[b+d];return g}function bF(a){return bL[a]}function bG(a){return bf.call(a)==x}function bN(a,c,d,e,f,g){var h=a;typeof c=="function"&&(e=d,d=c,c=!1);if(typeof d=="function"){d=typeof e=="undefined"?d:bt.createCallback(d,e,1),h=d(h);if(typeof h!="undefined")return h;h=a}var i=cb(h);if(i){var j=bf.call(h);if(!G[j])return h;var k=bH(h)}if(!i||!c)return i?k?bE(h):bM({},h):h;var l=bs[j];switch(j){case z:case A:return new l(+h);case C:case F:return new l(h);case E:return l(h.source,o.exec(h))}f||(f=[]),g||(g=[]);var m=f.length;while(m--)if(f[m]==a)return g[m];return h=k?l(h.length):{},k&&(bb.call(a,"index")&&(h.index=a.index),bb.call(a,"input")&&(h.input=a.input)),f.push(a),g.push(h),(k?cu:bS)(a,function(a,e){h[e]=bN(a,c,d,b,f,g)}),h}function bO(a,b,c){return bN(a,!0,b,c)}function bQ(a,b,c){var d;return b=bt.createCallback(b,c),bS(a,function(a,c,e){if(b(a,c,e))return d=c,!1}),d}function bT(a){var b=[];return bR(a,function(a,c){ca(a)&&b.push(c)}),b.sort()}function bU(a,b){return a?bb.call(a,b):!1}function bV(a){var b=-1,c=bJ(a),d=c.length,e={};while(++b<d){var f=c[b];e[a[f]]=f}return e}function bW(a){return a===!0||a===!1||bf.call(a)==z}function bX(a){return a?typeof a=="object"&&bf.call(a)==A:!1}function bY(a){return a?a.nodeType===1:!1}function bZ(a){var b=!0;if(!a)return b;var c=bf.call(a),d=a.length;return c==y||c==F||c==x||c==D&&typeof d=="number"&&ca(a.splice)?!d:(bS(a,function(){return b=!1}),b)}function b$(a,b,c,d,e,f){var h=c===g;if(typeof c=="function"&&!h){c=bt.createCallback(c,d,2);var i=c(a,b);if(typeof i!="undefined")return!!i}if(a===b)return a!==0||1/a==1/b;var j=typeof a,k=typeof b;if(a===a&&(!a||j!="function"&&j!="object")&&(!b||k!="function"&&k!="object"))return!1;if(a==null||b==null)return a===b;var l=bf.call(a),m=bf.call(b);l==x&&(l=D),m==x&&(m=D);if(l!=m)return!1;switch(l){case z:case A:return+a==+b;case C:return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case E:case F:return a==R(b)}var n=l==y;if(!n){if(bb.call(a,"__wrapped__ ")||bb.call(b,"__wrapped__"))return b$(a.__wrapped__||a,b.__wrapped__||b,c,d,e,f);if(l!=D)return!1;var o=a.constructor,p=b.constructor;if(o!=p&&!(ca(o)&&o instanceof o&&ca(p)&&p instanceof p))return!1}e||(e=[]),f||(f=[]);var q=e.length;while(q--)if(e[q]==a)return f[q]==b;var r=0;i=!0,e.push(a),f.push(b);if(n){q=a.length,r=b.length,i=r==a.length;if(!i&&!h)return i;while(r--){var s=q,t=b[r];if(h){while(s--)if(i=b$(a[s],t,c,d,e,f))break}else if(!(i=b$(a[r],t,c,d,e,f)))break}return i}return bR(b,function(b,g,h){if(bb.call(h,g))return r++,i=bb.call(a,g)&&b$(a[g],b,c,d,e,f)}),i&&!h&&bR(a,function(a,b,c){if(bb.call(c,b))return i=--r>-1}),i}function b_(a){return bi(a)&&!bj(parseFloat(a))}function ca(a){return typeof a=="function"}function cb(a){return a?H[typeof a]:!1}function cc(a){return ce(a)&&a!=+a}function cd(a){return a===null}function ce(a){return typeof a=="number"||bf.call(a)==C}function cg(a){return a?typeof a=="object"&&bf.call(a)==E:!1}function ch(a){return typeof a=="string"||bf.call(a)==F}function ci(a){return typeof a=="undefined"}function cj(a,b,c){var d=arguments,e=0,f=2;if(!cb(a))return a;if(c===g)var h=d[3],i=d[4],j=d[5];else i=[],j=[],typeof c!="number"&&(f=d.length),f>3&&typeof d[f-2]=="function"?h=bt.createCallback(d[--f-1],d[f--],2):f>2&&typeof d[f-1]=="function"&&(h=d[--f]);while(++e<f)(bH(d[e])?cu:bS)(d[e],function(b,c){var d,e,f=b,k=a[c];if(b&&((e=bH(b))||cf(b))){var l=i.length;while(l--)if(d=i[l]==b){k=j[l];break}if(!d){var m;if(h){f=h(k,b);if(m=typeof f!="undefined")k=f}m||(k=e?bH(k)?k:[]:cf(k)?k:{}),i.push(b),j.push(k),m||(k=cj(k,b,g,h,i,j))}}else h&&(f=h(k,b),typeof f=="undefined"&&(f=b)),typeof f!="undefined"&&(k=f);a[c]=k});return a}function ck(a,b,c){var d=typeof b=="function",e={};if(d)b=bt.createCallback(b,c);else var f=Z.apply(T,bp.call(arguments,1));return bR(a,function(a,c,g){if(d?!b(a,c,g):cP(f,c)<0)e[c]=a}),e}function cl(a){var b=-1,c=bJ(a),d=c.length,f=e(d);while(++b<d){var g=c[b];f[b]=[g,a[g]]}return f}function cm(a,b,c){var d={};if(typeof b!="function"){var e=-1,f=Z.apply(T,bp.call(arguments,1)),g=cb(a)?f.length:0;while(++e<g){var h=f[e];h in a&&(d[h]=a[h])}}else b=bt.createCallback(b,c),bR(a,function(a,c,e){b(a,c,e)&&(d[c]=a)});return d}function cn(a){var b=-1,c=bJ(a),d=c.length,f=e(d);while(++b<d)f[b]=a[c[b]];return f}function co(a){var b=-1,c=Z.apply(T,bp.call(arguments,1)),d=c.length,f=e(d);while(++b<d)f[b]=a[c[b]];return f}function cp(a,b,c){var d=-1,e=a?a.length:0,f=!1;return c=(c<0?bl(0,e+c):c)||0,typeof e=="number"?f=(ch(a)?a.indexOf(b,c):cP(a,b,c))>-1:bS(a,function(a){if(++d>=c)return!(f=a===b)}),f}function cq(a,b,c){var d={};return b=bt.createCallback(b,c),cu(a,function(a,c,e){c=R(b(a,c,e)),bb.call(d,c)?d[c]++:d[c]=1}),d}function cr(a,b,c){var d=!0;b=bt.createCallback(b,c);var e=-1,f=a?a.length:0;if(typeof f=="number"){while(++e<f)if(!(d=!!b(a[e],e,a)))break}else bS(a,function(a,c,e){return d=!!b(a,c,e)});return d}function cs(a,b,c){var d=[];b=bt.createCallback(b,c);var e=-1,f=a?a.length:0;if(typeof f=="number")while(++e<f){var g=a[e];b(g,e,a)&&d.push(g)}else bS(a,function(a,c,e){b(a,c,e)&&d.push(a)});return d}function ct(a,b,c){b=bt.createCallback(b,c);var d=-1,e=a?a.length:0;if(typeof e!="number"){var g;return bS(a,function(a,c,d){if(b(a,c,d))return g=a,!1}),g}while(++d<e){var f=a[d];if(b(f,d,a))return f}}function cu(a,b,c){var d=-1,e=a?a.length:0;b=b&&typeof c=="undefined"?b:bt.createCallback(b,c);if(typeof e=="number"){while(++d<e)if(b(a[d],d,a)===!1)break}else bS(a,b);return a}function cv(a,b,c){var d={};return b=bt.createCallback(b,c),cu(a,function(a,c,e){c=R(b(a,c,e)),(bb.call(d,c)?d[c]:d[c]=[]).push(a)}),d}function cw(a,b){var c=bp.call(arguments,2),d=-1,f=typeof b=="function",g=a?a.length:0,h=e(typeof g=="number"?g:0);return cu(a,function(a){h[++d]=(f?b:a[b]).apply(a,c)}),h}function cx(a,b,c){var d=-1,f=a?a.length:0;b=bt.createCallback(b,c);if(typeof f=="number"){var g=e(f);while(++d<f)g[d]=b(a[d],d,a)}else g=[],bS(a,function(a,c,e){g[++d]=b(a,c,e)});return g}function cy(a,b,c){var d=-Infinity,e=d;if(!b&&bH(a)){var f=-1,g=a.length;while(++f<g){var h=a[f];h>e&&(e=h)}}else b=!b&&ch(a)?bw:bt.createCallback(b,c),cu(a,function(a,c,f){var g=b(a,c,f);g>d&&(d=g,e=a)});return e}function cz(a,b,c){var d=Infinity,e=d;if(!b&&bH(a)){var f=-1,g=a.length;while(++f<g){var h=a[f];h<e&&(e=h)}}else b=!b&&ch(a)?bw:bt.createCallback(b,c),cu(a,function(a,c,f){var g=b(a,c,f);g<d&&(d=g,e=a)});return e}function cA(a,b){var c=-1,d=a?a.length:0;if(typeof d=="number"){var f=e(d);while(++c<d)f[c]=a[c][b]}return f||cx(a,b)}function cB(a,b,c,d){if(!a)return c;var e=arguments.length<3;b=bt.createCallback(b,d,4);var f=-1,g=a.length;if(typeof g=="number"){e&&(c=a[++f]);while(++f<g)c=b(c,a[f],f,a)}else bS(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)});return c}function cC(a,b,c,d){var e=a,f=a?a.length:0,g=arguments.length<3;if(typeof f!="number"){var h=bJ(a);f=h.length}return b=bt.createCallback(b,d,4),cu(a,function(a,d,i){d=h?h[--f]:--f,c=g?(g=!1,e[d]):b(c,e[d],d,i)}),c}function cD(a,b,c){return b=bt.createCallback(b,c),cs(a,function(a,c,d){return!b(a,c,d)})}function cE(a){var b=-1,c=a?a.length:0,d=e(typeof c=="number"?c:0);return cu(a,function(a){var c=$(bo()*(++b+1));d[b]=d[c],d[c]=a}),d}function cF(a){var b=a?a.length:0;return typeof b=="number"?b:bJ(a).length}function cG(a,b,c){var d;b=bt.createCallback(b,c);var e=-1,f=a?a.length:0;if(typeof f=="number"){while(++e<f)if(d=b(a[e],e,a))break}else bS(a,function(a,c,e){return!(d=b(a,c,e))});return!!d}function cH(a,b,c){var d=-1,f=a?a.length:0,g=e(typeof f=="number"?f:0);b=bt.createCallback(b,c),cu(a,function(a,c,e){g[++d]={criteria:b(a,c,e),index:d,value:a}}),f=g.length,g.sort(bx);while(f--)g[f]=g[f].value;return g}function cI(a){return a&&typeof a.length=="number"?bE(a):cn(a)}function cK(a){var b=-1,c=a?a.length:0,d=[];while(++b<c){var e=a[b];e&&d.push(e)}return d}function cL(a){var b=-1,c=a?a.length:0,d=Z.apply(T,bp.call(arguments,1)),e=bv(d),f=[];while(++b<c){var g=a[b];e(g)||f.push(g)}return f}function cM(a,b,c){var d=-1,e=a?a.length:0;b=bt.createCallback(b,c);while(++d<e)if(b(a[d],d,a))return d;return-1}function cN(a,b,c){if(a){var d=0,e=a.length;if(typeof b!="number"&&b!=null){var f=-1;b=bt.createCallback(b,c);while(++f<e&&b(a[f],f,a))d++}else{d=b;if(d==null||c)return a[0]}return bE(a,0,bm(bl(0,d),e))}}function cO(a,b,c,d){var e=-1,f=a?a.length:0,g=[];typeof b!="boolean"&&b!=null&&(d=c,c=b,b=!1),c!=null&&(c=bt.createCallback(c,d));while(++e<f){var h=a[e];c&&(h=c(h,e,a)),bH(h)?bc.apply(g,b?h:cO(h)):g.push(h)}return g}function cP(a,b,c){var d=-1,e=a?a.length:0;if(typeof c=="number")d=(c<0?bl(0,e+c):c||0)-1;else if(c)return d=cW(a,b),a[d]===b?d:-1;while(++d<e)if(a[d]===b)return d;return-1}function cQ(a,b,c){if(!a)return[];var d=0,e=a.length;if(typeof b!="number"&&b!=null){var f=e;b=bt.createCallback(b,c);while(f--&&b(a[f],f,a))d++}else d=b==null||c?1:b||d;return bE(a,0,bm(bl(0,e-d),e))}function cR(a){var b=arguments,c=b.length,d={0:{}},e=-1,f=a?a.length:0,g=f>=i,j=[],k=j;l:while(++e<f){var m=a[e];if(g)var n=h+m,o=d[0][n]?!(k=d[0][n]):k=d[0][n]=[];if(o||cP(k,m)<0){g&&k.push(m);var p=c;while(--p)if(!(d[p]||(d[p]=bv(b[p])))(m))continue l;j.push(m)}}return j}function cS(a,b,c){if(a){var d=0,e=a.length;if(typeof b!="number"&&b!=null){var f=e;b=bt.createCallback(b,c);while(f--&&b(a[f],f,a))d++}else{d=b;if(d==null||c)return a[e-1]}return bE(a,bl(0,e-d))}}function cT(a,b,c){var d=a?a.length:0;typeof c=="number"&&(d=(c<0?bl(0,d+c):bm(c,d-1))+1);while(d--)if(a[d]===b)return d;return-1}function cU(a,b,c){a=+a||0,c=+c||1,b==null&&(b=a,a=0);var d=-1,f=bl(0,X((b-a)/c)),g=e(f);while(++d<f)g[d]=a,a+=c;return g}function cV(a,b,c){if(typeof b!="number"&&b!=null){var d=0,e=-1,f=a?a.length:0;b=bt.createCallback(b,c);while(++e<f&&b(a[e],e,a))d++}else d=b==null||c?1:bl(0,b);return bE(a,d)}function cW(a,b,c,d){var e=0,f=a?a.length:e;c=c?bt.createCallback(c,d,1):ds,b=c(b);while(e<f){var g=e+f>>>1;c(a[g])<b?e=g+1:f=g}return e}function cX(a){return bH(a)||(arguments[0]=a?bp.call(a):T),cY(Z.apply(T,arguments))}function cY(a,b,c,d){var e=-1,f=a?a.length:0,g=[],j=g;typeof b!="boolean"&&b!=null&&(d=c,c=b,b=!1);var k=!b&&f>=i;if(k)var l={};c!=null&&(j=[],c=bt.createCallback(c,d));while(++e<f){var m=a[e],n=c?c(m,e,a):m;if(k)var o=h+n,p=l[o]?!(j=l[o]):j=l[o]=[];if(b?!e||j[j.length-1]!==n:p||cP(j,n)<0)(c||k)&&j.push(n),g.push(m)}return g}function cZ(a){var b=-1,c=a?a.length:0,d=c?cy(cA(a,"length")):0,f=e(d);while(++b<c){var g=-1,h=a[b];while(++g<d)(f[g]||(f[g]=e(c)))[b]=h[g]}return f}function c$(a){return cL(a,bp.call(arguments,1))}function c_(a){var b=-1,c=a?cy(cA(arguments,"length")):0,d=e(c);while(++b<c)d[b]=cA(arguments,b);return d}function da(a,b){var c=-1,d=a?a.length:0,e={};while(++c<d){var f=a[c];b?e[f]=b[c]:e[f[0]]=f[1]}return e}function db(a,b){return a<1?b():function(){if(--a<1)return b.apply(this,arguments)}}function dc(a,b){return bu.fastBind||bg&&arguments.length>2?bg.call.apply(bg,arguments):by(a,b,bp.call(arguments,2))}function dd(a){var b=arguments.length>1?Z.apply(T,bp.call(arguments,1)):bT(a),c=-1,d=b.length;while(++c<d){var e=b[c];a[e]=dc(a[e],a)}return a}function de(a,b){return by(a,b,bp.call(arguments,2),g)}function df(){var a=arguments;return function(){var b=arguments,c=a.length;while(c--)b=[a[c].apply(this,b)];return b[0]}}function dg(a,b,c){if(a==null)return ds;var d=typeof a;if(d!="function"){if(d!="object")return function(b){return b[a]};var e=bJ(a);return function(b){var c=e.length,d=!1;while(c--)if(!(d=b$(b[e[c]],a[e[c]],g)))break;return d}}return typeof b!="undefined"?c===1?function(c){return a.call(b,c)}:c===2?function(c,d){return a.call(b,c,d)}:c===4?function(c,d,e,f){return a.call(b,c,d,e,f)}:function(c,d,e){return a.call(b,c,d,e)}:a}function dh(a,b,c){function j(){e=h=null,i&&(f=a.apply(g,d))}var d,e,f,g,h,i=!0;if(c===!0){var k=!0;i=!1}else c&&H[typeof c]&&(k=c.leading,i="trailing"in c?c.trailing:i);return function(){return d=arguments,g=this,Y(h),!e&&k?(e=!0,f=a.apply(g,d)):h=be(j,b),f}}function di(a){var c=bp.call(arguments,1);return be(function(){a.apply(b,c)},1)}function dj(a,c){var d=bp.call(arguments,2);return be(function(){a.apply(b,d)},c)}function dk(a,b){var c={};return function(){var d=h+(b?b.apply(this,arguments):arguments[0]);return bb.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}}function dl(a){var b,c;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function dm(a){return by(a,bp.call(arguments,1))}function dn(a){return by(a,bp.call(arguments,1),null,g)}function dp(a,b,c){function k(){g=null,j&&(h=new L,e=a.apply(f,d))}var d,e,f,g,h=0,i=!0,j=!0;return c===!1?i=!1:c&&H[typeof c]&&(i="leading"in c?c.leading:i,j="trailing"in c?c.trailing:j),function(){var c=new L;!g&&!i&&(h=c);var j=b-(c-h);return d=arguments,f=this,j<=0?(Y(g),g=null,h=c,e=a.apply(f,d)):g||(g=be(k,j)),e}}function dq(a,b){return function(){var c=[a];return bc.apply(c,arguments),b.apply(this,c)}}function dr(a){return a==null?"":R(a).replace(t,bA)}function ds(a){return a}function dt(a){cu(bT(a),function(b){var c=bt[b]=a[b];bt.prototype[b]=function(){var a=this.__wrapped__,b=[a];bc.apply(b,arguments);var d=c.apply(bt,b);return a&&typeof a=="object"&&a==d?this:new bB(d)}})}function du(){return c._=V,this}function dw(a,b){return a==null&&b==null&&(b=1),a=+a||0,b==null&&(b=a,a=0),a+$(bo()*((+b||0)-a+1))}function dx(a,c){var d=a?a[c]:b;return ca(d)?a[c]():d}function dy(a,c,d){var e=bt.templateSettings;a||(a=""),d=bP({},d,e);var f=bP({},d.imports,e.imports),g=bJ(f),h=cn(f),i,m=0,o=d.interpolate||s,q="__p += '",r=Q((d.escape||s).source+"|"+o.source+"|"+(o===p?n:s).source+"|"+(d.evaluate||s).source+"|$","g");a.replace(r,function(b,c,d,e,f,g){return d||(d=e),q+=a.slice(m,g).replace(u,bz),c&&(q+="' +\n__e("+c+") +\n'"),f&&(i=!0,q+="';\n"+f+";\n__p += '"),d&&(q+="' +\n((__t = ("+d+")) == null ? '' : __t) +\n'"),m=g+b.length,b}),q+="';\n";var t=d.variable,v=t;v||(t="obj",q="with ("+t+") {\n"+q+"\n}\n"),q=(i?q.replace(j,""):q).replace(k,"$1").replace(l,"$1;"),q="function("+t+") {\n"+(v?"":t+" || ("+t+" = {});\n")+"var __t, __p = '', __e = _.escape"+(i?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+q+"return __p\n}";var x="\n/*\n//@ sourceURL="+(d.sourceURL||"/lodash/template/source["+w++ +"]")+"\n*/";try{var y=M(g,"return "+q+x).apply(b,h)}catch(z){throw z.source=q,z}return c?y(c):(y.source=q,y)}function dz(a,b,c){a=(a=+a)>-1?a:0;var d=-1,f=e(a);b=bt.createCallback(b,c,1);while(++d<a)f[d]=b(d);return f}function dA(a){return a==null?"":R(a).replace(m,bF)}function dB(a){var b=++f;return R(a==null?"":a)+b}function dC(a,b){return b(a),a}function dD(){return R(this.__wrapped__)}function dE(){return this.__wrapped__}c=c?K.defaults(a.Object(),c,K.pick(a,v)):a;var e=c.Array,B=c.Boolean,L=c.Date,M=c.Function,N=c.Math,O=c.Number,P=c.Object,Q=c.RegExp,R=c.String,S=c.TypeError,T=e(),U=P(),V=c._,W=Q("^"+R(U.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),X=N.ceil,Y=c.clearTimeout,Z=T.concat,$=N.floor,ba=W.test(ba=P.getPrototypeOf)&&ba,bb=U.hasOwnProperty,bc=T.push,bd=c.setImmediate,be=c.setTimeout,bf=U.toString,bg=W.test(bg=bf.bind)&&bg,bh=W.test(bh=e.isArray)&&bh,bi=c.isFinite,bj=c.isNaN,bk=W.test(bk=P.keys)&&bk,bl=N.max,bm=N.min,bn=c.parseInt,bo=N.random,bp=T.slice,bq=W.test(c.attachEvent),br=bg&&!/\n|true/.test(bg+bq),bs={};bs[y]=e,bs[z]=B,bs[A]=L,bs[D]=P,bs[C]=O,bs[E]=Q,bs[F]=R;var bu=bt.support={};bu.fastBind=bg&&!br,bt.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:p,variable:"",imports:{_:bt}},bB.prototype=bt.prototype;var bH=bh,bI=function(a){var b,c=a,d=[];if(!c)return d;if(!H[typeof a])return d;for(b in c)bb.call(c,b)&&d.push(b);return d},bJ=bk?function(a){return cb(a)?bk(a):[]}:bI,bK={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},bL=bV(bK),bM=function(a,b,c){var d,e=a,f=e;if(!e)return f;var g=arguments,h=0,i=typeof c=="number"?2:g.length;if(i>3&&typeof g[i-2]=="function")var j=bt.createCallback(g[--i-1],g[i--],2);else i>2&&typeof g[i-1]=="function"&&(j=g[--i]);while(++h<i){e=g[h];if(e&&H[typeof e]){var k=e.length;d=-1;if(bH(e))while(++d<k)f[d]=j?j(f[d],e[d]):e[d];else{var l=-1,m=H[typeof e]?bJ(e):[],k=m.length;while(++l<k)d=m[l],f[d]=j?j(f[d],e[d]):e[d]}}}return f},bP=function(a,b,c){var d,e=a,f=e;if(!e)return f;var g=arguments,h=0,i=typeof c=="number"?2:g.length;while(++h<i){e=g[h];if(e&&H[typeof e]){var j=e.length;d=-1;if(bH(e))while(++d<j)typeof f[d]=="undefined"&&(f[d]=e[d]);else{var k=-1,l=H[typeof e]?bJ(e):[],j=l.length;while(++k<j)d=l[k],typeof f[d]=="undefined"&&(f[d]=e[d])}}}return f},bR=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!H[typeof e])return f;b=b&&typeof c=="undefined"?b:bt.createCallback(b,c);for(d in e)if(b(e[d],d,a)===!1)return f;return f},bS=function(a,b,c){var d,e=a,f=e;if(!e)return f;if(!H[typeof e])return f;b=b&&typeof c=="undefined"?b:bt.createCallback(b,c);var g=-1,h=H[typeof e]?bJ(e):[],i=h.length;while(++g<i){d=h[g];if(b(e[d],d,a)===!1)return f}return f},cf=function(a){if(!a||bf.call(a)!=D)return!1;var b=a.valueOf,c=typeof b=="function"&&(c=ba(b))&&ba(c);return c?a==c||ba(a)==c:bD(a)},cJ=cs;br&&d&&typeof bd=="function"&&(di=dc(bd,c));var dv=bn(q+"08")==8?bn:function(a,b){return bn(ch(a)?a.replace(r,""):a,b||0)};return bt.after=db,bt.assign=bM,bt.at=co,bt.bind=dc,bt.bindAll=dd,bt.bindKey=de,bt.compact=cK,bt.compose=df,bt.countBy=cq,bt.createCallback=dg,bt.debounce=dh,bt.defaults=bP,bt.defer=di,bt.delay=dj,bt.difference=cL,bt.filter=cs,bt.flatten=cO,bt.forEach=cu,bt.forIn=bR,bt.forOwn=bS,bt.functions=bT,bt.groupBy=cv,bt.initial=cQ,bt.intersection=cR,bt.invert=bV,bt.invoke=cw,bt.keys=bJ,bt.map=cx,bt.max=cy,bt.memoize=dk,bt.merge=cj,bt.min=cz,bt.omit=ck,bt.once=dl,bt.pairs=cl,bt.partial=dm,bt.partialRight=dn,bt.pick=cm,bt.pluck=cA,bt.range=cU,bt.reject=cD,bt.rest=cV,bt.shuffle=cE,bt.sortBy=cH,bt.tap=dC,bt.throttle=dp,bt.times=dz,bt.toArray=cI,bt.union=cX,bt.uniq=cY,bt.unzip=cZ,bt.values=cn,bt.where=cJ,bt.without=c$,bt.wrap=dq,bt.zip=c_,bt.zipObject=da,bt.collect=cx,bt.drop=cV,bt.each=cu,bt.extend=bM,bt.methods=bT,bt.object=da,bt.select=cs,bt.tail=cV,bt.unique=cY,dt(bt),bt.clone=bN,bt.cloneDeep=bO,bt.contains=cp,bt.escape=dr,bt.every=cr,bt.find=ct,bt.findIndex=cM,bt.findKey=bQ,bt.has=bU,bt.identity=ds,bt.indexOf=cP,bt.isArguments=bG,bt.isArray=bH,bt.isBoolean=bW,bt.isDate=bX,bt.isElement=bY,bt.isEmpty=bZ,bt.isEqual=b$,bt.isFinite=b_,bt.isFunction=ca,bt.isNaN=cc,bt.isNull=cd,bt.isNumber=ce,bt.isObject=cb,bt.isPlainObject=cf,bt.isRegExp=cg,bt.isString=ch,bt.isUndefined=ci,bt.lastIndexOf=cT,bt.mixin=dt,bt.noConflict=du,bt.parseInt=dv,bt.random=dw,bt.reduce=cB,bt.reduceRight=cC,bt.result=dx,bt.runInContext=J,bt.size=cF,bt.some=cG,bt.sortedIndex=cW,bt.template=dy,bt.unescape=dA,bt.uniqueId=dB,bt.all=cr,bt.any=cG,bt.detect=ct,bt.foldl=cB,bt.foldr=cC,bt.include=cp,bt.inject=cB,bS(bt,function(a,b){bt.prototype[b]||(bt.prototype[b]=function(){var b=[this.__wrapped__];return bc.apply(b,arguments),a.apply(bt,b)})}),bt.first=cN,bt.last=cS,bt.take=cN,bt.head=cN,bS(bt,function(a,b){bt.prototype[b]||(bt.prototype[b]=function(b,c){var d=a(this.__wrapped__,b,c);return b==null||c&&typeof b!="function"?d:new bB(d)})}),bt.VERSION="1.2.1",bt.prototype.toString=dD,bt.prototype.value=dE,bt.prototype.valueOf=dE,cu(["join","pop","shift"],function(a){var b=T[a];bt.prototype[a]=function(){return b.apply(this.__wrapped__,arguments)}}),cu(["push","reverse","sort","unshift"],function(a){var b=T[a];bt.prototype[a]=function(){return b.apply(this.__wrapped__,arguments),this}}),cu(["concat","slice","splice"],function(a){var b=T[a];bt.prototype[a]=function(){return new bB(b.apply(this.__wrapped__,arguments))}}),bt}var b,c=typeof exports=="object"&&exports,d=typeof module=="object"&&module&&module.exports==c&&module,e=typeof global=="object"&&global;if(e.global===e||e.window===e)a=e;var f=0,g={},h=+(new Date)+"",i=200,j=/\b__p \+= '';/g,k=/\b(__p \+=) '' \+/g,l=/(__e\(.*?\)|\b__t\)) \+\n'';/g,m=/&(?:amp|lt|gt|quot|#39);/g,n=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,o=/\w*$/,p=/<%=([\s\S]+?)%>/g,q=" \t\f\n\r\u2028\u2029",r=RegExp("^["+q+"]*0+(?=.$)"),s=/($^)/,t=/[&<>"']/g,u=/['\n\r\t\u2028\u2029\\]/g,v=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],w=0,x="[object Arguments]",y="[object Array]",z="[object Boolean]",A="[object Date]",B="[object Function]",C="[object Number]",D="[object Object]",E="[object RegExp]",F="[object String]",G={};G[B]=!1,G[x]=G[y]=G[z]=G[A]=G[C]=G[D]=G[E]=G[F]=!0;var H={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,"undefined":!1},I={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"},K=J();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(a._=K,define(function(){return K})):c&&!c.nodeType?d?(d.exports=K)._=K:c._=K:a._=K})(this)
;((function(){var a=this,b=a.Backbone,c=[],d=c.push,e=c.slice,f=c.splice,g;typeof exports!="undefined"?g=exports:g=a.Backbone={},g.VERSION="1.0.0";var h=a._;!h&&typeof require!="undefined"&&(h=require("underscore")),g.$=a.jQuery||a.Zepto||a.ender||a.$,g.noConflict=function(){return a.Backbone=b,this},g.emulateHTTP=!1,g.emulateJSON=!1;var i=g.Events={on:function(a,b,c){if(!k(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!k(this,"once",a,[b,c])||!b)return this;var d=this,e=h.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,f,g,i,j,l,m;if(!this._events||!k(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;g=a?[a]:h.keys(this._events);for(i=0,j=g.length;i<j;i++){a=g[i];if(f=this._events[a]){this._events[a]=d=[];if(b||c)for(l=0,m=f.length;l<m;l++)e=f[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}}return this},trigger:function(a){if(!this._events)return this;var b=e.call(arguments,1);if(!k(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&l(c,b),d&&l(d,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;typeof b=="object"&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},j=/\s+/,k=function(a,b,c,d){if(!c)return!0;if(typeof c=="object"){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(j.test(c)){var f=c.split(j);for(var g=0,h=f.length;g<h;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},l=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:while(++d<e)(c=a[d]).callback.call(c.ctx);return;case 1:while(++d<e)(c=a[d]).callback.call(c.ctx,f);return;case 2:while(++d<e)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:while(++d<e)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:while(++d<e)(c=a[d]).callback.apply(c.ctx,b)}},m={listenTo:"on",listenToOnce:"once"};h.each(m,function(a,b){i[b]=function(b,c,d){var e=this._listeners||(this._listeners={}),f=b._listenerId||(b._listenerId=h.uniqueId("l"));return e[f]=b,typeof c=="object"&&(d=this),b[a](c,d,this),this}}),i.bind=i.on,i.unbind=i.off,h.extend(g,i);var n=g.Model=function(a,b){var c,d=a||{};b||(b={}),this.cid=h.uniqueId("c"),this.attributes={},h.extend(this,h.pick(b,o)),b.parse&&(d=this.parse(d,b)||{});if(c=h.result(this,"defaults"))d=h.defaults({},d,c);this.set(d,b),this.changed={},this.initialize.apply(this,arguments)},o=["url","urlRoot","collection"];h.extend(n.prototype,i,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return h.clone(this.attributes)},sync:function(){return g.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return h.escape(this.get(a))},has:function(a){return this.get(a)!=null},set:function(a,b,c){var d,e,f,g,i,j,k,l;if(a==null)return this;typeof a=="object"?(e=a,c=b):(e={})[a]=b,c||(c={});if(!this._validate(e,c))return!1;f=c.unset,i=c.silent,g=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=h.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],h.isEqual(l[d],b)||g.push(d),h.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,f?delete l[d]:l[d]=b;if(!i){g.length&&(this._pending=!0);for(var m=0,n=g.length;m<n;m++)this.trigger("change:"+g[m],this,l[g[m]],c)}if(j)return this;if(!i)while(this._pending)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,h.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,h.extend({},a,{unset:!0}))},hasChanged:function(a){return a==null?!h.isEmpty(this.changed):h.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?h.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a){if(h.isEqual(d[e],b=a[e]))continue;(c||(c={}))[e]=b}return c},previous:function(a){return a==null||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return h.clone(this._previousAttributes)},fetch:function(a){a=a?h.clone(a):{},a.parse===void 0&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){if(!b.set(b.parse(d,a),a))return!1;c&&c(b,d,a),b.trigger("sync",b,d,a)},L(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,f,g=this.attributes;a==null||typeof a=="object"?(d=a,c=b):(d={})[a]=b;if(d&&(!c||!c.wait)&&!this.set(d,c))return!1;c=h.extend({validate:!0},c);if(!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=h.extend({},g,d)),c.parse===void 0&&(c.parse=!0);var i=this,j=c.success;return c.success=function(a){i.attributes=g;var b=i.parse(a,c);c.wait&&(b=h.extend(d||{},b));if(h.isObject(b)&&!i.set(b,c))return!1;j&&j(i,a,c),i.trigger("sync",i,a,c)},L(this,c),e=this.isNew()?"create":c.patch?"patch":"update",e==="patch"&&(c.attrs=d),f=this.sync(e,this,c),d&&c.wait&&(this.attributes=g),f},destroy:function(a){a=a?h.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)};if(this.isNew())return a.success(),!1;L(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=h.result(this,"urlRoot")||h.result(this.collection,"url")||K();return this.isNew()?a:a+(a.charAt(a.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(a){return this._validate({},h.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=h.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,h.extend(b||{},{validationError:c})),!1):!0}});var p=["keys","values","pairs","invert","pick","omit"];h.each(p,function(a){n.prototype[a]=function(){var b=e.call(arguments);return b.unshift(this.attributes),h[a].apply(h,b)}});var q=g.Collection=function(a,b){b||(b={}),b.url&&(this.url=b.url),b.model&&(this.model=b.model),b.comparator!==void 0&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,h.extend({silent:!0},b))},r={add:!0,remove:!0,merge:!0},s={add:!0,merge:!1,remove:!1};h.extend(q.prototype,i,{model:n,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return g.sync.apply(this,arguments)},add:function(a,b){return this.set(a,h.defaults(b||{},s))},remove:function(a,b){a=h.isArray(a)?a.slice():[a],b||(b={});var c,d,e,f;for(c=0,d=a.length;c<d;c++){f=this.get(a[c]);if(!f)continue;delete this._byId[f.id],delete this._byId[f.cid],e=this.indexOf(f),this.models.splice(e,1),this.length--,b.silent||(b.index=e,f.trigger("remove",f,this,b)),this._removeReference(f)}return this},set:function(a,b){b=h.defaults(b||{},r),b.parse&&(a=this.parse(a,b)),h.isArray(a)||(a=a?[a]:[]);var c,e,g,i,j,k,l=b.at,m=this.comparator&&l==null&&b.sort!==!1,n=h.isString(this.comparator)?this.comparator:null,o=[],p=[],q={};for(c=0,e=a.length;c<e;c++){if(!(g=this._prepareModel(a[c],b)))continue;(j=this.get(g))?(b.remove&&(q[j.cid]=!0),b.merge&&(j.set(g.attributes,b),m&&!k&&j.hasChanged(n)&&(k=!0))):b.add&&(o.push(g),g.on("all",this._onModelEvent,this),this._byId[g.cid]=g,g.id!=null&&(this._byId[g.id]=g))}if(b.remove){for(c=0,e=this.length;c<e;++c)q[(g=this.models[c]).cid]||p.push(g);p.length&&this.remove(p,b)}o.length&&(m&&(k=!0),this.length+=o.length,l!=null?f.apply(this.models,[l,0].concat(o)):d.apply(this.models,o)),k&&this.sort({silent:!0});if(b.silent)return this;for(c=0,e=o.length;c<e;c++)(g=o[c]).trigger("add",g,this,b);return k&&this.trigger("sort",this,b),this},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;c<d;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),this.add(a,h.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:this.length},b)),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,h.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return a==null?void 0:this._byId[a.id!=null?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){return h.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),h.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(h.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=h.isFunction(b)?b:function(a){return a.get(b)};return h.sortedIndex(this.models,a,d,c)},pluck:function(a){return h.invoke(this.models,"get",a)},fetch:function(a){a=a?h.clone(a):{},a.parse===void 0&&(a.parse=!0);var b=a.success,c=this;return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},L(this,a),this.sync("read",this,a)},create:function(a,b){b=b?h.clone(b):{};if(!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(e){b.wait&&c.add(a,b),d&&d(a,e,b)},a.save(null,b),a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof n)return a.collection||(a.collection=this),a;b||(b={}),b.collection=this;var c=new this.model(a,b);return c._validate(a,b)?c:(this.trigger("invalid",this,a,b),!1)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){if(a!=="add"&&a!=="remove"||c===this)a==="destroy"&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],b.id!=null&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments);else return}});var t=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];h.each(t,function(a){q.prototype[a]=function(){var b=e.call(arguments);return b.unshift(this.models),h[a].apply(h,b)}});var u=["groupBy","countBy","sortBy"];h.each(u,function(a){q.prototype[a]=function(b,c){var d=h.isFunction(b)?b:function(a){return a.get(b)};return h[a](this.models,d,c)}});var v=g.View=function(a){this.cid=h.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];h.extend(v.prototype,i,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(a,b){return this.$el&&this.undelegateEvents(),this.$el=a instanceof g.$?a:g.$(a),this.el=this.$el[0],b!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=h.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];h.isFunction(c)||(c=this[a[b]]);if(!c)continue;var d=b.match(w),e=d[1],f=d[2];c=h.bind(c,this),e+=".delegateEvents"+this.cid,f===""?this.$el.on(e,c):this.$el.on(e,f,c)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(a){this.options&&(a=h.extend({},h.result(this,"options"),a)),h.extend(this,h.pick(a,x)),this.options=a},_ensureElement:function(){if(!this.el){var a=h.extend({},h.result(this,"attributes"));this.id&&(a.id=h.result(this,"id")),this.className&&(a["class"]=h.result(this,"className"));var b=g.$("<"+h.result(this,"tagName")+">").attr(a);this.setElement(b,!1)}else this.setElement(h.result(this,"el"),!1)}}),g.sync=function(a,b,c){var d=y[a];h.defaults(c||(c={}),{emulateHTTP:g.emulateHTTP,emulateJSON:g.emulateJSON});var e={type:d,dataType:"json"};c.url||(e.url=h.result(b,"url")||K()),c.data==null&&b&&(a==="create"||a==="update"||a==="patch")&&(e.contentType="application/json",e.data=JSON.stringify(c.attrs||b.toJSON(c))),c.emulateJSON&&(e.contentType="application/x-www-form-urlencoded",e.data=e.data?{model:e.data}:{});if(c.emulateHTTP&&(d==="PUT"||d==="DELETE"||d==="PATCH")){e.type="POST",c.emulateJSON&&(e.data._method=d);var f=c.beforeSend;c.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",d);if(f)return f.apply(this,arguments)}}e.type!=="GET"&&!c.emulateJSON&&(e.processData=!1),e.type==="PATCH"&&window.ActiveXObject&&(!window.external||!window.external.msActiveXFilteringEnabled)&&(e.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=c.xhr=g.ajax(h.extend(e,c));return b.trigger("request",b,i,c),i};var y={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};g.ajax=function(){return g.$.ajax.apply(g.$,arguments)};var z=g.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},A=/\((.*?)\)/g,B=/(\(\?)?:\w+/g,C=/\*\w+/g,D=/[\-{}\[\]+?.,\\\^$|#\s]/g;h.extend(z.prototype,i,{initialize:function(){},route:function(a,b,c){h.isRegExp(a)||(a=this._routeToRegExp(a)),h.isFunction(b)&&(c=b,b=""),c||(c=this[b]);var d=this;return g.history.route(a,function(e){var f=d._extractParameters(a,e);c&&c.apply(d,f),d.trigger.apply(d,["route:"+b].concat(f)),d.trigger("route",b,f),g.history.trigger("route",d,b,f)}),this},navigate:function(a,b){return g.history.navigate(a,b),this},_bindRoutes:function(){if(!this.routes)return;this.routes=h.result(this,"routes");var a,b=h.keys(this.routes);while((a=b.pop())!=null)this.route(a,this.routes[a])},_routeToRegExp:function(a){return a=a.replace(D,"\\$&").replace(A,"(?:$1)?").replace(B,function(a,b){return b?a:"([^/]+)"}).replace(C,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return h.map(c,function(a){return a?decodeURIComponent(a):null})}});var E=g.History=function(){this.handlers=[],h.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},F=/^[#\/]|\s+$/g,G=/^\/+|\/+$/g,H=/msie [\w.]+/,I=/\/$/;E.started=!1,h.extend(E.prototype,i,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(a==null)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(I,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(F,"")},start:function(a){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=h.extend({},{root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var b=this.getFragment(),c=document.documentMode,d=H.exec(navigator.userAgent.toLowerCase())&&(!c||c<=7);this.root=("/"+this.root+"/").replace(G,"/"),d&&this._wantsHashChange&&(this.iframe=g.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(b)),this._hasPushState?g.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!d?g.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=b;var e=this.location,f=e.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!f)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&f&&e.hash&&(this.fragment=this.getHash().replace(F,""),this.history.replaceState({},document.title,this.root+this.fragment+e.search));if(!this.options.silent)return this.loadUrl()},stop:function(){g.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();b===this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe)));if(b===this.fragment)return!1;this.iframe&&this.navigate(b),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=h.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0});return c},navigate:function(a,b){if(!E.started)return!1;if(!b||b===!0)b={trigger:b};a=this.getFragment(a||"");if(this.fragment===a)return;this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else if(this._wantsHashChange)this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace));else return this.location.assign(c);b.trigger&&this.loadUrl(a)},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),g.history=new E;var J=function(a,b){var c=this,d;a&&h.has(a,"constructor")?d=a.constructor:d=function(){return c.apply(this,arguments)},h.extend(d,c,b);var e=function(){this.constructor=d};return e.prototype=c.prototype,d.prototype=new e,a&&h.extend(d.prototype,a),d.__super__=c.prototype,d};n.extend=q.extend=z.extend=v.extend=E.extend=J;var K=function(){throw new Error('A "url" property or function must be specified')},L=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}})).call(this)
;Backbone.Paginator=function(a,b,c){"use strict";var d=b.map(a.VERSION.split("."),function(a){return parseInt(a,10)}),e={};return e.version="<%= pkg.version %>",e.clientPager=a.Collection.extend({useDiacriticsPlugin:!0,useLevenshteinPlugin:!0,sortColumn:"",sortDirection:"desc",lastSortColumn:"",fieldFilterRules:[],lastFieldFilterRules:[],filterFields:"",filterExpression:"",lastFilterExpression:"",defaults_ui:{firstPage:0,currentPage:1,perPage:5,totalPages:10,pagesInRange:4},initialize:function(){this.on("add",this.addModel,this),this.on("remove",this.removeModel,this),this.setDefaults()},setDefaults:function(){var a=b.defaults(this.paginator_ui,this.defaults_ui);b.defaults(this,a)},addModel:function(a){this.origModels.push(a)},removeModel:function(a){var c=b.indexOf(this.origModels,a);this.origModels.splice(c,1)},sync:function(a,e,f){var g=this;this.setDefaults();var h={};b.each(b.result(g,"server_api"),function(a,c){b.isFunction(a)&&(a=b.bind(a,g),a=a()),h[c]=a});var i=b.clone(g.paginator_core);b.each(i,function(a,c){b.isFunction(a)&&(a=b.bind(a,g),a=a()),i[c]=a}),i=b.defaults(i,{timeout:25e3,cache:!1,type:"GET",dataType:"jsonp"}),i=b.extend(i,{data:decodeURIComponent(c.param(h)),processData:!1,url:b.result(i,"url")},f);var j=d[0]!==0||d[1]!==9||d[2]!==10,k=i.success;i.success=function(a,b,c){k&&(j?k(a,b,c):k(e,a,i)),e&&e.trigger&&e.trigger("sync",e,a,i)};var l=i.error;i.error=function(a){l&&l(e,a,i),e&&e.trigger&&e.trigger("error",e,a,i)};var m=i.xhr=c.ajax(i);return e&&e.trigger&&e.trigger("request",e,m,i),m},nextPage:function(a){this.currentPage<this.information.totalPages&&(this.currentPage=++this.currentPage,this.pager(a))},previousPage:function(a){this.currentPage>1&&(this.currentPage=--this.currentPage,this.pager(a))},goTo:function(a,b){a!==undefined&&(this.currentPage=parseInt(a,10),this.pager(b))},howManyPer:function(a){if(a!==undefined){var b=this.perPage;this.perPage=parseInt(a,10),this.currentPage=Math.ceil((b*(this.currentPage-1)+1)/a),this.pager()}},setSort:function(a,b){a!==undefined&&b!==undefined&&(this.lastSortColumn=this.sortColumn,this.sortColumn=a,this.sortDirection=b,this.pager(),this.info())},setFieldFilter:function(a){b.isEmpty(a)?(this.lastFieldFilterRules=this.fieldFilterRules,this.fieldFilterRules="",this.pager(),this.info()):(this.lastFieldFilterRules=this.fieldFilterRules,this.fieldFilterRules=a,this.pager(),this.info())},doFakeFieldFilter:function(a){if(!b.isEmpty(a)){var c=this.origModels;return c===undefined&&(c=this.models),c=this._fieldFilter(c,a),this.filterExpression!==""&&(c=this._filter(c,this.filterFields,this.filterExpression)),c.length}},setFilter:function(a,b){a!==undefined&&b!==undefined&&(this.filterFields=a,this.lastFilterExpression=this.filterExpression,this.filterExpression=b,this.pager(),this.info())},doFakeFilter:function(a,c){if(a!==undefined&&c!==undefined){var d=this.origModels;return d===undefined&&(d=this.models),b.isEmpty(this.fieldFilterRules)||(d=this._fieldFilter(d,this.fieldFilterRules)),d=this._filter(d,a,c),d.length}},pager:function(a){var c=this,d=this.perPage,e=(c.currentPage-1)*d,f=e+d;c.origModels===undefined&&(c.origModels=c.models),c.models=c.origModels.slice(),this.sortColumn!==""&&(c.models=c._sort(c.models,this.sortColumn,this.sortDirection)),b.isEmpty(this.fieldFilterRules)||(c.models=c._fieldFilter(c.models,this.fieldFilterRules)),this.filterExpression!==""&&(c.models=c._filter(c.models,this.filterFields,this.filterExpression));if(this.lastSortColumn!==this.sortColumn||this.lastFilterExpression!==this.filterExpression||!b.isEqual(this.fieldFilterRules,this.lastFieldFilterRules))e=0,f=e+d,c.currentPage=1,this.lastSortColumn=this.sortColumn,this.lastFieldFilterRules=this.fieldFilterRules,this.lastFilterExpression=this.filterExpression;c.sortedAndFilteredModels=c.models.slice(),c.info(),c.reset(c.models.slice(e,f)),b.result(a,"success")},_sort:function(a,c,d){return a=a.sort(function(a,e){var f=a.get(c),g=e.get(c);if(b.isUndefined(f)||b.isUndefined(g)||f===null||g===null)return 0;f=f.toString().toLowerCase(),g=g.toString().toLowerCase();if(d==="desc")if(!f.match(/[^\-\d\.]/)&&f.match(/-?[\d\.]+/)&&!g.match(/[^\-\d\.]/)&&g.match(/-?[\d\.]+/)){if(f-0<g-0)return 1;if(f-0>g-0)return-1}else{if(f<g)return 1;if(f>g)return-1}else if(!f.match(/[^\-\d\.]/)&&f.match(/-?[\d\.]+/)&&!g.match(/[^\-\d\.]/)&&g.match(/-?[\d\.]+/)){if(f-0<g-0)return-1;if(f-0>g-0)return 1}else{if(f<g)return-1;if(f>g)return 1}if(a.cid&&e.cid){var h=a.cid,i=e.cid;if(h<i)return-1;if(h>i)return 1}return 0}),a},_fieldFilter:function(a,c){if(b.isEmpty(c))return a;var d=[];return b.each(a,function(a){var e=!0;b.each(c,function(c){if(!e)return!1;e=!1;if(c.type==="function"){var d=b.wrap(c.value,function(b){return b(a.get(c.field))});d()&&(e=!0)}else c.type==="required"?b.isEmpty(a.get(c.field).toString())||(e=!0):c.type==="min"?!b.isNaN(Number(a.get(c.field)))&&!b.isNaN(Number(c.value))&&Number(a.get(c.field))>=Number(c.value)&&(e=!0):c.type==="max"?!b.isNaN(Number(a.get(c.field)))&&!b.isNaN(Number(c.value))&&Number(a.get(c.field))<=Number(c.value)&&(e=!0):c.type==="range"?!b.isNaN(Number(a.get(c.field)))&&b.isObject(c.value)&&!b.isNaN(Number(c.value.min))&&!b.isNaN(Number(c.value.max))&&Number(a.get(c.field))>=Number(c.value.min)&&Number(a.get(c.field))<=Number(c.value.max)&&(e=!0):c.type==="minLength"?a.get(c.field).toString().length>=c.value&&(e=!0):c.type==="maxLength"?a.get(c.field).toString().length<=c.value&&(e=!0):c.type==="rangeLength"?b.isObject(c.value)&&!b.isNaN(Number(c.value.min))&&!b.isNaN(Number(c.value.max))&&a.get(c.field).toString().length>=c.value.min&&a.get(c.field).toString().length<=c.value.max&&(e=!0):c.type==="oneOf"?b.isArray(c.value)&&b.include(c.value,a.get(c.field))&&(e=!0):c.type==="equalTo"?c.value===a.get(c.field)&&(e=!0):c.type==="containsAllOf"?b.isArray(c.value)&&b.isArray(a.get(c.field))&&b.intersection(c.value,a.get(c.field)).length===c.value.length&&(e=!0):c.type==="pattern"?a.get(c.field).toString().match(c.value)&&(e=!0):e=!1}),e&&d.push(a)}),d},_filter:function(d,e,f){var g=this,h={};b.isString(e)?h[e]={cmp_method:"regexp"}:b.isArray(e)?b.each(e,function(a){h[a]={cmp_method:"regexp"}}):b.each(e,function(a,c){h[c]=b.defaults(a,{cmp_method:"regexp"})}),e=h,b.has(a.Paginator,"removeDiacritics")&&g.useDiacriticsPlugin&&(f=a.Paginator.removeDiacritics(f));if(f===""||!b.isString(f))return d;var i=b.map(c.trim(f).split(/\s/g),function(a){return a.toLowerCase()}),j="("+b.uniq(i).join("|")+")",k=new RegExp(j,"igm"),l=[];return b.each(d,function(c){var d=[];b.each(e,function(e,h){var j=c.get(h);if(j){var l=[];b.has(a.Paginator,"removeDiacritics")&&g.useDiacriticsPlugin?j=a.Paginator.removeDiacritics(j.toString()):j=j.toString();if(e.cmp_method==="levenshtein"&&b.has(a.Paginator,"levenshtein")&&g.useLevenshteinPlugin){var m=a.Paginator.levenshtein(j,f);b.defaults(e,{max_distance:0}),m<=e.max_distance&&(l=b.uniq(i))}else l=j.match(k);l=b.map(l,function(a){return a.toString().toLowerCase()}),b.each(l,function(a){d.push(a)})}}),d=b.uniq(b.without(d,"")),b.isEmpty(b.difference(i,d))&&l.push(c)}),l},info:function(){var a=this,b={},c=a.sortedAndFilteredModels?a.sortedAndFilteredModels.length:a.length,d=Math.ceil(c/a.perPage);return b={totalUnfilteredRecords:a.origModels.length,totalRecords:c,currentPage:a.currentPage,perPage:this.perPage,totalPages:d,firstPage:this.firstPage,lastPage:d,previous:!1,next:!1,startRecord:c===0?0:(a.currentPage-1)*this.perPage+1,endRecord:Math.min(c,a.currentPage*this.perPage)},a.currentPage>1&&(b.previous=a.currentPage-1),a.currentPage<b.totalPages&&(b.next=a.currentPage+1),b.pageSet=a.setPagination(b),a.information=b,b},setPagination:function(a){var b=[],c=0,d=0,e=this.pagesInRange*2,f=Math.ceil(a.totalRecords/a.perPage);if(f>1)if(f<=1+e)for(c=1,d=f;c<=d;c++)b.push(c);else if(a.currentPage<=this.pagesInRange+1)for(c=1,d=2+e;c<d;c++)b.push(c);else if(f-this.pagesInRange>a.currentPage&&a.currentPage>this.pagesInRange)for(c=a.currentPage-this.pagesInRange;c<=a.currentPage+this.pagesInRange;c++)b.push(c);else for(c=f-e;c<=f;c++)b.push(c);return b},bootstrap:function(a){return b.extend(this,a),this.goTo(1),this.info(),this}}),e.clientPager.prototype.prevPage=e.clientPager.prototype.previousPage,e.requestPager=a.Collection.extend({sync:function(a,e,f){var g=this;g.setDefaults();var h={};b.each(b.result(g,"server_api"),function(a,c){b.isFunction(a)&&(a=b.bind(a,g),a=a()),h[c]=a});var i=b.clone(g.paginator_core);b.each(i,function(a,c){b.isFunction(a)&&(a=b.bind(a,g),a=a()),i[c]=a}),i=b.defaults(i,{timeout:25e3,cache:!1,type:"GET",dataType:"jsonp"}),f.data?f.data=decodeURIComponent(c.param(b.extend(h,f.data))):f.data=decodeURIComponent(c.param(h)),i=b.extend(i,{data:decodeURIComponent(c.param(h)),processData:!1,url:b.result(i,"url")},f);var j=d[0]!==0||d[1]!==9||d[2]!==10,k=i.success;i.success=function(a,b,c){k&&(j?k(a,b,c):k(e,a,i)),d[0]<1&&e&&e.trigger&&e.trigger("sync",e,a,i)};var l=i.error;i.error=function(a){l&&l(e,a,i),e&&e.trigger&&e.trigger("error",e,a,i)};var m=i.xhr=c.ajax(i);return e&&e.trigger&&e.trigger("request",e,m,i),m},setDefaults:function(){var a=this;b.defaults(a.paginator_ui,{firstPage:0,currentPage:1,perPage:5,totalPages:10,pagesInRange:4}),b.each(a.paginator_ui,function(c,d){b.isUndefined(a[d])&&(a[d]=a.paginator_ui[d])})},requestNextPage:function(a){if(this.currentPage!==undefined)return this.currentPage+=1,this.pager(a);var b=new c.Deferred;return b.reject(),b.promise()},requestPreviousPage:function(a){if(this.currentPage!==undefined)return this.currentPage-=1,this.pager(a);var b=new c.Deferred;return b.reject(),b.promise()},updateOrder:function(a){a!==undefined&&(this.sortField=a,this.pager())},goTo:function(a,b){if(a!==undefined)return this.currentPage=parseInt(a,10),this.pager(b);var d=new c.Deferred;return d.reject(),d.promise()},howManyPer:function(a){a!==undefined&&(this.currentPage=this.firstPage,this.perPage=a,this.pager())},info:function(){var a={totalRecords:this.totalRecords||0,currentPage:this.currentPage,firstPage:this.firstPage,totalPages:Math.ceil(this.totalRecords/this.perPage),lastPage:this.totalPages,perPage:this.perPage,previous:!1,next:!1};return this.currentPage>1&&(a.previous=this.currentPage-1),this.currentPage<a.totalPages&&(a.next=this.currentPage+1),a.hasNext=a.next,a.hasPrevious=a.next,a.pageSet=this.setPagination(a),this.information=a,a},setPagination:function(a){var b=[],c=0,d=0,e=this.pagesInRange*2,f=Math.ceil(a.totalRecords/a.perPage);if(f>1)if(f<=1+e)for(c=1,d=f;c<=d;c++)b.push(c);else if(a.currentPage<=this.pagesInRange+1)for(c=1,d=2+e;c<d;c++)b.push(c);else if(f-this.pagesInRange>a.currentPage&&a.currentPage>this.pagesInRange)for(c=a.currentPage-this.pagesInRange;c<=a.currentPage+this.pagesInRange;c++)b.push(c);else for(c=f-e;c<=f;c++)b.push(c);return b},pager:function(a){return b.isObject(a)||(a={}),this.fetch(a)},url:function(){return this.paginator_core!==undefined&&this.paginator_core.url!==undefined?this.paginator_core.url:null},bootstrap:function(a){return b.extend(this,a),this.setDefaults(),this.info(),this}}),e.requestPager.prototype.nextPage=e.requestPager.prototype.requestNextPage,e.requestPager.prototype.prevPage=e.requestPager.prototype.requestPreviousPage,e}(Backbone,_,jQuery)
;((function(){var a,b,c,d,e,f,g,h;Backbone.Collection.prototype.syncDirty=function(){var a,b,c,d,e,f,g;d=localStorage.getItem(""+this.url+"_dirty"),b=d&&d.split(",")||[],g=[];for(e=0,f=b.length;e<f;e++)a=b[e],c=a.length===36?this.where({id:a})[0]:this.get(parseInt(a)),g.push(c.save());return g},Backbone.Collection.prototype.syncDestroyed=function(){var a,b,c,d,e,f,g;d=localStorage.getItem(""+this.url+"_destroyed"),b=d&&d.split(",")||[],g=[];for(e=0,f=b.length;e<f;e++)a=b[e],c=new this.model({id:a}),c.collection=this,g.push(c.destroy());return g},Backbone.Collection.prototype.syncDirtyAndDestroyed=function(){return this.syncDirty(),this.syncDestroyed()},a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},window.Store=function(){function b(a){this.name=a,this.records=this.recordsOn(this.name)}return b.prototype.sep="",b.prototype.generateId=function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},b.prototype.save=function(){return localStorage.setItem(this.name,this.records.join(","))},b.prototype.recordsOn=function(a){var b;return b=localStorage.getItem(a),b&&b.split(",")||[]},b.prototype.dirty=function(a){var b;return b=this.recordsOn(this.name+"_dirty"),_.include(b,a.id.toString())||(b.push(a.id),localStorage.setItem(this.name+"_dirty",b.join(","))),a},b.prototype.clean=function(a,b){var c,d;return d=""+this.name+"_"+b,c=this.recordsOn(d),_.include(c,a.id.toString())&&localStorage.setItem(d,_.without(c,a.id.toString()).join(",")),a},b.prototype.destroyed=function(a){var b;return b=this.recordsOn(this.name+"_destroyed"),_.include(b,a.id.toString())||(b.push(a.id),localStorage.setItem(this.name+"_destroyed",b.join(","))),a},b.prototype.create=function(a){return _.isObject(a)?(a.id||(a.id=this.generateId(),a.set(a.idAttribute,a.id)),localStorage.setItem(this.name+this.sep+a.id,JSON.stringify(a)),this.records.push(a.id.toString()),this.save(),a):a},b.prototype.update=function(a){return localStorage.setItem(this.name+this.sep+a.id,JSON.stringify(a)),_.include(this.records,a.id.toString())||this.records.push(a.id.toString()),this.save(),a},b.prototype.clear=function(){var a,b,c,d;d=this.records;for(b=0,c=d.length;b<c;b++)a=d[b],localStorage.removeItem(this.name+this.sep+a);return this.records=[],this.save()},b.prototype.hasDirtyOrDestroyed=function(){return!_.isEmpty(localStorage.getItem(this.name+"_dirty"))||!_.isEmpty(localStorage.getItem(this.name+"_destroyed"))},b.prototype.find=function(a){return JSON.parse(localStorage.getItem(this.name+this.sep+a.id))},b.prototype.findAll=function(){var a,b,c,d,e;d=this.records,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(JSON.parse(localStorage.getItem(this.name+this.sep+a)));return e},b.prototype.destroy=function(a){return localStorage.removeItem(this.name+this.sep+a.id),this.records=_.reject(this.records,function(b){return b===a.id.toString()}),this.save(),a},b}(),c={needsTranslation:Backbone.VERSION==="0.9.10",forBackboneCaller:function(a){return this.needsTranslation?function(b,c,d){return a.call(null,c)}:a},forDualstorageCaller:function(a,b,c){return this.needsTranslation?function(d){return a.call(null,b,d,c)}:a}},e=function(a,b,c){var d,e;return e=new Store(c.storeName),d=function(){switch(a){case"read":return b.id?e.find(b):e.findAll();case"hasDirtyOrDestroyed":return e.hasDirtyOrDestroyed();case"clear":return e.clear();case"create":if(!(c.add&&!c.merge&&e.find(b))){b=e.create(b);if(c.dirty)return e.dirty(b)}break;case"update":return e.update(b),c.dirty?e.dirty(b):e.clean(b,"dirty");case"delete":return e.destroy(b),c.dirty?e.destroyed(b):b.id.toString().length===36?e.clean(b,"dirty"):e.clean(b,"destroyed")}}(),c.ignoreCallbacks||(d?c.success(d):c.error("Record not found")),d},h=function(a,b){var c;return a?(c=a[b],_.isFunction(c)?c.call(a):c):null},g=function(a,b){if(!a||!a.parseBeforeLocalSave)return b;if(_.isFunction(a.parseBeforeLocalSave))return a.parseBeforeLocalSave(b)},b=Backbone.sync,f=function(a,d,e){return e.success=c.forBackboneCaller(e.success),e.error=c.forBackboneCaller(e.error),b(a,d,e)},d=function(a,b,d){var i,j,k,l;console.log(b.collection.paginator_core.url),d.storeName=h(b.collection,"url")||h(b,"url"),d.success=c.forDualstorageCaller(d.success,b,d),d.error=c.forDualstorageCaller(d.error,b,d);if(h(b,"remote")||h(b.collection,"remote"))return f(a,b,d);j=h(b,"local")||h(b.collection,"local"),d.dirty=d.remote===!1&&!j;if(d.remote===!1||j)return e(a,b,d);d.ignoreCallbacks=!0,l=d.success,i=d.error;switch(a){case"read":return e("hasDirtyOrDestroyed",b,d)?l(e(a,b,d)):(d.success=function(a,c,f){var h,i,j;a=g(b,a),d.add||e("clear",b,d);if(_.isArray(a))for(i=0,j=a.length;i<j;i++)h=a[i],e("create",h,d);else e("create",a,d);return l(a,c,f)},d.error=function(c){return l(e(a,b,d))},f(a,b,d));case"create":return d.success=function(b,c,f){return e(a,b,d),l(b,c,f)},d.error=function(c){return d.dirty=!0,l(e(a,b,d))},f(a,b,d);case"update":return _.isString(b.id)&&b.id.length===36?(k=b.clone(),d.success=function(a,b,c){return e("delete",k,d),e("create",a,d),l(a,b,c)},d.error=function(b){return d.dirty=!0,l(e(a,k,d))},b.set({id:null}),f("create",b,d)):(d.success=function(c,f,g){return l(e(a,b,d))},d.error=function(c){return d.dirty=!0,l(e(a,b,d))},f(a,b,d));case"delete":return _.isString(b.id)&&b.id.length===36?e(a,b,d):(d.success=function(c,f,g){return e(a,b,d),l(c,f,g)},d.error=function(c){return d.dirty=!0,l(e(a,b,d))},f(a,b,d))}},Backbone.sync=d})).call(this)
;(function(a){a.flexslider=function(b,c){var d=a(b),e=a.extend({},a.flexslider.defaults,c),f=e.namespace,g="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,h=g?"touchend":"click",i=e.direction==="vertical",j=e.reverse,k=e.itemWidth>0,l=e.animation==="fade",m=e.asNavFor!=="",n={};a.data(b,"flexslider",d),n={init:function(){d.animating=!1,d.currentSlide=e.startAt,d.animatingTo=d.currentSlide,d.atEnd=d.currentSlide===0||d.currentSlide===d.last,d.containerSelector=e.selector.substr(0,e.selector.search(" ")),d.slides=a(e.selector,d),d.container=a(d.containerSelector,d),d.count=d.slides.length,d.syncExists=a(e.sync).length>0,e.animation==="slide"&&(e.animation="swing"),d.prop=i?"top":"marginLeft",d.args={},d.manualPause=!1,d.transitions=!e.video&&!l&&e.useCSS&&function(){var a=document.createElement("div"),b=["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"];for(var c in b)if(a.style[b[c]]!==undefined)return d.pfx=b[c].replace("Perspective","").toLowerCase(),d.prop="-"+d.pfx+"-transform",!0;return!1}(),e.controlsContainer!==""&&(d.controlsContainer=a(e.controlsContainer).length>0&&a(e.controlsContainer)),e.manualControls!==""&&(d.manualControls=a(e.manualControls).length>0&&a(e.manualControls)),e.randomize&&(d.slides.sort(function(){return Math.round(Math.random())-.5}),d.container.empty().append(d.slides)),d.doMath(),m&&n.asNav.setup(),d.setup("init"),e.controlNav&&n.controlNav.setup(),e.directionNav&&n.directionNav.setup(),e.keyboard&&(a(d.containerSelector).length===1||e.multipleKeyboard)&&a(document).bind("keyup",function(a){var b=a.keyCode;if(!d.animating&&(b===39||b===37)){var c=b===39?d.getTarget("next"):b===37?d.getTarget("prev"):!1;d.flexAnimate(c,e.pauseOnAction)}}),e.mousewheel&&d.bind("mousewheel",function(a,b,c,f){a.preventDefault();var g=b<0?d.getTarget("next"):d.getTarget("prev");d.flexAnimate(g,e.pauseOnAction)}),e.pausePlay&&n.pausePlay.setup(),e.slideshow&&(e.pauseOnHover&&d.hover(function(){!d.manualPlay&&!d.manualPause&&d.pause()},function(){!d.manualPause&&!d.manualPlay&&d.play()}),e.initDelay>0?setTimeout(d.play,e.initDelay):d.play()),g&&e.touch&&n.touch(),(!l||l&&e.smoothHeight)&&a(window).bind("resize focus",n.resize),setTimeout(function(){e.start(d)},200)},asNav:{setup:function(){d.asNav=!0,d.animatingTo=Math.floor(d.currentSlide/d.move),d.currentItem=d.currentSlide,d.slides.removeClass(f+"active-slide").eq(d.currentItem).addClass(f+"active-slide"),d.slides.click(function(b){b.preventDefault();var c=a(this),f=c.index();!a(e.asNavFor).data("flexslider").animating&&!c.hasClass("active")&&(d.direction=d.currentItem<f?"next":"prev",d.flexAnimate(f,e.pauseOnAction,!1,!0,!0))})}},controlNav:{setup:function(){d.manualControls?n.controlNav.setupManual():n.controlNav.setupPaging()},setupPaging:function(){var b=e.controlNav==="thumbnails"?"control-thumbs":"control-paging",c=1,i;d.controlNavScaffold=a('<ol class="'+f+"control-nav "+f+b+'"></ol>');if(d.pagingCount>1)for(var j=0;j<d.pagingCount;j++)i=e.controlNav==="thumbnails"?'<img src="'+d.slides.eq(j).attr("data-thumb")+'"/>':"<a>"+c+"</a>",d.controlNavScaffold.append("<li>"+i+"</li>"),c++;d.controlsContainer?a(d.controlsContainer).append(d.controlNavScaffold):d.append(d.controlNavScaffold),n.controlNav.set(),n.controlNav.active(),d.controlNavScaffold.delegate("a, img",h,function(b){b.preventDefault();var c=a(this),g=d.controlNav.index(c);c.hasClass(f+"active")||(d.direction=g>d.currentSlide?"next":"prev",d.flexAnimate(g,e.pauseOnAction))}),g&&d.controlNavScaffold.delegate("a","click touchstart",function(a){a.preventDefault()})},setupManual:function(){d.controlNav=d.manualControls,n.controlNav.active(),d.controlNav.on(h,function(b){b.preventDefault();var c=a(this),g=d.controlNav.index(c);c.hasClass(f+"active")||(g>d.currentSlide?d.direction="next":d.direction="prev",d.flexAnimate(g,e.pauseOnAction))}),g&&d.controlNav.on("click touchstart",function(a){a.preventDefault()})},set:function(){var b=e.controlNav==="thumbnails"?"img":"a";d.controlNav=a("."+f+"control-nav li "+b,d.controlsContainer?d.controlsContainer:d)},active:function(){d.controlNav.removeClass(f+"active").eq(d.animatingTo).addClass(f+"active")},update:function(b,c){d.pagingCount>1&&b==="add"?d.controlNavScaffold.append(a("<li><a>"+d.count+"</a></li>")):d.pagingCount===1?d.controlNavScaffold.find("li").remove():d.controlNav.eq(c).closest("li").remove(),n.controlNav.set(),d.pagingCount>1&&d.pagingCount!==d.controlNav.length?d.update(c,b):n.controlNav.active()}},directionNav:{setup:function(){var b=a('<ul class="'+f+'direction-nav"><li><a class="'+f+'prev" href="#">'+e.prevText+'</a></li><li><a class="'+f+'next" href="#">'+e.nextText+"</a></li></ul>");d.controlsContainer?(a(d.controlsContainer).append(b),d.directionNav=a("."+f+"direction-nav li a",d.controlsContainer)):(d.append(b),d.directionNav=a("."+f+"direction-nav li a",d)),n.directionNav.update(),d.directionNav.bind(h,function(b){b.preventDefault();var c=a(this).hasClass(f+"next")?d.getTarget("next"):d.getTarget("prev");d.flexAnimate(c,e.pauseOnAction)}),g&&d.directionNav.bind("click touchstart",function(a){a.preventDefault()})},update:function(){var a=f+"disabled";d.pagingCount===1?d.directionNav.addClass(a):e.animationLoop?d.directionNav.removeClass(a):d.animatingTo===0?d.directionNav.removeClass(a).filter("."+f+"prev").addClass(a):d.animatingTo===d.last?d.directionNav.removeClass(a).filter("."+f+"next").addClass(a):d.directionNav.removeClass(a)}},pausePlay:{setup:function(){var b=a('<div class="'+f+'pauseplay"><a></a></div>');d.controlsContainer?(d.controlsContainer.append(b),d.pausePlay=a("."+f+"pauseplay a",d.controlsContainer)):(d.append(b),d.pausePlay=a("."+f+"pauseplay a",d)),n.pausePlay.update(e.slideshow?f+"pause":f+"play"),d.pausePlay.bind(h,function(b){b.preventDefault(),a(this).hasClass(f+"pause")?(d.manualPause=!0,d.manualPlay=!1,d.pause()):(d.manualPause=!1,d.manualPlay=!0,d.play())}),g&&d.pausePlay.bind("click touchstart",function(a){a.preventDefault()})},update:function(a){a==="play"?d.pausePlay.removeClass(f+"pause").addClass(f+"play").text(e.playText):d.pausePlay.removeClass(f+"play").addClass(f+"pause").text(e.pauseText)}},touch:function(){function o(h){d.animating?h.preventDefault():h.touches.length===1&&(d.pause(),g=i?d.h:d.w,m=Number(new Date),f=k&&j&&d.animatingTo===d.last?0:k&&j?d.limit-(d.itemW+e.itemMargin)*d.move*d.animatingTo:k&&d.currentSlide===d.last?d.limit:k?(d.itemW+e.itemMargin)*d.move*d.currentSlide:j?(d.last-d.currentSlide+d.cloneOffset)*g:(d.currentSlide+d.cloneOffset)*g,a=i?h.touches[0].pageY:h.touches[0].pageX,c=i?h.touches[0].pageX:h.touches[0].pageY,b.addEventListener("touchmove",p,!1),b.addEventListener("touchend",q,!1))}function p(b){h=i?a-b.touches[0].pageY:a-b.touches[0].pageX,n=i?Math.abs(h)<Math.abs(b.touches[0].pageX-c):Math.abs(h)<Math.abs(b.touches[0].pageY-c);if(!n||Number(new Date)-m>500)b.preventDefault(),!l&&d.transitions&&(e.animationLoop||(h/=d.currentSlide===0&&h<0||d.currentSlide===d.last&&h>0?Math.abs(h)/g+2:1),d.setProps(f+h,"setTouch"))}function q(i){b.removeEventListener("touchmove",p,!1);if(d.animatingTo===d.currentSlide&&!n&&h!==null){var k=j?-h:h,o=k>0?d.getTarget("next"):d.getTarget("prev");d.canAdvance(o)&&(Number(new Date)-m<550&&Math.abs(k)>50||Math.abs(k)>g/2)?d.flexAnimate(o,e.pauseOnAction):l||d.flexAnimate(d.currentSlide,e.pauseOnAction,!0)}b.removeEventListener("touchend",q,!1),a=null,c=null,h=null,f=null}var a,c,f,g,h,m,n=!1;b.addEventListener("touchstart",o,!1)},resize:function(){!d.animating&&d.is(":visible")&&(k||d.doMath(),l?n.smoothHeight():k?(d.slides.width(d.computedW),d.update(d.pagingCount),d.setProps()):i?(d.viewport.height(d.h),d.setProps(d.h,"setTotal")):(e.smoothHeight&&n.smoothHeight(),d.newSlides.width(d.computedW),d.setProps(d.computedW,"setTotal")))},smoothHeight:function(a){if(!i||l){var b=l?d:d.viewport;a?b.animate({height:d.slides.eq(d.animatingTo).height()},a):b.height(d.slides.eq(d.animatingTo).height())}},sync:function(b){var c=a(e.sync).data("flexslider"),f=d.animatingTo;switch(b){case"animate":c.flexAnimate(f,e.pauseOnAction,!1,!0);break;case"play":!c.playing&&!c.asNav&&c.play();break;case"pause":c.pause()}}},d.flexAnimate=function(b,c,h,o,p){m&&d.pagingCount===1&&(d.direction=d.currentItem<b?"next":"prev");if(!d.animating&&(d.canAdvance(b,p)||h)&&d.is(":visible")){if(m&&o){var q=a(e.asNavFor).data("flexslider");d.atEnd=b===0||b===d.count-1,q.flexAnimate(b,!0,!1,!0,p),d.direction=d.currentItem<b?"next":"prev",q.direction=d.direction;if(Math.ceil((b+1)/d.visible)-1!==d.currentSlide&&b!==0)d.currentItem=b,d.slides.removeClass(f+"active-slide").eq(b).addClass(f+"active-slide"),b=Math.floor(b/d.visible);else return d.currentItem=b,d.slides.removeClass(f+"active-slide").eq(b).addClass(f+"active-slide"),!1}d.animating=!0,d.animatingTo=b,e.before(d),c&&d.pause(),d.syncExists&&!p&&n.sync("animate"),e.controlNav&&n.controlNav.active(),k||d.slides.removeClass(f+"active-slide").eq(b).addClass(f+"active-slide"),d.atEnd=b===0||b===d.last,e.directionNav&&n.directionNav.update(),b===d.last&&(e.end(d),e.animationLoop||d.pause());if(!l){var r=i?d.slides.filter(":first").height():d.computedW,s,t,u;k?(s=e.itemWidth>d.w?e.itemMargin*2:e.itemMargin,u=(d.itemW+s)*d.move*d.animatingTo,t=u>d.limit&&d.visible!==1?d.limit:u):d.currentSlide===0&&b===d.count-1&&e.animationLoop&&d.direction!=="next"?t=j?(d.count+d.cloneOffset)*r:0:d.currentSlide===d.last&&b===0&&e.animationLoop&&d.direction!=="prev"?t=j?0:(d.count+1)*r:t=j?(d.count-1-b+d.cloneOffset)*r:(b+d.cloneOffset)*r,d.setProps(t,"",e.animationSpeed);if(d.transitions){if(!e.animationLoop||!d.atEnd)d.animating=!1,d.currentSlide=d.animatingTo;d.container.unbind("webkitTransitionEnd transitionend"),d.container.bind("webkitTransitionEnd transitionend",function(){d.wrapup(r)})}else d.container.animate(d.args,e.animationSpeed,e.easing,function(){d.wrapup(r)})}else g?(d.slides.eq(d.currentSlide).css({opacity:0,zIndex:1}),d.slides.eq(b).css({opacity:1,zIndex:2}),d.slides.unbind("webkitTransitionEnd transitionend"),d.slides.eq(d.currentSlide).bind("webkitTransitionEnd transitionend",function(){e.after(d)}),d.animating=!1,d.currentSlide=d.animatingTo):(d.slides.eq(d.currentSlide).fadeOut(e.animationSpeed,e.easing),d.slides.eq(b).fadeIn(e.animationSpeed,e.easing,d.wrapup));e.smoothHeight&&n.smoothHeight(e.animationSpeed)}},d.wrapup=function(a){!l&&!k&&(d.currentSlide===0&&d.animatingTo===d.last&&e.animationLoop?d.setProps(a,"jumpEnd"):d.currentSlide===d.last&&d.animatingTo===0&&e.animationLoop&&d.setProps(a,"jumpStart")),d.animating=!1,d.currentSlide=d.animatingTo,e.after(d)},d.animateSlides=function(){d.animating||d.flexAnimate(d.getTarget("next"))},d.pause=function(){clearInterval(d.animatedSlides),d.playing=!1,e.pausePlay&&n.pausePlay.update("play"),d.syncExists&&n.sync("pause")},d.play=function(){d.animatedSlides=setInterval(d.animateSlides,e.slideshowSpeed),d.playing=!0,e.pausePlay&&n.pausePlay.update("pause"),d.syncExists&&n.sync("play")},d.canAdvance=function(a,b){var c=m?d.pagingCount-1:d.last;return b?!0:m&&d.currentItem===d.count-1&&a===0&&d.direction==="prev"?!0:m&&d.currentItem===0&&a===d.pagingCount-1&&d.direction!=="next"?!1:a===d.currentSlide&&!m?!1:e.animationLoop?!0:d.atEnd&&d.currentSlide===0&&a===c&&d.direction!=="next"?!1:d.atEnd&&d.currentSlide===c&&a===0&&d.direction==="next"?!1:!0},d.getTarget=function(a){return d.direction=a,a==="next"?d.currentSlide===d.last?0:d.currentSlide+1:d.currentSlide===0?d.last:d.currentSlide-1},d.setProps=function(a,b,c){var f=function(){var c=a?a:(d.itemW+e.itemMargin)*d.move*d.animatingTo,f=function(){if(k)return b==="setTouch"?a:j&&d.animatingTo===d.last?0:j?d.limit-(d.itemW+e.itemMargin)*d.move*d.animatingTo:d.animatingTo===d.last?d.limit:c;switch(b){case"setTotal":return j?(d.count-1-d.currentSlide+d.cloneOffset)*a:(d.currentSlide+d.cloneOffset)*a;case"setTouch":return j?a:a;case"jumpEnd":return j?a:d.count*a;case"jumpStart":return j?d.count*a:a;default:return a}}();return f*-1+"px"}();d.transitions&&(f=i?"translate3d(0,"+f+",0)":"translate3d("+f+",0,0)",c=c!==undefined?c/1e3+"s":"0s",d.container.css("-"+d.pfx+"-transition-duration",c)),d.args[d.prop]=f,(d.transitions||c===undefined)&&d.container.css(d.args)},d.setup=function(b){if(!l){var c,h;b==="init"&&(d.viewport=a('<div class="'+f+'viewport"></div>').css({overflow:"hidden",position:"relative"}).appendTo(d).append(d.container),e.slideOffset>0&&d.viewport.css("padding","0 "+e.slideOffset+"px"),d.cloneCount=0,d.cloneOffset=0,j&&(h=a.makeArray(d.slides).reverse(),d.slides=a(h),d.container.empty().append(d.slides))),e.animationLoop&&!k&&(d.cloneCount=2,d.cloneOffset=1,b!=="init"&&d.container.find(".clone").remove(),d.container.append(d.slides.first().clone().addClass("clone")).prepend(d.slides.last().clone().addClass("clone"))),d.newSlides=a(e.selector,d),c=j?d.count-1-d.currentSlide+d.cloneOffset:d.currentSlide+d.cloneOffset,i&&!k?(d.container.height((d.count+d.cloneCount)*200+"%").css("position","absolute").width("100%"),setTimeout(function(){d.newSlides.css({display:"block"}),d.doMath(),d.viewport.height(d.h),d.setProps(c*d.h,"init")},b==="init"?100:0)):(d.container.width((d.count+d.cloneCount)*200+"%"),d.setProps(c*d.computedW,"init"),setTimeout(function(){d.doMath(),d.newSlides.css({width:d.computedW,"float":"left",display:"block"}),e.smoothHeight&&n.smoothHeight()},b==="init"?100:0))}else d.slides.css({width:"100%","float":"left",marginRight:"-100%",position:"relative"}),b==="init"&&(g?d.slides.css({opacity:0,display:"block",webkitTransition:"opacity "+e.animationSpeed/1e3+"s ease",zIndex:1}).eq(d.currentSlide).css({opacity:1,zIndex:2}):d.slides.eq(d.currentSlide).fadeIn(e.animationSpeed,e.easing)),e.smoothHeight&&n.smoothHeight();k||d.slides.removeClass(f+"active-slide").eq(d.currentSlide).addClass(f+"active-slide")},d.doMath=function(){var a=d.slides.first(),b=e.itemMargin,c=e.minItems,f=e.maxItems;d.w=d.width(),d.h=a.height(),d.boxPadding=a.outerWidth()-a.width(),k?(d.itemT=e.itemWidth+b,d.minW=c?c*d.itemT:d.w,d.maxW=f?f*d.itemT:d.w,d.itemW=d.minW>d.w?(d.w-b*c)/c:d.maxW<d.w?(d.w-b*f)/f:e.itemWidth>d.w?d.w:e.itemWidth,d.visible=Math.floor(d.w/(d.itemW+b)),d.move=e.move>0&&e.move<d.visible?e.move:d.visible,d.pagingCount=Math.ceil((d.count-d.visible)/d.move+1),d.last=d.pagingCount-1,d.limit=d.pagingCount===1?0:e.itemWidth>d.w?(d.itemW+b*2)*d.count-d.w-b:(d.itemW+b)*d.count-d.w-b):(d.itemW=d.w,d.pagingCount=d.count,d.last=d.count-1),d.computedW=d.itemW-e.slideOffset*2},d.update=function(a,b){d.doMath(),k||(a<d.currentSlide?d.currentSlide+=1:a<=d.currentSlide&&a!==0&&(d.currentSlide-=1),d.animatingTo=d.currentSlide);if(e.controlNav&&!d.manualControls)if(b==="add"&&!k||d.pagingCount>d.controlNav.length)n.controlNav.update("add");else if(b==="remove"&&!k||d.pagingCount<d.controlNav.length)k&&d.currentSlide>d.last&&(d.currentSlide-=1,d.animatingTo-=1),n.controlNav.update("remove",d.last);e.directionNav&&n.directionNav.update()},d.addSlide=function(b,c){var f=a(b);d.count+=1,d.last=d.count-1,i&&j?c!==undefined?d.slides.eq(d.count-c).after(f):d.container.prepend(f):c!==undefined?d.slides.eq(c).before(f):d.container.append(f),d.update(c,"add"),d.slides=a(e.selector+":not(.clone)",d),d.setup(),e.added(d)},d.removeSlide=function(b){var c=isNaN(b)?d.slides.index(a(b)):b;d.count-=1,d.last=d.count-1,isNaN(b)?a(b,d.slides).remove():i&&j?d.slides.eq(d.last).remove():d.slides.eq(b).remove(),d.doMath(),d.update(c,"remove"),d.slides=a(e.selector+":not(.clone)",d),d.setup(),e.removed(d)},n.init()},a.flexslider.defaults={namespace:"flex-",selector:".slides > li",animation:"fade",easing:"swing",direction:"horizontal",reverse:!1,animationLoop:!0,smoothHeight:!1,startAt:0,slideshow:!0,slideshowSpeed:7e3,animationSpeed:600,initDelay:0,randomize:!1,pauseOnAction:!0,pauseOnHover:!1,useCSS:!0,touch:!0,video:!1,controlNav:!0,directionNav:!0,prevText:"Previous",nextText:"Next",keyboard:!0,multipleKeyboard:!1,mousewheel:!1,pausePlay:!1,pauseText:"Pause",playText:"Play",controlsContainer:"",manualControls:"",sync:"",asNavFor:"",itemWidth:0,itemMargin:0,minItems:0,maxItems:0,move:0,start:function(){},before:function(){},after:function(){},end:function(){},added:function(){},removed:function(){},slideOffset:0},a.fn.flexslider=function(b){b===undefined&&(b={});if(typeof b=="object")return this.each(function(){var c=a(this),d=b.selector?b.selector:".slides > li",e=c.find(d);e.length===1?(e.fadeIn(400),b.start&&b.start(c)):c.data("flexslider")==undefined&&new a.flexslider(this,b)});var c=a(this).data("flexslider");switch(b){case"play":c.play();break;case"pause":c.pause();break;case"next":c.flexAnimate(c.getTarget("next"),!0);break;case"prev":case"previous":c.flexAnimate(c.getTarget("prev"),!0);break;default:typeof b=="number"&&c.flexAnimate(b,!0)}}})(jQuery)
;((function(){var a;a=function(){function a(){this.options_index=0,this.parsed=[]}return a.prototype.add_node=function(a){return a.nodeName.toUpperCase()==="OPTGROUP"?this.add_group(a):this.add_option(a)},a.prototype.add_group=function(a){var b,c,d,e,f,g;b=this.parsed.length,this.parsed.push({array_index:b,group:!0,label:a.label,children:0,disabled:a.disabled}),f=a.childNodes,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(this.add_option(c,b,a.disabled));return g},a.prototype.add_option=function(a,b,c){if(a.nodeName.toUpperCase()==="OPTION")return a.text!==""?(b!=null&&(this.parsed[b].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:a.value,text:a.text,html:a.innerHTML,selected:a.selected,disabled:c===!0?c:a.disabled,group_array_index:b,classes:a.className,style:a.style.cssText})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1},a}(),a.select_to_array=function(b){var c,d,e,f,g;d=new a,g=b.childNodes;for(e=0,f=g.length;e<f;e++)c=g[e],d.add_node(c);return d.parsed},this.SelectParser=a})).call(this),function(){var a,b;b=this,a=function(){function a(a,b){this.form_field=a,this.options=b!=null?b:{},this.is_multiple=this.form_field.multiple,this.set_default_text(),this.set_default_values(),this.setup(),this.set_up_html(),this.register_observers(),this.finish_setup()}return a.prototype.set_default_values=function(){var a=this;return this.click_test_action=function(b){return a.test_active_click(b)},this.activate_action=function(b){return a.activate_field(b)},this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.result_single_selected=null,this.allow_single_deselect=this.options.allow_single_deselect!=null&&this.form_field.options[0]!=null&&this.form_field.options[0].text===""?this.options.allow_single_deselect:!1,this.disable_search_threshold=this.options.disable_search_threshold||0,this.disable_search=this.options.disable_search||!1,this.enable_split_word_search=this.options.enable_split_word_search!=null?this.options.enable_split_word_search:!0,this.search_contains=this.options.search_contains||!1,this.choices=0,this.single_backstroke_delete=this.options.single_backstroke_delete||!1,this.max_selected_options=this.options.max_selected_options||Infinity,this.inherit_select_classes=this.options.inherit_select_classes||!1},a.prototype.set_default_text=function(){return this.form_field.getAttribute("data-placeholder")?this.default_text=this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||"Select Some Options":this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||"Select an Option",this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||"No results match"},a.prototype.mouse_enter=function(){return this.mouse_on_container=!0},a.prototype.mouse_leave=function(){return this.mouse_on_container=!1},a.prototype.input_focus=function(a){var b=this;if(this.is_multiple){if(!this.active_field)return setTimeout(function(){return b.container_mousedown()},50)}else if(!this.active_field)return this.activate_field()},a.prototype.input_blur=function(a){var b=this;if(!this.mouse_on_container)return this.active_field=!1,setTimeout(function(){return b.blur_test()},100)},a.prototype.result_add_option=function(a){var b,c;return a.disabled?"":(a.dom_id=this.container_id+"_o_"+a.array_index,b=a.selected&&this.is_multiple?[]:["active-result"],a.selected&&b.push("result-selected"),a.group_array_index!=null&&b.push("group-option"),a.classes!==""&&b.push(a.classes),c=a.style.cssText!==""?' style="'+a.style+'"':"",'<li id="'+a.dom_id+'" class="'+b.join(" ")+'"'+c+">"+a.html+"</li>")},a.prototype.results_update_field=function(){return this.set_default_text(),this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.result_single_selected=null,this.results_build()},a.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},a.prototype.results_search=function(a){return this.results_showing?this.winnow_results():this.results_show()},a.prototype.keyup_checker=function(a){var b,c;b=(c=a.which)!=null?c:a.keyCode,this.search_field_scale();switch(b){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices>0)return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:a.preventDefault();if(this.results_showing)return this.result_select(a);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}},a.prototype.generate_field_id=function(){var a;return a=this.generate_random_id(),this.form_field.id=a,a},a.prototype.generate_random_char=function(){var a,b,c;return a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ",c=Math.floor(Math.random()*a.length),b=a.substring(c,c+1)},a}(),b.AbstractChosen=a}.call(this),function(){var a,b,c,d,e,f={}.hasOwnProperty,g=function(a,b){function d(){this.constructor=a}for(var c in b)f.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};d=this,a=jQuery,a.fn.extend({chosen:function(c){var d,e,f;return f=navigator.userAgent.toLowerCase(),e=/(msie) ([\w.]+)/.exec(f)||[],d={name:e[1]||"",version:e[2]||"0"},d.name==="msie"&&(d.version==="6.0"||d.version==="7.0"&&document.documentMode===7)?this:this.each(function(d){var e;e=a(this);if(!e.hasClass("chzn-done"))return e.data("chosen",new b(this,c))})}}),b=function(b){function f(){return e=f.__super__.constructor.apply(this,arguments),e}return g(f,b),f.prototype.setup=function(){return this.form_field_jq=a(this.form_field),this.current_value=this.form_field_jq.val(),this.is_rtl=this.form_field_jq.hasClass("chzn-rtl")},f.prototype.finish_setup=function(){return this.form_field_jq.addClass("chzn-done")},f.prototype.set_up_html=function(){var b,d,e,f,g,h;return this.container_id=this.form_field.id.length?this.form_field.id.replace(/[^\w]/g,"_"):this.generate_field_id(),this.container_id+="_chzn",b=["chzn-container"],b.push("chzn-container-"+(this.is_multiple?"multi":"single")),this.inherit_select_classes&&this.form_field.className&&b.push(this.form_field.className),this.is_rtl&&b.push("chzn-rtl"),this.f_width=this.form_field_jq.outerWidth(),e={id:this.container_id,"class":b.join(" "),style:"width: "+this.f_width+"px;",title:this.form_field.title},d=a("<div />",e),this.is_multiple?d.html('<ul class="chzn-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chzn-drop" style="left:-9000px;"><ul class="chzn-results"></ul></div>'):d.html('<a href="javascript:void(0)" class="chzn-single chzn-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chzn-drop" style="left:-9000px;"><div class="chzn-search"><input type="text" autocomplete="off" /></div><ul class="chzn-results"></ul></div>'),this.form_field_jq.hide().after(d),this.container=a("#"+this.container_id),this.dropdown=this.container.find("div.chzn-drop").first(),f=this.container.height(),g=this.f_width-c(this.dropdown),this.dropdown.css({width:g+"px",top:f+"px"}),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chzn-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chzn-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chzn-search").first(),this.selected_item=this.container.find(".chzn-single").first(),h=g-c(this.search_container)-c(this.search_field),this.search_field.css({width:h+"px"})),this.results_build(),this.set_tab_index(),this.form_field_jq.trigger("liszt:ready",{chosen:this})},f.prototype.register_observers=function(){var a=this;return this.container.mousedown(function(b){a.container_mousedown(b)}),this.container.mouseup(function(b){a.container_mouseup(b)}),this.container.mouseenter(function(b){a.mouse_enter(b)}),this.container.mouseleave(function(b){a.mouse_leave(b)}),this.search_results.mouseup(function(b){a.search_results_mouseup(b)}),this.search_results.mouseover(function(b){a.search_results_mouseover(b)}),this.search_results.mouseout(function(b){a.search_results_mouseout(b)}),this.form_field_jq.bind("liszt:updated",function(b){a.results_update_field(b)}),this.form_field_jq.bind("liszt:activate",function(b){a.activate_field(b)}),this.form_field_jq.bind("liszt:open",function(b){a.container_mousedown(b)}),this.search_field.blur(function(b){a.input_blur(b)}),this.search_field.keyup(function(b){a.keyup_checker(b),b.preventDefault()}),this.search_field.keydown(function(b){a.keydown_checker(b)}),this.search_field.focus(function(b){a.input_focus(b)}),this.is_multiple?this.search_choices.click(function(b){a.choices_click(b)}):this.container.click(function(a){a.preventDefault()})},f.prototype.search_field_disabled=function(){this.is_disabled=this.form_field_jq[0].disabled;if(this.is_disabled)return this.container.addClass("chzn-disabled"),this.search_field[0].disabled=!0,this.is_multiple||this.selected_item.unbind("focus",this.activate_action),this.close_field();this.container.removeClass("chzn-disabled"),this.search_field[0].disabled=!1;if(!this.is_multiple)return this.selected_item.bind("focus",this.activate_action)},f.prototype.container_mousedown=function(b){var c;if(!this.is_disabled)return c=b!=null?a(b.target).hasClass("search-choice-close"):!1,b&&b.type==="mousedown"&&!this.results_showing&&b.preventDefault(),!this.pending_destroy_click&&!c?(this.active_field?!this.is_multiple&&b&&(a(b.target)[0]===this.selected_item[0]||a(b.target).parents("a.chzn-single").length)&&(b.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),a(document).click(this.click_test_action),this.results_show()),this.activate_field()):this.pending_destroy_click=!1},f.prototype.container_mouseup=function(a){if(a.target.nodeName==="ABBR"&&!this.is_disabled)return this.results_reset(a)},f.prototype.blur_test=function(a){if(!this.active_field&&this.container.hasClass("chzn-container-active"))return this.close_field()},f.prototype.close_field=function(){return a(document).unbind("click",this.click_test_action),this.active_field=!1,this.results_hide(),this.container.removeClass("chzn-container-active"),this.winnow_results_clear(),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale()},f.prototype.activate_field=function(){return this.container.addClass("chzn-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},f.prototype.test_active_click=function(b){return a(b.target).parents("#"+this.container_id).length?this.active_field=!0:this.close_field()},f.prototype.results_build=function(){var a,b,c,e,f;this.parsing=!0,this.results_data=d.SelectParser.select_to_array(this.form_field),this.is_multiple&&this.choices>0?(this.search_choices.find("li.search-choice").remove(),this.choices=0):this.is_multiple||(this.selected_item.addClass("chzn-default").find("span").text(this.default_text),this.disable_search||this.form_field.options.length<=this.disable_search_threshold?this.container.addClass("chzn-container-single-nosearch"):this.container.removeClass("chzn-container-single-nosearch")),a="",f=this.results_data;for(c=0,e=f.length;c<e;c++)b=f[c],b.group?a+=this.result_add_group(b):b.empty||(a+=this.result_add_option(b),b.selected&&this.is_multiple?this.choice_build(b):b.selected&&!this.is_multiple&&(this.selected_item.removeClass("chzn-default").find("span").text(b.text),this.allow_single_deselect&&this.single_deselect_control_build()));return this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.search_results.html(a),this.parsing=!1},f.prototype.result_add_group=function(b){return b.disabled?"":(b.dom_id=this.container_id+"_g_"+b.array_index,'<li id="'+b.dom_id+'" class="group-result">'+a("<div />").text(b.label).html()+"</li>")},f.prototype.result_do_highlight=function(a){var b,c,d,e,f;if(a.length){this.result_clear_highlight(),this.result_highlight=a,this.result_highlight.addClass("highlighted"),d=parseInt(this.search_results.css("maxHeight"),10),f=this.search_results.scrollTop(),e=d+f,c=this.result_highlight.position().top+this.search_results.scrollTop(),b=c+this.result_highlight.outerHeight();if(b>=e)return this.search_results.scrollTop(b-d>0?b-d:0);if(c<f)return this.search_results.scrollTop(c)}},f.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},f.prototype.results_show=function(){var a;if(!this.is_multiple)this.selected_item.addClass("chzn-single-with-drop"),this.result_single_selected&&this.result_do_highlight(this.result_single_selected);else if(this.max_selected_options<=this.choices)return this.form_field_jq.trigger("liszt:maxselected",{chosen:this}),!1;return a=this.is_multiple?this.container.height():this.container.height()-1,this.form_field_jq.trigger("liszt:showing_dropdown",{chosen:this}),this.dropdown.css({top:a+"px",left:0}),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results()},f.prototype.results_hide=function(){return this.is_multiple||this.selected_item.removeClass("chzn-single-with-drop"),this.result_clear_highlight(),this.form_field_jq.trigger("liszt:hiding_dropdown",{chosen:this}),this.dropdown.css({left:"-9000px"}),this.results_showing=!1},f.prototype.set_tab_index=function(a){var b;if(this.form_field_jq.attr("tabindex"))return b=this.form_field_jq.attr("tabindex"),this.form_field_jq.attr("tabindex",-1),this.search_field.attr("tabindex",b)},f.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},f.prototype.search_results_mouseup=function(b){var c;c=a(b.target).hasClass("active-result")?a(b.target):a(b.target).parents(".active-result").first();if(c.length)return this.result_highlight=c,this.result_select(b),this.search_field.focus()},f.prototype.search_results_mouseover=function(b){var c;c=a(b.target).hasClass("active-result")?a(b.target):a(b.target).parents(".active-result").first();if(c)return this.result_do_highlight(c)},f.prototype.search_results_mouseout=function(b){if(a(b.target).hasClass("active-result"))return this.result_clear_highlight()},f.prototype.choices_click=function(b){b.preventDefault();if(this.active_field&&!a(b.target).hasClass("search-choice")&&!this.results_showing)return this.results_show()},f.prototype.choice_build=function(b){var c,d,e,f=this;return this.is_multiple&&this.max_selected_options<=this.choices?(this.form_field_jq.trigger("liszt:maxselected",{chosen:this}),!1):(c=this.container_id+"_c_"+b.array_index,this.choices+=1,b.disabled?d='<li class="search-choice search-choice-disabled" id="'+c+'"><span>'+b.html+"</span></li>":d='<li class="search-choice" id="'+c+'"><span>'+b.html+'</span><a href="javascript:void(0)" class="search-choice-close" rel="'+b.array_index+'"></a></li>',this.search_container.before(d),e=a("#"+c).find("a").first(),e.click(function(a){return f.choice_destroy_link_click(a)}))},f.prototype.choice_destroy_link_click=function(b){return b.preventDefault(),this.is_disabled?b.stopPropagation:(this.pending_destroy_click=!0,this.choice_destroy(a(b.target)))},f.prototype.choice_destroy=function(a){if(this.result_deselect(a.attr("rel")))return this.choices-=1,this.show_search_field_default(),this.is_multiple&&this.choices>0&&this.search_field.val().length<1&&this.results_hide(),a.parents("li").first().remove(),this.search_field_scale()},f.prototype.results_reset=function(){this.form_field.options[0].selected=!0,this.selected_item.find("span").text(this.default_text),this.is_multiple||this.selected_item.addClass("chzn-default"),this.show_search_field_default(),this.results_reset_cleanup(),this.form_field_jq.trigger("change");if(this.active_field)return this.results_hide()},f.prototype.results_reset_cleanup=function(){return this.current_value=this.form_field_jq.val(),this.selected_item.find("abbr").remove()},f.prototype.result_select=function(a){var b,c,d,e;if(this.result_highlight)return b=this.result_highlight,c=b.attr("id"),this.result_clear_highlight(),this.is_multiple?this.result_deactivate(b):(this.search_results.find(".result-selected").removeClass("result-selected"),this.result_single_selected=b,this.selected_item.removeClass("chzn-default")),b.addClass("result-selected"),e=c.substr(c.lastIndexOf("_")+1),d=this.results_data[e],d.selected=!0,this.form_field.options[d.options_index].selected=!0,this.is_multiple?this.choice_build(d):(this.selected_item.find("span").first().text(d.text),this.allow_single_deselect&&this.single_deselect_control_build()),(!a.metaKey&&!a.ctrlKey||!this.is_multiple)&&this.results_hide(),this.search_field.val(""),(this.is_multiple||this.form_field_jq.val()!==this.current_value)&&this.form_field_jq.trigger("change",{selected:this.form_field.options[d.options_index].value}),this.current_value=this.form_field_jq.val(),this.search_field_scale()},f.prototype.result_activate=function(a){return a.addClass("active-result")},f.prototype.result_deactivate=function(a){return a.removeClass("active-result")},f.prototype.result_deselect=function(b){var c,d;return d=this.results_data[b],this.form_field.options[d.options_index].disabled?!1:(d.selected=!1,this.form_field.options[d.options_index].selected=!1,c=a("#"+this.container_id+"_o_"+b),c.removeClass("result-selected").addClass("active-result").show(),this.result_clear_highlight(),this.winnow_results(),this.form_field_jq.trigger("change",{deselected:this.form_field.options[d.options_index].value}),this.search_field_scale(),!0)},f.prototype.single_deselect_control_build=function(){if(this.allow_single_deselect&&this.selected_item.find("abbr").length<1)return this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>')},f.prototype.winnow_results=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;this.no_results_clear(),j=0,k=this.search_field.val()===this.default_text?"":a("<div/>").text(a.trim(this.search_field.val())).html(),g=this.search_contains?"":"^",f=new RegExp(g+k.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),n=new RegExp(k.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),s=this.results_data;for(o=0,q=s.length;o<q;o++){c=s[o];if(!c.disabled&&!c.empty)if(c.group)a("#"+c.dom_id).css("display","none");else if(!this.is_multiple||!c.selected){b=!1,i=c.dom_id,h=a("#"+i);if(f.test(c.html))b=!0,j+=1;else if(this.enable_split_word_search&&(c.html.indexOf(" ")>=0||c.html.indexOf("[")===0)){e=c.html.replace(/\[|\]/g,"").split(" ");if(e.length)for(p=0,r=e.length;p<r;p++)d=e[p],f.test(d)&&(b=!0,j+=1)}b?(k.length?(l=c.html.search(n),m=c.html.substr(0,l+k.length)+"</em>"+c.html.substr(l+k.length),m=m.substr(0,l)+"<em>"+m.substr(l)):m=c.html,h.html(m),this.result_activate(h),c.group_array_index!=null&&a("#"+this.results_data[c.group_array_index].dom_id).css("display","list-item")):(this.result_highlight&&i===this.result_highlight.attr("id")&&this.result_clear_highlight(),this.result_deactivate(h))}}return j<1&&k.length?this.no_results(k):this.winnow_results_set_highlight()},f.prototype.winnow_results_clear=function(){var b,c,d,e,f;this.search_field.val(""),c=this.search_results.find("li"),f=[];for(d=0,e=c.length;d<e;d++)b=c[d],b=a(b),b.hasClass("group-result")?f.push(b.css("display","auto")):!this.is_multiple||!b.hasClass("result-selected")?f.push(this.result_activate(b)):f.push(void 0);return f},f.prototype.winnow_results_set_highlight=function(){var a,b;if(!this.result_highlight){b=this.is_multiple?[]:this.search_results.find(".result-selected.active-result"),a=b.length?b.first():this.search_results.find(".active-result").first();if(a!=null)return this.result_do_highlight(a)}},f.prototype.no_results=function(b){var c;return c=a('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>'),c.find("span").first().html(b),this.search_results.append(c)},f.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},f.prototype.keydown_arrow=function(){var b,c;this.result_highlight?this.results_showing&&(c=this.result_highlight.nextAll("li.active-result").first(),c&&this.result_do_highlight(c)):(b=this.search_results.find("li.active-result").first(),b&&this.result_do_highlight(a(b)));if(!this.results_showing)return this.results_show()},f.prototype.keyup_arrow=function(){var a;if(!this.results_showing&&!this.is_multiple)return this.results_show();if(this.result_highlight)return a=this.result_highlight.prevAll("li.active-result"),a.length?this.result_do_highlight(a.first()):(this.choices>0&&this.results_hide(),this.result_clear_highlight())},f.prototype.keydown_backstroke=function(){var a;if(this.pending_backstroke)return this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke();a=this.search_container.siblings("li.search-choice").last();if(a.length&&!a.hasClass("search-choice-disabled"))return this.pending_backstroke=a,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus")},f.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},f.prototype.keydown_checker=function(a){var b,c;b=(c=a.which)!=null?c:a.keyCode,this.search_field_scale(),b!==8&&this.pending_backstroke&&this.clear_backstroke();switch(b){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(a),this.mouse_on_container=!1;break;case 13:a.preventDefault();break;case 38:a.preventDefault(),this.keyup_arrow();break;case 40:this.keydown_arrow()}},f.prototype.search_field_scale=function(){var b,c,d,e,f,g,h,i,j;if(this.is_multiple){d=0,h=0,f="position:absolute; left: -1000px; top: -1000px; display:none;",g=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"];for(i=0,j=g.length;i<j;i++)e=g[i],f+=e+":"+this.search_field.css(e)+";";return c=a("<div />",{style:f}),c.text(this.search_field.val()),a("body").append(c),h=c.width()+25,c.remove(),h>this.f_width-10&&(h=this.f_width-10),this.search_field.css({width:h+"px"}),b=this.container.height(),this.dropdown.css({top:b+"px"})}},f.prototype.generate_random_id=function(){var b;b="sel"+this.generate_random_char()+this.generate_random_char()+this.generate_random_char();while(a("#"+b).length>0)b+=this.generate_random_char();return b},f}(AbstractChosen),d.Chosen=b,c=function(a){var b;return b=a.outerWidth()-a.width()},d.get_side_border_padding=c}.call(this)
;var Janrain=Janrain||{};Janrain.Integration=Janrain.Integration||{},function(a){"use strict",function(){function d(a){janrain.capture.ui.modal.close()}function e(b){a(".login_navigation").toggle(),window.SITE.user.login(b.userName),b.needsOnBoarding?window.location="/"+window.SITE_LOCALE+"/onboarding":window.location.reload()}function f(a){var b={janRainAccessToken:a.accessToken,janRainId:a.userData.uuid,username:a.userData.username};return b}function g(){var b=["capture_forgotUsername_userName2","capture_createAccount_userName2","userName","userName2"],c,d,e;for(c=0;c<b.length;c+=1){d=b[c],e=a("input[name="+d+"]");if(e&&e.val()&&e.attr("placeholder")!==e.val())return e.val()}return""}function h(){var b=a('<a href="#" id="janrain-modal-close" class="popup-close sfx-paper">Close</a>');a("#janrainModal").append(b),a("#janrainModal > img").hide(),b.on("click",function(b){b.preventDefault(),a("#janrainModal").find("#printRegistration, #completeRegistration").length>0?window.location.reload():janrain.capture.ui.modal.closeConfirm()})}function i(c,e){console.log("submitting profile"),console.log(c),UTAG_DATA_DEFAULTS.registration_id=c.janRainId,c.username=g(),a.post(b+"/auth",{userName:c.username,password:c.janRainId}),a.ajax({url:b+"/account/login",type:"POST",data:JSON.stringify(c),dataType:"json",contentType:"application/json; charset=utf-8",error:d,success:e,async:!0})}function j(){a(document).on("click",".capture_mattel_getStarted a",function(a){a.preventDefault(),window.location="/"+window.SITE_LOCALE+"/onboarding"})}var b="/api",c=this;this.resetUserNameSelects=function(){c.cachedUserName!==undefined&&a("#userNameLists select").each(function(b){c.cachedUserName[b%3]!==undefined&&a(this).val(c.cachedUserName[b%3])})},this.setupCreateAccount=function(){a(document).on("change","#userNameLists select",c.setUsernameFromSelects),janrain.events.onCaptureScreenShow.addHandler(function(){setTimeout(function(){var b="";for(var c=1;c<1e4;c++)b+='<option value ="'+c+'">'+c+"</option>";a("#janrainModal").find("select[name=UserNumberList]").append(b)},1e3)})},this.setUsernameFromSelects=function(b){if(b===undefined)return;var d=a(b.target).parent().children(),e=_.map(d,function(b){return a(b).val()});c.cachedUserName=e,a("#capture_createAccount_userName2, #capture_forgotUsername_userName2").val(e.join(""))},this.onLogin=function(a){var b=f(a);b.isNewRegistration=!1,i(b,e),window.MAT.analytics.trackAccountAction("Login Submit",b.janRainId)},this.onLogout=function(){return localStorage.clear(),a.post("/user/profile",function(){location.reload()}),!1},this.onRegister=function(a){var b=f(a);b.isNewRegistration=!0,i(b),window.MAT.analytics.trackAccountAction("Registration Submit",b.janRainId)},this.onForgotPassword=function(){window.MAT.analytics.trackAccountAction("forgotPassword")},this.onFormDisplay=function(b){a("input[name=userName]").focus()},this.onModalReady=function(){h(),c.setupCreateAccount(),j()},this.onValidationComplete=function(a){c.setUsernameFromSelects(),console.log(arguments),a&&_.delay(c.resetUserNameSelects,2e3)},this.onRegistrationFailed=function(){console.log(arguments)},this.shouldFixUniqueTip=!1,this.onCaptureServerValidationFailed=function(a){var b=Janrain.Integration,c="";_.isArray(a.errors)&&a.validation&&a.validation.messages&&_.isArray(a.alternatives)&&a.errors[0]===a.validation.messages.unique&&(c=a.validation.messages.unique+" "+'<ul class="capture_suggestions">',_.each(a.alternatives,function(a){c+='<li><a href="#" class="capture_suggestion">'+a+"</a></li>"}),c+="</ul>",b.uniqueMessageFix={message:c,id:"#capture_createAccount_form_item_"+a.name},b.shouldFixUniqueTip=!0)},this.onCaptureRenderComplete=function(){var b=Janrain.Integration;b.shouldFixUniqueTip===!0&&b.uniqueMessageFix!==undefined&&(a(b.uniqueMessageFix.id).find(".capture_tip_error").html(b.uniqueMessageFix.message),b.shouldFixUniqueTip=!1)}}.apply(Janrain.Integration)}(jQuery)
;(function(a){typeof define=="function"&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){var b=[],c=a(document),d=navigator.userAgent.toLowerCase(),e=a(window),f=[],g={ieQuirks:null,msie:/msie/.test(d)&&!/opera/.test(d),opera:/opera/.test(d)};g.ie6=g.msie&&/msie 6./.test(d)&&typeof window.XMLHttpRequest!="object",g.ie7=g.msie&&/msie 7.0/.test(d),a.modal=function(b,c){return a.modal.impl.init(b,c)},a.modal.close=function(){a.modal.impl.close()},a.modal.focus=function(b){a.modal.impl.focus(b)},a.modal.setContainerDimensions=function(){a.modal.impl.setContainerDimensions()},a.modal.setPosition=function(){a.modal.impl.setPosition()},a.modal.update=function(b,c){a.modal.impl.update(b,c)},a.fn.modal=function(b){return a.modal.impl.init(this,b)},a.modal.defaults={appendTo:"body",focus:!0,opacity:50,overlayId:"simplemodal-overlay",overlayCss:{},containerId:"simplemodal-container",containerCss:{},dataId:"simplemodal-data",dataCss:{},minHeight:null,minWidth:null,maxHeight:null,maxWidth:null,autoResize:!1,autoPosition:!0,zIndex:1e3,close:!0,closeHTML:'<a class="modalCloseImg" title="Close"></a>',closeClass:"simplemodal-close",escClose:!0,overlayClose:!1,fixed:!0,position:null,persist:!1,modal:!0,onOpen:null,onShow:null,onClose:null},a.modal.impl={d:{},init:function(b,c){var d=this;if(d.d.data)return!1;g.ieQuirks=g.msie&&!a.support.boxModel,d.o=a.extend({},a.modal.defaults,c),d.zIndex=d.o.zIndex,d.occb=!1;if(typeof b=="object")b=b instanceof a?b:a(b),d.d.placeholder=!1,b.parent().parent().size()>0&&(b.before(a("<span></span>").attr("id","simplemodal-placeholder").css({display:"none"})),d.d.placeholder=!0,d.display=b.css("display"),d.o.persist||(d.d.orig=b.clone(!0)));else if(typeof b=="string"||typeof b=="number")b=a("<div></div>").html(b);else return alert("SimpleModal Error: Unsupported data type: "+typeof b),d;return d.create(b),b=null,d.open(),a.isFunction(d.o.onShow)&&d.o.onShow.apply(d,[d.d]),d},create:function(c){var d=this;d.getDimensions(),d.o.modal&&g.ie6&&(d.d.iframe=a('<iframe src="javascript:false;"></iframe>').css(a.extend(d.o.iframeCss,{display:"none",opacity:0,position:"fixed",height:f[0],width:f[1],zIndex:d.o.zIndex,top:0,left:0})).appendTo(d.o.appendTo)),d.d.overlay=a("<div></div>").attr("id",d.o.overlayId).addClass("simplemodal-overlay").css(a.extend(d.o.overlayCss,{display:"none",opacity:d.o.opacity/100,height:d.o.modal?b[0]:0,width:d.o.modal?b[1]:0,position:"fixed",left:0,top:0,zIndex:d.o.zIndex+1})).appendTo(d.o.appendTo),d.d.container=a("<div></div>").attr("id",d.o.containerId).addClass("simplemodal-container").css(a.extend({position:d.o.fixed?"fixed":"absolute"},d.o.containerCss,{display:"none",zIndex:d.o.zIndex+2})).append(d.o.close&&d.o.closeHTML?a(d.o.closeHTML).addClass(d.o.closeClass):"").appendTo(d.o.appendTo),d.d.wrap=a("<div></div>").attr("tabIndex",-1).addClass("simplemodal-wrap").css({height:"100%",outline:0,width:"100%"}).appendTo(d.d.container),d.d.data=c.attr("id",c.attr("id")||d.o.dataId).addClass("simplemodal-data").css(a.extend(d.o.dataCss,{display:"none"})).appendTo("body"),c=null,d.setContainerDimensions(),d.d.data.appendTo(d.d.wrap),(g.ie6||g.ieQuirks)&&d.fixIE()},bindEvents:function(){var d=this;a("."+d.o.closeClass).bind("click.simplemodal",function(a){a.preventDefault(),d.close()}),d.o.modal&&d.o.close&&d.o.overlayClose&&d.d.overlay.bind("click.simplemodal",function(a){a.preventDefault(),d.close()}),c.bind("keydown.simplemodal",function(a){d.o.modal&&a.keyCode===9?d.watchTab(a):d.o.close&&d.o.escClose&&a.keyCode===27&&(a.preventDefault(),d.close())}),e.bind("resize.simplemodal orientationchange.simplemodal",function(){d.getDimensions(),d.o.autoResize?d.setContainerDimensions():d.o.autoPosition&&d.setPosition(),g.ie6||g.ieQuirks?d.fixIE():d.o.modal&&(d.d.iframe&&d.d.iframe.css({height:f[0],width:f[1]}),d.d.overlay.css({height:b[0],width:b[1]}))})},unbindEvents:function(){a("."+this.o.closeClass).unbind("click.simplemodal"),c.unbind("keydown.simplemodal"),e.unbind(".simplemodal"),this.d.overlay.unbind("click.simplemodal")},fixIE:function(){var b=this,c=b.o.position;a.each([b.d.iframe||null,b.o.modal?b.d.overlay:null,b.d.container.css("position")==="fixed"?b.d.container:null],function(a,b){if(b){var d="document.body.clientHeight",e="document.body.clientWidth",f="document.body.scrollHeight",g="document.body.scrollLeft",h="document.body.scrollTop",i="document.body.scrollWidth",j="document.documentElement.clientHeight",k="document.documentElement.clientWidth",l="document.documentElement.scrollLeft",m="document.documentElement.scrollTop",n=b[0].style;n.position="absolute";if(a<2)n.removeExpression("height"),n.removeExpression("width"),n.setExpression("height",""+f+" > "+d+" ? "+f+" : "+d+' + "px"'),n.setExpression("width",""+i+" > "+e+" ? "+i+" : "+e+' + "px"');else{var o,q;if(c&&c.constructor===Array){var r=c[0]?typeof c[0]=="number"?c[0].toString():c[0].replace(/px/,""):b.css("top").replace(/px/,"");o=r.indexOf("%")===-1?r+" + (t = "+m+" ? "+m+" : "+h+') + "px"':parseInt(r.replace(/%/,""))+" * (("+j+" || "+d+") / 100) + (t = "+m+" ? "+m+" : "+h+') + "px"';if(c[1]){var s=typeof c[1]=="number"?c[1].toString():c[1].replace(/px/,"");q=s.indexOf("%")===-1?s+" + (t = "+l+" ? "+l+" : "+g+') + "px"':parseInt(s.replace(/%/,""))+" * (("+k+" || "+e+") / 100) + (t = "+l+" ? "+l+" : "+g+') + "px"'}}else o="("+j+" || "+d+") / 2 - (this.offsetHeight / 2) + (t = "+m+" ? "+m+" : "+h+') + "px"',q="("+k+" || "+e+") / 2 - (this.offsetWidth / 2) + (t = "+l+" ? "+l+" : "+g+') + "px"';n.removeExpression("top"),n.removeExpression("left"),n.setExpression("top",o),n.setExpression("left",q)}}})},focus:function(b){var c=this,d=b&&a.inArray(b,["first","last"])!==-1?b:"first",e=a(":input:enabled:visible:"+d,c.d.wrap);setTimeout(function(){e.length>0?e.focus():c.d.wrap.focus()},10)},getDimensions:function(){var a=this,d=typeof window.innerHeight=="undefined"?e.height():window.innerHeight;b=[c.height(),c.width()],f=[d,e.width()]},getVal:function(a,b){return a?typeof a=="number"?a:a==="auto"?0:a.indexOf("%")>0?parseInt(a.replace(/%/,""))/100*(b==="h"?f[0]:f[1]):parseInt(a.replace(/px/,"")):null},update:function(a,b){var c=this;if(!c.d.data)return!1;c.d.origHeight=c.getVal(a,"h"),c.d.origWidth=c.getVal(b,"w"),c.d.data.hide(),a&&c.d.container.css("height",a),b&&c.d.container.css("width",b),c.setContainerDimensions(),c.d.data.show(),c.o.focus&&c.focus(),c.unbindEvents(),c.bindEvents()},setContainerDimensions:function(){var a=this,b=g.ie6||g.ie7,c=a.d.origHeight?a.d.origHeight:g.opera?a.d.container.height():a.getVal(b?a.d.container[0].currentStyle.height:a.d.container.css("height"),"h"),d=a.d.origWidth?a.d.origWidth:g.opera?a.d.container.width():a.getVal(b?a.d.container[0].currentStyle.width:a.d.container.css("width"),"w"),e=a.d.data.outerHeight(!0),h=a.d.data.outerWidth(!0);a.d.origHeight=a.d.origHeight||c,a.d.origWidth=a.d.origWidth||d;var i=a.o.maxHeight?a.getVal(a.o.maxHeight,"h"):null,j=a.o.maxWidth?a.getVal(a.o.maxWidth,"w"):null,k=i&&i<f[0]?i:f[0],l=j&&j<f[1]?j:f[1],m=a.o.minHeight?a.getVal(a.o.minHeight,"h"):"auto";c?c=a.o.autoResize&&c>k?k:c<m?m:c:e?e>k?c=k:a.o.minHeight&&m!=="auto"&&e<m?c=m:c=e:c=m;var n=a.o.minWidth?a.getVal(a.o.minWidth,"w"):"auto";d?d=a.o.autoResize&&d>l?l:d<n?n:d:h?h>l?d=l:a.o.minWidth&&n!=="auto"&&h<n?d=n:d=h:d=n,a.d.container.css({height:c,width:d}),a.d.wrap.css({overflow:e>c||h>d?"auto":"visible"}),a.o.autoPosition&&a.setPosition()},setPosition:function(){var a=this,b,c,d=f[0]/2-a.d.container.outerHeight(!0)/2,g=f[1]/2-a.d.container.outerWidth(!0)/2,h=a.d.container.css("position")!=="fixed"?e.scrollTop():0;a.o.position&&Object.prototype.toString.call(a.o.position)==="[object Array]"?(b=h+(a.o.position[0]||d),c=a.o.position[1]||g):(b=h+d,c=g),a.d.container.css({left:c,top:b})},watchTab:function(b){var c=this;if(a(b.target).parents(".simplemodal-container").length>0){c.inputs=a(":input:enabled:visible:first, :input:enabled:visible:last",c.d.data[0]);if(!b.shiftKey&&b.target===c.inputs[c.inputs.length-1]||b.shiftKey&&b.target===c.inputs[0]||c.inputs.length===0){b.preventDefault();var d=b.shiftKey?"last":"first";c.focus(d)}}else b.preventDefault(),c.focus()},open:function(){var b=this;b.d.iframe&&b.d.iframe.show(),a.isFunction(b.o.onOpen)?b.o.onOpen.apply(b,[b.d]):(b.d.overlay.show(),b.d.container.show(),b.d.data.show()),b.o.focus&&b.focus(),b.bindEvents()},close:function(){var b=this;if(!b.d.data)return!1;b.unbindEvents();if(a.isFunction(b.o.onClose)&&!b.occb)b.occb=!0,b.o.onClose.apply(b,[b.d]);else{if(b.d.placeholder){var c=a("#simplemodal-placeholder");b.o.persist?c.replaceWith(b.d.data.removeClass("simplemodal-data").css("display",b.display)):(b.d.data.hide().remove(),c.replaceWith(b.d.orig))}else b.d.data.hide().remove();b.d.container.hide().remove(),b.d.overlay.hide(),b.d.iframe&&b.d.iframe.hide().remove(),b.d.overlay.remove(),b.d={}}}}})
;(function(){function g(){try{return d in b&&b[d]}catch(a){return!1}}var a={},b=window,c=b.document,d="localStorage",e="__storejs__",f;a.disabled=!1,a.set=function(a,b){},a.get=function(a){},a.remove=function(a){},a.clear=function(){},a.transact=function(b,c,d){var e=a.get(b);d==null&&(d=c,c=null),typeof e=="undefined"&&(e=c||{}),d(e),a.set(b,e)},a.getAll=function(){},a.serialize=function(a){return JSON.stringify(a)},a.deserialize=function(a){if(typeof a!="string")return undefined;try{return JSON.parse(a)}catch(b){return a||undefined}};if(g())f=b[d],a.set=function(b,c){return c===undefined?a.remove(b):(f.setItem(b,a.serialize(c)),c)},a.get=function(b){return a.deserialize(f.getItem(b))},a.remove=function(a){f.removeItem(a)},a.clear=function(){f.clear()},a.getAll=function(){var b={};for(var c=0;c<f.length;++c){var d=f.key(c);b[d]=a.get(d)}return b};else if(c.documentElement.addBehavior){var h,i;try{i=new ActiveXObject("htmlfile"),i.open(),i.write('<script>document.w=window</script><iframe src="/favicon.ico"></frame>'),i.close(),h=i.w.frames[0].document,f=h.createElement("div")}catch(j){f=c.createElement("div"),h=c.body}function k(b){return function(){var c=Array.prototype.slice.call(arguments,0);c.unshift(f),h.appendChild(f),f.addBehavior("#default#userData"),f.load(d);var e=b.apply(a,c);return h.removeChild(f),e}}var l=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function m(a){return a.replace(l,"___")}a.set=k(function(b,c,e){return c=m(c),e===undefined?a.remove(c):(b.setAttribute(c,a.serialize(e)),b.save(d),e)}),a.get=k(function(b,c){return c=m(c),a.deserialize(b.getAttribute(c))}),a.remove=k(function(a,b){b=m(b),a.removeAttribute(b),a.save(d)}),a.clear=k(function(a){var b=a.XMLDocument.documentElement.attributes;a.load(d);for(var c=0,e;e=b[c];c++)a.removeAttribute(e.name);a.save(d)}),a.getAll=k(function(b){var c=b.XMLDocument.documentElement.attributes;b.load(d);var e={};for(var f=0,g;g=c[f];++f)e[g]=a.get(g);return e})}try{a.set(e,e),a.get(e)!=e&&(a.disabled=!0),a.remove(e)}catch(j){a.disabled=!0}a.enabled=!a.disabled,typeof module!="undefined"&&typeof module!="function"?module.exports=a:typeof define=="function"&&define.amd?define(a):this.store=a})()
;(function(a){var b={init:function(b){var c={set_width:!1,set_height:!1,horizontalScroll:!1,scrollInertia:950,mouseWheel:!0,mouseWheelPixels:"auto",autoDraggerLength:!0,autoHideScrollbar:!1,scrollButtons:{enable:!1,scrollType:"continuous",scrollSpeed:"auto",scrollAmount:40},advanced:{updateOnBrowserResize:!0,updateOnContentResize:!0,autoExpandHorizontalScroll:!1,autoScrollOnFocus:!0,normalizeMouseWheelDelta:!1},contentTouchScroll:!0,callbacks:{onScrollStart:function(){},onScroll:function(){},onTotalScroll:function(){},onTotalScrollBack:function(){},onTotalScrollOffset:0,onTotalScrollBackOffset:0,whileScrolling:function(){}},theme:"light"},b=a.extend(!0,c,b);return this.each(function(){var c=a(this);b.set_width&&c.css("width",b.set_width),b.set_height&&c.css("height",b.set_height);if(!a(document).data("mCustomScrollbar-index"))a(document).data("mCustomScrollbar-index","1");else{var d=parseInt(a(document).data("mCustomScrollbar-index"));a(document).data("mCustomScrollbar-index",d+1)}c.wrapInner("<div class='mCustomScrollBox mCS-"+b.theme+"' id='mCSB_"+a(document).data("mCustomScrollbar-index")+"' style='position:relative; height:100%; overflow:hidden; max-width:100%;' />").addClass("mCustomScrollbar _mCS_"+a(document).data("mCustomScrollbar-index"));var e=c.children(".mCustomScrollBox");if(b.horizontalScroll){e.addClass("mCSB_horizontal").wrapInner("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />");var f=e.children(".mCSB_h_wrapper");f.wrapInner("<div class='mCSB_container' style='position:absolute; left:0;' />").children(".mCSB_container").css({width:f.children().outerWidth(),position:"relative"}).unwrap()}else e.wrapInner("<div class='mCSB_container' style='position:relative; top:0;' />");var g=e.children(".mCSB_container");a.support.touch&&g.addClass("mCS_touch"),g.after("<div class='mCSB_scrollTools' style='position: absolute; display: block;background: url(/Static/images/product_catalog/draggerRail.png) no-repeat;background-size: 6px 488px;'><div class='mCSB_draggerContainer'><div class='mCSB_dragger' style='position:absolute;' oncontextmenu='return false;'><div class='mCSB_dragger_bar'><div class='mCSB_dragger_bar_top'></div><div class='mCSB_dragger_bar_btm'></div></div></div></div></div>");var h=e.children(".mCSB_scrollTools"),i=h.children(".mCSB_draggerContainer"),j=i.children(".mCSB_dragger");b.horizontalScroll?j.data("minDraggerWidth",j.width()):j.data("minDraggerHeight",j.height()),b.scrollButtons.enable&&(b.horizontalScroll?h.prepend("<a class='mCSB_buttonLeft' oncontextmenu='return false;'></a>").append("<a class='mCSB_buttonRight' oncontextmenu='return false;'></a>"):h.prepend("<a class='mCSB_buttonUp' oncontextmenu='return false;'></a>").append("<a class='mCSB_buttonDown' oncontextmenu='return false;'></a>")),e.bind("scroll",function(){c.is(".mCS_disabled")||e.scrollTop(0).scrollLeft(0)}),c.data({mCS_Init:!0,mCustomScrollbarIndex:a(document).data("mCustomScrollbar-index"),horizontalScroll:b.horizontalScroll,scrollInertia:b.scrollInertia,scrollEasing:"mcsEaseOut",mouseWheel:b.mouseWheel,mouseWheelPixels:b.mouseWheelPixels,autoDraggerLength:b.autoDraggerLength,autoHideScrollbar:b.autoHideScrollbar,scrollButtons_enable:b.scrollButtons.enable,scrollButtons_scrollType:b.scrollButtons.scrollType,scrollButtons_scrollSpeed:b.scrollButtons.scrollSpeed,scrollButtons_scrollAmount:b.scrollButtons.scrollAmount,autoExpandHorizontalScroll:b.advanced.autoExpandHorizontalScroll,autoScrollOnFocus:b.advanced.autoScrollOnFocus,normalizeMouseWheelDelta:b.advanced.normalizeMouseWheelDelta,contentTouchScroll:b.contentTouchScroll,onScrollStart_Callback:b.callbacks.onScrollStart,onScroll_Callback:b.callbacks.onScroll,onTotalScroll_Callback:b.callbacks.onTotalScroll,onTotalScrollBack_Callback:b.callbacks.onTotalScrollBack,onTotalScroll_Offset:b.callbacks.onTotalScrollOffset,onTotalScrollBack_Offset:b.callbacks.onTotalScrollBackOffset,whileScrolling_Callback:b.callbacks.whileScrolling,bindEvent_scrollbar_drag:!1,bindEvent_content_touch:!1,bindEvent_scrollbar_click:!1,bindEvent_mousewheel:!1,bindEvent_buttonsContinuous_y:!1,bindEvent_buttonsContinuous_x:!1,bindEvent_buttonsPixels_y:!1,bindEvent_buttonsPixels_x:!1,bindEvent_focusin:!1,bindEvent_autoHideScrollbar:!1,mCSB_buttonScrollRight:!1,mCSB_buttonScrollLeft:!1,mCSB_buttonScrollDown:!1,mCSB_buttonScrollUp:!1});if(b.horizontalScroll)c.css("max-width")!=="none"&&(b.advanced.updateOnContentResize||(b.advanced.updateOnContentResize=!0));else if(c.css("max-height")!=="none"){var k=!1,l=parseInt(c.css("max-height"));c.css("max-height").indexOf("%")>=0&&(k=l,l=c.parent().height()*k/100),c.css("overflow","hidden"),e.css("max-height",l)}c.mCustomScrollbar("update");if(b.advanced.updateOnBrowserResize){var m,n=a(window).width(),o=a(window).height();a(window).bind("resize."+c.data("mCustomScrollbarIndex"),function(){m&&clearTimeout(m),m=setTimeout(function(){if(!c.is(".mCS_disabled")&&!c.is(".mCS_destroyed")){var b=a(window).width(),d=a(window).height();if(n!==b||o!==d)c.css("max-height")!=="none"&&k&&e.css("max-height",c.parent().height()*k/100),c.mCustomScrollbar("update"),n=b,o=d}},150)})}if(b.advanced.updateOnContentResize){var p;if(b.horizontalScroll)var q=g.outerWidth();else var q=g.outerHeight();p=setInterval(function(){if(b.horizontalScroll){b.advanced.autoExpandHorizontalScroll&&g.css({position:"absolute",width:"auto"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:g.outerWidth(),position:"relative"}).unwrap();var a=g.outerWidth()}else var a=g.outerHeight();a!=q&&(c.mCustomScrollbar("update"),q=a)},300)}})},update:function(){var b=a(this),c=b.children(".mCustomScrollBox"),d=c.children(".mCSB_container");d.removeClass("mCS_no_scrollbar"),b.removeClass("mCS_disabled mCS_destroyed"),c.scrollTop(0).scrollLeft(0);var e=c.children(".mCSB_scrollTools"),f=e.children(".mCSB_draggerContainer"),g=f.children(".mCSB_dragger");if(b.data("horizontalScroll")){var h=e.children(".mCSB_buttonLeft"),i=e.children(".mCSB_buttonRight"),j=c.width();b.data("autoExpandHorizontalScroll")&&d.css({position:"absolute",width:"auto"}).wrap("<div class='mCSB_h_wrapper' style='position:relative; left:0; width:999999px;' />").css({width:d.outerWidth(),position:"relative"}).unwrap();var k=d.outerWidth()}else var l=e.children(".mCSB_buttonUp"),m=e.children(".mCSB_buttonDown"),n=c.height(),o=d.outerHeight();if(o>n&&!b.data("horizontalScroll")){e.css("display","block");var p=f.height();if(b.data("autoDraggerLength")){var q=Math.round(n/o*p),r=g.data("minDraggerHeight");if(q<=r)g.css({height:r});else if(q>=p-10){var s=p-10;g.css({height:s})}else g.css({height:q});g.children(".mCSB_dragger_bar").css({"line-height":g.height()+"px"})}var t=g.height(),u=(o-n)/(p-t);b.data("scrollAmount",u).mCustomScrollbar("scrolling",c,d,f,g,l,m,h,i);var v=Math.abs(d.position().top);b.mCustomScrollbar("scrollTo",v,{scrollInertia:0,trigger:"internal"})}else if(k>j&&b.data("horizontalScroll")){e.css("display","block");var w=f.width();if(b.data("autoDraggerLength")){var x=Math.round(j/k*w),y=g.data("minDraggerWidth");if(x<=y)g.css({width:y});else if(x>=w-10){var z=w-10;g.css({width:z})}else g.css({width:x})}var A=g.width(),u=(k-j)/(w-A);b.data("scrollAmount",u).mCustomScrollbar("scrolling",c,d,f,g,l,m,h,i);var v=Math.abs(d.position().left);b.mCustomScrollbar("scrollTo",v,{scrollInertia:0,trigger:"internal"})}else c.unbind("mousewheel focusin"),b.data("horizontalScroll")?g.add(d).css("left",0):g.add(d).css("top",0),e.css("display","none"),d.addClass("mCS_no_scrollbar"),b.data({bindEvent_mousewheel:!1,bindEvent_focusin:!1})},scrolling:function(b,d,e,f,g,h,i,j){function n(a,b,c,d){k.data("horizontalScroll")?k.mCustomScrollbar("scrollTo",f.position().left-b+d,{moveDragger:!0,trigger:"internal"}):k.mCustomScrollbar("scrollTo",f.position().top-a+c,{moveDragger:!0,trigger:"internal"})}var k=a(this);if(!k.data("bindEvent_scrollbar_drag")){var l,m;a.support.msPointer?(f.bind("MSPointerDown",function(b){b.preventDefault(),k.data({on_drag:!0}),f.addClass("mCSB_dragger_onDrag");var c=a(this),d=c.offset(),e=b.originalEvent.pageX-d.left,g=b.originalEvent.pageY-d.top;e<c.width()&&e>0&&g<c.height()&&g>0&&(l=g,m=e)}),a(document).bind("MSPointerMove."+k.data("mCustomScrollbarIndex"),function(a){a.preventDefault();if(k.data("on_drag")){var b=f,c=b.offset(),d=a.originalEvent.pageX-c.left,e=a.originalEvent.pageY-c.top;n(l,m,e,d)}}).bind("MSPointerUp."+k.data("mCustomScrollbarIndex"),function(a){k.data({on_drag:!1}),f.removeClass("mCSB_dragger_onDrag")})):(f.bind("mousedown touchstart",function(b){b.preventDefault(),b.stopImmediatePropagation();var c=a(this),d=c.offset(),e,g;if(b.type==="touchstart"){var h=b.originalEvent.touches[0]||b.originalEvent.changedTouches[0];e=h.pageX-d.left,g=h.pageY-d.top}else k.data({on_drag:!0}),f.addClass("mCSB_dragger_onDrag"),e=b.pageX-d.left,g=b.pageY-d.top;e<c.width()&&e>0&&g<c.height()&&g>0&&(l=g,m=e)}).bind("touchmove",function(b){b.preventDefault(),b.stopImmediatePropagation();var c=b.originalEvent.touches[0]||b.originalEvent.changedTouches[0],d=a(this),e=d.offset(),f=c.pageX-e.left,g=c.pageY-e.top;n(l,m,g,f)}),a(document).bind("mousemove."+k.data("mCustomScrollbarIndex"),function(a){if(k.data("on_drag")){var b=f,c=b.offset(),d=a.pageX-c.left,e=a.pageY-c.top;n(l,m,e,d)}}).bind("mouseup."+k.data("mCustomScrollbarIndex"),function(a){k.data({on_drag:!1}),f.removeClass("mCSB_dragger_onDrag")})),k.data({bindEvent_scrollbar_drag:!0})}if(a.support.touch&&k.data("contentTouchScroll")&&!k.data("bindEvent_content_touch")){var o,p,q,r,s,t,u;d.bind("touchstart",function(b){b.stopImmediatePropagation(),o=b.originalEvent.touches[0]||b.originalEvent.changedTouches[0],p=a(this),q=p.offset(),s=o.pageX-q.left,r=o.pageY-q.top,t=r,u=s}),d.bind("touchmove",function(b){b.preventDefault(),b.stopImmediatePropagation(),o=b.originalEvent.touches[0]||b.originalEvent.changedTouches[0],p=a(this).parent(),q=p.offset(),s=o.pageX-q.left,r=o.pageY-q.top,k.data("horizontalScroll")?k.mCustomScrollbar("scrollTo",u-s,{trigger:"internal"}):k.mCustomScrollbar("scrollTo",t-r,{trigger:"internal"})})}k.data("bindEvent_scrollbar_click")||(e.bind("click",function(b){var c=(b.pageY-e.offset().top)*k.data("scrollAmount"),d=a(b.target);k.data("horizontalScroll")&&(c=(b.pageX-e.offset().left)*k.data("scrollAmount")),(d.hasClass("mCSB_draggerContainer")||d.hasClass("mCSB_draggerRail"))&&k.mCustomScrollbar("scrollTo",c,{trigger:"internal",scrollEasing:"draggerRailEase"})}),k.data({bindEvent_scrollbar_click:!0})),k.data("mouseWheel")&&(k.data("bindEvent_mousewheel")||(b.bind("mousewheel",function(a,b){var c,g=k.data("mouseWheelPixels"),h=Math.abs(d.position().top),i=f.position().top,j=e.height()-f.height();k.data("normalizeMouseWheelDelta")&&(b<0?b=-1:b=1),g==="auto"&&(g=100+Math.round(k.data("scrollAmount")/2)),k.data("horizontalScroll")&&(i=f.position().left,j=e.width()-f.width(),h=Math.abs(d.position().left));if(b>0&&i!==0||b<0&&i!==j)a.preventDefault(),a.stopImmediatePropagation();c=h-b*g,k.mCustomScrollbar("scrollTo",c,{trigger:"internal"})}),k.data({bindEvent_mousewheel:!0})));if(k.data("scrollButtons_enable"))if(k.data("scrollButtons_scrollType")==="pixels"){k.data("horizontalScroll")?(j.add(i).unbind("mousedown touchstart MSPointerDown mouseup MSPointerUp mouseout MSPointerOut touchend",w,x),k.data({bindEvent_buttonsContinuous_x:!1}),k.data("bindEvent_buttonsPixels_x")||(j.bind("click",function(a){a.preventDefault(),v(Math.abs(d.position().left)+k.data("scrollButtons_scrollAmount"))}),i.bind("click",function(a){a.preventDefault(),v(Math.abs(d.position().left)-k.data("scrollButtons_scrollAmount"))}),k.data({bindEvent_buttonsPixels_x:!0}))):(h.add(g).unbind("mousedown touchstart MSPointerDown mouseup MSPointerUp mouseout MSPointerOut touchend",w,x),k.data({bindEvent_buttonsContinuous_y:!1}),k.data("bindEvent_buttonsPixels_y")||(h.bind("click",function(a){a.preventDefault(),v(Math.abs(d.position().top)+k.data("scrollButtons_scrollAmount"))}),g.bind("click",function(a){a.preventDefault(),v(Math.abs(d.position().top)-k.data("scrollButtons_scrollAmount"))}),k.data({bindEvent_buttonsPixels_y:!0})));function v(a){f.data("preventAction")||(f.data("preventAction",!0),k.mCustomScrollbar("scrollTo",a,{trigger:"internal"}))}}else{if(k.data("horizontalScroll")){j.add(i).unbind("click"),k.data({bindEvent_buttonsPixels_x:!1});if(!k.data("bindEvent_buttonsContinuous_x")){j.bind("mousedown touchstart MSPointerDown",function(a){a.preventDefault();var b=A();k.data({mCSB_buttonScrollRight:setInterval(function(){k.mCustomScrollbar("scrollTo",Math.abs(d.position().left)+b,{trigger:"internal",scrollEasing:"easeOutCirc"})},17)})});var w=function(a){a.preventDefault(),clearInterval(k.data("mCSB_buttonScrollRight"))};j.bind("mouseup touchend MSPointerUp mouseout MSPointerOut",w),i.bind("mousedown touchstart MSPointerDown",function(a){a.preventDefault();var b=A();k.data({mCSB_buttonScrollLeft:setInterval(function(){k.mCustomScrollbar("scrollTo",Math.abs(d.position().left)-b,{trigger:"internal",scrollEasing:"easeOutCirc"})},17)})});var x=function(a){a.preventDefault(),clearInterval(k.data("mCSB_buttonScrollLeft"))};i.bind("mouseup touchend MSPointerUp mouseout MSPointerOut",x),k.data({bindEvent_buttonsContinuous_x:!0})}}else{h.add(g).unbind("click"),k.data({bindEvent_buttonsPixels_y:!1});if(!k.data("bindEvent_buttonsContinuous_y")){h.bind("mousedown touchstart MSPointerDown",function(a){a.preventDefault();var b=A();k.data({mCSB_buttonScrollDown:setInterval(function(){k.mCustomScrollbar("scrollTo",Math.abs(d.position().top)+b,{trigger:"internal",scrollEasing:"easeOutCirc"})},17)})});var y=function(a){a.preventDefault(),clearInterval(k.data("mCSB_buttonScrollDown"))};h.bind("mouseup touchend MSPointerUp mouseout MSPointerOut",y),g.bind("mousedown touchstart MSPointerDown",function(a){a.preventDefault();var b=A();k.data({mCSB_buttonScrollUp:setInterval(function(){k.mCustomScrollbar("scrollTo",Math.abs(d.position().top)-b,{trigger:"internal",scrollEasing:"easeOutCirc"})},17)})});var z=function(a){a.preventDefault(),clearInterval(k.data("mCSB_buttonScrollUp"))};g.bind("mouseup touchend MSPointerUp mouseout MSPointerOut",z),k.data({bindEvent_buttonsContinuous_y:!0})}}function A(){var a=k.data("scrollButtons_scrollSpeed");return k.data("scrollButtons_scrollSpeed")==="auto"&&(a=Math.round((k.data("scrollInertia")+100)/40)),a}}k.data("autoScrollOnFocus")&&(k.data("bindEvent_focusin")||(b.bind("focusin",function(){b.scrollTop(0).scrollLeft(0);var c=a(document.activeElement);if(c.is("input,textarea,select,button,a[tabindex],area,object")){var e=d.position().top,f=c.position().top,g=b.height()-c.outerHeight();k.data("horizontalScroll")&&(e=d.position().left,f=c.position().left,g=b.width()-c.outerWidth()),(e+f<0||e+f>g)&&k.mCustomScrollbar("scrollTo",f,{trigger:"internal"})}}),k.data({bindEvent_focusin:!0}))),k.data("autoHideScrollbar")&&(k.data("bindEvent_autoHideScrollbar")||(b.bind("mouseenter",function(a){b.addClass("mCS-mouse-over"),c.showScrollbar.call(b.children(".mCSB_scrollTools"))}).bind("mouseleave touchend",function(a){b.removeClass("mCS-mouse-over"),a.type==="mouseleave"&&c.hideScrollbar.call(b.children(".mCSB_scrollTools"))}),k.data({bindEvent_autoHideScrollbar:!0})))},scrollTo:function(b,d){function s(a){this.mcs={top:i.position().top,left:i.position().left,draggerTop:l.position().top,draggerLeft:l.position().left,topPct:Math.round(100*Math.abs(i.position().top)/Math.abs(i.outerHeight()-h.height())),leftPct:Math.round(100*Math.abs(i.position().left)/Math.abs(i.outerWidth()-h.width()))};switch(a){case"onScrollStart":e.data("mCS_tweenRunning",!0).data("onScrollStart_Callback").call(e,this.mcs);break;case"whileScrolling":e.data("whileScrolling_Callback").call(e,this.mcs);break;case"onScroll":e.data("onScroll_Callback").call(e,this.mcs);break;case"onTotalScrollBack":e.data("onTotalScrollBack_Callback").call(e,this.mcs);break;case"onTotalScroll":e.data("onTotalScroll_Callback").call(e,this.mcs)}}var e=a(this),f={moveDragger:!1,trigger:"external",callbacks:!0,scrollInertia:e.data("scrollInertia"),scrollEasing:e.data("scrollEasing")},d=a.extend(f,d),g,h=e.children(".mCustomScrollBox"),i=h.children(".mCSB_container"),j=h.children(".mCSB_scrollTools"),k=j.children(".mCSB_draggerContainer"),l=k.children(".mCSB_dragger"),m=draggerSpeed=d.scrollInertia,n,o,p,q;if(!i.hasClass("mCS_no_scrollbar")){e.data({mCS_trigger:d.trigger}),e.data("mCS_Init")&&(d.callbacks=!1);if(b||b===0){if(typeof b=="number")d.moveDragger?(g=b,e.data("horizontalScroll")?b=l.position().left*e.data("scrollAmount"):b=l.position().top*e.data("scrollAmount"),draggerSpeed=0):g=b/e.data("scrollAmount");else if(typeof b=="string"){var r;b==="top"?r=0:b==="bottom"&&!e.data("horizontalScroll")?r=i.outerHeight()-h.height():b==="left"?r=0:b==="right"&&e.data("horizontalScroll")?r=i.outerWidth()-h.width():b==="first"?r=e.find(".mCSB_container").find(":first"):b==="last"?r=e.find(".mCSB_container").find(":last"):r=e.find(b),r.length===1?(e.data("horizontalScroll")?b=r.position().left:b=r.position().top,g=b/e.data("scrollAmount")):g=b=r}e.data("horizontalScroll")?(e.data("onTotalScrollBack_Offset")&&(o=-e.data("onTotalScrollBack_Offset")),e.data("onTotalScroll_Offset")&&(q=h.width()-i.outerWidth()+e.data("onTotalScroll_Offset")),g<0?(g=b=0,clearInterval(e.data("mCSB_buttonScrollLeft")),o||(n=!0)):g>=k.width()-l.width()?(g=k.width()-l.width(),b=h.width()-i.outerWidth(),clearInterval(e.data("mCSB_buttonScrollRight")),q||(p=!0)):b=-b,c.mTweenAxis.call(this,l[0],"left",Math.round(g),draggerSpeed,d.scrollEasing),c.mTweenAxis.call(this,i[0],"left",Math.round(b),m,d.scrollEasing,{onStart:function(){d.callbacks&&!e.data("mCS_tweenRunning")&&s("onScrollStart"),e.data("autoHideScrollbar")&&c.showScrollbar.call(j)},onUpdate:function(){d.callbacks&&s("whileScrolling")},onComplete:function(){d.callbacks&&(s("onScroll"),(n||o&&i.position().left>=o)&&s("onTotalScrollBack"),(p||q&&i.position().left<=q)&&s("onTotalScroll")),l.data("preventAction",!1),e.data("mCS_tweenRunning",!1),e.data("autoHideScrollbar")&&(h.hasClass("mCS-mouse-over")||c.hideScrollbar.call(j))}})):(e.data("onTotalScrollBack_Offset")&&(o=-e.data("onTotalScrollBack_Offset")),e.data("onTotalScroll_Offset")&&(q=h.height()-i.outerHeight()+e.data("onTotalScroll_Offset")),g<0?(g=b=0,clearInterval(e.data("mCSB_buttonScrollUp")),o||(n=!0)):g>=k.height()-l.height()?(g=k.height()-l.height(),b=h.height()-i.outerHeight(),clearInterval(e.data("mCSB_buttonScrollDown")),q||(p=!0)):b=-b,c.mTweenAxis.call(this,l[0],"top",Math.round(g),draggerSpeed,d.scrollEasing),c.mTweenAxis.call(this,i[0],"top",Math.round(b),m,d.scrollEasing,{onStart:function(){d.callbacks&&!e.data("mCS_tweenRunning")&&s("onScrollStart"),e.data("autoHideScrollbar")&&c.showScrollbar.call(j)},onUpdate:function(){d.callbacks&&s("whileScrolling")},onComplete:function(){d.callbacks&&(s("onScroll"),(n||o&&i.position().top>=o)&&s("onTotalScrollBack"),(p||q&&i.position().top<=q)&&s("onTotalScroll")),l.data("preventAction",!1),e.data("mCS_tweenRunning",!1),e.data("autoHideScrollbar")&&(h.hasClass("mCS-mouse-over")||c.hideScrollbar.call(j))}})),e.data("mCS_Init")&&e.data({mCS_Init:!1})}}},stop:function(){var b=a(this),d=b.children().children(".mCSB_container"),e=b.children().children().children().children(".mCSB_dragger");c.mTweenAxisStop.call(this,d[0]),c.mTweenAxisStop.call(this,e[0])},disable:function(b){var c=a(this),d=c.children(".mCustomScrollBox"),e=d.children(".mCSB_container"),f=d.children(".mCSB_scrollTools"),g=f.children().children(".mCSB_dragger");d.unbind("mousewheel focusin mouseenter mouseleave touchend"),e.unbind("touchstart touchmove"),b&&(c.data("horizontalScroll")?g.add(e).css("left",0):g.add(e).css("top",0)),f.css("display","none"),e.addClass("mCS_no_scrollbar"),c.data({bindEvent_mousewheel:!1,bindEvent_focusin:!1,bindEvent_content_touch:!1,bindEvent_autoHideScrollbar:!1}).addClass("mCS_disabled")},destroy:function(){var b=a(this);b.removeClass("mCustomScrollbar _mCS_"+b.data("mCustomScrollbarIndex")).addClass("mCS_destroyed").children().children(".mCSB_container").unwrap().children().unwrap().siblings(".mCSB_scrollTools").remove(),a(document).unbind("mousemove."+b.data("mCustomScrollbarIndex")+" mouseup."+b.data("mCustomScrollbarIndex")+" MSPointerMove."+b.data("mCustomScrollbarIndex")+" MSPointerUp."+b.data("mCustomScrollbarIndex")),a(window).unbind("resize."+b.data("mCustomScrollbarIndex"))}},c={showScrollbar:function(){this.stop().animate({opacity:1},"fast")},hideScrollbar:function(){this.stop().animate({opacity:0},"fast")},mTweenAxis:function(a,b,c,d,e,f){function p(){return window.performance&&window.performance.now?window.performance.now():window.performance&&window.performance.webkitNow?window.performance.webkitNow():Date.now?Date.now():(new Date).getTime()}function q(){l||g.call(),l=p()-j,r(),l>=a._time&&(a._time=l>a._time?l+k-(l-a._time):l+k-1,a._time<l+1&&(a._time=l+1)),a._time<d?a._id=_request(q):i.call()}function r(){d>0?(a.currVal=u(a._time,m,o,d,e),n[b]=Math.round(a.currVal)+"px"):n[b]=c+"px",h.call()}function s(){k=1e3/60,a._time=l+k,_request=window.requestAnimationFrame?window.requestAnimationFrame:function(a){return r(),setTimeout(a,.01)},a._id=_request(q)}function t(){if(a._id==null)return;window.requestAnimationFrame?window.cancelAnimationFrame(a._id):clearTimeout(a._id),a._id=null}function u(a,b,c,d,e){switch(e){case"linear":return c*a/d+b;case"easeOutQuad":return a/=d,-c*a*(a-2)+b;case"easeInOutQuad":a/=d/2;if(a<1)return c/2*a*a+b;return a--,-c/2*(a*(a-2)-1)+b;case"easeOutCubic":return a/=d,a--,c*(a*a*a+1)+b;case"easeOutQuart":return a/=d,a--,-c*(a*a*a*a-1)+b;case"easeOutQuint":return a/=d,a--,c*(a*a*a*a*a+1)+b;case"easeOutCirc":return a/=d,a--,c*Math.sqrt(1-a*a)+b;case"easeOutSine":return c*Math.sin(a/d*(Math.PI/2))+b;case"easeOutExpo":return c*(-Math.pow(2,-10*a/d)+1)+b;case"mcsEaseOut":var f=(a/=d)*a,g=f*a;return b+c*(.499999999999997*g*f+ -2.5*f*f+5.5*g+ -6.5*f+4*a);case"draggerRailEase":a/=d/2;if(a<1)return c/2*a*a*a+b;return a-=2,c/2*(a*a*a+2)+b}}var f=f||{},g=f.onStart||function(){},h=f.onUpdate||function(){},i=f.onComplete||function(){},j=p(),k,l=0,m=a.offsetTop,n=a.style;b==="left"&&(m=a.offsetLeft);var o=c-m;t(),s()},mTweenAxisStop:function(a){if(a._id==null)return;window.requestAnimationFrame?window.cancelAnimationFrame(a._id):clearTimeout(a._id),a._id=null},rafPolyfill:function(){var a=["ms","moz","webkit","o"],b=a.length;while(--b>-1&&!window.requestAnimationFrame)window.requestAnimationFrame=window[a[b]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[b]+"CancelAnimationFrame"]||window[a[b]+"CancelRequestAnimationFrame"]}};c.rafPolyfill.call(),a.support.touch="ontouchstart"in window,a.support.msPointer=window.navigator.msPointerEnabled;var d="https:"==document.location.protocol?"https:":"http:";a.event.special.mousewheel||document.write('<script src="'+d+'//cdnjs.cloudflare.com/ajax/libs/jquery-mousewheel/3.0.6/jquery.mousewheel.min.js"></script>'),a.fn.mCustomScrollbar=function(c){if(b[c])return b[c].apply(this,Array.prototype.slice.call(arguments,1));if(typeof c=="object"||!c)return b.init.apply(this,arguments);a.error("Method "+c+" does not exist")}})(jQuery)
;(function(a){function b(b,c){function r(){return d.update(),t(),d}function s(){var a=m.toLowerCase();j.obj.css(l,n/h.ratio),g.obj.css(l,-n),p.start=j.obj.offset()[l],h.obj.css(a,i[c.axis]),i.obj.css(a,i[c.axis]),j.obj.css(a,j[c.axis])}function t(){q?f.obj[0].ontouchstart=function(a){1===a.touches.length&&(u(a.touches[0]),a.stopPropagation())}:(j.obj.bind("mousedown",u),i.obj.bind("mouseup",w)),c.scroll&&window.addEventListener?(e[0].addEventListener("DOMMouseScroll",v,!1),e[0].addEventListener("mousewheel",v,!1),e[0].addEventListener("MozMousePixelScroll",function(a){a.preventDefault()},!1)):c.scroll&&(e[0].onmousewheel=v)}function u(b){a("body").addClass("noSelect");var c=parseInt(j.obj.css(l),10);p.start=k?b.pageX:b.pageY,o.start=c=="auto"?0:c,q?(document.ontouchmove=function(a){a.preventDefault(),w(a.touches[0])},document.ontouchend=x):(a(document).bind("mousemove",w),a(document).bind("mouseup",x),j.obj.bind("mouseup",x))}function v(b){if(g.ratio<1){var d=b||window.event,e=d.wheelDelta?d.wheelDelta/120:-d.detail/3;n-=e*c.wheel,n=Math.min(g[c.axis]-f[c.axis],Math.max(0,n)),j.obj.css(l,n/h.ratio),g.obj.css(l,-n);if(c.lockscroll||n!==g[c.axis]-f[c.axis]&&n!==0)d=a.event.fix(d),d.preventDefault()}}function w(a){g.ratio<1&&(c.invertscroll&&q?o.now=Math.min(i[c.axis]-j[c.axis],Math.max(0,o.start+(p.start-(k?a.pageX:a.pageY)))):o.now=Math.min(i[c.axis]-j[c.axis],Math.max(0,o.start+((k?a.pageX:a.pageY)-p.start))),n=o.now*h.ratio,g.obj.css(l,-n),j.obj.css(l,o.now))}function x(){a("body").removeClass("noSelect"),a(document).unbind("mousemove",w),a(document).unbind("mouseup",x),j.obj.unbind("mouseup",x),document.ontouchmove=document.ontouchend=null}var d=this,e=b,f={obj:a(".viewport",b)},g={obj:a(".overview",b)},h={obj:a(".scrollbar",b)},i={obj:a(".track",h.obj)},j={obj:a(".thumb",h.obj)},k=c.axis==="x",l=k?"left":"top",m=k?"Width":"Height",n=0,o={start:0,now:0},p={},q="ontouchstart"in document.documentElement;return this.update=function(a){f[c.axis]=f.obj[0]["offset"+m],g[c.axis]=g.obj[0]["scroll"+m],g.ratio=f[c.axis]/g[c.axis],h.obj.toggleClass("disable",g.ratio>=1),i[c.axis]=c.size==="auto"?f[c.axis]:c.size,j[c.axis]=Math.min(i[c.axis],Math.max(0,c.sizethumb==="auto"?i[c.axis]*g.ratio:c.sizethumb)),h.ratio=c.sizethumb==="auto"?g[c.axis]/i[c.axis]:(g[c.axis]-f[c.axis])/(i[c.axis]-j[c.axis]),n=a==="relative"&&g.ratio<=1?Math.min(g[c.axis]-f[c.axis],Math.max(0,n)):0,n=a==="bottom"&&g.ratio<=1?g[c.axis]-f[c.axis]:isNaN(parseInt(a,10))?n:parseInt(a,10),s()},r()}a.tiny=a.tiny||{},a.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:!0,lockscroll:!0,size:"auto",sizethumb:"auto",invertscroll:!1}},a.fn.tinyscrollbar=function(c){var d=a.extend({},a.tiny.scrollbar.options,c);return this.each(function(){a(this).data("tsb",new b(a(this),d))}),this},a.fn.tinyscrollbar_update=function(b){return a(this).data("tsb").update(b)}})(jQuery)
;(function(a,b){function D(a){return e===""?a:(a=a.charAt(0).toUpperCase()+a.substr(1),e+a)}var c=Math,d=b.createElement("div").style,e=function(){var a="t,webkitT,MozT,msT,OT".split(","),b,c=0,e=a.length;for(;c<e;c++){b=a[c]+"ransform";if(b in d)return a[c].substr(0,a[c].length-1)}return!1}(),f=e?"-"+e.toLowerCase()+"-":"",g=D("transform"),h=D("transitionProperty"),i=D("transitionDuration"),j=D("transformOrigin"),k=D("transitionTimingFunction"),l=D("transitionDelay"),m=/android/gi.test(navigator.appVersion),n=/iphone|ipad/gi.test(navigator.appVersion),o=/hp-tablet/gi.test(navigator.appVersion),p=D("perspective")in d,q="ontouchstart"in a&&!o,r=e!==!1,s=D("transition")in d,t="onorientationchange"in a?"orientationchange":"resize",u=q?"touchstart":"mousedown",v=q?"touchmove":"mousemove",w=q?"touchend":"mouseup",x=q?"touchcancel":"mouseup",y=function(){if(e===!1)return!1;var a={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"};return a[e]}(),z=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){return setTimeout(a,1)}}(),A=function(){return a.cancelRequestAnimationFrame||a.webkitCancelAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||a.msCancelRequestAnimationFrame||clearTimeout}(),B=p?" translateZ(0)":"",C=function(c,d){var e=this,l;e.wrapper=typeof c=="object"?c:b.getElementById(c),e.wrapper.style.overflow="hidden",e.scroller=e.wrapper.children[0],e.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:m,hideScrollbar:n,fadeScrollbar:n&&p,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(l in d)e.options[l]=d[l];e.x=e.options.x,e.y=e.options.y,e.options.useTransform=r&&e.options.useTransform,e.options.hScrollbar=e.options.hScroll&&e.options.hScrollbar,e.options.vScrollbar=e.options.vScroll&&e.options.vScrollbar,e.options.zoom=e.options.useTransform&&e.options.zoom,e.options.useTransition=s&&e.options.useTransition,e.options.zoom&&m&&(B=""),e.scroller.style[h]=e.options.useTransform?f+"transform":"top left",e.scroller.style[i]="0",e.scroller.style[j]="0 0",e.options.useTransition&&(e.scroller.style[k]="cubic-bezier(0.33,0.66,0.66,1)"),e.options.useTransform?e.scroller.style[g]="translate("+e.x+"px,"+e.y+"px)"+B:e.scroller.style.cssText+=";position:absolute;top:"+e.y+"px;left:"+e.x+"px",e.options.useTransition&&(e.options.fixedScrollbar=!0),e.refresh(),e._bind(t,a),e._bind(u),q||e.options.wheelAction!="none"&&(e._bind("DOMMouseScroll"),e._bind("mousewheel")),e.options.checkDOMChanges&&(e.checkDOMTime=setInterval(function(){e._checkDOMChanges()},500))};C.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(a){var b=this;switch(a.type){case u:if(!q&&a.button!==0)return;b._start(a);break;case v:b._move(a);break;case w:case x:b._end(a);break;case t:b._resize();break;case"DOMMouseScroll":case"mousewheel":b._wheel(a);break;case y:b._transitionEnd(a)}},_checkDOMChanges:function(){if(this.moved||this.zoomed||this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)return;this.refresh()},_scrollbar:function(a){var d=this,e;if(!d[a+"Scrollbar"]){d[a+"ScrollbarWrapper"]&&(r&&(d[a+"ScrollbarIndicator"].style[g]=""),d[a+"ScrollbarWrapper"].parentNode.removeChild(d[a+"ScrollbarWrapper"]),d[a+"ScrollbarWrapper"]=null,d[a+"ScrollbarIndicator"]=null);return}d[a+"ScrollbarWrapper"]||(e=b.createElement("div"),d.options.scrollbarClass?e.className=d.options.scrollbarClass+a.toUpperCase():e.style.cssText="position:absolute;z-index:100;"+(a=="h"?"height:7px;bottom:1px;left:2px;right:"+(d.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(d.hScrollbar?"7":"2")+"px;top:2px;right:1px"),e.style.cssText+=";pointer-events:none;"+f+"transition-property:opacity;"+f+"transition-duration:"+(d.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(d.options.hideScrollbar?"0":"1"),d.wrapper.appendChild(e),d[a+"ScrollbarWrapper"]=e,e=b.createElement("div"),d.options.scrollbarClass||(e.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+f+"background-clip:padding-box;"+f+"box-sizing:border-box;"+(a=="h"?"height:100%":"width:100%")+";"+f+"border-radius:3px;border-radius:3px"),e.style.cssText+=";pointer-events:none;"+f+"transition-property:"+f+"transform;"+f+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+f+"transition-duration:0;"+f+"transform: translate(0,0)"+B,d.options.useTransition&&(e.style.cssText+=";"+f+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),d[a+"ScrollbarWrapper"].appendChild(e),d[a+"ScrollbarIndicator"]=e),a=="h"?(d.hScrollbarSize=d.hScrollbarWrapper.clientWidth,d.hScrollbarIndicatorSize=c.max(c.round(d.hScrollbarSize*d.hScrollbarSize/d.scrollerW),8),d.hScrollbarIndicator.style.width=d.hScrollbarIndicatorSize+"px",d.hScrollbarMaxScroll=d.hScrollbarSize-d.hScrollbarIndicatorSize,d.hScrollbarProp=d.hScrollbarMaxScroll/d.maxScrollX):(d.vScrollbarSize=d.vScrollbarWrapper.clientHeight,d.vScrollbarIndicatorSize=c.max(c.round(d.vScrollbarSize*d.vScrollbarSize/d.scrollerH),8),d.vScrollbarIndicator.style.height=d.vScrollbarIndicatorSize+"px",d.vScrollbarMaxScroll=d.vScrollbarSize-d.vScrollbarIndicatorSize,d.vScrollbarProp=d.vScrollbarMaxScroll/d.maxScrollY),d._scrollbarPos(a,!0)},_resize:function(){var a=this;setTimeout(function(){a.refresh()},m?200:0)},_pos:function(a,b){if(this.zoomed)return;a=this.hScroll?a:0,b=this.vScroll?b:0,this.options.useTransform?this.scroller.style[g]="translate("+a+"px,"+b+"px) scale("+this.scale+")"+B:(a=c.round(a),b=c.round(b),this.scroller.style.left=a+"px",this.scroller.style.top=b+"px"),this.x=a,this.y=b,this._scrollbarPos("h"),this._scrollbarPos("v")},_scrollbarPos:function(a,b){var d=this,e=a=="h"?d.x:d.y,f;if(!d[a+"Scrollbar"])return;e=d[a+"ScrollbarProp"]*e,e<0?(d.options.fixedScrollbar||(f=d[a+"ScrollbarIndicatorSize"]+c.round(e*3),f<8&&(f=8),d[a+"ScrollbarIndicator"].style[a=="h"?"width":"height"]=f+"px"),e=0):e>d[a+"ScrollbarMaxScroll"]&&(d.options.fixedScrollbar?e=d[a+"ScrollbarMaxScroll"]:(f=d[a+"ScrollbarIndicatorSize"]-c.round((e-d[a+"ScrollbarMaxScroll"])*3),f<8&&(f=8),d[a+"ScrollbarIndicator"].style[a=="h"?"width":"height"]=f+"px",e=d[a+"ScrollbarMaxScroll"]+(d[a+"ScrollbarIndicatorSize"]-f))),d[a+"ScrollbarWrapper"].style[l]="0",d[a+"ScrollbarWrapper"].style.opacity=b&&d.options.hideScrollbar?"0":"1",d[a+"ScrollbarIndicator"].style[g]="translate("+(a=="h"?e+"px,0)":"0,"+e+"px)")+B},_start:function(b){var d=this,e=q?b.touches[0]:b,f,h,i,j,k;if(!d.enabled)return;d.options.onBeforeScrollStart&&d.options.onBeforeScrollStart.call(d,b),(d.options.useTransition||d.options.zoom)&&d._transitionTime(0),d.moved=!1,d.animating=!1,d.zoomed=!1,d.distX=0,d.distY=0,d.absDistX=0,d.absDistY=0,d.dirX=0,d.dirY=0,d.options.zoom&&q&&b.touches.length>1&&(j=c.abs(b.touches[0].pageX-b.touches[1].pageX),k=c.abs(b.touches[0].pageY-b.touches[1].pageY),d.touchesDistStart=c.sqrt(j*j+k*k),d.originX=c.abs(b.touches[0].pageX+b.touches[1].pageX-d.wrapperOffsetLeft*2)/2-d.x,d.originY=c.abs(b.touches[0].pageY+b.touches[1].pageY-d.wrapperOffsetTop*2)/2-d.y,d.options.onZoomStart&&d.options.onZoomStart.call(d,b));if(d.options.momentum){d.options.useTransform?(f=getComputedStyle(d.scroller,null)[g].replace(/[^0-9\-.,]/g,"").split(","),h=+(f[12]||f[4]),i=+(f[13]||f[5])):(h=+getComputedStyle(d.scroller,null).left.replace(/[^0-9-]/g,""),i=+getComputedStyle(d.scroller,null).top.replace(/[^0-9-]/g,""));if(h!=d.x||i!=d.y)d.options.useTransition?d._unbind(y):A(d.aniTime),d.steps=[],d._pos(h,i),d.options.onScrollEnd&&d.options.onScrollEnd.call(d)}d.absStartX=d.x,d.absStartY=d.y,d.startX=d.x,d.startY=d.y,d.pointX=e.pageX,d.pointY=e.pageY,d.startTime=b.timeStamp||Date.now(),d.options.onScrollStart&&d.options.onScrollStart.call(d,b),d._bind(v,a),d._bind(w,a),d._bind(x,a)},_move:function(a){var b=this,d=q?a.touches[0]:a,e=d.pageX-b.pointX,f=d.pageY-b.pointY,h=b.x+e,i=b.y+f,j,k,l,m=a.timeStamp||Date.now();b.options.onBeforeScrollMove&&b.options.onBeforeScrollMove.call(b,a);if(b.options.zoom&&q&&a.touches.length>1){j=c.abs(a.touches[0].pageX-a.touches[1].pageX),k=c.abs(a.touches[0].pageY-a.touches[1].pageY),b.touchesDist=c.sqrt(j*j+k*k),b.zoomed=!0,l=1/b.touchesDistStart*b.touchesDist*this.scale,l<b.options.zoomMin?l=.5*b.options.zoomMin*Math.pow(2,l/b.options.zoomMin):l>b.options.zoomMax&&(l=2*b.options.zoomMax*Math.pow(.5,b.options.zoomMax/l)),b.lastScale=l/this.scale,h=this.originX-this.originX*b.lastScale+this.x,i=this.originY-this.originY*b.lastScale+this.y,this.scroller.style[g]="translate("+h+"px,"+i+"px) scale("+l+")"+B,b.options.onZoom&&b.options.onZoom.call(b,a);return}b.pointX=d.pageX,b.pointY=d.pageY;if(h>0||h<b.maxScrollX)h=b.options.bounce?b.x+e/2:h>=0||b.maxScrollX>=0?0:b.maxScrollX;if(i>b.minScrollY||i<b.maxScrollY)i=b.options.bounce?b.y+f/2:i>=b.minScrollY||b.maxScrollY>=0?b.minScrollY:b.maxScrollY;b.distX+=e,b.distY+=f,b.absDistX=c.abs(b.distX),b.absDistY=c.abs(b.distY);if(b.absDistX<6&&b.absDistY<6)return;b.options.lockDirection&&(b.absDistX>b.absDistY+5?(i=b.y,f=0):b.absDistY>b.absDistX+5&&(h=b.x,e=0)),b.moved=!0,b._pos(h,i),b.dirX=e>0?-1:e<0?1:0,b.dirY=f>0?-1:f<0?1:0,m-b.startTime>300&&(b.startTime=m,b.startX=b.x,b.startY=b.y),b.options.onScrollMove&&b.options.onScrollMove.call(b,a)},_end:function(d){if(q&&d.touches.length!==0)return;var e=this,f=q?d.changedTouches[0]:d,h,j,k={dist:0,time:0},l={dist:0,time:0},m=(d.timeStamp||Date.now())-e.startTime,n=e.x,o=e.y,p,r,s,t,u;e._unbind(v,a),e._unbind(w,a),e._unbind(x,a),e.options.onBeforeScrollEnd&&e.options.onBeforeScrollEnd.call(e,d);if(e.zoomed){u=e.scale*e.lastScale,u=Math.max(e.options.zoomMin,u),u=Math.min(e.options.zoomMax,u),e.lastScale=u/e.scale,e.scale=u,e.x=e.originX-e.originX*e.lastScale+e.x,e.y=e.originY-e.originY*e.lastScale+e.y,e.scroller.style[i]="200ms",e.scroller.style[g]="translate("+e.x+"px,"+e.y+"px) scale("+e.scale+")"+B,e.zoomed=!1,e.refresh(),e.options.onZoomEnd&&e.options.onZoomEnd.call(e,d);return}if(!e.moved){q&&(e.doubleTapTimer&&e.options.zoom?(clearTimeout(e.doubleTapTimer),e.doubleTapTimer=null,e.options.onZoomStart&&e.options.onZoomStart.call(e,d),e.zoom(e.pointX,e.pointY,e.scale==1?e.options.doubleTapZoom:1),e.options.onZoomEnd&&setTimeout(function(){e.options.onZoomEnd.call(e,d)},200)):this.options.handleClick&&(e.doubleTapTimer=setTimeout(function(){e.doubleTapTimer=null,h=f.target;while(h.nodeType!=1)h=h.parentNode;h.tagName!="SELECT"&&h.tagName!="INPUT"&&h.tagName!="TEXTAREA"&&(j=b.createEvent("MouseEvents"),j.initMouseEvent("click",!0,!0,d.view,1,f.screenX,f.screenY,f.clientX,f.clientY,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,0,null),j._fake=!0,h.dispatchEvent(j))},e.options.zoom?250:0))),e._resetPos(400),e.options.onTouchEnd&&e.options.onTouchEnd.call(e,d);return}if(m<300&&e.options.momentum){k=n?e._momentum(n-e.startX,m,-e.x,e.scrollerW-e.wrapperW+e.x,e.options.bounce?e.wrapperW:0):k,l=o?e._momentum(o-e.startY,m,-e.y,e.maxScrollY<0?e.scrollerH-e.wrapperH+e.y-e.minScrollY:0,e.options.bounce?e.wrapperH:0):l,n=e.x+k.dist,o=e.y+l.dist;if(e.x>0&&n>0||e.x<e.maxScrollX&&n<e.maxScrollX)k={dist:0,time:0};if(e.y>e.minScrollY&&o>e.minScrollY||e.y<e.maxScrollY&&o<e.maxScrollY)l={dist:0,time:0}}if(k.dist||l.dist){s=c.max(c.max(k.time,l.time),10),e.options.snap&&(p=n-e.absStartX,r=o-e.absStartY,c.abs(p)<e.options.snapThreshold&&c.abs(r)<e.options.snapThreshold?e.scrollTo(e.absStartX,e.absStartY,200):(t=e._snap(n,o),n=t.x,o=t.y,s=c.max(t.time,s))),e.scrollTo(c.round(n),c.round(o),s),e.options.onTouchEnd&&e.options.onTouchEnd.call(e,d);return}if(e.options.snap){p=n-e.absStartX,r=o-e.absStartY,c.abs(p)<e.options.snapThreshold&&c.abs(r)<e.options.snapThreshold?e.scrollTo(e.absStartX,e.absStartY,200):(t=e._snap(e.x,e.y),(t.x!=e.x||t.y!=e.y)&&e.scrollTo(t.x,t.y,t.time)),e.options.onTouchEnd&&e.options.onTouchEnd.call(e,d);return}e._resetPos(200),e.options.onTouchEnd&&e.options.onTouchEnd.call(e,d)},_resetPos:function(a){var b=this,c=b.x>=0?0:b.x<b.maxScrollX?b.maxScrollX:b.x,d=b.y>=b.minScrollY||b.maxScrollY>0?b.minScrollY:b.y<b.maxScrollY?b.maxScrollY:b.y;if(c==b.x&&d==b.y){b.moved&&(b.moved=!1,b.options.onScrollEnd&&b.options.onScrollEnd.call(b)),b.hScrollbar&&b.options.hideScrollbar&&(e=="webkit"&&(b.hScrollbarWrapper.style[l]="300ms"),b.hScrollbarWrapper.style.opacity="0"),b.vScrollbar&&b.options.hideScrollbar&&(e=="webkit"&&(b.vScrollbarWrapper.style[l]="300ms"),b.vScrollbarWrapper.style.opacity="0");return}b.scrollTo(c,d,a||0)},_wheel:function(a){var b=this,c,d,e,f,g;if("wheelDeltaX"in a)c=a.wheelDeltaX/12,d=a.wheelDeltaY/12;else if("wheelDelta"in a)c=d=a.wheelDelta/12;else if("detail"in a)c=d=-a.detail*3;else return;if(b.options.wheelAction=="zoom"){g=b.scale*Math.pow(2,1/3*(d?d/Math.abs(d):0)),g<b.options.zoomMin&&(g=b.options.zoomMin),g>b.options.zoomMax&&(g=b.options.zoomMax),g!=b.scale&&(!b.wheelZoomCount&&b.options.onZoomStart&&b.options.onZoomStart.call(b,a),b.wheelZoomCount++,b.zoom(a.pageX,a.pageY,g,400),setTimeout(function(){b.wheelZoomCount--,!b.wheelZoomCount&&b.options.onZoomEnd&&b.options.onZoomEnd.call(b,a)},400));return}e=b.x+c,f=b.y+d,e>0?e=0:e<b.maxScrollX&&(e=b.maxScrollX),f>b.minScrollY?f=b.minScrollY:f<b.maxScrollY&&(f=b.maxScrollY),b.maxScrollY<0&&b.scrollTo(e,f,0)},_transitionEnd:function(a){var b=this;if(a.target!=b.scroller)return;b._unbind(y),b._startAni()},_startAni:function(){var a=this,b=a.x,d=a.y,e=Date.now(),f,g,h;if(a.animating)return;if(!a.steps.length){a._resetPos(400);return}f=a.steps.shift(),f.x==b&&f.y==d&&(f.time=0),a.animating=!0,a.moved=!0;if(a.options.useTransition){a._transitionTime(f.time),a._pos(f.x,f.y),a.animating=!1,f.time?a._bind(y):a._resetPos(0);return}h=function(){var i=Date.now(),j,k;if(i>=e+f.time){a._pos(f.x,f.y),a.animating=!1,a.options.onAnimationEnd&&a.options.onAnimationEnd.call(a),a._startAni();return}i=(i-e)/f.time-1,g=c.sqrt(1-i*i),j=(f.x-b)*g+b,k=(f.y-d)*g+d,a._pos(j,k),a.animating&&(a.aniTime=z(h))},h()},_transitionTime:function(a){a+="ms",this.scroller.style[i]=a,this.hScrollbar&&(this.hScrollbarIndicator.style[i]=a),this.vScrollbar&&(this.vScrollbarIndicator.style[i]=a)},_momentum:function(a,b,d,e,f){var g=6e-4,h=c.abs(a)/b,i=h*h/(2*g),j=0,k=0;return a>0&&i>d?(k=f/(6/(i/h*g)),d+=k,h=h*d/i,i=d):a<0&&i>e&&(k=f/(6/(i/h*g)),e+=k,h=h*e/i,i=e),i*=a<0?-1:1,j=h/g,{dist:i,time:c.round(j)}},_offset:function(a){var b=-a.offsetLeft,c=-a.offsetTop;while(a=a.offsetParent)b-=a.offsetLeft,c-=a.offsetTop;return a!=this.wrapper&&(b*=this.scale,c*=this.scale),{left:b,top:c}},_snap:function(a,b){var d=this,e,f,g,h,i,j;g=d.pagesX.length-1;for(e=0,f=d.pagesX.length;e<f;e++)if(a>=d.pagesX[e]){g=e;break}g==d.currPageX&&g>0&&d.dirX<0&&g--,a=d.pagesX[g],i=c.abs(a-d.pagesX[d.currPageX]),i=i?c.abs(d.x-a)/i*500:0,d.currPageX=g,g=d.pagesY.length-1;for(e=0;e<g;e++)if(b>=d.pagesY[e]){g=e;break}return g==d.currPageY&&g>0&&d.dirY<0&&g--,b=d.pagesY[g],j=c.abs(b-d.pagesY[d.currPageY]),j=j?c.abs(d.y-b)/j*500:0,d.currPageY=g,h=c.round(c.max(i,j))||200,{x:a,y:b,time:h}},_bind:function(a,b,c){(b||this.scroller).addEventListener(a,this,!!c)},_unbind:function(a,b,c){(b||this.scroller).removeEventListener(a,this,!!c)},destroy:function(){var b=this;b.scroller.style[g]="",b.hScrollbar=!1,b.vScrollbar=!1,b._scrollbar("h"),b._scrollbar("v"),b._unbind(t,a),b._unbind(u),b._unbind(v,a),b._unbind(w,a),b._unbind(x,a),b.options.hasTouch||(b._unbind("DOMMouseScroll"),b._unbind("mousewheel")),b.options.useTransition&&b._unbind(y),b.options.checkDOMChanges&&clearInterval(b.checkDOMTime),b.options.onDestroy&&b.options.onDestroy.call(b)},refresh:function(){var a=this,b,d,e,f,g=0,h=0;a.scale<a.options.zoomMin&&(a.scale=a.options.zoomMin),a.wrapperW=a.wrapper.clientWidth||1,a.wrapperH=a.wrapper.clientHeight||1,a.minScrollY=-a.options.topOffset||0,a.scrollerW=c.round(a.scroller.offsetWidth*a.scale),a.scrollerH=c.round((a.scroller.offsetHeight+a.minScrollY)*a.scale),a.maxScrollX=a.wrapperW-a.scrollerW,a.maxScrollY=a.wrapperH-a.scrollerH+a.minScrollY,a.dirX=0,a.dirY=0,a.options.onRefresh&&a.options.onRefresh.call(a),a.hScroll=a.options.hScroll&&a.maxScrollX<0,a.vScroll=a.options.vScroll&&(!a.options.bounceLock&&!a.hScroll||a.scrollerH>a.wrapperH),a.hScrollbar=a.hScroll&&a.options.hScrollbar,a.vScrollbar=a.vScroll&&a.options.vScrollbar&&a.scrollerH>a.wrapperH,b=a._offset(a.wrapper),a.wrapperOffsetLeft=-b.left,a.wrapperOffsetTop=-b.top;if(typeof a.options.snap=="string"){a.pagesX=[],a.pagesY=[],f=a.scroller.querySelectorAll(a.options.snap);for(d=0,e=f.length;d<e;d++)g=a._offset(f[d]),g.left+=a.wrapperOffsetLeft,g.top+=a.wrapperOffsetTop,a.pagesX[d]=g.left<a.maxScrollX?a.maxScrollX:g.left*a.scale,a.pagesY[d]=g.top<a.maxScrollY?a.maxScrollY:g.top*a.scale}else if(a.options.snap){a.pagesX=[];while(g>=a.maxScrollX)a.pagesX[h]=g,g-=a.wrapperW,h++;a.maxScrollX%a.wrapperW&&(a.pagesX[a.pagesX.length]=a.maxScrollX-a.pagesX[a.pagesX.length-1]+a.pagesX[a.pagesX.length-1]),g=0,h=0,a.pagesY=[];while(g>=a.maxScrollY)a.pagesY[h]=g,g-=a.wrapperH,h++;a.maxScrollY%a.wrapperH&&(a.pagesY[a.pagesY.length]=a.maxScrollY-a.pagesY[a.pagesY.length-1]+a.pagesY[a.pagesY.length-1])}a._scrollbar("h"),a._scrollbar("v"),a.zoomed||(a.scroller.style[i]="0",a._resetPos(400))},scrollTo:function(a,b,c,d){var e=this,f=a,g,h;e.stop(),f.length||(f=[{x:a,y:b,time:c,relative:d}]);for(g=0,h=f.length;g<h;g++)f[g].relative&&(f[g].x=e.x-f[g].x,f[g].y=e.y-f[g].y),e.steps.push({x:f[g].x,y:f[g].y,time:f[g].time||0});e._startAni()},scrollToElement:function(a,b){var d=this,e;a=a.nodeType?a:d.scroller.querySelector(a);if(!a)return;e=d._offset(a),e.left+=d.wrapperOffsetLeft,e.top+=d.wrapperOffsetTop,e.left=e.left>0?0:e.left<d.maxScrollX?d.maxScrollX:e.left,e.top=e.top>d.minScrollY?d.minScrollY:e.top<d.maxScrollY?d.maxScrollY:e.top,b=b===undefined?c.max(c.abs(e.left)*2,c.abs(e.top)*2):b,d.scrollTo(e.left,e.top,b)},scrollToPage:function(a,b,c){var d=this,e,f;c=c===undefined?400:c,d.options.onScrollStart&&d.options.onScrollStart.call(d),d.options.snap?(a=a=="next"?d.currPageX+1:a=="prev"?d.currPageX-1:a,b=b=="next"?d.currPageY+1:b=="prev"?d.currPageY-1:b,a=a<0?0:a>d.pagesX.length-1?d.pagesX.length-1:a,b=b<0?0:b>d.pagesY.length-1?d.pagesY.length-1:b,d.currPageX=a,d.currPageY=b,e=d.pagesX[a],f=d.pagesY[b]):(e=-d.wrapperW*a,f=-d.wrapperH*b,e<d.maxScrollX&&(e=d.maxScrollX),f<d.maxScrollY&&(f=d.maxScrollY)),d.scrollTo(e,f,c)},disable:function(){this.stop(),this._resetPos(0),this.enabled=!1,this._unbind(v,a),this._unbind(w,a),this._unbind(x,a)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(y):A(this.aniTime),this.steps=[],this.moved=!1,this.animating=!1},zoom:function(a,b,c,d){var e=this,f=c/e.scale;if(!e.options.useTransform)return;e.zoomed=!0,d=d===undefined?200:d,a=a-e.wrapperOffsetLeft-e.x,b=b-e.wrapperOffsetTop-e.y,e.x=a-a*f+e.x,e.y=b-b*f+e.y,e.scale=c,e.refresh(),e.x=e.x>0?0:e.x<e.maxScrollX?e.maxScrollX:e.x,e.y=e.y>e.minScrollY?e.minScrollY:e.y<e.maxScrollY?e.maxScrollY:e.y,e.scroller.style[i]=d+"ms",e.scroller.style[g]="translate("+e.x+"px,"+e.y+"px) scale("+c+")"+B,e.zoomed=!1},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}},d=null,typeof exports!="undefined"?exports.iScroll=C:a.iScroll=C})(window,document)
;(function(a){var b={},c={mode:"horizontal",slideSelector:"",infiniteLoop:!0,hideControlOnEnd:!1,speed:500,easing:null,slideMargin:0,startSlide:0,randomStart:!1,captions:!1,ticker:!1,tickerHover:!1,adaptiveHeight:!1,adaptiveHeightSpeed:500,video:!1,useCSS:!0,preloadImages:"visible",touchEnabled:!0,swipeThreshold:50,oneToOneTouch:!0,preventDefaultSwipeX:!0,preventDefaultSwipeY:!1,pager:!0,pagerType:"full",pagerShortSeparator:" / ",pagerSelector:null,buildPager:null,pagerCustom:null,controls:!0,nextText:"Next",prevText:"Prev",nextSelector:null,prevSelector:null,autoControls:!1,startText:"Start",stopText:"Stop",autoControlsCombine:!1,autoControlsSelector:null,auto:!1,pause:4e3,autoStart:!0,autoDirection:"next",autoHover:!1,autoDelay:0,minSlides:1,maxSlides:1,moveSlides:0,slideWidth:0,onSliderLoad:function(){},onSlideBefore:function(){},onSlideAfter:function(){},onSlideNext:function(){},onSlidePrev:function(){}};a.fn.bxSlider=function(d){if(this.length==0)return this;if(this.length>1)return this.each(function(){a(this).bxSlider(d)}),this;var e={},f=this;b.el=this;var g=a(window).width(),h=a(window).height(),j=function(){e.settings=a.extend({},c,d),e.settings.slideWidth=parseInt(e.settings.slideWidth),e.children=f.children(e.settings.slideSelector),e.children.length<e.settings.minSlides&&(e.settings.minSlides=e.children.length),e.children.length<e.settings.maxSlides&&(e.settings.maxSlides=e.children.length),e.settings.randomStart&&(e.settings.startSlide=Math.floor(Math.random()*e.children.length)),e.active={index:e.settings.startSlide},e.carousel=e.settings.minSlides>1||e.settings.maxSlides>1,e.carousel&&(e.settings.preloadImages="all"),e.minThreshold=e.settings.minSlides*e.settings.slideWidth+(e.settings.minSlides-1)*e.settings.slideMargin,e.maxThreshold=e.settings.maxSlides*e.settings.slideWidth+(e.settings.maxSlides-1)*e.settings.slideMargin,e.working=!1,e.controls={},e.interval=null,e.animProp=e.settings.mode=="vertical"?"top":"left",e.usingCSS=e.settings.useCSS&&e.settings.mode!="fade"&&function(){var a=document.createElement("div"),b=["WebkitPerspective","MozPerspective","OPerspective","msPerspective"];for(var c in b)if(a.style[b[c]]!==undefined)return e.cssPrefix=b[c].replace("Perspective","").toLowerCase(),e.animProp="-"+e.cssPrefix+"-transform",!0;return!1}(),e.settings.mode=="vertical"&&(e.settings.maxSlides=e.settings.minSlides),k()},k=function(){f.wrap('<div class="bx-wrapper"><div class="bx-viewport"></div></div>'),e.viewport=f.parent(),e.loader=a('<div class="bx-loading" />'),e.viewport.prepend(e.loader),f.css({width:e.settings.mode=="horizontal"?e.children.length*215+"%":"auto",position:"relative"}),e.usingCSS&&e.settings.easing?f.css("-"+e.cssPrefix+"-transition-timing-function",e.settings.easing):e.settings.easing||(e.settings.easing="swing");var b=p();e.viewport.css({width:"100%",overflow:"hidden",position:"relative"}),e.viewport.parent().css({maxWidth:n()}),e.children.css({"float":e.settings.mode=="horizontal"?"left":"none",listStyle:"none",position:"relative"}),e.children.width(o()),e.settings.mode=="horizontal"&&e.settings.slideMargin>0&&e.children.css("marginRight",e.settings.slideMargin),e.settings.mode=="vertical"&&e.settings.slideMargin>0&&e.children.css("marginBottom",e.settings.slideMargin),e.settings.mode=="fade"&&(e.children.css({position:"absolute",zIndex:0,display:"none"}),e.children.eq(e.settings.startSlide).css({zIndex:50,display:"block"})),e.controls.el=a('<div class="bx-controls" />'),e.settings.captions&&y();if(e.settings.infiniteLoop&&e.settings.mode!="fade"&&!e.settings.ticker){var c=e.settings.mode=="vertical"?e.settings.minSlides:e.settings.maxSlides,d=e.children.slice(0,c).clone().addClass("bx-clone"),g=e.children.slice(-c).clone().addClass("bx-clone");f.append(d).prepend(g)}e.active.last=e.settings.startSlide==q()-1,e.settings.video&&f.fitVids();var h=e.children.eq(e.settings.startSlide);e.settings.preloadImages=="all"&&(h=f.children()),e.settings.ticker?e.settings.pager=!1:(e.settings.pager&&v(),e.settings.controls&&w(),e.settings.auto&&e.settings.autoControls&&x(),(e.settings.controls||e.settings.autoControls||e.settings.pager)&&e.viewport.after(e.controls.el)),h.imagesLoaded(l)},l=function(){e.loader.remove(),s(),e.settings.mode=="vertical"&&(e.settings.adaptiveHeight=!0),e.viewport.height(m()),f.redrawSlider(),e.settings.onSliderLoad(e.active.index),e.initialized=!0,a(window).bind("resize",P),e.settings.auto&&e.settings.autoStart&&I(),e.settings.ticker&&J(),e.settings.pager&&E(e.settings.startSlide),e.settings.controls&&H(),e.settings.touchEnabled&&!e.settings.ticker&&L()},m=function(){var b=0,c=a();if(e.settings.mode!="vertical"&&!e.settings.adaptiveHeight)c=e.children;else if(!e.carousel)c=e.children.eq(e.active.index);else{var d=e.settings.moveSlides==1?e.active.index:e.active.index*r();c=e.children.eq(d);for(i=1;i<=e.settings.maxSlides-1;i++)d+i>=e.children.length?c=c.add(e.children.eq(i-1)):c=c.add(e.children.eq(d+i))}return e.settings.mode=="vertical"?(c.each(function(c){b+=a(this).outerHeight()}),e.settings.slideMargin>0&&(b+=e.settings.slideMargin*(e.settings.minSlides-1))):b=Math.max.apply(Math,c.map(function(){return a(this).outerHeight(!1)}).get()),b},n=function(){var a="100%";return e.settings.slideWidth>0&&(e.settings.mode=="horizontal"?a=e.settings.maxSlides*e.settings.slideWidth+(e.settings.maxSlides-1)*e.settings.slideMargin:a=e.settings.slideWidth),a},o=function(){var a=e.settings.slideWidth,b=e.viewport.width();return e.settings.slideWidth==0||e.settings.slideWidth>b&&!e.carousel||e.settings.mode=="vertical"?a=b:e.settings.maxSlides>1&&e.settings.mode=="horizontal"&&(b>e.maxThreshold||b<e.minThreshold&&(a=(b-e.settings.slideMargin*(e.settings.minSlides-1))/e.settings.minSlides)),a},p=function(){var a=1;if(e.settings.mode=="horizontal"&&e.settings.slideWidth>0)if(e.viewport.width()<e.minThreshold)a=e.settings.minSlides;else if(e.viewport.width()>e.maxThreshold)a=e.settings.maxSlides;else{var b=e.children.first().width();a=Math.floor(e.viewport.width()/b)}else e.settings.mode=="vertical"&&(a=e.settings.minSlides);return a},q=function(){var a=0;if(e.settings.moveSlides>0)if(e.settings.infiniteLoop)a=e.children.length/r();else{var b=0,c=0;while(b<e.children.length)++a,b=c+p(),c+=e.settings.moveSlides<=p()?e.settings.moveSlides:p()}else a=Math.ceil(e.children.length/p());return a},r=function(){return e.settings.moveSlides>0&&e.settings.moveSlides<=p()?e.settings.moveSlides:p()},s=function(){if(e.children.length>e.settings.maxSlides&&e.active.last&&!e.settings.infiniteLoop){if(e.settings.mode=="horizontal"){var a=e.children.last(),b=a.position();t(-(b.left-(e.viewport.width()-a.width())),"reset",0)}else if(e.settings.mode=="vertical"){var c=e.children.length-e.settings.minSlides,b=e.children.eq(c).position();t(-b.top,"reset",0)}}else{var b=e.children.eq(e.active.index*r()).position();e.active.index==q()-1&&(e.active.last=!0),b!=undefined&&(e.settings.mode=="horizontal"?t(-b.left,"reset",0):e.settings.mode=="vertical"&&t(-b.top,"reset",0))}},t=function(a,b,c,d){if(e.usingCSS){var g=e.settings.mode=="vertical"?"translate3d(0, "+a+"px, 0)":"translate3d("+a+"px, 0, 0)";f.css("-"+e.cssPrefix+"-transition-duration",c/1e3+"s"),b=="slide"?(f.css(e.animProp,g),f.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){f.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),F()})):b=="reset"?f.css(e.animProp,g):b=="ticker"&&(f.css("-"+e.cssPrefix+"-transition-timing-function","linear"),f.css(e.animProp,g),f.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){f.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),t(d.resetValue,"reset",0),K()}))}else{var h={};h[e.animProp]=a,b=="slide"?f.animate(h,c,e.settings.easing,function(){F()}):b=="reset"?f.css(e.animProp,a):b=="ticker"&&f.animate(h,speed,"linear",function(){t(d.resetValue,"reset",0),K()})}},u=function(){var b="",c=q();for(var d=0;d<c;d++){var f="";e.settings.buildPager&&a.isFunction(e.settings.buildPager)?(f=e.settings.buildPager(d),e.pagerEl.addClass("bx-custom-pager")):(f=d+1,e.pagerEl.addClass("bx-default-pager")),b+='<div class="bx-pager-item"><a href="" data-slide-index="'+d+'" class="bx-pager-link">'+f+"</a></div>"}e.pagerEl.html(b)},v=function(){e.settings.pagerCustom?e.pagerEl=a(e.settings.pagerCustom):(e.pagerEl=a('<div class="bx-pager" />'),e.settings.pagerSelector?a(e.settings.pagerSelector).html(e.pagerEl):e.controls.el.addClass("bx-has-pager").append(e.pagerEl),u()),e.pagerEl.delegate("a","click",D)},w=function(){e.controls.next=a('<a class="bx-next" href="">'+e.settings.nextText+"</a>"),e.controls.prev=a('<a class="bx-prev" href="">'+e.settings.prevText+"</a>"),e.controls.next.bind("click",z),e.controls.prev.bind("click",A),e.settings.nextSelector&&a(e.settings.nextSelector).append(e.controls.next),e.settings.prevSelector&&a(e.settings.prevSelector).append(e.controls.prev),!e.settings.nextSelector&&!e.settings.prevSelector&&(e.controls.directionEl=a('<div class="bx-controls-direction" />'),e.controls.directionEl.append(e.controls.prev).append(e.controls.next),e.controls.el.addClass("bx-has-controls-direction").append(e.controls.directionEl))},x=function(){e.controls.start=a('<div class="bx-controls-auto-item"><a class="bx-start" href="">'+e.settings.startText+"</a></div>"),e.controls.stop=a('<div class="bx-controls-auto-item"><a class="bx-stop" href="">'+e.settings.stopText+"</a></div>"),e.controls.autoEl=a('<div class="bx-controls-auto" />'),e.controls.autoEl.delegate(".bx-start","click",B),e.controls.autoEl.delegate(".bx-stop","click",C),e.settings.autoControlsCombine?e.controls.autoEl.append(e.controls.start):e.controls.autoEl.append(e.controls.start).append(e.controls.stop),e.settings.autoControlsSelector?a(e.settings.autoControlsSelector).html(e.controls.autoEl):e.controls.el.addClass("bx-has-controls-auto").append(e.controls.autoEl),G(e.settings.autoStart?"stop":"start")},y=function(){e.children.each(function(b){var c=a(this).find("img:first").attr("title");c!=undefined&&a(this).append('<div class="bx-caption"><span>'+c+"</span></div>")})},z=function(a){e.settings.auto&&f.stopAuto(),f.goToNextSlide(),a.preventDefault()},A=function(a){e.settings.auto&&f.stopAuto(),f.goToPrevSlide(),a.preventDefault()},B=function(a){f.startAuto(),a.preventDefault()},C=function(a){f.stopAuto(),a.preventDefault()},D=function(b){e.settings.auto&&f.stopAuto();var c=a(b.currentTarget),d=parseInt(c.attr("data-slide-index"));d!=e.active.index&&f.goToSlide(d),b.preventDefault()},E=function(b){if(e.settings.pagerType=="short"){e.pagerEl.html(b+1+e.settings.pagerShortSeparator+e.children.length);return}e.pagerEl.find("a").removeClass("active"),e.pagerEl.each(function(c,d){a(d).find("a").eq(b).addClass("active")})},F=function(){if(e.settings.infiniteLoop){var a="";e.active.index==0?a=e.children.eq(0).position():e.active.index==q()-1&&e.carousel?a=e.children.eq((q()-1)*r()).position():e.active.index==e.children.length-1&&(a=e.children.eq(e.children.length-1).position()),e.settings.mode=="horizontal"?t(-a.left,"reset",0):e.settings.mode=="vertical"&&t(-a.top,"reset",0)}e.working=!1,e.settings.onSlideAfter(e.children.eq(e.active.index),e.oldIndex,e.active.index)},G=function(a){e.settings.autoControlsCombine?e.controls.autoEl.html(e.controls[a]):(e.controls.autoEl.find("a").removeClass("active"),e.controls.autoEl.find("a:not(.bx-"+a+")").addClass("active"))},H=function(){q()==1?(e.controls.prev.addClass("disabled"),e.controls.next.addClass("disabled")):!e.settings.infiniteLoop&&e.settings.hideControlOnEnd&&(e.active.index==0?(e.controls.prev.addClass("disabled"),e.controls.next.removeClass("disabled")):e.active.index==q()-1?(e.controls.next.addClass("disabled"),e.controls.prev.removeClass("disabled")):(e.controls.prev.removeClass("disabled"),e.controls.next.removeClass("disabled")))},I=function(){if(e.settings.autoDelay>0)var a=setTimeout(f.startAuto,e.settings.autoDelay);else f.startAuto();e.settings.autoHover&&f.hover(function(){e.interval&&(f.stopAuto(!0),e.autoPaused=!0)},function(){e.autoPaused&&(f.startAuto(!0),e.autoPaused=null)})},J=function(){var b=0;if(e.settings.autoDirection=="next")f.append(e.children.clone().addClass("bx-clone"));else{f.prepend(e.children.clone().addClass("bx-clone"));var c=e.children.first().position();b=e.settings.mode=="horizontal"?-c.left:-c.top}t(b,"reset",0),e.settings.pager=!1,e.settings.controls=!1,e.settings.autoControls=!1,e.settings.tickerHover&&!e.usingCSS&&e.viewport.hover(function(){f.stop()},function(){var b=0;e.children.each(function(c){b+=e.settings.mode=="horizontal"?a(this).outerWidth(!0):a(this).outerHeight(!0)});var c=e.settings.speed/b,d=e.settings.mode=="horizontal"?"left":"top",g=c*(b-Math.abs(parseInt(f.css(d))));K(g)}),K()},K=function(a){speed=a?a:e.settings.speed;var b={left:0,top:0},c={left:0,top:0};e.settings.autoDirection=="next"?b=f.find(".bx-clone").first().position():c=e.children.first().position();var d=e.settings.mode=="horizontal"?-b.left:-b.top,g=e.settings.mode=="horizontal"?-c.left:-c.top,h={resetValue:g};t(d,"ticker",speed,h)},L=function(){e.touch={start:{x:0,y:0},end:{x:0,y:0}},e.viewport.bind("touchstart",M)},M=function(a){if(e.working)a.preventDefault();else{e.touch.originalPos=f.position();var b=a.originalEvent;e.touch.start.x=b.changedTouches[0].pageX,e.touch.start.y=b.changedTouches[0].pageY,e.viewport.bind("touchmove",N),e.viewport.bind("touchend",O)}},N=function(a){var b=a.originalEvent,c=Math.abs(b.changedTouches[0].pageX-e.touch.start.x),d=Math.abs(b.changedTouches[0].pageY-e.touch.start.y);c*3>d&&e.settings.preventDefaultSwipeX?a.preventDefault():d*3>c&&e.settings.preventDefaultSwipeY&&a.preventDefault();if(e.settings.mode!="fade"&&e.settings.oneToOneTouch){var f=0;if(e.settings.mode=="horizontal"){var g=b.changedTouches[0].pageX-e.touch.start.x;f=e.touch.originalPos.left+g}else{var g=b.changedTouches[0].pageY-e.touch.start.y;f=e.touch.originalPos.top+g}t(f,"reset",0)}},O=function(a){e.viewport.unbind("touchmove",N);var b=a.originalEvent,c=0;e.touch.end.x=b.changedTouches[0].pageX,e.touch.end.y=b.changedTouches[0].pageY;if(e.settings.mode=="fade"){var d=Math.abs(e.touch.start.x-e.touch.end.x);d>=e.settings.swipeThreshold&&(e.touch.start.x>e.touch.end.x?f.goToNextSlide():f.goToPrevSlide(),f.stopAuto())}else{var d=0;e.settings.mode=="horizontal"?(d=e.touch.end.x-e.touch.start.x,c=e.touch.originalPos.left):(d=e.touch.end.y-e.touch.start.y,c=e.touch.originalPos.top),!e.settings.infiniteLoop&&(e.active.index==0&&d>0||e.active.last&&d<0)?t(c,"reset",200):Math.abs(d)>=e.settings.swipeThreshold?(d<0?f.goToNextSlide():f.goToPrevSlide(),f.stopAuto()):t(c,"reset",200)}e.viewport.unbind("touchend",O)},P=function(b){var c=a(window).width(),d=a(window).height();if(g!=c||h!=d)g=c,h=d,f.redrawSlider()};return f.goToSlide=function(b,c){if(e.working||e.active.index==b)return;e.working=!0,e.oldIndex=e.active.index,b<0?e.active.index=q()-1:b>=q()?e.active.index=0:e.active.index=b,e.settings.onSlideBefore(e.children.eq(e.active.index),e.oldIndex,e.active.index),c=="next"?e.settings.onSlideNext(e.children.eq(e.active.index),e.oldIndex,e.active.index):c=="prev"&&e.settings.onSlidePrev(e.children.eq(e.active.index),e.oldIndex,e.active.index),e.active.last=e.active.index>=q()-1,e.settings.pager&&E(e.active.index),e.settings.controls&&H();if(e.settings.mode=="fade")e.settings.adaptiveHeight&&e.viewport.height()!=m()&&e.viewport.animate({height:m()},e.settings.adaptiveHeightSpeed),e.children.filter(":visible").fadeOut(e.settings.speed).css({zIndex:0}),e.children.eq(e.active.index).css("zIndex",51).fadeIn(e.settings.speed,function(){a(this).css("zIndex",50),F()});else{e.settings.adaptiveHeight&&e.viewport.height()!=m()&&e.viewport.animate({height:m()},e.settings.adaptiveHeightSpeed);var d=0,g={left:0,top:0};if(!e.settings.infiniteLoop&&e.carousel&&e.active.last)if(e.settings.mode=="horizontal"){var h=e.children.eq(e.children.length-1);g=h.position(),d=e.viewport.width()-h.width()}else{var i=e.children.length-e.settings.minSlides;g=e.children.eq(i).position()}else if(e.carousel&&e.active.last&&c=="prev"){var j=e.settings.moveSlides==1?e.settings.maxSlides-r():(q()-1)*r()-(e.children.length-e.settings.maxSlides),h=f.children(".bx-clone").eq(j);g=h.position()}else if(c=="next"&&e.active.index==0)g=f.find("> .bx-clone").eq(e.settings.maxSlides).position(),e.active.last=!1;else if(b>=0){var k=b*r();g=e.children.eq(k).position()}if("undefined"!=typeof g){var l=e.settings.mode=="horizontal"?-(g.left-d):-g.top;t(l,"slide",e.settings.speed)}}},f.goToNextSlide=function(){if(!e.settings.infiniteLoop&&e.active.last)return;var a=parseInt(e.active.index)+1;f.goToSlide(a,"next")},f.goToPrevSlide=function(){if(!e.settings.infiniteLoop&&e.active.index==0)return;var a=parseInt(e.active.index)-1;f.goToSlide(a,"prev")},f.startAuto=function(a){if(e.interval)return;e.interval=setInterval(function(){e.settings.autoDirection=="next"?f.goToNextSlide():f.goToPrevSlide()},e.settings.pause),e.settings.autoControls&&a!=1&&G("stop")},f.stopAuto=function(a){if(!e.interval)return;clearInterval(e.interval),e.interval=null,e.settings.autoControls&&a!=1&&G("start")},f.getCurrentSlide=function(){return e.active.index},f.getSlideCount=function(){return e.children.length},f.redrawSlider=function(){e.children.add(f.find(".bx-clone")).width(o()),e.viewport.css("height",m()),e.settings.ticker||s(),e.active.last&&(e.active.index=q()-1),e.active.index>=q()&&(e.active.last=!0),e.settings.pager&&!e.settings.pagerCustom&&(u(),E(e.active.index))},f.destroySlider=function(){if(!e.initialized)return;e.initialized=!1,a(".bx-clone",this).remove(),e.children.removeAttr("style"),this.removeAttr("style").unwrap().unwrap(),e.controls.el&&e.controls.el.remove(),e.controls.next&&e.controls.next.remove(),e.controls.prev&&e.controls.prev.remove(),e.pagerEl&&e.pagerEl.remove(),a(".bx-caption",this).remove(),e.controls.autoEl&&e.controls.autoEl.remove(),clearInterval(e.interval),a(window).unbind("resize",P)},f.reloadSlider=function(a){a!=undefined&&(d=a),f.destroySlider(),j()},j(),this}})(jQuery),function(a,b){var c="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";a.fn.imagesLoaded=function(d){function e(){var b=a(m),c=a(o);h&&(o.length?h.reject(j,b,c):h.resolve(j)),a.isFunction(d)&&d.call(g,j,b,c)}function f(b,d){b.src===c||-1!==a.inArray(b,k)||(k.push(b),d?o.push(b):m.push(b),a.data(b,"imagesLoaded",{isBroken:d,src:b.src}),i&&h.notifyWith(a(b),[d,j,a(m),a(o)]),j.length===k.length&&(setTimeout(e),j.unbind(".imagesLoaded")))}var g=this,h=a.isFunction(a.Deferred)?a.Deferred():0,i=a.isFunction(h.notify),j=g.find("img").add(g.filter("img")),k=[],m=[],o=[];return a.isPlainObject(d)&&a.each(d,function(a,b){"callback"===a?d=b:h&&h[a](b)}),j.length?j.bind("load.imagesLoaded error.imagesLoaded",function(a){f(a.target,"error"===a.type)}).each(function(d,e){var g=e.src,h=a.data(e,"imagesLoaded");if(h&&h.src===g)f(e,h.isBroken);else if(e.complete&&e.naturalWidth!==b)f(e,0===e.naturalWidth||0===e.naturalHeight);else if(e.readyState||e.complete)e.src=c,e.src=g}):e(),h?h.promise(g):g}}(jQuery)
;function JsonServiceClient(a){this.baseSyncReplyUri=Path.combine(a,"Json/SyncReply"),this.baseAsyncOneWayUri=Path.combine(a,"Json/AsyncOneWay")}JsonServiceClient.prototype.send=function(a,b,c,d,e){var f=new Date,g=Path.combine(this.baseSyncReplyUri,a),h=JsonServiceClient.id++,i={type:"GET",url:g,data:b,dataType:"json",success:function(e){var g=new Date,i=g.getTime()-f.getTime();if(!e){c&&c(null);return}var j=JsonServiceClient.parseResponseStatus_(e.ResponseStatus);j.isSuccess?(c&&c(e),JsonServiceClient.onSuccess({id:h,webMethod:a,request:b,response:e,durationMs:i})):(d&&d(j),JsonServiceClient.onError({id:h,webMethod:a,request:b,error:j,durationMs:i}))},error:function(c,e,g){var i=new Date,j=i.getTime()-f.getTime();try{var k=c.responseText;try{k=JsonServiceClient.parseJSON(k)}catch(l){}d&&d(k)}catch(l){}JsonServiceClient.onError({id:h,webMethod:a,request:b,error:c.responseText,durationMs:j})}};for(var j in e)i[j]=e[j];var k=JsonServiceClient.ajax(i)},JsonServiceClient.prototype.getFromService=function(a,b,c,d){var e=document.all?{cache:!1}:null;this.send(a,b,c,d,e)},JsonServiceClient.prototype.postFormDataToService=function(a,b,c,d){this.send(a,b,c,d,{type:"POST"})},JsonServiceClient.prototype.postToService=function(a,b,c,d){var e=JsonServiceClient.toJSON(b);this.send(a,e,c,d,{type:"POST",processData:!1,contentType:"application/json; charset=utf-8"})},JsonServiceClient.prototype.putToService=function(a,b,c,d){var e=JsonServiceClient.toJSON(b);this.send(a,e,c,d,{type:"PUT",processData:!1,contentType:"application/json; charset=utf-8"})},JsonServiceClient.prototype.deleteFromService=function(a,b,c,d){var e=JsonServiceClient.toJSON(b);this.send(a,e,c,d,{type:"DELETE",processData:!1,contentType:"application/json; charset=utf-8"})},JsonServiceClient.id=0,JsonServiceClient.onError=function(){},JsonServiceClient.onSuccess=function(){},JsonServiceClient.parseResponseStatus_=function(a){if(!a)return{isSuccess:!0};var b={isSuccess:a.ErrorCode===undefined||a.ErrorCode===null,errorCode:a.ErrorCode,message:a.Message,errorMessage:a.ErrorMessage,stackTrace:a.StackTrace,fieldErrors:[],fieldErrorMap:{}};if(a.FieldErrors)for(var c=0,d=a.FieldErrors.length;c<d;c++){var e=a.FieldErrors[c],f={errorCode:e.ErrorCode,fieldName:e.FieldName,errorMessage:e.ErrorMessage||""};b.fieldErrors.push(f),f.fieldName&&(b.fieldErrorMap[f.fieldName]=f)}return b},JsonServiceClient.toJsonDate=function(a){var b=is.Date(a)?a:new Date(a)},JsonServiceClient.parseJSON=function(a){if(typeof JSON=="object"&&JSON.parse)return JSON.parse(a);if($&&$.parseJSON)return $.parseJSON(a);if(goog&&goog.json)return goog.json.parse(a);throw"no json parser found"},JsonServiceClient.toJSON=function(a){if(typeof JSON=="object"&&JSON.stringify)return JSON.stringify(a);if($&&$.toJSON)return $.toJSON(a);if(goog&&goog.json)return goog.json.serialize(a);throw"no json serializer found"},JsonServiceClient.ajax=function(a){if($&&$.ajax)return $.ajax(a);throw"no ajax provider found"};var is={Null:function(a){return a===null},Undefined:function(a){return a===undefined},Empty:function(a){return a===null||a===undefined||a===""},Function:function(a){return typeof a=="function"?a.constructor.toString().match(/Function/)!==null:!1},String:function(a){return a===null||a===undefined||a.type?!1:typeof a=="string"?!0:typeof a=="object"?a.constructor.toString().match(/string/i)!==null:!1},Array:function(a){return is.Empty(a)||a.type?!1:typeof a=="object"?a.constructor.toString().match(/array/i)!==null||a.length!==undefined:!1},Boolean:function(a){return is.Empty(a)||a.type?!1:typeof a=="boolean"?!0:typeof a=="object"?a.constructor.toString().match(/boolean/i)!==null:!1},Date:function(a){return is.Empty(a)||a.type?!1:typeof a=="date"?!0:typeof a=="object"?a.constructor.toString().match(/date/i)!==null:!1},Number:function(a){return is.Empty(a)||a.type?!1:typeof a=="number"?!0:typeof a=="object"?a.constructor.toString().match(/Number/)!==null:!1},ValueType:function(a){return is.Empty(a)||a.type?!1:is.String(a)||is.Date(a)||is.Number(a)||is.Boolean(a)}},S={};S.rtrim=function(a,b){return b=b||"\\s",a.replace(new RegExp("["+b+"]+$","g"),"")},S.toString=function(){if(arguments.length==0||!arguments[0])return null;var a="";for(var b=0;b<arguments.length;b++){var c=arguments[b];a&&(a+="/");if(is.String(c))a+=c;else if(is.ValueType(c))a+=c.toString();else if(is.Array(c))a+="["+A.join(c,",")+"]";else{var d="";for(var e in c)d&&(d+=","),d+=e+":"+S.safeString(c[e]);a+="{"+d+"}"}}return a},S.safeString=function(a){return a?S.containsAny(a,["[","]","{","}",","])?'"'+a+'"':a:a},S.containsAny=function(a,b){if(!is.String(a))return;for(var c=0,d=b.length;c<d;c++)if(a.indexOf(b[c])!=-1)return!0;return!1},S.startsWith=function(a,b){return!a||!b?!1:a.lastIndexOf(b,0)==0},S.pad=function(a,b,c,d){var c=c||(d?" ":"0");a=a.toString();while(a.length<b)a=d?a+c:c+a;return a},S.padLeft=function(a,b,c){return S.pad(a,b,c,!1)},S.padRight=function(a,b,c){return S.pad(a,b,c,!0)},S.lpad=S.padLeft,S.rpad=S.padRight;var A={};A.each=function(a,b){if(!a)return;for(var c=0,d=a.length;c<d;c++)b(a[c])},A.convertAll=function(a,b){var c=[];for(var d=0,e=a.length;d<e;d++)c[d]=b(a[d]);return c},A.join=function(a,b){var c="";b=b||",";for(var d=0,e=a.length;d<e;d++)c&&(c+=b),c+=a[d];return c},A.toTable=function(a,b){b=b||{};var c=[],d=[];for(var e=0,f=a.length;e<f;e++){var g=a[e];if(!g)continue;if(e==0){d.push("<table><thead><tr>");for(var h in g)c.push(h),d.push("<th>"+h+"</th>");d.push("</tr></thead><tbody>")}d.push("<tr>");for(var i=0,j=c.length;i<j;i++){var h=c[i],k=b[h]?b[h](g[h]):Dto.formatValue(g[h]);d.push("<td>"+k+"</td>")}d.push("</tr>")}return d.push("</tbody></table>"),d.join("")};var O={};O.keys=function(a){var b=[];for(var c in a)b.push(c);return b};var Path={};Path.combine=function(){var a="";for(var b=0,c=arguments.length;b<c;b++)a.length>0&&(a+="/"),a+=S.rtrim(arguments[b],"/");return a},Path.getFirstArg=function(a){return a?a.split("/")[0]:null},Path.getFirstValue=function(a){return!a||a.indexOf("/")==-1?null:a.substr(a.indexOf("/")+1)},Path.getArgs=function(a){return a?a.split("/"):null};var Urn={};Urn.toId=function(a){return a.replace(/:/g,"_")},Urn.getIdValue=function(a){return a.split(":")[2]},Urn.fromId=function(a){return a.replace(/_/g,":")};var Dto={};Dto.toArray=function(a){return is.Array(a)?S.toString(a):"["+S.toString(a)+"]"},Dto.toUtcDate=function(a){return a.getUTCFullYear()+"-"+S.lpad(a.getUTCMonth()+1,2)+"-"+S.lpad(a.getUTCDate(),2)+"T"+S.lpad(a.getUTCHours(),2)+":"+S.lpad(a.getUTCMinutes(),2)+":"+S.lpad(a.getUTCSeconds(),2)+"Z"},Dto.isJsonDate=function(a){return is.String(a)?S.startsWith(a,Dto.WcfDatePrefix):!1},Dto.WcfDatePrefix="/Date(",Dto.toJsonDate=function(a){return a=Dto.parseJsonDate(a),Dto.WcfDatePrefix+a.getTime()+"+0000)/"},Dto.parseJsonDate=function(a){return is.Date(a)?a:S.startsWith(a,Dto.WcfDatePrefix)?new Date(parseInt(a.substring(Dto.WcfDatePrefix.length,a.length-2))):new Date(a)},Dto.formatDate=function(a){return a=Dto.parseJsonDate(a),a.getUTCFullYear()+"/"+S.lpad(a.getUTCMonth()+1,2)+"/"+S.lpad(a.getUTCDate(),2)},Dto.formatValue=function(a){return Dto.isJsonDate(a)?Dto.formatDate(a):is.Empty(a)?"":a},Dto.firstToLower=function(a){return a.charAt(0).toLowerCase()+a.slice(1)},Dto.mapToJsObject=function(a){var b={};return $.map(a,function(c,d){_.isArray(a[d])?b[Dto.firstToLower(d)]=$.map(a[d],Dto.mapToJsObject):_.isObject(a[d])?b[Dto.firstToLower(d)]=Dto.mapToJsObject(a[d]):b[Dto.firstToLower(d)]=a[d]}),b}
;(function(a){"use strict";var b={};a.MAT=b})(this)
;(function(a){"use strict",a.MAT.analytics={init:function(){$("[data-tealium-event], [data-tealium-page]").on("click",function(){var a=$(this),b=a.data("tealiumPage"),c=a.attr("tealiumEvent")||a.data("tealiumEvent"),d=document.title,e=a.closest($("[id$=promo]"));if(e&&e.length){var f=$(".row").children().index(e);c="P"+f+" "+c}var g={};return c?(g.event_id=c,g.event_category_id=d):(g.page_id=b,g.category_id=d),g=$.extend({},UTAG_DATA_DEFAULTS,g),utag.track("view",g),a.attr("href")&&setTimeout(function(){window.location=a.attr("href")},500),!1})},trackPage:function(a,b,c){var d={page_id:a,category_id:b};c&&$.extend(d,c),d=$.extend({},UTAG_DATA_DEFAULTS,d),utag.track("view",d)},trackEvent:function(a,b,c){var d={event_id:a,event_category_id:b};c&&$.extend(d,c),d=$.extend({},UTAG_DATA_DEFAULTS,d),utag.track("view",d)},trackAccountAction:function(a,b){var c={registration_id:b,page_id:a,category_id:"SIGNREG",login_most_recent_date_attr38:"",login_site_section_attr40:""};utag.view(c)},trackPlayer:function(a,b){function f(b){var c={Play:"PLAYING",Pause:"PAUSED",Load:"BUFFERING",Complete:""};switch(b.newstate){case c.Play:var e=a.getDuration(),f=a.getPosition();d&&b.oldstate==c.Load&&(g("Launch",e,f),g("Play",e,f),d=!1);default:}}function g(b,d,f){var g={event_id:e,event_category_id:"video",event_action_type:b,event_action_attr46:_.indexOf(c,b)+"",event_detail_sub_attr48:a.id,event_length_attr49:f+"",event_length_full_attr50:d+""};utag.view(g)}function h(b){var c=a.getDuration(),d=a.getPosition();g(b,c,d)}function i(){var a=SITE_LOCALE.split("-");return a[a.length-1].toUpperCase()}var c=["Launch","Pause","Play","Completion"],d=!0,e=i()+": "+b;VIDEOS.youtube?(a.logStateChange=function(a){f(a)},a.logGenericEvent=function(a){h(a)}):(a.onPlay(f),a.onPause(function(a){h("Pause")}),a.onComplete(function(a){h("Completion")}))},whenTealiumIsReady:function(a){window.isTealiumSDKReady?a():$(window).on("tealiumSDK:loaded",a)}}})(this)
;(function(a){function b(){if(b.prototype._singletonInstance)return b.prototype._singletonInstance;b.prototype._singletonInstance=this}"use strict",b.prototype.init=function(){if(!a.SITE.user){console.log("Cannot initialize bunchball singleton without SITE.user");return}this.bindEvents()},b.prototype.bindEvents=function(){$(document).on("click","[data-bunchball-action]",function(b){a.SITE.user.logAction($(b.currentTarget).attr("data-bunchball-action"))})},a.MAT.bunchball=new b})(this)
;(function(a){"use strict",a.MAT.mixins={kineticHelpers:{makeKineticImageAssets:function(a,b){if(typeof a!="object"&&a instanceof Image==0)return console.log("no image assets to convert, or imageList not an iterable"),!1;var c=this,d=c.$self,e=typeof a=="string"?undefined:a instanceof Array?[]:{},f={};return b=_.extend(f,b),a instanceof Image?(b.image=a,e=new Kinetic.Image(b)):_.each(a,function(a,c){if(a instanceof Image==0){console.log("Asset is not an instance of an Image, stopping.");return}b.image=a,e[c]=new Kinetic.Image(b)}),e},appendTo:function(a){var b=this;if(!a instanceof Kinetic.Layer||!a instanceof Kinetic.Group||!a instanceof Kinetic.Stage)throw new Error("Container must be an instance of Kinetic.Layer, Kinetic.Group or Kinetic.Stage.");if(!b._kineticAssetToAppend)throw new Error("Object has no kinetic asset to append.");a.add(b._kineticAssetToAppend)},getDimensions:function(a){var b=this,c=0,d=0,e=0,f=0;if(a instanceof Kinetic.Group==0&&a instanceof Kinetic.Layer==0&&a instanceof Kinetic.Stage==0)throw new Error("getDimensions is only for kinetic containers (group, layer, stage)");return _.each(a.children,function(a){var b=a.getPosition(),g=a.getSize(),h=b.x,i=b.y,j=g.width,k=g.height;c=h<c?h:c,e=i<e?i:e,d=h+j>d?h+j:d,f=i+k>f?i+k:f}),{width:d-c,height:f-e}}},imageHelpers:{loadImageAssets:function(a,b){function i(a,i){var j,k=!1;j=new Image,b.crossorigin===!0&&j.setAttribute("crossorigin","anonymous"),j.onload=function(){k=!0,g+=1,c.publish("imageAssetLoaded",e,j,a),(i===undefined||g===f)&&c.publish("allImageAssetsLoaded",e,j,a)},j.src=d+a,i===undefined?h=j:h[i]=j}b=b||{};if(typeof a!="object"&&typeof a!="string")return console.log("imageAssets either is not defined or cannot be parsed. Firing imageAssetLoaded anyway."),console.log(a),this.publish("imageAssetLoaded",b.asyncId),this.publish("allImageAssetsLoaded",b.asyncId),!1;var c=this,d=b.baseUrl||"",e=b.asyncId,f=0,g=0,h=typeof a=="string"?undefined:a instanceof Array?[]:{};return f=function(){var b=0;return typeof a!="string"?_.each(a,function(c,d){c&&c.length!==0?b+=1:a instanceof Array?a.splice(d,1):delete a[d]}):b=1,b}(),typeof a=="string"?i(a):_.each(a,function(a,b){i(a,b)}),h}},localStorageHelpers:{setLocal:function(b,c){var d=this,e=d.settings?d.settings.storagePrefix||"":"";if(a.store.enabled===!0)return store.set(e+b,c);console.warn("localStorage is disabled!")},getLocal:function(a){var b=this,c=b.settings?b.settings.storagePrefix||"":"",d;return a===undefined?(d={},_.each(store.getAll(),function(a,b){b.indexOf(c)===0&&(d[b]=a)}),d):store.get(c+a)}},pubSub:{publish:function(a){if(typeof a!="string")throw new Error("You must provide a valid topic to publish.");var b=this,c=[].slice,d=c.call(arguments,1),e=b.subscriptions=b.subscriptions||{},f,g,h,i=0,j;if(!e[a])return!0;f=e[a].slice();for(h=f.length;i<h;i+=1){g=f[i],j=g.callback.apply(g.context,d);if(j===!1)break}return j!==!1},subscribe:function(a,b,c,d){if(typeof a!="string")throw new Error("You must provide a valid topic to create a subscription.");arguments.length===3&&typeof c=="number"&&(d=c,c=b,b=null),arguments.length===2&&(c=b,b=null),d=d||10;var e=this,f=0,g=a.split(/\s/),h=g.length,i,j=e.subscriptions=e.subscriptions||{},k,l;for(f;f<h;f+=1){a=g[f],i=!1,j[a]||(j[a]=[]),k=j[a].length-1,l={callback:c,context:b,priority:d};for(k;k>=0;k-=1)if(j[a][k].priority<=d){j[a].splice(k+1,0,l),i=!0;break}i||j[a].unshift(l)}return c},unsubscribe:function(a,b){var c=this,d=c.subscriptions=c.subscriptions||{},e,f=0;if(typeof a!="string")throw new Error("You must provide a valid topic to remove a subscription.");if(!d[a]){console.log("no subscriptions of topic: "+a);return}e=d[a].length;for(f;f<e;f+=1)if(d[a][f].callback===b){d[a].splice(f,1);break}},subscribeOnce:function(a,b,c,d){function f(){var d=[].slice;typeof c=="function"&&c.apply(b,arguments),e.unsubscribe(a,f)}var e=this;if(typeof a!="string")throw new Error("You must provide a valid topic to create a subscription.");arguments.length===3&&typeof c=="number"&&(d=c,c=b,b=null),arguments.length===2&&(c=b,b=null),e.subscribe(a,b,f,d)},ready:function(){var a=this,b=!1;a.subscribe("ready",function(){b=!0}),a.ready=function(c){b?c():a.subscribeOnce("ready",function(){c()})}}},textHelpers:{initialCaps:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},firstToLower:function(a){return a.charAt(0).toLowerCase()+a.slice(1)}}}})(this)
;(function(a){"use strict",a.MAT.translationParser=function(a){a=a instanceof jQuery?a:$(a);var b={};return a.children().each(function(){var a=$(this);a.attr("data-name")&&(b[a.attr("data-name")]=a.html())}),b}})(this)
;(function(a){"use strict";var b=function(){};b.prototype.load=function(a){function f(a){_.each(a,function(a,b){var d,e;if(b==="settings")return;switch(typeof a){case"string":c+=1;break;case"object":f(a)}})}function g(a,c){var d={};return c=c||{},a.settings&&(c=_.extend(c,a.settings)),_.each(a,function(a,e){if(e==="settings")return;switch(typeof a){case"string":d[e]=b.loadImageAssets(a,c);break;case"object":d[e]=g(a,c)}}),d}var b=this,c=0,d=0,e={};if(!a)throw new Error("I require an image manifest.");if(typeof a=="Array"&&a.length===0){b.publish("complete",e);return}b.subscribe("imageAssetLoaded",function(a){d+=1,b.publish("imageLoaded",c,d),d===c&&b.publish("complete",e)}),f(a),b.publish("imagesCounted",c),e=g(a)},_.extend(b.prototype,a.MAT.mixins.pubSub,a.MAT.mixins.imageHelpers),a.MAT.Preloader=b})(this)
;(function(a){"use strict",a.MAT.decorators={waitForInaction:function(b,c){function e(){var e=this,f=arguments;d&&a.clearTimeout(d),d=a.setTimeout(function(){b.apply(e,f)},c)}var d;return e},preventClickSpam:function(b,c){function f(){var f=this,g=arguments;if(e)return;b.apply(f,g),e=!0,d=a.setTimeout(function(){e=!1,a.clearTimeout(d)},c)}var d,e=!1;return f}}})(this)
;(function(a){"use strict",a.MAT.eventNames={actionDown:Modernizr.touch?"touchstart":"mousedown",actionUp:Modernizr.touch?"touchend":"mouseup",actionMove:Modernizr.touch?"touchmove":"mousemove"}})(this)
;(function(a){"use strict";var b,c=!0,d=c?"callback":"jsCallback";b={connectionParams:{apiKey:"91fd5b51c1cb4fa284d160f6ec94de7b",server:BUNCHBALL_API_URL},callAPI:function(a,b,c){var e=this;$.ajax({url:e.connectionParams.server+"/bunchball",dataType:"jsonp",type:"GET",jsonp:d,data:a,success:function(a,c,d){typeof b=="function"&&(a=e.mapToJsObject(a),b(a,c,d))},error:function(a,b,d){typeof c=="function"&&c(a,b,d)}})},callProxyAPI:function(a,b,c){function f(a,b){console.log("error:"),console.log(a),typeof c=="function"&&c(a)}function g(c){if(c.ResponseStatus&&c.ResponseStatus.Message||c.errorCode){console.warn("Error with Bunchball Endpoint: "+a.endPoint);return}typeof b=="function"&&b(c)}var d=this,e;e={type:"GET",data:{},callbackError:f,endPoint:"/"},a=$.extend(e,a),a.endPoint.substr(0,1)==="/"&&(a.endPoint=a.endPoint.substr(1,a.endPoint.length)),$.ajax({url:"/api/"+a.endPoint,type:a.type,data:a.data,success:g,error:f})},batchRun:function(b,c,d){function g(a){typeof d=="function"&&d(a)}function h(a){a=e.mapToJsObject(a),typeof c=="function"&&c(a)}var e=this,f=[];if(b instanceof Array==0)throw new Error("batchRun requires an array of request objects.");_.each(b,function(a){f.push(e.makeUrlParams(a))}),a.MAT.nitro.callAPI({method:"batch.run",methodFeed:JSON.stringify(f)},h,g)},makeUrlParams:function(a){var b="",c;return _.each(a,function(a,c){b!==""&&(b+="&"),b+=c+"="+a}),encodeURI(b)},mapToJsObject:function(b){var c={};return typeof b!="object"?b:($.map(b,function(d,e){var f=a.MAT.nitro;_.isArray(b[e])?c[f.firstToLower(e)]=$.map(b[e],f.mapToJsObject):_.isObject(b[e])?c[f.firstToLower(e)]=f.mapToJsObject(b[e]):c[f.firstToLower(e)]=b[e]}),c)}},c&&(b.connectionParams.server="/api"),_.extend(b,a.MAT.mixins.textHelpers),a.MAT.nitro=b})(this)
;(function(a){"use strict";var b=window.Avatar,c,d;c=function(a){var b=this;b.settings=a||{}},c.prototype.fetch=function(){var a=this,b=a.settings.url;if(a.settings.url!==undefined)$.ajax(b,{dataType:"json",complete:function(a,b){},success:function(b,c,d){return a.data=b,a.publish("fetchSuccess",b),b},error:function(b,c,d){return console.log("fetch failed. Error: "+d),a.data={error:d},a.data}});else return{error:"no url specified."}},_.extend(c.prototype,a.MAT.mixins.pubSub),a.MAT.Model=c})(this)
;(function(a){"use strict";if(a.MAT.Model===undefined)throw new Error("sliderModel requires Model");var b;b=function(a){var b=this;b.settings=a||{},b.data=a.data,delete b.settings.data},_.extend(b.prototype,a.MAT.Model.prototype),a.MAT.SliderModel=b})(this)
;(function(a){"use strict";var b=function(b){var c=this;if(b===undefined||b instanceof a.MAT.User==0)throw new Error("user agrument must be an instance of User.");c._preferences={},c.user=b};b.prototype.update=function(a){var b=this;b._preferences=a},b.prototype.save=function(b,c,d){function g(a){console.warn("Error setting preference: "),console.warn(a),typeof d=="function"&&d(b,a),e.publish("save:error",b,a)}function h(a){typeof c=="function"&&c(a),e.publish("save:success",b)}function i(a){e.batchRun(a)}var e=this,f=e._preferences;f[b]===undefined&&console.warn("key does not exist, cannot save."),a.MAT.nitro.callProxyAPI({endPoint:"user/preferences",data:{name:b,value:f[b]},type:"POST"},h,g)},b.prototype.set=function(a,b){var c=this;if(typeof a=="string"){c._preferences[a]=b,c.publish("preferenceSet",a,b);return}if(typeof a=="object"){_.each(a,function(a,b){c._preferences[b]=a,c.publish("preferenceSet",b,a)});return}},b.prototype.get=function(a){function d(a){var b;if(typeof a!="string")return b;if(a.indexOf("{")===0||a.indexOf("[")===0)try{b=JSON.parse(a)}catch(c){b=a}else b=a;return b}var b=this,c;if(b._preferences[a]===undefined)return;return a===undefined?(_.each(b._preferences,function(a,b){c[b]=d(a)}),c):a instanceof Array?(_.each(a,function(a){c.push(d(b._preferences[a]))}),c):(c=d(b._preferences[a]),typeof c=="object"&&c.pSet!==undefined&&(c=b.getUserPreferenceSet(a,b._preferences)),c)},b.prototype.createUserPreferenceSet=function(a,b){function f(b){function j(b,c){var e={pSet:b};return c&&(e.more=a+"_"+(d+1)),e}var e,g,h=[],i=a+(d===0?"":"_"+d);g=JSON.stringify(j(b));while(g.length+i.length>128)h.push(b.pop()),g=JSON.stringify(j(b,!0));c[i]=g,h.length>0&&(d+=1,f(h.reverse()))}var c={},d=0,e=128;if(b instanceof Array==0){console.warn("This method currently only supports arrays!");return}return _.each(b,function(c){var d={pSet:c,more:a+"_"+b.length};if(JSON.stringify(d).length>e)throw new Error("Individual preference item needs to be shorter.");return!1}),f(_.clone(b)),c},b.prototype.getUserPreferenceSet=function(a,b){function d(a){if(typeof a=="string"&&(a.indexOf("[")===0||a.indexOf("{")===0))try{a=JSON.parse(a)}catch(e){return a}a.pSet&&_.isArray(a.pSet)?c=c.concat(a.pSet):(console.warn("Preference set is not an array, and cannot be concatenated:"),console.log(a)),a.more&&d(b[a.more])}var c=[];if(!b)throw new Error("getUserPreferenceSet requires an object of source preferences.");if(!b[a])return;return d(b[a]),c},_.extend(b.prototype,a.MAT.mixins.pubSub),a.MAT.PreferenceCollection=b})(this)
;(function(a){"use strict";if(a.MAT.nitro===undefined)throw new Error("MAT.User requires MAT.nitro.");if(a.store===undefined)throw new Error("MAT.User requires store.js");var b,c=a.store;b=function(){var a=this;a.settings={storagePrefix:"user.",catalogs:{avatar:{catalogName:"MAT_AVATAR",avatarInstanceName:"avatar"},dormRoom:{catalogName:"DORM_ROOM",canvasInstanceName:"dormRoom"}},pointMap:{points:"Gold Charms",bigPoints:"Gem Charms"}},a.ready(),a.persistence=a.persistence(a),a.attrs={},a.setAttr("loggedIn",!1)},b.prototype.init=function(){function c(a){console.log("Error retreiving user session!"),console.log(a),b.setAttr("loggedIn",!1),b.publish("notLoggedIn"),b.publish("user:initialized")}function d(a){a.userName&&a.sessionKey?(b.setAttr("userID",a.userName),b.setAttr("sessionKey",a.sessionKey),b.setAttr("loggedIn",!0),b.publish("login:success",a.userName,a.sessionKey)):c(a)}var b=this;b.subscribeOnce("userAttributesUpdated",function(){b.publish("ready"),b.publish("user:initialized")}),b.subscribe("login:success",function(){b.getUserAttributes()}),window.USER_LOGGED_IN?a.MAT.nitro.callProxyAPI({endPoint:"/user/info/"},d,c):c("Not Logged In.")},b.prototype.getActions=function(){function e(c){a.MAT.mixins.localStorageHelpers.setLocal("bunchballActions:"+b.attrs.userID,{val:c,exp:864e5,time:(new Date).getTime()}),b.setAttr("actions",c)}function f(){a.MAT.nitro.callProxyAPI({endPoint:"/site/action"},e)}var b=this,d=c.get("bunchballActions:"+b.attrs.userID);if(d)if((new Date).getTime()-d.time>d.exp)f();else{b.setAttr("actions",d.val);return}else f()},b.prototype.getUserAttributes=function(){function c(a){if(a.errorCode||!a.siteLevel||!a.alliance||!a.avatarItems||!a.points||!a.ownedItems){console.warn("Error retreiving user attrs from proxy api."),console.log(a);return}b.getLevel(a),b.getPoints(a),b.getAlliance(a),b.getOwnedItems(a),b.getAvatarItems(a),b.getPreferences(a),b.getUnlockedStories(),b.publish("getUserAttributes:complete")}function d(a){console.log("error")}var b=this;b.subscribe("getUserAttributes:complete",function(){b.publish("userAttributesUpdated")}),b.getActions(),window.USER_LOGGED_IN&&a.MAT.nitro.callProxyAPI({endPoint:"/user/info/"+b.attrs.userID+"?fields=alliance,avatarItems,level,ownedItems,points,preferences"},c,d)},b.prototype.setAttr=function(a,b){var c=this;if(typeof a=="string"){c.attrs[a]=b,c.publish("attributeSet",a,b);return}if(typeof a=="object"){_.each(a,function(a,b){c.attrs[b]=a,c.publish("attributeSet",b,a)});return}},b.prototype.login=function(b){function d(a){c.publish("login:error")}function e(a){var d=a.sessionKey;d&&(c.attrs.sessionKey=d,c.attrs.userID=b,c.publish("login:success",b,d),c.setAttr("loggedIn",!0))}var c=this;b=b||c.attrs.userID;if(b===undefined)throw new Error("No userName to log in with!");a.MAT.nitro.callProxyAPI({endPoint:"/user/info/"+b},e,d)},b.prototype.logout=function(b){function d(a){a.nitro.res==="ok"?(c.persistence.resetLocal(!0),_.each(c.attrs,function(a,b){delete c.attrs[b]}),c.setAttr("loggedIn",!1),c.publish("logout:success")):c.publish("logout:error")}function e(a,b){console.log("error logging out:"),console.log(a)}var c=this;b=b||c.attrs.userID;if(b===undefined){console.warn("Nobody to log out.");return}a.MAT.nitro.callAPI({method:"user.logout",apiKey:a.MAT.nitro.connectionParams.apiKey,userID:b,sessionKey:c.attrs.sessionKey},d,e)},b.prototype.getInventory=function(b){function f(a){console.warn("getInventory error:"),console.log(a),c.publish("getInventory:complete",b,a)}function g(d){var f;d&&_.isArray(d)&&(c.setAttr(e,new a.MAT.CatalogItemList(d)),c.publish("getInventory:complete",b,d))}var c=this,d="inventory_",e=d+b;b=b||"dormRoom",a.MAT.nitro.callProxyAPI({endPoint:"/user/inventory/"+b},g,f)},b.prototype.getLevel=function(b){function d(a){if(a.errorCode||!a.siteLevel){console.warn("something went wrong retreiving user level!");return}c.setAttr("level",a.siteLevel)}function e(a,b){console.log("error getting user level.")}var c=this;b?d(b):a.MAT.nitro.callProxyAPI({type:"GET",endPoint:"/user/info/"+c.attrs.userID+"?fields=level"},d,e)},b.prototype.getPoints=function(b){function d(a){var b={};if(a.errorCode||!a.points){console.warn("Error retreiving points balance!");return}_.each(a.points,function(a){b[a.shortName]=a}),c.setAttr("points",b)}function e(a,b){console.warn("error getting user Points.")}var c=this;b?d(b):a.MAT.nitro.callProxyAPI({type:"GET",endPoint:"/user/info/"+c.attrs.userID+"?fields=points"},d,e)},b.prototype.getOwnedItems=function(b){function d(a,b){console.warn("error getting owned items:"),console.log(a);return}function e(b){if(!b.ownedItems||b.errorCode){d(b);return}b.ownedItems.length===0&&console.warn("User has no owned items!"),c.setAttr("ownedItems",new a.MAT.CatalogItemList(b.ownedItems))}var c=this;b?e(b):a.MAT.nitro.callAPI({endPoint:"/user/info/"+c.attrs.userID+"?fields=ownedItems"},e,d)},b.prototype.getAvatars=function(b){function d(a){if(!a.nitro||a.nitro.res!=="ok"){console.warn("Error retreiving avatars!"),console.log(a.nitro.Error);return}a.nitro.UserCatalogInstance===undefined&&console.log("this user does not have an avatar!")}function e(a){console.warn("error retreiving user avatars.")}var c=this;if(!c.settings.catalogs.avatar.catalogName)throw new Error("I require a catalogName to get Avatars for.");b?d(b):a.MAT.nitro.callAPI({method:"user.getAvatars",sessionKey:c.attrs.sessionKey,catalogName:c.settings.catalogs.avatar.catalogName})},b.prototype.getChallenges=function(b){function d(a){console.warn("Error retreiving challenges:"),console.log(a)}function e(a){if(!a.challenges||a.errorCode){d(a);return}c.setAttr("challenges",a.challenges)}var c=this;b?e(b):a.MAT.nitro.callProxyAPI({endPoint:"/user/info/"+c.attrs.userID+"?fields=challenges"},e,d)},b.prototype.getAvatarItems=function(b){function d(a){console.log("error getting Avatar Items."),console.log(a)}function e(b){if(!b.avatarItems||b.errorCode){d(b);return}b.avatarItems.length===0&&console.warn("User has no items on their avatar!"),c.setAttr("avatarItems",new a.MAT.CatalogItemList(b.avatarItems))}var c=this;b?e(b):a.MAT.nitro.callProxyAPI({endPoint:"/user/info/"+c.attrs.userID+"?fields=avatarItems"},e,d)},b.prototype.getPreferences=function(b){function d(a){console.warn("Error retreiving preferences!"),console.log(a)}function e(b){if(!b.preferences||b.errorCode){d(b);return}c.attrs.preferences=new a.MAT.PreferenceCollection(c),c.attrs.preferences.update(b.preferences)}var c=this;b?e(b):a.MAT.nitro.callProxyAPI({endPoint:"/user/info/"+c.attrs.userID+"?fields=preferences"},e,d)},b.prototype.getUnlockedStories=function(){function e(a){_.each(a,function(a){a.completionCount>0&&(a.name.indexOf("unlock-")===0&&c.push(a.name.replace(/(-*)\-[^-]+$/,"")),a.name.indexOf("complete-")===0&&d.push(a.name.replace(/(-*)\-[^-]+$/,"")))}),c=_.unique(c),d=_.unique(d),b.setAttr("unlockedStories",c.length-d.length),b.publish("unlockedStories:set")}var b=this,c=[],d=[];a.MAT.nitro.callProxyAPI({endPoint:"user/challenge?folder=stories"},e)},b.prototype.getAlliance=function(b){function i(a){console.warn("Error getting alliance:"),console.log(b)}function j(a){if(!a.alliance||a.errorCode){i(a);return}a.alliance=_.extend(a.alliance,{percentRebel:h,percentRoyal:g}),c.setAttr("alliance",a.alliance)}var c=this,d=parseInt(c.attrs.points.rebel.lifetimeBalance,10),e=parseInt(c.attrs.points.royal.lifetimeBalance,10),f=d+e,g=Math.floor(e/f*100)/100,h=Math.floor(d/f*100)/100;b?j(b):a.MAT.nitro.callProxyAPI({endPoint:"/user/info/"+c.attrs.userID+"?fields=alliance"})},b.prototype.getCanvasItems=function(b,c){function e(a){console.log("error getting Canvas Items:"),console.log(a)}function f(b){var c,f=d.settings.catalogs.dormRoom.catalogName;if(b.nitro){if(b.nitro.res!=="ok"||!b.nitro.canvasRecord){e(b);return}if(!b.nitro.canvasRecord.canvasItems||!b.nitro.canvasRecord.canvasItems.catalogItem){d.setAttr("canvasItems",new a.MAT.CatalogItemList([])),d.publish("getCanvasItems:complete");return}c=b.nitro.canvasRecord.canvasItems.catalogItem;if(c)c instanceof Array==0&&(c=[c]),d.setAttr("canvasItems",new a.MAT.CatalogItemList(c)),d.publish("getCanvasItems:complete");else{e(b);return}return}if(b.errorCode){e(b);return}d.setAttr("canvasItems",new a.MAT.CatalogItemList(b)),d.publish("getCanvasItems:complete")}var d=this;c?f(c):a.MAT.nitro.callProxyAPI({endPoint:"/user/canvas/"},f,e)},b.prototype.placeItemOnAvatar=function(b,c,d){function g(a){a.nitro.res!=="ok"&&(console.warn("error placing item: "+f),console.log(e.getOwnedItemsByCatalogId(f)),console.log(a),d(a)),console.log("placed item: "+f),c(a)}function h(a){console.warn("error placing item: "+f),d(a)}var e=this,f=b.catalogItemId;c=c||function(){},d=d||function(){},a.MAT.nitro.callAPI({method:"user.placeAvatarItem",itemId:f,sessionKey:e.attrs.sessionKey,instanceName:e.settings.catalogs.avatar.avatarInstanceName},g,h)},b.prototype.removeItemOnAvatar=function(b,c,d){function g(a){a.nitro.res!=="ok"?(console.warn("error placing item: "+f),console.log(a),d(a)):(console.log("removed item: "+f),c(a))}function h(a){console.warn("error removing item: "+f),d(a)}var e=this,f=b.catalogItemId;c=c||function(){},d=d||function(){},a.MAT.nitro.callAPI({method:"user.removeAvatarItem",itemId:f,sessionKey:e.attrs.sessionKey,instanceName:e.settings.catalogs.avatar.avatarInstanceName},g,h)},b.prototype.swapItemOnAvatar=function(b,c,d,e){function j(a){console.log("error swapping: "),console.log(a),e(a)}function k(a){a.nitro.res==="ok"?(_.each(a.nitro.nitro,function(a){if(a.res!=="ok"){switch(a.method){case"user.removeAvatarItem":console.warn("error removing avatar item"),console.log(a);break;case"user.placeAvatarItem":console.warn("error placing avatar item"),console.log(a)}g=!0}}),g===!0&&e(a)):e(a)}var f=this,g=!1,h=b.catalogItemId,i=c.catalogItemId;d=d||function(){},e=e||function(){},a.MAT.nitro.batchRun([{method:"user.removeAvatarItem",itemId:i,sessionKey:f.attrs.sessionKey,instanceName:f.settings.catalogs.avatar.avatarInstanceName},{method:"user.placeAvatarItem",itemId:h,sessionKey:f.attrs.sessionKey,instanceName:f.settings.catalogs.avatar.avatarInstanceName}],k,j)},b.prototype.setTendency=function(a){var b=this;a&&(a=Math.abs(a)<=1?a:a>0?1:-1,b.setAttr("tendency",a),b.publish("tendency:set"))},b.prototype.logAction=function(b,d,e){if(!this.attrs.loggedIn)return;var f=this,g=c.get("bunchballActions:"+f.attrs.userID),h=_.where(g.val,{name:b})[0]||{},i=f.updateUserAttributes||a.MAT.decorators.preventClickSpam(function(){function b(a){f.getChallenges(a),f.getPoints(a),f.getLevel(a)}function c(a){console.log("logAction: error getting user attributes:"),console.log(a)}a.MAT.nitro.callProxyAPI({endPoint:"/user/info/"+f.attrs.userID+"?fields=challenges,level,points"},b,c)},3e4);f.updateUserAttributes===undefined&&(f.updateUserAttributes=i);if(!h.name)return;if(h.logged)return;h.rateLimit>=86400&&(h.logged=!0,a.MAT.mixins.localStorageHelpers.setLocal("bunchballActions:"+f.attrs.userID,g),f.attrs.actions=g.val);var j=function(c){typeof d=="function"&&d(c),setTimeout(function(){a.SITE.nitro.showPendingNotifications("notificationsCallback"),i(),f.publish("logAction:complete",b)},3e3)},k=function(a){typeof e=="function"&&e(),console.log("There was an error logging the action "+b)};a.MAT.nitro.callProxyAPI({endPoint:"/user/action/"+b,type:"POST"},j,k)},_.extend(b.prototype,a.MAT.mixins.pubSub),a.MAT.User=b})(this)
;(function(a){"use strict",a.MAT.User.prototype.persistence=function(b){var c;if(b===undefined)throw new Error("Parent User object not defined: persistence will not work.");return c={settings:{storagePrefix:b.settings.storagePrefix},removeLocal:function(a){var b=this;return store.remove(b.settings.storagePrefix+a)},resetLocal:function(a){var b=this,c=b.getLocal("userID"),d=b.attrs;_.each(d,function(a,c){b.removeLocal(c)}),a===!0&&b.setLocal("userID",c)},setLocalPreference:function(a,b){var c=this;c.setLocal("pref_"+a,b)},getLocalPreference:function(a){var c=this,d,e;return a===undefined?(d=c.getLocal(),e={},_.each(d,function(a,c){c.indexOf(b.settings.storagePrefix+"pref_")===0&&(e[c]=a)}),e):c.getLocal("pref_"+a)},removeLocalPreference:function(a){var b=this;b.removeLocal("pref_"+a)}},_.extend(c,a.MAT.mixins.localStorageHelpers),c}})(this)
;(function(a){"use strict";var b=function(a){var b=this;b.settings=a,b.categoryNames=[],b.categories={},b.newTimeSpan=14};b.prototype.init=function(){var b=this;b.spinner=new a.SITE.ui.Spinner(".shop-wrapper > div:first-child"),b.getCatalog(),b.bindEvents()},b.prototype.getCatalog=function(){function c(c){b.catalog=new a.MAT.CatalogItemList(c),b.getAllItems(),b.getCategoryItems(),b.publish("catalogRetrieved"),b.publish("ready"),b.spinner.hide()}function d(a,b){console.warn("error getting catalog.")}var b=this;a.MAT.nitro.callProxyAPI({endPoint:"site/catalog/"+b.settings.catalogName},c,d)},b.prototype.getAllItems=function(){var a=this,b=this.categoryNames,c=[];b.length>0?_.each(b,function(b){c=c.concat(a.filterByCategory(b))}):console.warn("Please provide an array of category names."),a.categories.all=c},b.prototype.getCategoryItems=function(){var a=this,b=this.categoryNames;b.length>0?_.each(b,function(b){var c=a.parseCategory(b);a.categories[b]=a.filterByCategory(c)}):console.warn("Please provide an array of category names.")},b.prototype.parseCategory=function(a){var b,c="--";return a.indexOf(c)>-1?b=a.split(c):b=a,b},b.prototype.filterByCategory=function(a){var b=this,c=b.parseCategory(a),d;return _.isArray(c)?(d=[],_.each(c,function(a){d=d.concat(b.catalog.getItemsByCategory(a,b.settings.catalogName))})):d=b.catalog.getItemsByCategory(a,b.settings.catalogName),d},b.prototype.purchaseItem=function(b){function d(d){var e=c.catalog.getItemById(b,c.settings.catalogName),f=e.price,g=a.SITE.user,h=a.SITE.user.attrs.points;h[e.currencyType].points=h[e.currencyType].points-f,g.setAttr("points",h),g.logAction(e.bunchballAction),g.logAction("buy."+e.alliance+".item"),a.SITE.publish("points:updated",a.SITE.user.attrs.points[e.currencyType].points,e.currencyType)}function e(a,b){console.log("PURCHASE ITEM FAIL"),console.log(a)}var c=this;a.MAT.nitro.callProxyAPI({type:"POST",data:{itemId:b},endPoint:"user/item"},d,e)},b.prototype.checkIfItemNew=function(a){var b=this,c=parseInt(a.createTime,10),d=(new Date).getTime()/1e3,e=Math.round((d-c)/60/60/24);return a.ownedCount===0&&e<=b.newTimeSpan},b.prototype.templates={confirmModal:['<div class="shop-modal">','<div class="col-1-3 shop-modal--2-column__item-image" style="background-image: url(<%= thumbUrl %>);"></div>','<div class="col-2-3 shop-modal--2-column__item-copy">','<h2 class="shop-modal--2-column__item-heading"><%= confirmHeading %></h2>','<hr class="shop-modal--2-column__rule">','<h3 class="shop-modal--2-column__item-price--<%= currencyType %>"><%= price %></h3>','<div><button class="shop-modal--2-column__button sfx-paper" data-itemId="<%= id %>"><%= confirmButton %></button></div>',"</div>","</div>"].join("\n"),NSFModal:['<div class="shop-modal">','<div class="col-1-3 shop-modal--2-column__item-image" style="background-image: url(<%= thumbUrl %>);"></div>','<div class="col-2-3 shop-modal--2-column__item-copy">','<h2 class="shop-modal--2-column__item-heading--nsf"><%= nsfHeading %></h2>','<hr class="shop-modal--2-column__rule">','<h3 class="shop-modal--2-column__item-price--<%= currencyType %>"><%= price %></h3>','<div><button class="shop-modal__button sfx-paper" id="keepShopping"><%= nsfButton %></button></div>',"</div>","</div>"].join("\n"),loginModal:['<div class="shop-modal">','<h2 class="shop-modal--login__heading"><%= heading %></h2>','<hr class="shop-modal--login__rule">','<button class="shop-modal__button sfx-paper" id="shopModalLogin"><%= loginText %></button>','<button class="shop-modal__button sfx-paper" id="shopModalRegister"><%= signUpText %></button>',"</div>"].join("\n")},b.prototype.bindEvents=function(){a.SITE.user.subscribe("attributeSet",function(b){b==="points"&&a.SITE.globalStats.render()})},b.prototype.sizeShelves=function(a,b){$("body").append('<div id="temp-shop-hidden">'),$("#temp-shop-hidden").css({opacity:0,position:"absolute",left:-9999,right:-9999}).append(a);var c=[],d=!1,e=b.funcIsItem3up||function(){return!1},f=b.defaultNumRows||4;return a.find("li").each(function(a){var b=$(this),g=c[c.length-1];g===undefined&&(g=c[c.push([])-1],b.addClass("first")),e(b)&&(d=!0,console.log("item is 3up: "+a+" length: "+g.length),g.length<3&&_.each(g,function(a){a.addClass("up3")})),(d&&g.length<3||d===!1&&g.length<f)&&_.each(g,function(a){var c=a.height(),d=b.height(),e=a.find(".shop-item__thumb").height(),f=b.find(".shop-item__thumb").height();e!==f&&(e<f?a.css("padding-top",f-e):f<e&&b.css("padding-top",e-f)),c!==d&&(c<d?a.css("height",d):d<c&&b.css("height",c))}),d===!0?g.length<3?(b.addClass("up3"),g.push(b)):(console.log("whoa, create new row"),console.log(a),g=c[c.push([])-1],b.addClass("first"),g.push(b),d=e(b),e(b)&&(console.log(">item is 3up"),b.addClass("up3")),console.log(b.attr("class"))):d===!1&&(g.length<f?g.push($(this)):(g=c[c.push([])-1],b.addClass("first"),g.push(b),d=e(b),e(b)&&b.addClass("up3")))}),$("#temp-shop-hidden").remove(),a},_.extend(b.prototype,a.MAT.mixins.pubSub,a.MAT.mixins.bbCatalogHelpers),a.MAT.Shop=b})(this)
;(function(a,b){function c(a,b){var c=this,d={width:492,height:369,storagePrefix:"avatar."};b=_.extend(d,b),c.settings=b,c.sliders=[],c.name=b.name,c.kineticAssets={},c.container=a,c.images={},c.state={},c.ready(),c.saveToImage()}"use strict",c.prototype.init=function(){var a=this;a.bindEvents(),a.initBackground(),a.initEditor()},c.prototype.tearDown=function(){function b(a){_.each(a,function(a){!a instanceof Kinetic.Group||!a instanceof Kinetic.Layer||!a instanceof Kinetic.Image||!a instanceof Kinetic.Rect||!a instanceof Kinetic.Polygon?b(a):a.destroy&&a.destroy()})}var a=this;b(a.kineticAssets),_.each(a.sliders,function(a){a.tearDown()})},c.prototype.initEditor=function(){function e(){var c=_.keys(d.sliders).length,e=0,f=[];b.sliders={},_.each(d.sliders,function(d,g){var h=d,i;b.settings.debug===!0&&_.extend(h,{debug:!0}),i=new a.MAT.AvatarSlider(g,b,h),i.subscribe("slider:initialized",function(a){e+=1,f.push(a),b.publish("avatar:sliderInitialized",e,c),e===c&&(b.setSliderZIndex(),b.fixSliderConflicts(),b.publish("ready",b.name))}),i.subscribe("slider:slideUpdated",function(a,c,d){b.publish("avatar:buildChanged",a,c,d)}),i.init(),b.sliders[g]=i})}var b=this,c=b.container,d=b.settings;b.kineticAssets.groups={front:new Kinetic.Group({width:d.width,height:d.width}),back:new Kinetic.Group({width:d.width,height:d.width}),middle:new Kinetic.Group({width:d.width,height:d.width}),events:new Kinetic.Group({width:d.width,height:d.width})},b.kineticAssets.layers={},typeof c=="string"?(c=b.container=new Kinetic.Stage({container:c,width:d.width,height:d.height,x:0,y:0}),c.add(b.kineticAssets.groups.back),c.add(b.kineticAssets.groups.middle),c.add(b.kineticAssets.groups.front),c.add(b.kineticAssets.groups.events)):(c.add(b.kineticAssets.groups.back),c.add(b.kineticAssets.groups.middle),c.add(b.kineticAssets.groups.front),c.add(b.kineticAssets.groups.events),b.container=c),e()},c.prototype.initBackground=function(){var a=this,b=a.settings.backgroundImage;a.kineticAssets.backgroundImage=new Kinetic.Image({image:b,x:0,y:0}),a.container.add(a.kineticAssets.backgroundImage),a.kineticAssets.backgroundImage.moveToBottom()},c.prototype.setSliderZIndex=function(){var a=this,b=a.kineticAssets.groups.events,c=["hats","hair","eyes","lips","neck_accessory","hand_accessory","capes","tops","bottoms","footwear","leggings","skins"],d=["hats","eyes","lips","neck_accessory","hand_accessory","capes","tops","bottoms","footwear","leggings","skins","hair"],e=["hats","eyes","lips","neck_accessory","hand_accessory","tops","bottoms","footwear","leggings","skins","hair","capes"];_.each(c,function(b){if(a.sliders[b]!==undefined){var c=a.sliders[b];c.slideGroups.front.moveToBottom()}}),_.each(d,function(b){if(a.sliders[b]!==undefined){var c=a.sliders[b];c.slideGroups.back.moveToBottom()}}),_.each(e,function(c){a.sliders[c]!==undefined&&b.get(".event_"+c).each(function(a){a.moveToBottom()})})},c.prototype.saveToImage=function(){this.saveToImage=_.throttle(function(b,c){function k(c){console.log("saving: "+c.name+" to image");var e={callback:function(e){var f=c.toImageSettings,i=f?f.mimeType||"image/png":"image/png",j=i.replace("image/","."),k=e.src.replace("data:"+i+";base64,",""),l,m;if(c.name===undefined)throw new Error("saveToImage requires that all exports have a name property.");l=c.name+"_",m="image_"+c.name,function(){var a=d.getActiveCatalogItems(),b=_.sortBy(_.keys(a),function(a){return a}),c=!0;_.each(b,function(b){c?c=!1:l+="_",l+=a[b]===undefined||a[b]==="empty"?"empty":a[b].catalogItemId}),l+="_v3"+j}(),d.shadowStage.removeChildren(),c.name&&a.SITE.user.setAttr(m,{src:e.src,fileName:l,mimeType:i,storeName:m}),typeof b=="function"&&b(c.name,e),d.publish("saveToImage",c.name,e),h+=1,h===g&&d.container.draw()}};c.toImageSettings&&(e=_.extend(c.toImageSettings,e)),i.toImage(e)}var d=this,e=d.settings,f=e.exports,g=0,h=0,i,j=c?_.find(f,{name:c}):undefined;if(f===undefined)return;g=c?1:f.length,d.kineticAssets.groups.events.setVisible(!1),d.container.draw(),delete d.container.attrs.visible,i=d.container.clone(),d.container.setVisible(!0),i.setVisible(!0),i.setOpacity(1),i.children.each(function(a){a instanceof Kinetic.Group==0&&(a.setVisible(!1),a.draw())}),i.draw(),i.get("Group").each(function(a){a.children.each(function(a){switch(a.getName()){case"active":a.setOpacity(1);break;case"inactive":a.setOpacity(0)}})}),i.draw(),d.shadowStage.removeChildren(),d.shadowStage.add(i),d.shadowStage.draw(),c===undefined?(console.log("itemNameToExport is undefined"),_.each(f,function(a){k(a)})):j!==undefined?(console.log("found one, saving now."),k(j)):console.warn("saveToImage: export item: "+c+" was not found."),d.kineticAssets.groups.events.setVisible(!0),d.container.draw()},2e3)},c.prototype.saveImageToServer=function(a,c,d){var e=this,f=a.imageSource,g=a.fileName,h=a.storeName,i=a.mimeType,j=a.exportName;console.log("===mat.avatar.saveImageToServer==="),console.log(a),f.indexOf("data")===0&&(f=f.replace("data:"+i+";base64,","")),b.ajax({url:"/api/avatar",type:"POST",data:{imageSource:f,fileName:g,exportName:j},dataType:"json",success:function(a){e.publish("saveImageToServer:success",a.imageUrl,h),typeof c=="function"&&c(a.imageUrl,h),e.publish("saveImageToServer:success",a.imageUrl,h)},error:function(a){console.log("save image to server error:"),console.log(a),typeof d=="function"&&d(a),e.publish("saveImageToServer:error")}})},c.prototype.bindEvents=function(){var a=this,b=a.settings;a.subscribe("avatar:buildChanged",function(c,d){a.fixSliderConflicts(c),a.saveState(c,d),b.exports!==undefined&&a.saveToImage(),a.publish("avatar:buildUpdated",a.state)})},c.prototype.fixSliderConflicts=function(a){var b=this;(function c(){if(b.sliders===undefined)return;var c=b.sliders.bottoms,d=b.sliders.tops,e,f,g,h,i;if(c&&d){e=d.activeSlide,f=c.activeSlide;if(!f||!e)return;if(e.catalogItem&&f.id!=="empty")if(e.catalogItem.tags&&e.catalogItem.tags.indexOf("top_long")>-1||e.catalogItem.category&&e.catalogItem.category.indexOf("dresses")>-1)switch(a){case"tops":c.gotoSlide("empty");break;case"bottoms":_.each(d.slides,function(a,b){if(a.catalogItem.tags.indexOf("top_short")>-1)return d.gotoSlide(b),!1;b===d.slides.length-1&&d.gotoSlide("empty")});break;default:c.gotoSlide("empty")}f.id==="empty"&&e.catalogItem&&e.catalogItem.tags&&e.catalogItem.tags.indexOf("top_short")>-1&&(i=0,c.gotoSlide(i))}})()},c.prototype.saveState=function(a,b){var c=this,d={};c.state.lastActiveSlider=a,_.each(c.sliders,function(a){d[a.name]=a.activeSlide}),c.state.activeSlides=d},c.prototype.shadowStage=function(){return b("body").append('<div id="avatarShadowStage" style="display: none;"></div>'),new Kinetic.Stage({container:"avatarShadowStage",width:1024,height:768})}(),c.prototype.hide=function(a){var b=this,c=new Kinetic.Tween({node:b.container,opacity:0,duration:.5,onFinish:function(){b.container.setVisible(!1),b.container.setListening(!1),b.container.drawHit(),b.container.draw(),typeof a=="function"&&a(),b.publish("hidden")}});c.play()},c.prototype.show=function(){var a=this,b=new Kinetic.Tween({node:a.container,opacity:1,duration:.5,onFinish:function(){a.publish("shown")}});a.container.setListening(!0),a.container.setVisible(!0),b.play()},c.prototype.bbCatalogItemsToAvatarItems=function(b,c){var d=this,e=[],f=a.SITE.user,g=f.settings.catalogs.avatar.catalogName,h,i=[],j=f.attrs.avatarItems;if(!b||!c){console.warn("No bbCatalogItems or avatar editor type supplied. Stopping.");return}switch(c){case"look":h={lookFrontUrl:"front",lookBackUrl:"back"};break;case"fashion":h={fashionFrontUrl:"front",fashionBackUrl:"back"}}return _.each(b,function(a){var b={assetUrls:{},catalogItem:a,isActive:!1};_.each(h,function(c,d){b.assetUrls[c]=a[d]}),j&&_.indexOf(i,a.catalogItemId)===-1&&j.getItemsByCatalogItemId(a.catalogItemId,g).length>0&&(i.push(a.catalogItemId),b.isActive=!0),e.push(b)}),e},c.prototype.getActiveCatalogItems=function(){var a=this,b={};return _.each(a.sliders,function(a){b[a.name]=a.getActiveSlide()}),b},_.extend(c.prototype,a.MAT.mixins.pubSub,a.MAT.mixins.imageHelpers,a.MAT.mixins.localStorageHelpers),a.MAT.Avatar=c})(this,jQuery)
;(function(a){function c(a,b,c){var d=this,e=!1,f=0;d.name=a,d._state={activeSlideID:0},d.activeSlideID=0,d.assets=[],d.kineticAssets={},d.avatarKineticAssets=b.kineticAssets,d.avatarContainer=b.container,d.parent=b,d.slideGroups={},d.emptySlide={kineticImages:{},id:"empty"};if(typeof c!="object")throw new Error("settings must be an object, not a "+typeof c);d.settings=c,d.sliderData=c.sliderData||[],delete d.settings.sliderData,_.each(d.sliderData,function(a,b){if(a.isActive===!0)return d.activeSlideID=b,e=!0,!1}),c.allowEmpty&&(f=d.sliderData.push(d.emptySlide)-1,e===!1&&(d.activeSlideID=f))}"use strict";if(a.MAT.Avatar===undefined)throw new Error("MAT.Avatar.Slider requires MAT.Avatar");var b=a.MAT.Avatar;c.prototype.init=function(){var a=this,b=a.$self;a.slides=a.sliderData,a.activeSlide=a.slides[a.activeSlideID],a.slides===undefined||a.slides.length===0?a.initSlider():(a.subscribeOnce("slider:allAssetsLoaded",function(){a.initSlider()}),a.getAllSlideAssets(a.slides))},c.prototype.initSlider=function(){var a=this,b=a.settings,c=a.avatarContainer,d=new Kinetic.Group({name:a.name+"-front",x:b.position.x,y:b.position.y}),e=new Kinetic.Group({name:a.name+"-back",x:b.position.x,y:b.position.y}),f=a.slides,g;a.slideGroups={front:d,back:e},_.each(f,function(b,c){a.initSlide(b,c)}),g=a.findSlidesForStage(),_.each(f,function(b,c){g.indexOf(c)>-1&&a.addSlideToStage(b)}),a.name==="skins"?(a.avatarKineticAssets.groups.middle.add(d),a.avatarKineticAssets.groups.middle.add(e)):(a.avatarKineticAssets.groups.front.add(d),a.avatarKineticAssets.groups.back.add(e)),a.bindEvents(),a.publish("slider:initialized",a.name),c.draw()},c.prototype.initSlide=function(a,b){var c=this;a.catalogItem&&a.catalogItem.name&&_.each(a.kineticImages,function(b){b.attrs.catalogName=a.catalogItem.name}),b===c.activeSlideID&&(c.showSlide(a),_.each(a.kineticImages,function(a){a.setName("active")}),c._state.activeSlideID=c.activeSlideID)},c.prototype.getAllSlideAssets=function(a){if(a===undefined||a.length===0)throw new Error("cannot generate slides, no slides supplied.");var b=this,c=_.keys(a).length,d=0;b.subscribe("allImageAssetsLoaded",function(){d+=1,d===c&&(_.each(a,function(a){a.imageAssets&&(a.kineticImages=b.makeKineticImageAssets(a.imageAssets,{opacity:0}))}),b.publish("slider:allAssetsLoaded",b.name))}),_.each(a,function(a){b.loadSlideAssets(a)})},c.prototype.loadSlideAssets=function(a){if(a.assetUrls===undefined){this.publish("allImageAssetsLoaded");return}var b=this;a.imageAssets=b.loadImageAssets(a.assetUrls)},c.prototype.gotoSlide=function(a,b,c,d){function k(){var a=h==="empty"?e.emptySlide:e.slides[h],d=e._state.activeSlideID==="empty"?e.emptySlide:e.slides[e._state.activeSlideID];b===!0&&(e.activeSlideID=h,e.activeSlide=a,_.each(d.kineticImages,function(a){a.setName("inactive")}),_.each(a.kineticImages,function(a){a.setName("active")})),e._state.activeSlideID=h,c?e.publish("slider:slideChangedQuiet",e.name,h):e.publish("slider:slideChanged",e.name,h)}var e=this,f=e.slides,g=e._state.activeSlideID,h,i="f",j;b=b===!1?!1:!0;if(a===undefined||a===g){e.publish("slider:noSlideChangeNeeded");return}a!=="empty"?(a>f.length-1?h=0:a<0?h=f.length-1:h=a,a>g?i="f":i="r"):a==="empty"&&(h="empty",i="f"),j={direction:i,callback:k,quiet:c,noTransition:d},e.transitionSlide(h,j)},c.prototype.filterSlidesByTag=function(a){var b=this,c=b.filteredSlides||[],d=[],e=!1,f;b.deferredFilter&&(b.unsubscribe("slider:slideChanged",b.deferredFilter),delete b.deferredFilter),a!==undefined?(_.each(c,function(b,e){if(!b)return;if(b.id&&b.id==="empty")return;b.catalogItem&&b.catalogItem.tags.indexOf(a)>-1&&(d.push(b),delete c[e])}),c=_.without(c,undefined),_.each(b.slides,function(d,f){if(!d)return;if(d.id&&d.id==="empty")return;d.catalogItem&&d.catalogItem.tags.indexOf(a)===-1&&(f===b.activeSlideID?e=!0:(c.push(d),delete b.slides[f]))}),b.slides=_.without(b.slides,undefined),_.each(d,function(a){b.slides.push(a)}),e===!0&&(b.deferredFilter=function(){var c=b.activeSlide,d;b.filterSlidesByTag(a),b.unsubscribe("slider:slideChanged",b.deferredFilter)},b.subscribe("slider:slideChanged",b.deferredFilter)),b.filteredSlides=c):(b.slides=b.slides.concat(c),delete b.filteredSlides),b.kineticAssets.hitArea&&(b.kineticAssets.hitArea.setVisible(!0),b.avatarContainer.draw()),_.each(b.slides,function(a,c){if(a===b.activeSlide)return f=c,!1}),b.activeSlideID=f!==-1?f:b.activeSlideID},c.prototype.getNextPrevSlides=function(){var a=this,b=a.$self,c=a._state.activeSlideID,d=a.slides,e=c-1>-1?c-1:d.length-1,f=c+1<d.length?c+1:0,g=d[e],h=d[f];return g===a.activeSlide&&(g=h),h===a.activeSlide&&(h=g),{next:h,prev:g}},c.prototype.showNextPrevOptions=function(a,b){var c=this,d=c.settings.nextPrevOptionPadding||100,e=20,f,g=.6,h=c.settings.position?c.settings.position.x||0:0;c.settings.bringNextPrevOptionsToFront===!0&&c.slideGroups.front.moveToTop();if(a===undefined||b===undefined)f=c.getNextPrevSlides(),a=f.next,b=f.prev;a===b&&(b=_.clone(a),b.isClone=!0,a.kineticImages&&(b.kineticImages={},_.each(a.kineticImages,function(a,c){b.kineticImages[c]=a.clone(),a.parent.add(b.kineticImages[c])}))),c._nextPrevOptions={nextSlide:a,prevSlide:b},c.activeSlide.kineticImages&&_.each(c.activeSlide.kineticImages,function(a){a.setZIndex(0)}),b.kineticImages&&_.each(b.kineticImages,function(a,b){a.setAbsolutePosition({x:h-d,y:a.getAbsolutePosition().y}),a.setOpacity(g)}),_.each(a.kineticImages,function(a,b){a.setAbsolutePosition({x:h+e+d,y:a.getAbsolutePosition().y}),a.setOpacity(g)}),c.avatarContainer.clear(),c.avatarContainer.draw()},c.prototype.hideNextPrevOptions=function(){var a=this,b=a._nextPrevOptions,c=b.nextSlide,d=b.prevSlide,e=100,f=100;a.settings.bringNextPrevOptionsToFront===!0&&a.parent.setSliderZIndex(),d.isClone===!0?_.each(d.kineticImages,function(a,b){a.destroy()}):_.each(d.kineticImages,function(a,b){a.setOpacity(0)}),_.each(c.kineticImages,function(a,b){a.setOpacity(0)}),a.avatarContainer.clear(),a.avatarContainer.draw()},c.prototype.transitionSlide=function(b,c){function p(){var c;j===k&&(a.clearTimeout(c),c=a.setTimeout(function(){d.tidyStage(b),d.isTransitioning=!1,m.call(d)}))}function q(b,c,e){function h(){var b;k+=1,g+=1,p(),g===f&&typeof e=="function"&&(a.clearTimeout(b),a.setTimeout(function(){e.call(d)}))}if(b===undefined||c===undefined)return;var f=_.keys(b.kineticImages).length,g=0;_.each(b.kineticImages,function(a,b){var d=new Kinetic.Tween({node:a,opacity:c,duration:.1,onFinish:h});d.play()})}function r(a,b){var c;_.each(a.kineticImages,function(a,c){a.setOpacity(b),d.avatarContainer.draw(),k+=1,p()})}if(b===undefined)return;var d=this,e=d.slides,f=b==="empty"?d.emptySlide:e[b],g=d._state.activeSlideID==="empty"?d.emptySlide:d.slides[d._state.activeSlideID],h=f.kineticImages?_.keys(f.kineticImages).length:0,i=g&&g.kineticImages?_.keys(g.kineticImages).length:0,j=h+i,k=0,l,m,n,o;c=c||{},l=c.direction,m=c.callback,n=c.quiet,o=c.noTransition,d._state.idsOnStage.indexOf(b)===-1&&d.addSlideToStage(f),l=l||"f",f.kineticImages&&_.each(f.kineticImages,function(a){a.setX(0),a.moveToTop()}),d.isTransitioning=!0,b==="empty"||d.slides[b].id==="empty"?o?r(g,0):q(g,0):o?(r(f,1),r(g,0)):q(f,1,function(){q(g,0)})},c.prototype.nextSlide=function(){var a=this,b=a._state.activeSlideID,c;b==="empty"?c=0:c=b+1,a.gotoSlide(c)},c.prototype.prevSlide=function(){var a=this,b=a._state.activeSlideID,c;b==="empty"?c=0:c=b-1,a.gotoSlide(c)},c.prototype.bindEvents=function(){var a=this,b=a.settings,c=a.avatarContainer,d=c.getStage(),e;if(a._state.eventsBound===!0)return;(function(){function d(b){var d,e={x:b.x,y:b.y,width:b.width,height:b.height,name:"event_"+a.name};return a.settings.debug===!0&&_.extend(e,{fill:"#b4d455",stroke:"black",strokeWidth:1,opacity:.5}),d=new Kinetic.Rect(e),a.avatarKineticAssets.groups.events.add(d),a.kineticAssets.hitArea=d,c.draw(),a.slides.length>1&&(a.settings.activatedBy==="click"?a.bindClick(d):a.bindDrag(d)),d}if(a.settings.activatedBy==="none"||a.settings.activatedBy===!1)return;if(!b.hitArea)return;_.isArray(b.hitArea)?(a.hitArea=[],_.each(b.hitArea,function(b){a.hitArea.push(d(b))})):a.hitArea=d(b.hitArea)})(),a.subscribe("slider:slideChanged",function(b,c){var d=a.activeSlide.catalogItem||"empty";a.publish("slider:slideUpdated",b,c,d)}),a._state.eventsBound=!0},c.prototype.bindDrag=function(a){var b=this,c=b.settings,d=b.avatarContainer,e=d.getStage(),f;Modernizr.touch?a.on("touchstart",_.throttle(function(a){b.isTransitioning||b.bindDragHandleInput("touch")},500)):a.on("mousedown",_.throttle(function(a){b.isTransitioning||b.bindDragHandleInput("mouse")},500))},c.prototype.bindDragHandleInput=function(a){function l(){h=a==="mouse"?e.getMousePosition().x:e.getTouchPosition().x,_.each(j.kineticImages,function(a){a.setX(a.getX()+(h-g))}),_.each(k.kineticImages,function(a){a.setX(a.getX()+(h-g))}),d.batchDraw(),g=h}function m(){b.hideNextPrevOptions(),a==="mouse"?(e.off("mousemove"),e.off("mouseup")):(e.off("touchmove"),e.off("touchend")),h&&(h>f&&b.prevSlide(),h<f&&b.nextSlide())}a=a||"mouse";var b=this,c=b.settings,d=b.avatarContainer,e=d.getStage(),f=a==="mouse"?e.getMousePosition().x:e.getTouchPosition().x,g=f,h,i,j,k;b.showNextPrevOptions(j,k),i=b._nextPrevOptions,j=i.nextSlide,k=i.prevSlide,a==="mouse"?(e.on("mousemove",l),e.on("mouseup",m)):(e.on("touchmove",l),e.on("touchend",m)),d.clear(),d.draw()},c.prototype.bindClick=function(b){var c=this,d=a.MAT.eventNames,e=c.settings.deferToDrag||!1;b.on(d.actionDown,_.throttle(function(a){var f=a.clientX,g=!1,h=!0;b.on(d.actionMove,function(a){Math.abs(a.clientX-f)>10&&e===!0&&(g=!0,c.publish("actionMove",a),b.off(d.actionMove),b.off(d.actionUp))}),b.on(d.actionUp,function(a){(e===!1||e===!0&&g===!1)&&c.nextSlide(),b.off(d.actionMove),b.off(d.actionUp)})},500))},c.prototype.showSlide=function(a){var b=this;if(a===undefined){console.warn(b.name+".showSlide(): slide is undefined!");return}_.each(a.kineticImages,function(a){a.setOpacity(1)}),b.parent.container.draw()},c.prototype.hideSlide=function(a){var b=this;if(a===undefined||a.kineticImages===undefined){console.warn(b.name+".hideSlide(): slide is undefined!");return}_.each(a.kineticImages,function(a){a.setOpacity(0)}),b.parent.container.draw()},c.prototype.getActiveSlide=function(){var a=this,b=a.activeSlide;if(b){if(b.catalogItem!==undefined)return b.catalogItem;if(b.id==="empty")return"empty"}return undefined},c.prototype.tearDown=function(){var a=this;_.each(a.slideGroups,function(a){a.destroy&&a.destroy()})},c.prototype.addSlide=function(a){var b=this;b.slides.push(a)},c.prototype.tidyStage=function(a){var b=this,c=b._state.idsOnStage,d;a=a!==undefined?a:b._state.activeSlideID,d=b.findSlidesForStage(a),_.each(b.slides,function(a,e){d.indexOf(e)>-1?c.indexOf(e)===-1&&b.addSlideToStage(a):b.removeSlideFromStage(a)}),b.avatarContainer.draw()},c.prototype.addSlideToStage=function(a){var b=this,c=b.slideGroups,d=c.back,e=c.front,f=b.slides.indexOf(a),g=!1;b._state.idsOnStage=b._state.idsOnStage||[],a.kineticImages.front&&(e.add(a.kineticImages.front),g=!0),a.kineticImages.back&&(d.add(a.kineticImages.back),g=!0),g===!0&&b._state.idsOnStage.indexOf(f)===-1&&b._state.idsOnStage.push(f)},c.prototype.removeSlideFromStage=function(a){var b=this,c=b.slideGroups,d=b.slides.indexOf(a),e=!1;a.kineticImages.front&&(a.kineticImages.front.remove(),e=!0),a.kineticImages.back&&(a.kineticImages.back.remove(),e=!0),e===!0&&(b._state.idsOnStage=_.without(b._state.idsOnStage,d))},c.prototype.findSlidesForStage=function(a){var b=this,c=b.slides,d,e,f;return a=a!==undefined?a:b._state.activeSlideID,d=b._state.activeSlideID,c=b.slides,e=c[a+1]?a+1:0,f=c[a-1]?a-1:c.length-1,b.slides.length===0?[]:[a,d,e,f]},_.extend(c.prototype,a.MAT.mixins.imageHelpers,a.MAT.mixins.kineticHelpers,a.MAT.mixins.pubSub),a.MAT.AvatarSlider=c})(this)
;(function(a){"use strict",window.ISDEBUGGINGENABLED||(console.log=function(){return"Debugging disabled: See site.js."},console.warn=function(){return"Debugging disabled. See site.js."}),a.SITE={},_.extend(a.SITE,a.MAT.mixins.pubSub)})(this)
;(function(a){"use strict",a.SITE.modernizrTests=function(){Modernizr.addTest("isWindows",function(){return a.navigator.platform&&a.navigator.platform.toLowerCase().indexOf("win")===0}),Modernizr.addTest("isWebkit",function(){return a.navigator.userAgent&&a.navigator.userAgent.toLowerCase().indexOf("webkit")>-1}),Modernizr.addTest("isGecko",function(){var b=a.navigator.userAgent.toLowerCase();return a.navigator.userAgent&&b.indexOf("gecko")>-1&&b.indexOf("webkit")===-1})}()})(this)
;(function(a){"use strict",a.SITE.assetManifest={"Home/Index":["/Static/images/home/parallax/layer0.jpg","/Static/images/home/parallax/layer1.png","/Static/images/home/parallax/layer2.png","/Static/images/home/parallax/layer3.png","/Static/images/home/parallax/layer4.png","/Static/images/home/parallax/mouse.png","/Static/images/home/parallax/maddie.png","/Static/images/home/parallax/briar.png","/Static/images/home/parallax/raven.png","/Static/images/home/parallax/apple.png","/Static/images/home/parallax/bush.png","/Static/images/backgrounds/home-bg.jpg","/Static/images/backgrounds/slider-border.png","/Static/images/backgrounds/mod-chapter.png","/Static/images/backgrounds/mod-generic-promo.png","/Static/images/backgrounds/mod-image-promo.png","/Static/images/home/parallax/layer0.jpg","/Static/images/home/parallax/layer1.png","/Static/images/home/parallax/layer2.png","/Static/images/home/parallax/layer3.png","/Static/images/home/parallax/layer4.png","/Static/images/home/parallax/briar.png","/Static/images/home/parallax/maddie.png","/Static/images/home/parallax/raven.png","/Static/images/home/parallax/apple.png"],"onboarding/Index":["/Static/images/backgrounds/onboarding-page-bg.jpg","/Static/images/backgrounds/onboarding-poll-bg.png","/Static/images/backgrounds/onboarding-code-bg.png","/Static/images/backgrounds/onboarding-code-top-bg.png","/Static/images/backgrounds/onboarding-code-middle-bg.png","/Static/images/backgrounds/onboarding-code-bottom-bg.png"],"Theatre/Index":["/Static/images/videos/video-bg.jpg","/Static/images/backgrounds/bottom-promo-bg.png","/Static/images/videos/video-thumb-bg.png","/Static/images/videos/video-description-bg.jpg","/Static/images/videos/video-title-bg.png"],"bookmark/Index":["/Static/images/bookmark/page-background-royal.jpg","/Static/images/bookmark/page-background-rebel.jpg","/Static/images/bookmark/book.png"],"Chapter/Index":function(){var a=["/Static/images/characters/character-mirror-bg.jpg","/Static/images/characters/card-popup-bg.png"],b=$(".card-image");return _.each(b,function(b){a.push($(b).attr("src")),a.push($(b).data("cardbackimage"))}),a},"bookend/Index":["/Static/images/shops/landing/parallax-shopsLanding_background.jpg","/Static/images/shops/landing/parallax-shopsLanding_foreground.png"],"bookend/fashionshop":["/Static/images/shops/fashion/shopFashion-bg.jpg","/Static/images/shops/fashion/shopFashion-panel-frame.png","/Static/images/shops/fashion/shopFashion-panel-inset.png","/Static/images/shops/fashion/shopFashion-panel-frame.png","/Static/images/shops/fashion/shopFashion-panel-shelf.png","/Static/images/shops/fashion/buttonFashion-hair-sprite.png","/Static/images/shops/fashion/buttonFashion-tops-sprite.png","/Static/images/shops/fashion/buttonFashion-skirts-sprite.png","/Static/images/shops/fashion/buttonFashion-tights-sprite.png","/Static/images/shops/fashion/buttonFashion-shoes-sprite.png","/Static/images/shops/fashion/buttonFashion-accessories-sprite.png","/Static/images/ui/spinner.png"],"bookend/furnishingsshop":["/Static/images/shops/furnishings/shopFurniture-bg.jpg","/Static/images/shops/furnishings/shopFurniture-panel-frame.png","/Static/images/shops/furnishings/shopFurniture-panel-inset.png","/Static/images/shops/furnishings/shopFurniture-panel-frame.png","/Static/images/shops/furnishings/shopFurniture-panel-shelf.png","/Static/images/shops/furnishings/buttonFurniture-wallFloor-sprite.png","/Static/images/shops/furnishings/buttonFurniture-furniture-sprite.png","/Static/images/shops/furnishings/buttonFurniture-decor-sprite.png","/Static/images/ui/spinner.png"]}})(this)
;(function(a){"use strict";if(a.MAT.User===undefined)throw new Error("GAME.user requires MAT.User");a.SITE.user=new a.MAT.User,window.onload=function(){a.SITE.user.init()}})(this)
;(function(a){"use strict",a.SITE.ui={vars:{baseUnit:0,windowWidth:0,windowHeight:0,gutter:0,isNarrow:!1,mobileBreakPoint:479,emBased:$("html").hasClass("em-based-responsive")},state:{isPageRevealed:!1},init:function(){var b=this;b.$window=$(window),b.$body=$("body"),b.$preloader=$(".preloader"),b.$meter=$(".meter"),b.$globalHeader=$(".global-header"),b.$main=$(".main"),b.$footer=$(".global-footer"),b.$placementGrid=$(".grid").eq(0),b.$curtains=$('[class*="curtain"]'),b.$logo=$(".logo"),b.$menu=$(".navigation-main"),b.$window.on("scroll",b.onScroll),b.$window.on("resize",b.onResize),b.$window.on("orientationchange",b.onOrientationChange),b.$window.on("imageLoaded",function(a,c){b.$preloader.find(".percentage").html(Math.floor(c.completed/c.total*100))});if(!SITE.assetManifest||typeof SITE.assetManifest[ROUTE]!="object"&&typeof SITE.assetManifest[ROUTE]!="function")ROUTE!=="dormroom/Index"&&(SITE.ui.revealPage(),$(window).trigger("imagesLoaded"));else{var c=typeof SITE.assetManifest[ROUTE]=="object"?SITE.assetManifest[ROUTE]:SITE.assetManifest[ROUTE]();SITE.ui.loadImages(c,function(){$(window).trigger("imagesLoaded")})}window.scrollTo(0,1),b.setVars(),b.setTendency(),a.SITE.user.subscribe("user:initialized",function(){a.SITE.user.attrs.loggedIn||b.setTendency("neutral")}),a.SITE.user.subscribe("attributeSet",function(){var c=a.SITE.user.attrs.alliance;c&&(c.allianceId===0?b.setTendency("neutral"):c.percentRebel>=.5?b.setTendency("rebel"):c.percentRoyal>=.5?b.setTendency("royal"):c.allianceName.toLowerCase()==="royal"?b.setTendency("royal"):c.allianceName.toLowerCase()==="rebel"?b.setTendency("rebel"):b.setTendency("neutral"))}),a.translations&&a.translations.tooltips&&b.initGenericTooltips(),b.publish("ready")},setTendency:function(b){b=b||store.get("tendency");switch(b){case"rebel":this.$body.removeClass("royal").addClass("rebel"),a.MAT.mixins.localStorageHelpers.setLocal("tendency","rebel");break;case"royal":this.$body.removeClass("rebel").addClass("royal"),a.MAT.mixins.localStorageHelpers.setLocal("tendency","royal");break;default:this.$body.removeClass("rebel").removeClass("royal"),a.MAT.mixins.localStorageHelpers.setLocal("tendency","")}},loadImages:function(a,b){function f(){c.$window.trigger("imageLoaded",{completed:d++,total:a.length}),e()}var c=this,d=1,e=_.after(a.length,function(){typeof b=="function"&&b(),c.revealPage()});c.hidePage(),_.each(a,function(a){var b=new Image;b.onload=f,b.src=a})},hidePage:function(){this.$preloader.appendTo("body").animate({opacity:1},400),this.$curtains.css({width:"50.5%"})},revealPage:function(){var a=this;a.$main.show(),a.$footer.show(),a.$preloader.animate({opacity:0},400,function(){a.$preloader.detach(),a.$window.trigger("resize"),a.$window.trigger("revealPage"),a.state.isPageRevealed=!0})},onOrientationChange:function(a){var b=this;b.$placementGrid.css("display","none"),setTimeout(function(){b.$placementGrid.css("display","block"),b.$window.trigger("resize")},10)},onResize:function(){var a=this,b;a.vars.emBased&&a.$window.width()<1024&&a.$body.css("font-size",a.$window.width()/64+"px"),b=window.setTimeout(function(){a.setVars(),a.positionCurtains(),a.positionNav(),a.onScroll(),window.resizeTo&&clearTimeout(window.resizeTo),window.resizeTo=setTimeout(function(){a.$window.trigger("resizeEnd")},100)},100)},onScroll:function(){var a=this,b,c,d;a.vars.windowWidth<a.vars.mobileBreakPoint||a.vars.windowHeight<a.vars.mobileBreakPoint?(a.$curtains.css("top",""),a.$logo.css("top",""),a.$menu.css("padding-top",""),a.$meter.css("top",""),a.$globalHeader.css("margin-top",""),a.mainNav.$toggle.css("top","")):(d,b=a.$window.scrollTop(),c=a.$globalHeader.outerHeight(),b-c+a.vars.baseUnit>0&&(b=c-a.vars.baseUnit),d=c===0?0:c-b+"px",a.$curtains.css({top:d}),a.$logo.css({top:d}),a.$menu.css({"padding-top":d}),a.$meter.css({top:d}),a.$globalHeader.css({"margin-top":b*-1+"px"}),a.mainNav.$toggle.css({top:d}))},positionCurtains:function(){this.$curtains.css({width:this.vars.gutter+"px"})},closeCurtains:function(){this.$curtains.css("width","50.5%")},showPreloader:function(){this.$preloader.css("opacity",1).appendTo("body")},positionNav:function(){this.$logo.css({left:this.vars.gutter+"px"}),this.$menu.css({left:this.vars.gutter+"px"})},setVars:function(){this.vars.baseUnit=parseInt($("body").css("font-size"),10),this.vars.windowWidth=this.$window.width(),this.vars.windowHeight=this.$window.height(),this.vars.isNarrow=this.vars.windowWidth<this.vars.mobileBreakPoint||this.vars.windowHeight<this.vars.mobileBreakPoint,this.vars.gutter=this.$placementGrid.offset().left},initGenericTooltips:function(){_.each(a.translations.tooltips,function(a){if(typeof a!="object")return;if(a.text.length===0)return;var b=_.extend({},a.options,{content:a.text});$(a.selector).tooltip2(b)})}},_.bindAll(a.SITE.ui),_.extend(a.SITE.ui,a.MAT.mixins.pubSub),a.SITE.ui.ready()})(this)
;(function(a){"use strict",a.SITE.ui.header={init:function(){var b=this;b.$mattelNav=$("#mdn-hd"),b.$globalHeader=$(".global-header"),b.$toggle=$(".top-nav-toggle"),b.$meter=$(".meter"),b.scrollbarHtml='<div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>',b.$globalMenu=b.$globalHeader.find("ul"),b.$globalMenu.find("li").length>0&&a.SITE.ui.vars.isNarrow&&(b.$toggle.css("display","block"),b.$toggle.on("click",function(a){a.preventDefault(),a.stopPropagation(),b.toggleMenu()}),b.$globalMenu.on("click",function(a){a.stopPropagation()}),b.$globalMenu.find(".capture_modal_open").on("click",function(a){b.toggleMenu()})),$("#nav-our-sites").hover(function(){b.$globalHeader.css({"z-index":"40"})},function(){b.$globalHeader.css({"z-index":"20"})}),b.$languageSelect=b.$globalHeader.find("select#language"),b.$languageSelect.length&&!Modernizr.touch&&(b.$languageSelect.chosen({disable_search_threshold:9999}),b.$languageSelect.data("chosen").dropdown.find(".chzn-results").height()>300&&(b.$languageSelect.data("chosen").dropdown.prepend(b.scrollbarHtml).find(".chzn-results").wrap('<div class="viewport"/>').addClass("overview"),b.$languageSelect.data("chosen").dropdown.find(".viewport").css({height:"300px"}).find("li").css({"margin-right":"1.125em"}),b.$languageSelect.data("chosen").dropdown.tinyscrollbar({sizethumb:71}))),b.$languageSelect.on("change",b.onLanguageSelectChange)},toggleMenu:function(){var a=this;a.toggleMenuActive=a.toggleMenuActive?!1:!0,a.$globalMenu.slideToggle("fast"),$("body").off("click",a.toggleMenu),a.$globalMenu.promise().done(function(){a.toggleMenuActive===!0&&$("body").not(".top-nav-toggle").one("click",a.toggleMenu)})},onLanguageSelectChange:function(a){if(a.currentTarget===undefined)return!1;var b=this,c=$(a.currentTarget);$.ajax({type:"GET",url:"/"+SITE_LOCALE+"/account/setuserlocale/"+c.val(),success:function(a){b.redirectToNewLocale(a)},error:function(){}})},redirectToNewLocale:function(a){var b=document.URL.replace(a.oldLocale,a.newLocale);b=b.replace(/#$/,""),window.location=b}},_.bindAll(a.SITE.ui.header)})(this)
;(function(a){function c(){var a=/lang=en/,b=window.location.hash.split("#modal=")[1];if(b)if(a.test(b)){window.location.hash="";var c="http://".concat(window.location.hostname,"/en-us#modal=",b.replace(/[?]lang=en/,"")),d="menubar=yes,resizable=yes,scrollbars=yes,status=yes,toolbar=yes,location=yes",e=window.open(c,"",d);window.focus&&e.focus()}else{var f=new IframeModal({src:b,width:960,height:575},{onClose:function(){$.modal.close(),window.location.hash=""}});f.showModal()}}"use strict";var b=['<div class="iframe-modal">','<iframe src="<%= src %>" width="<%= width %>" height="<%= height %>" style="border:0">',"</div>"].join("\n");window.IframeModal=function(a,c){var d={width:"80%",height:"80%",ratio:!1,appendTo:"body"};this.options=_.extend(d,a),this.simpleModalOptions=_.extend({},c),this.$container=$(this.options.appendTo),this.compiledTemplate=_.template(b)},IframeModal.prototype.showModal=function(){var a=this,b=$(window),c=typeof a.options.width=="string"&&a.options.width.indexOf("%")!==-1?b.width()*parseInt(a.options.width)/100:parseInt(a.options.width),d=typeof a.options.height=="string"&&a.options.height.indexOf("%")!==-1?b.height()*parseInt(a.options.height)/100:parseInt(a.options.height),e=a.options.ratio,f;a.options.ratio&&c/d>e?c=parseInt(d*e,10):a.options.ratio&&c/d<e&&(d=parseInt(c/e)),f=a.compiledTemplate({src:a.options.src,width:c,height:d}),$.modal(f,_.extend({zIndex:50,opacity:100,autoResize:!0,overlayClose:!0,appendTo:a.$container,containerId:"iframe-modal-container",overlayId:"iframe-modal-overlay"},a.simpleModalOptions))},$.fn.iframeModal=function(a){return this.each(function(){var b=$(this).attr("href"),c=b?{src:b}:{},d=new IframeModal($.extend(c,a));$(this).on("click",function(a){a.preventDefault(),d.showModal(a),VIDEOS&&VIDEOS.player&&VIDEOS.player.jwplayer&&VIDEOS.player.jwplayer.pause()})})},$(window).on("load",c),$(window).on("hashchange",c)})(this)
;(function(a){"use strict",a.SITE.ui.mainNav={init:function(b){var c=this,d;c.$el=$(".navigation-main"),c.$scrollbar=c.$el.find(".scroll-container"),c.$overview=c.$scrollbar.find(".overview"),c.$toggle=c.$el.find(".toggle"),c.$logo=$(".header-main .logo"),Modernizr.touch?(d=new iScroll(c.$overview.parent()[0],{hScroll:!1}),a.SITE.ui.$window.on("resize",function(a){d.refresh()})):(c.$scrollbar.tinyscrollbar({sizethumb:71}),a.SITE.ui.$window.on("resize",function(a){c.$scrollbar.tinyscrollbar_update()})),store.get("openedOnce")||(a.MAT.mixins.localStorageHelpers.setLocal("openedOnce",!0),setTimeout(function(){c.$el.addClass("open")},1e3),setTimeout(function(){c.$el.removeClass("open")},4e3)),c.$toggle.on("click",function(a){a.preventDefault(),c.$el.hasClass("open")?(c.$el.removeClass("open"),c.$logo.removeClass("open")):(c.$el.addClass("open"),c.$logo.addClass("open"))}),$(document).click(function(){c.$el.hasClass("open")&&(c.$el.removeClass("open"),c.$logo.removeClass("open"))}),c.$el.click(function(a){a.stopPropagation()}),c.$el.find(".music-video").on("click",function(a){a.preventDefault(),window.location=b.musicVideoUrl})}}})(this)
;(function(a){function c(a,b){var c={mouseEnter:!1,mouseDown:!1,mouseUp:!1};this.options=_.extend(c,b),this.collection=a,this.init()}"use strict";var b=document.createElement("audio");c.prototype.init=function(){this.options.mouseEnter&&this.loadSound(this.options.mouseEnter),this.options.mouseDown&&this.loadSound(this.options.mouseDown),this.options.mouseUp&&this.loadSound(this.options.mouseUp),this.bindEvents()},c.prototype.bindEvents=function(){var a=this;a.options.mouseEnter&&$(document).on("mouseenter",a.collection.selector,function(){a.onMouseEnter()}),a.options.mouseDown&&$(document).on("mousedown",a.collection.selector,function(){a.onMouseDown()}),a.options.mouseUp&&$(document).on("mouseup",a.collection.selector,function(){a.onMouseUp()})},c.prototype.onMouseEnter=function(a){this.playSound(this.options.mouseEnter)},c.prototype.onMouseDown=function(a){this.playSound(this.options.mouseDown)},c.prototype.onMouseUp=function(a){this.playSound(this.options.mouseUp)},c.prototype.loadSound=function(a){b.src=a,b.load()},c.prototype.playSound=function(a){b.src!==a?b.src=a:b.seek(0),b.play()},$.fn.sfxButton=function(a){var b=new c(this,a);return this},$(".sfx-jelly, .flex-control-nav a, .flex-direction-nav a, .flex-control-nav a, .bx-next, .bx-prev, .bx-pager-item a").sfxButton({mouseDown:"/Static/audio/button_jelly_click.mp3"}),$(".sfx-paper, .capture_btn, .janrain_close_confirm a, .simplemodal-close").sfxButton({mouseDown:"/Static/audio/button_paper_click.mp3"}),function(){Modernizr.audio&&Modernizr.audio.mp3&&_.each(["button_jelly_Click.mp3","button_paper_Click.mp3"],function(a){var b=new Audio;b.src="/Static/audio/"+a})}()})(this)
;(function(a){function b(){var a=_.uniqueId("spinner-canvas-"),b=$('<div id="'+a+'" />');return b.data("id",a),b.css({position:"absolute",top:"50%",left:"50%","margin-top":"-30px","margin-left":"-30px","z-index":100}),b}function c(a){var b=a||"body",c=this;typeof b instanceof jQuery?c.$container=b:c.$container=$(b),c.init()}"use strict",c.prototype.init=function(){function f(){var a={idle:[{x:0,y:0,width:60,height:60},{x:64,y:0,width:60,height:60},{x:128,y:0,width:60,height:60},{x:192,y:0,width:60,height:60},{x:256,y:0,width:60,height:60},{x:320,y:0,width:60,height:60},{x:384,y:0,width:60,height:60},{x:448,y:0,width:60,height:60},{x:512,y:0,width:60,height:60},{x:576,y:0,width:60,height:60},{x:640,y:0,width:60,height:60},{x:704,y:0,width:60,height:60}]},b=new Kinetic.Sprite({image:c,animation:"idle",animations:a,frameRate:12,index:0});e.add(b),b.start(),d.draw()}var a=this,c,d,e;a.$div=b(),a.$container.append(a.$div),d=new Kinetic.Stage({container:a.$div.attr("id"),width:70,height:69}),e=new Kinetic.Layer,d.add(e),c=new Image,c.onload=function(){f()},c.src="/Static/images/ui/spinner.png"},c.prototype.show=function(){return this.$div.show(),this.$div},c.prototype.hide=function(){return this.$div.hide(),this.$div},c.prototype.setContainer=function(a){$(a).append(this.$div)},a.SITE.ui.Spinner=c})(this)
;(function(a){var b=a.SITE.ui.templates={};b.cardModal=['<div class="card-container">','<figure class="character-card">','<img src="http://placekitten.com/g/300/450">',"<figcaption>","<section>","<h1><%= characterName =></h1>","<p><%= characterDescription =></p>","</section>","</figcaption>","</figure>","</div>"].join("\n")})(this)
;(function(a){"use strict";var b=a.SITE.ui.tendencyMeter={init:function(b){var c=this;b=_.extend(c.defaults,b),c.setTendencyPos(),a.SITE.user.subscribe("tendency:set",function(a,b){c.setTendencyPos()})},setTendencyPos:function(){var b=this,c,d=d||0,e=a.SITE.user.attrs.tendency||0,f=b.defaults.$meter.width();Math.abs(e)>1&&(e=e>0?1:-1),b.defaults.type==="vu"&&(d=e*7,e=Math.sin(e)),c=f*e/2,b.defaults.$indicator.css(a.SITE.ui.vars.prfx+"transform","rotate("+d+"deg)  translateX("+c+"px)")},defaults:{$meter:$(".meter"),$indicator:$(".indicator"),type:""}};_.extend(b,a.MAT.mixins.pubSub)})(this)
;var tabDisplay,tabTrigger=!1;(function(a){"use strict";var b=a.SITE.ui.tabs={init:function(a){var b=this;$(window).on("imagesLoaded",function(){$(".vault-downloads").length>0&&(navigator.appName=="Microsoft Internet Explorer"||!!navigator.userAgent.match(/Trident/))&&($(a).find("div.tab-on").css("display",tabDisplay),tabTrigger=!0,setTimeout(function(){$(a).find("div.tab").not("div.tab-on").css("display","none")},4e3))}),_.each(a,function(a){b.setup(a)})},setup:function(a){var b=1,c=this,d=$('<menu class="tab-nav"></menu>'),e=a.querySelectorAll(".tab"),f="tab-on",g=$(".tab-on"),h=$(e).index(g);tabDisplay=$(a).find("div.tab").css("display"),_.each(e,function(e){var g=e.getAttribute("data-tabname")||"Tab "+b,j="<li>"+g+"</li>";e.$navItem=$(j),e.$navItem.on("click",function(){console.log(this.innerHTML),c.tabToggle(e,a)}),d.append(e.$navItem),b==h+1&&e.$navItem.addClass(f),b+=1}),$(a).prepend(d)},tabToggle:function(a,b){var c=this,d="tab-on",e=$(a),f=$("."+d);e.hasClass(d)||(f.removeClass(d),$(b).find("div.tab").css("display","none"),e.addClass(d),a.$navItem.addClass(d),$(b).find("div.tab-on").css("display",tabDisplay))}};_.extend(b,a.MAT.mixins.pubSub)})(this)
;(function(a){function b(a,b){var c={text:"No text specified"};this.options=$.extend(c,b),this.$el=$(a),this.$tooltip=$('<div class="tooltip"></div>'),this.init()}"use strict",b.prototype.init=function(){this.$el.data("tooltip",{tooltip:this,options:this.options}),this.setText(this.$el.data("tooltip-text")?this.$el.data("tooltip-text"):this.options.text),this.bindEvents()},b.prototype.bindEvents=function(){var a=this;a.$el.on("mouseenter",function(b){a.onMouseEnter(b)}),a.$el.on("mouseleave",function(b){a.onMouseLeave(b)})},b.prototype.onMouseEnter=function(a){var b=this;b.showTooltip(),b.$el.on("mousemove",function(a){b.onMouseMove(a)})},b.prototype.onMouseLeave=function(a){var b=this;b.hideTooltip(),b.$el.off("mousemove",function(a){b.onMouseMove(a)})},b.prototype.onMouseMove=function(a){this.moveTooltip(a.pageX,a.pageY)},b.prototype.showTooltip=function(){a.SITE.ui.$body.append(this.$tooltip),this.$tooltip.stop().animate({opacity:1})},b.prototype.hideTooltip=function(){var a=this;a.$tooltip.stop().animate({opacity:0},function(){a.$tooltip.detach()})},b.prototype.setText=function(a){this.$tooltip.text(a)},b.prototype.moveTooltip=function(a,b){this.$tooltip.css({left:a+"px",top:b+"px"})},$.fn.tooltip=function(){var a=arguments;return typeof a[0]=="string"?this.each(function(){$(this).data("tooltip")&&$(this).data("tooltip").tooltip[a[0]](a[1])}):this.each(function(){if(!$(this).data("tooltip"))var c=new b(this,a[0])})}})(this)
;(function(a){"use strict";var b=a.SITE.ui.ContentDrawer=function(a){var b=this;b.defaults={buttonText:"Read More",nameSpace:"ui-contentDrawer-",containers:$(".ui-contentDrawer-container"),callback:function(){}},$.extend(b.defaults,a),b.nameSpace=b.defaults.nameSpace,b.callback=b.defaults.callback,b.$containers=b.defaults.containers,b.init()};b.prototype.init=function(){var a=this;_.each(a.$containers,function(b){a.setup(b)})},b.prototype.setup=function(b){var c=this,d="Read More",e=$(b),f=e.attr("class"),g=$('<button class="'+c.nameSpace+'control button sfx-paper">'+c.defaults.buttonText+"</button>"),h=g.parent().data("characterName");e.before(g),e.wrapInner('<div class="drawer-content"/>'),e.inner=e.find(".drawer-content"),e.dimAxis=f.toLowerCase().indexOf("horizontal")>0?"width":"height",c.toggleVisibility(e),e.addClass("animate"),e.on("oTransitionEnd transitionend webkitTransitionEnd",function(){typeof c.callback=="function"&&c.callback()}),g.attr("data-tealium-page",h+" "+d),g.on("click touchstart",function(){c.toggleVisibility(e);var b=$(this).data("tealiumPage");e.state&&e.state==="visible"&&a.MAT.analytics.trackPage(b,"Mirror Blogs")})},b.prototype.toggleVisibility=function(a){var b=this;a.dimVal=a.dimAxis==="width"?a.inner.outerWidth():a.inner.outerHeight(),Modernizr.cssanimations?a.state==="visible"||a.state===undefined?(a.css(a.dimAxis,0),a.state="hidden",b.publish("drawer:closed",a)):(a.css(a.dimAxis,a.dimVal),a.state="visible",b.publish("drawer:opened",a)):a.slideToggle(250)},_.extend(b.prototype,a.MAT.mixins.pubSub)})(this)
;(function(a){function b(a){var b=this;this.defaults={slider:".hover-slider",rate:100},this.options=_.extend(this.defaults,a),this.init()}"use strict",b.prototype.init=function(){var a=this;this.slider=$(this.options.slider),this.slider.height=this.slider.outerHeight(),this.container=this.slider.offsetParent(),this.container.height=this.container.outerHeight(),this.container.top=this.container.position().top,this.max=this.slider.height-this.container.height,this.max<0&&(this.max=0),this.build()},b.prototype.build=function(){var a=this,b=$('<div class="scroller-control-up" />'),c=$('<div class="scroller-control-down" />'),d;b.hover(function(){d=window.setInterval(function(){var b=Math.abs(a.slider.position().top);b>0&&a.moveUp()},5)},function(){window.clearInterval(d)}),c.hover(function(){d=window.setInterval(function(){var b=Math.abs(a.slider.position().top);b<a.max&&a.moveDown()},5)},function(){window.clearInterval(d)}),this.container.remove(".scroller-control-up"),this.container.remove(".scroller-control-down"),this.container.append(b),this.container.append(c)},b.prototype.moveUp=function(){var a=this,b=this.slider.position().top+1;this.slider.css({transform:"translateY("+b+"px)"})},b.prototype.moveDown=function(){var a=this,b=this.slider.position().top-1;this.slider.css({transform:"translateY("+b+"px)"})},a.SITE.ui.HoverScroller=b})(this)
;(function(a){function b(a){if(b.instance)return b.instance;b.instance=this,this.selector=a,this.init()}"use strict",b.prototype.init=function(){this.$el=$(this.selector),this.template=_.template(this.$el.find("#global-stats-template").html())},b.prototype.render=function(){this.$el.html(this.template(a.SITE.user.attrs)),this.$el.fadeIn("fast",function(){$(window).trigger("globalStats:render")})},a.SITE.globalStats=new b(".user-stats"),$(document).ready(function(){var b=a.MAT.decorators.waitForInaction(function(){a.SITE.globalStats.render()},1e3);a.SITE.user.subscribe("attributeSet",function(a,c){(a==="points"||a==="level"||a==="image_head")&&b()})}),$(window).on("globalStats:render",function(){$(".global-stats-currency-gold").tooltip2({content:window.translations.globalStats.currency,pointerPosition:"tr"}),$(".global-stats-currency-gems").tooltip2({content:window.translations.globalStats.currency,pointerPosition:"tr"}),$(".global-stats-level-container").tooltip2({content:window.translations.globalStats.levels,pointerPosition:"tr"}),$(".global-stats-bookmark-link").tooltip2({content:window.translations.globalStats.bookmarkExplanation,pointerPosition:"tr"})}),a.SITE.user.subscribe("unlockedStories:set",function(){a.SITE.globalStats.render()})})(this)
;(function(a){function b(a,b){this.$el=$(a),this.$settings=$.extend({duration:"ALLTIME",returnCount:10},b),this.init()}"use strict",b.prototype={init:function(b){var c=new a.SITE.ui.Spinner;this.$list=this.$el.find("ul"),this.$spinner=c.$div,this.$el.append(this.$spinner),this.$prev=this.$el.find(".prev"),this.$next=this.$el.find(".next"),this.$findMe=this.$el.find(".find-me"),this.users=[],this.iScroll={},this.leaderTemplate=_.template(this.$el.find(".leaderboard-list-item-template").html()),this.fetchLeaders(),this.bindEvents(),a.SITE.user.attrs.userID&&this.$findMe.show()},bindEvents:function(){var b=this;b.$prev.on("click",function(){b.prev()}),b.$next.on("click",function(){b.next()}),b.$findMe.on("click",function(c){c.preventDefault(),b.fetchLeadersById(a.SITE.user.attrs.userID)})},showSpinner:function(){this.$spinner.show("fast")},hideSpinner:function(){this.$spinner.hide("fast")},fetchLeadersById:function(b){var c=this;c.showSpinner(),a.MAT.nitro.callProxyAPI({endPoint:"site/leader/"},function(a){c.onFetchSuccess(a)})},fetchLeaders:function(){var b=this;b.$list.fadeOut("fast"),b.showSpinner(),a.MAT.nitro.callProxyAPI({endPoint:"site/leader?returnCount=".concat(b.$settings.returnCount,"&duration=",b.$settings.duration)},function(a){b.onFetchSuccess(a)})},onFetchSuccess:function(a){this.users=a,this.hideSpinner(),this.$list.fadeIn("fast"),this.render()},prev:function(){this.iScroll.scrollToPage(0,this.iScroll.currPageY-1,200)},next:function(){this.iScroll.scrollToPage(0,this.iScroll.currPageY+1,200)},render:function(){var a=this,b=1;a.$list.empty(),_.each(a.users,function(c){c.num=b++,a.$list.append(a.leaderTemplate(c))}),a.iScroll=new iScroll("leaderboard-scroll-wrapper",{hScroll:!1,vScrollbar:!1,snap:!0})}},_.bindAll(b),a.SITE.ui.Leaderboard=b})(this)
;(function(a){function c(a){var b={x:0,y:0,width:400,height:400,frameRate:20,gravity:.1,count:30};this.options=_.extend(b,a),this.position=[this.options.x,this.options.y],this.particles=g(this.options.count),this.canvas=e(),this.stage=f(this.canvas.data("id"),this.options.width,this.options.height),this.init()}function d(){this.position=[0,0],this.rotationSpeed=Math.random()*10-5,this.velocity=[Math.random()*10-5,Math.random()*-4],this.life=Math.random()*50,this.star=new Kinetic.Star({numPoints:Math.floor(Math.random()*2+6),innerRadius:Math.floor(Math.random()*2+1),outerRadius:Math.floor(Math.random()*3+6),radius:Math.floor(Math.random()*3+3),fill:"white"})}function e(){var a=_.uniqueId("sparkle-canvas-"),c=$('<div id="'+a+'" />');return c.data("id",a),c.css({"pointer-events":"none",position:"absolute","z-index":1e3}),b.append(c),c}function f(a,b,c){var d=new Kinetic.Layer,e=new Kinetic.Stage({width:b,height:c,container:a});return e.add(d),e}function g(a){var b=0,c=[];for(b;b<a;b++){var e=new d;c.push(e)}return c}"use strict";var b=$("body");c.prototype.init=function(){var a=this;this.canvas.css({left:a.position[0]-a.options.width/2,top:a.position[1]-a.options.height/2}),_.each(a.particles,function(b){b.position=[a.options.width/2,a.options.height/2],a.stage.children[0].add(b.star)}),a.loop()},c.prototype.loop=function(a){var b=this;b.particles.length>0?(b.moveParticles(),b.stage.draw(),setTimeout(function(){b.loop()},b.options.frameRate)):(b.canvas.remove(),delete this)},c.prototype.moveParticles=function(){var a=this,b=0;for(b;b<a.particles.length;b++){var c=a.particles[b];if(c.life>0)c.life--,c.position[0]+=c.velocity[0],c.velocity[1]+=a.options.gravity,c.position[1]+=c.velocity[1],c.star.setAttr("rotationDeg",c.star.getAttr("rotationDeg")+c.rotationSpeed),c.star.setAttr("scaleX",c.star.getAttr("scaleX")+.05),c.star.setAttr("scaleY",c.star.getAttr("scaleY")+.05),c.star.setAttr("opacity",Math.random()),c.star.setAttr("x",c.position[0]),c.star.setAttr("y",c.position[1]);else{var d=a.particles.indexOf(c);c.star.destroy(),a.particles.splice(d,1)}}},a.SITE.ui.Sparkles=c,function(){function e(){var c=0;for(c;c<10;c++)var d=new a.SITE.ui.Sparkles({x:Math.random()*$(window).innerWidth(),y:Math.random()*$(window).innerHeight()});b.on("click",function(b){var c=new a.SITE.ui.Sparkles({x:b.pageX,y:b.pageY})})}var c=[38,38,40,40,37,39,37,39,66,65,13],d=0;$(document).on("keydown",function(a){c[d]===a.keyCode?d++:d=0,d===c.length&&(e(),d=0)})}()})(this)
;(function(a){function b(a){var b={content:"No text specified",pointerPosition:"br",target:null,activateOn:"mouseenter",deactivateOn:"mouseleave",followMouse:!0,uid:undefined,size:"auto",cssClass:"",positionFixes:{x:10,y:-42}},c;return this._state={},a=this.options=$.extend(b,a),a.size==="auto"&&(a.size=this.determineBestSize(a)),this.$target=a.target instanceof jQuery?a.target:$(a.target),c=c||_.uniqueId("tooltip2--"),this.$tooltip=$('<div class="tooltip2 '+a.cssClass+'" id="'+c+'"><div class="tooltip2__container"><div class="tooltip2__content"></div></div></div>'),this.init()}"use strict",b.prototype.init=function(){return this.$target.data("tooltip2",{tooltip:this,options:this.options}),this.moveTooltip(),this.configure(),this.setContent(this.options.content),this.bindEvents(),this},b.prototype.configure=function(){var a=this.options;this.$tooltip.addClass("pointer-"+a.pointerPosition).addClass(a.size)},b.prototype.bindEvents=function(){var a=this;typeof this.options.activateOn=="string"?this.options.target===null?console.log("cannot bind "+this.options.activateOn+" event for tooltip2!"):a.$target.on(this.options.activateOn,function(b){a.activate(b)}):typeof this.options.activateOn=="function"&&this.options.activateOn.call(this),typeof this.options.deactivateOn=="string"?this.options.target===null?console.log("cannot bind "+this.options.deactivateOn+" event for tooltip2 - target is null!"):a.$target.on(this.options.deactivateOn,function(b){a.deactivate(b)}):typeof this.options.deactivateOn=="function"&&this.options.deactivateOn.call(this)},b.prototype.activate=function(){var a=this;typeof a.options.beforeActivate=="function"&&a.options.beforeActivate.call(a),a.showTooltip(),a._state.active=!0,a.options.followMouse&&a.followMouse()},b.prototype.deactivate=function(){var a=this;a.hideTooltip(),a._state.active=!1,a._state.isFollowingMouse&&a.unFollowMouse(),typeof a.options.afterDeactivate=="function"&&a.options.afterDeactivate.call(a)},b.prototype.followMouse=function(){var a=this;if(a._state.isFollowingMouse)return;a.$target.length>0?a.$target.on("mousemove",a.moveTooltip):$(window).on("mousemove",a.moveTooltip),a._state.isFollowingMouse=!0},b.prototype.unFollowMouse=function(){this.$target.off("mousemove",this.moveTooltip),this._state.isFollowingMouse=!1},b.prototype.showTooltip=function(){a.SITE.ui.$body.append(this.$tooltip),this._state.tooltipSize={width:this.$tooltip.outerWidth(),height:this.$tooltip.outerHeight()},this.$tooltip.stop().css("opacity",1)},b.prototype.hideTooltip=function(){var a=this;a.$tooltip.stop().css("opacity",0).detach()},b.prototype.setContent=function(a){this.$tooltip.find(".tooltip2__content").html(a)},b.prototype.moveTooltip=function(){function b(b){var c=_.memoize(function(b){var c,d,e=a._state.tooltipSize.width,f=a._state.tooltipSize.height,g=a.options.positionFixes;switch(b){case"bl":c=0,d=-f+g.y;break;case"br":c=-e+g.x,d=-f+g.y;break;case"rb":c=-e+g.x,d=-f;break;case"rt":c=-e+g.y,d=0;break;case"tr":c=-e,d=-g.y;break;case"tl":c=0,d=-g.y;break;case"lt":c=-g.y,d=0;break;case"lb":c=-g.y,d=-f}return{x:c,y:d}}),d=c(this.options.pointerPosition);this.$tooltip.css({left:b.pageX+d.x+"px",top:b.pageY+2+d.y+"px"})}var a=this;this.moveTooltip=_.bind(b,this)},b.prototype.determineBestSize=function(a){var b=52,c=195,d=a.content.length;return d<=b?"small":d<=c?"medium":"large"},a.SITE.ui.Tooltip2=b,$.fn.tooltip2=function(){var a=arguments;return typeof a[0]=="string"?this.each(function(){var b=$(this).data("tooltip2")?$(this).data("tooltip2").tooltip:undefined,c=Array.prototype.shift.call(a);b!==undefined&&b[c]!==undefined&&b[c].apply(b,a)}):this.each(function(){if(!$(this).data("tooltip2"))return new b(_.extend({},a[0],{target:this}));console.log("tooltip already generated!")})}})(this)
;(function(a){"use strict",a.SITE.checkScreenSize=function(){var b=screen.width,c=screen.height,d=$("#popup-screen-too-small");return Modernizr.touch?b<1024&&c<1024?($(window).load(function(){d.height(screen.height-$(".global-header").outerHeight()),d.removeClass("hide"),$(".main").empty().append(d),a.SITE.ui.revealPage(),$(".global-footer").hide()}),!1):!0:!0}})(this)
;(function(a){function b(){if(b.instance)return b.instance;b.instance=this,this.init()}"use strict",b.prototype.init=function(){var b={apiKey:a.MAT.nitro.connectionParams.apiKey,server:BUNCHBALL_API_URL,userId:a.SITE.user.attrs.userID};a.notificationsCallback=function(b){b.html=_.template(b.html,a.LOCALIZATION.notifications)},a.SITE.nitro=new Nitro(b),a.SITE.nitro.showPendingNotifications("notificationsCallback")},a.SITE.user.subscribe("login:success",function(){a.SITE.notifications=new b})})(this)
;function orientaionCheck(){if(!window.matchMedia)return"col-1-4";var a;return window.matchMedia("(orientation: portrait)").matches?a="col-1-1":window.matchMedia("(orientation: landscape)").matches&&(a="col-1-2"),a}function onYouTubePlayerReady(a){ytplayer=document.getElementById(a),ytplayer.getPosition=function(){return ytplayer.getCurrentTime()},ytplayer.addEventListener("onStateChange","onytplayerStateChange"),VIDEOS.tagVideo(ytplayer)}function onytplayerStateChange(a){e=new Array,this.e.oldstate="BUFFERING";switch(a){case 0:ytplayer.logGenericEvent("Completion"),VIDEOS.playNextVideo();break;case 1:this.e.newstate="PLAYING",ytplayer.logStateChange(e);break;case 2:ytplayer.logGenericEvent("Pause")}}(function(a){"use strict",a.VIDEOS={apiRoot:"http://mediaportal.mirror-image.com/playlists/",apiExtension:".json",playlists:[],videoList:[],youtube:!0,isDeepLinked:!0,playerSettings:{width:625,height:351,autoplay:!1,server_detection:!0,player_profile:"Lightning",jsonp_callback:"mirrorImageCallback"},Video:Backbone.Model.extend({url:"",defaults:{description:"No description available",title:"No title available",screenshots:[{width:185,height:100,url:"http://placehold.it/135x85&text=no+thumb+available"}]}}),Videos:Backbone.Paginator.clientPager.extend({paginator_core:{local:!0,type:"GET",dataType:"jsonp",jsonp:"jsonp_callback",url:""},paginator_ui:{firstPage:1,currentPage:1,perPage:9},server_api:{$callback:"jsonp_callback"}}),Pagination:Backbone.View.extend({el:"#video-pager",events:{"click a.previous":"gotoPrev","click a.next":"gotoNext","click a.page":"gotoPage","click a.filter":"filter"},initialize:function(){this.collection.on("reset",this.render,this),this.$el.appendTo("#video-pager"),this.pagingTemplate=_.template($("#video-pager-template").html())},render:function(){if(!a.SITE.ui.vars.isNarrow){var b=this.pagingTemplate(this.collection.info());this.$el.html(b)}},gotoPrev:function(a){a.preventDefault(),this.collection.previousPage()},gotoNext:function(a){a.preventDefault(),this.collection.nextPage()},gotoPage:function(a){a.preventDefault();var b=$(a.target).text();this.collection.goTo(b)}}),Player:Backbone.View.extend({el:"#video-player-container",loadedPlayers:[],currentVideo:{},initialize:function(){var b=this,c=Backbone.Collection.extend();b.fullCollection=new c,b.$el=$(b.el),b.template=_.template($("#video-player-template").html()),b.jwplayer={},a.SITE.ui.vars.isNarrow&&(b.$el.addClass("narrow"),b.$el.on("click",function(a){b.$el.detach()}),b.$el.on("click",".popup-close",function(a){b.$el.detach()}),b.$el.detach(),b.$el.on("click",".video",function(a){a.stopPropagation()})),VIDEOS.playNextVideo=function(){var a=b.fullCollection.indexOf(b.currentVideo),c=b.fullCollection.at(a+1);c&&Backbone.history.navigate("watch/"+c.get("slug"),!0)},VIDEOS.tagVideo=function(c){var d=b.currentVideo.get("internalName");a.SITE.user.logAction(b.currentVideo.get("action")),a.MAT.analytics.trackPlayer(c,d)},a.mirrorImageCallback=function(a){var c,d;b.$el.find("#video-player").html(a),b.$("object").length>0?c=b.$("#video-player object").attr("id"):c=b.$("#video-player div").first().attr("id"),b.jwplayer=jwplayer.api.selectPlayer(c),setTimeout(function(){b.jwplayer.onComplete(function(){VIDEOS.playNextVideo()})},200),VIDEOS.tagVideo(b.jwplayer)},$(".videos").on("click","#interactive-music-video-button",function(){typeof ytplayer!="undefined"?ytplayer.pauseVideo():b.jwplayer.pause()})},render:function(b){var c=this,d=c.fullCollection.where({slug:b})[0],e;VIDEOS.youtube?e={embed:'<div id="eahytPlayer"></div>',title:d.get("title"),description:d.get("description")}:e={embed:getDurationedMediaViewer(d.get("video_id"),a.VIDEOS.playerSettings),title:d.get("title"),description:d.get("description")},c.currentVideo=d,c.$el.html(c.template(e));var f=location.pathname.indexOf("watch");if(f!=-1&&VIDEOS.isDeepLinked){var g=d.get("playlist");$("#video-select option[value='"+g+"']").attr("selected","selected"),$("#video-select").trigger("liszt:updated")}if(VIDEOS.youtube){var h={allowScriptAccess:"always",wmode:"transparent",allowFullScreen:"true"},i={id:"ytPlayer"};swfobject.embedSWF(d.get("srcUrl")+"?enablejsapi=1&playerapiid=ytPlayer&modestbranding=1&version=3&autoplay=1","eahytPlayer","100%","100%","8",null,null,h,i)}$("html, body").animate({scrollTop:0}),a.SITE.ui.vars.isNarrow&&c.$el.appendTo(a.SITE.ui.$body)}}),Gallery:Backbone.View.extend({el:".thumbs-container",initialize:function(){var b=this;_.bindAll(this),b.spinner=new a.SITE.ui.Spinner(b.el),b.$el=$(b.el),b.collection.on("reset",b.render,this),a.SITE.ui.vars.isNarrow?b.thumbsTemplate=this.$("#thumbs-template-mobile").html():b.thumbsTemplate=this.$("#thumbs-template").html()},render:function(){var b=this,c=a.SITE.ui.vars.isNarrow?0:200;b.$el.html(_.template(b.thumbsTemplate,{videos:b.collection.toJSON(),thumbAlignClass:orientaionCheck()}));if(!!window.matchMedia){var d=window.matchMedia("(orientation: portrait)");d.addListener(function(a){a.matches?($(".module").addClass("col-1-1"),$(".module").removeClass("col-1-2")):($(".module").addClass("col-1-2"),$(".module").removeClass("col-1-1"))})}(a.SITE.ui.vars.isNarrow||b.youtube)&&b.$(".flexslider").flexslider({animation:"slide",animationLoop:!1,directionNav:!1,maxItems:1,minItems:1,itemMargin:15,slideshow:!1})}}),Filter:Backbone.View.extend({el:"#video-filter",events:{"change select":"filter"},initialize:function(){this.template=_.template($("#video-filter-template").html())},filter:function(b){VIDEOS.isDeepLinked=!1;var c=$(b.target).find(":selected").attr("data-field");switch(c){case"created_at":this.collection.setFilter("availability","available"),this.collection.setSort(c);break;case"playlist":this.collection.setFilter(c,$(b.target).val());break;default:this.collection.setFilter("availability","available")}!a.SITE.ui.vars.isNarrow&&!self.youtube&&this.collection.pager()},render:function(a){var b=this;$(this.el).html(this.template({playlists:a})),this.$select=this.$("select"),this.$select.chosen({disable_search_threshold:9999}),this.$select.next().find("a").attr("data-bypass",!0)}}),init:function(){function l(a){var c=new b.Videos;c.origModels=[],c.url=b.apiRoot+a.id+b.apiExtension,c.paginator_core.url=b.apiRoot+a.id+b.apiExtension,c.fetch({success:function(b){n(b,a)},error:function(){console.log("could not fetch data for playlist: "+b.apiRoot+a.id+b.apiExtension),k()}})}function m(a){var b=window[a.id],c=[],d=Backbone.Model.extend();for(var e=0;e<b.length;e++)c.push(new d(b[e]));var f=Backbone.Collection.extend({model:d});n(new f(c),a)}function n(a,e){if(a.models.length===0){k();return}_.each(a.models,function(a){var b=a.get("custom_fields"),c=_.where(b,{name:"InternalName"})[0].value,d=_.where(b,{name:"sitemap-url"})[0].value.replace(/\s/g,""),f=new RegExp("(?!.*/).*","g");a.set("playlist",e.title),a.set("internalName",c),a.set("action","watch.video."+c.replace(/ /g,".").replace(/['"]/g,"").toLowerCase()),a.set("slug",d===""?a.get("video_id"):f.exec(d)[0])}),c.add(a.toJSON()),d.fullCollection.add(a.toJSON()),j+=1,j<b.playlists.length&&(b.youtube?m(b.playlists[j]):l(b.playlists[j])),k()}var b=this,c=new b.Videos({model:new Backbone.Model(b.videoList)}),d=new b.Player({collection:c}),e=new b.Gallery({collection:c}),f=new b.Pagination({collection:c}),g=new b.Filter({collection:c}),h=Backbone.Router.extend({routes:{"watch/:id":"watch","*actions":"index"},index:function(){c.models.length>0&&!a.SITE.ui.vars.isNarrow&&d.render(c.at(0).get("slug"))},watch:function(a){d.render(a)}}),i=new h,j=0,k;b.player=d,b.gallery=e,a.SITE.ui.vars.isNarrow?$("section.videos").addClass("mobile"):$("section.videos").addClass("desktop"),$("#video-thumbs").on("click","a[href]:not([data-bypass])",function(a){a.preventDefault(),Backbone.history.navigate($(this).attr("href"),!0),VIDEOS.isDeepLinked=!1}),c.origModels=[],a.SITE.ui.vars.isNarrow&&(c.perPage=9999),e.spinner.show(),k=_.after(b.playlists.length,function(){c.pager(),g.render(b.playlists),Backbone.history.start({pushState:!0,root:"/"+SITE_LOCALE+"/videos/"}),e.spinner.hide();var a=location.pathname.indexOf("watch");if(a!=-1&&VIDEOS.isDeepLinked){var d={target:$("#video-select")};g.filter(d)}}),b.playlists.length>0&&(b.youtube?m(b.playlists[0]):l(b.playlists[0]))}}})(this);var ytplayer
;(function(a){"use strict",a.HOME={},_.extend(a.HOME,a.MAT.mixins.pubSub)})(this)
;(function(a){function c(b){var c=this;c.maxOffset=[0,0],c.container=new Kinetic.Group({width:b.dimensions[0],height:b.dimensions[1]}),_.each(b.images,function(b){var d;b.offset=b.offset||[0,0],d=new Image,d.onload=function(){var e=new Kinetic.Image({x:b.offset[0],y:b.offset[1],image:d,width:b.dimensions[0],height:b.dimensions[1],listening:b.onClick||b.onMouseEnter||b.onMouseLeave?!0:!1,id:b.id||_.uniqueId("parallax-")});typeof b.onClick=="function"&&e.on("mouseup",function(a){b.onClick(a,e)}),a.Modernizr.touch||(typeof b.onMouseEnter=="function"&&e.on("mouseenter",function(a){b.onMouseEnter(a,e)}),typeof b.onMouseLeave=="function"&&e.on("mouseleave",function(a){b.onMouseLeave(a,e)})),c.container.add(e),c.container.draw()},d.src=b.src})}function d(a){var b=this;b.maxOffset=[0,0],b.originalDimensions=a.dimensions,b.container=$('<div class="layer"></div>'),_.each(a.images,function(a){var c;a.offset=a.offset||[0,0],c=$("<img />"),c.attr("src",a.src),c.css({left:a.offset[0]+"px",top:a.offset[1]+"px",width:a.dimensions[0]+"px",height:a.dimensions[1]+"px"}),typeof a.onClick=="function"&&(c.css("cursor","pointer"),c.on("mouseup",function(b){a.onClick(b)})),b.container.append(c)})}function e(a){var b=this,c=_.uniqueId("drag-controller-");b.$thumb=$("<div />"),b.$thumb.css({width:a.originalDimensions[0]*2+"px",height:a.originalDimensions[1]*2+"px"}),b.$el=$("<div />").attr("id",c).css({width:a.originalDimensions[0]+"px",height:a.originalDimensions[1]+"px"}).append(b.$thumb),b.timer=null,a.$el.after(b.$el),b.iScroll=new iScroll(c,{hScroll:a.options.hParallax,vScroll:a.options.vParallax,hScrollbar:!1,vScrollbar:!1,bounce:!1,onScrollMove:function(a){var c,d,e=b._lastPointerPosition,f=a.changedTouches||(a.originalEvent?a.originalEvent.changedTouches:undefined),g;f.length>0&&(d={x:f[0].clientX,y:f[0].clientY},c={x:Math.abs(d.x-b._lastPointerPosition.x),y:Math.abs(d.y-b._lastPointerPosition.y)},c.y>c.x&&(g=window.scrollY-(d.y-b._lastPointerPosition.y),window.scrollTo(window.scrollX,g)),b._deltaMove=c,b._lastPointerPosition={x:f[0].clientX,y:f[0].clientY})},onScrollStart:function(){function c(){a.animatingTo=[b.x/b.maxScrollX,b.y/b.maxScrollY],b.timer=setTimeout(c,1e3/a.options.frameRate)}var b=this;c()},onScrollEnd:function(){clearTimeout(this.timer)}}),b._deltaMove={x:0,y:0},b._lastPointerPosition={x:0,y:0}}"use strict";var b=function(a,b,c){var d={hParallax:!0,vParallax:!0,useCanvas:!0,frameRate:1e3/30,easing:3,drag:!1};this.selector=a,this.options=_.extend(d,c),this.$el=$(a),this.layersData=b,this.layers=[],this.timer=null,this.currentPosition=[0,0],this.animatingTo=[.5,.5],this.mainLoop=null,this.originalDimensions=[c.width,c.height],this.viewportDimensions=[c.width,c.height],this.viewportOffset=[0,0]};b.prototype.init=function(){var a=this;a.setupContainer(),a.setviewportDimensions(),a.addLayers(),a.setViewportOffset(),a.setLayerMaxOffsets(),a.options.drag&&(a.controller=new e(a)),a.bindEvents(),this.loop()},b.prototype.loop=function(){var a=this;a.parallax((a.animatingTo[0]-a.currentPosition[0])/a.options.easing+a.currentPosition[0],(a.animatingTo[1]-a.currentPosition[1])/a.options.easing+a.currentPosition[1]),a.options.useCanvas&&a.container.draw(),setTimeout(function(){requestAnimationFrame(a.loop)},a.options.frameRate)},b.prototype.setupContainer=function(){this.options.useCanvas?(this.container=new Kinetic.Stage({container:this.selector.substring(1),width:this.viewportDimensions[0],height:this.viewportDimensions[1]}),this.container.add(new Kinetic.Layer)):this.container=$(this.selector).css({width:this.viewportDimensions[0]+"px",height:this.viewportDimensions[1]+"px"})},b.prototype.addLayers=function(){var a=this,b;_.each(a.layersData,function(e){a.options.useCanvas?b=new c(e):b=new d(e),a.layers.push(b)}),_.each(a.layers,function(b){a.options.useCanvas?a.container.children[0].add(b.container):a.container.append(b.container)})},b.prototype.scaleContainer=function(){var a=this,b=a.viewportDimensions[0]/a.originalDimensions[0];a.options.useCanvas?a.container.setScale(b):a.container.css({"-webkit-transform":"scale("+b+")"}),a.options.drag&&(a.controller.$thumb.css({width:a.viewportDimensions[0]*2+"px",height:a.viewportDimensions[1]*2+"px"}),a.controller.iScroll.refresh())},b.prototype.setviewportDimensions=function(){this.viewportDimensions=[this.$el.parent().width(),this.$el.height()]},b.prototype.setViewportOffset=function(){this.viewportOffset=[this.$el.offset().left,this.$el.offset().top]},b.prototype.setLayerMaxOffsets=function(){var a=this;a.options.useCanvas?_.each(a.layers,function(b){b.maxOffset=[a.originalDimensions[0]-b.container.getWidth(),a.originalDimensions[1]-b.container.getHeight()]}):_.each(a.layers,function(b){b.maxOffset=[a.originalDimensions[0]-b.originalDimensions[0],0]})},b.prototype.bindEvents=function(){var a=this;_.bindAll(a),a.options.drag&&a.controller.$el.on("mouseup",function(b){var c=document.createEvent("MouseEvents");c.initMouseEvent("mouseup",!0,!0,window,0,b.pageX,b.pageY,b.clientX,b.clientY,!1,!1,!1,!1,!1,null),a.controller.$el.css("margin-left","-9999px"),document.elementFromPoint(b.clientX,b.clientY).dispatchEvent(c),a.controller.$el.css("margin-left","0")}),a.options.drag||a.$el.on("mousemove",a.onMouseMove),$(window).on("resize",a.onResize)},b.prototype.onMouseMove=function(a){this.animatingTo=[(a.clientX-this.viewportOffset[0])/this.viewportDimensions[0],(a.clientY-this.viewportOffset[1])/this.viewportDimensions[1]]},b.prototype.onResize=function(a){this.setviewportDimensions(),this.setViewportOffset(),this.scaleContainer(),this.setLayerMaxOffsets()},b.prototype.parallax=function(a,b){var c=this;c.currentPosition=[a,b],_.each(c.layers,function(d){c.options.hParallax&&(c.options.useCanvas?d.container.setX(Math.floor(d.maxOffset[0]*a)):d.container.css({"margin-left":Math.floor(d.maxOffset[0]*a)+"px"})),c.options.vParallax&&(c.options.useCanvas?d.container.setY(Math.floor(d.maxOffset[1]*b)):d.container.css({"margin-top":Math.floor(d.maxOffset[1]*b)+"px"}))})},a.HOME.ParallaxScene=b})(this)
;(function(a){"use strict",HOME.preLaunchHero={$arrow:$(".meter-arrow"),$body:$("body"),init:function(a){var b=this;b.$screen=$("<div/>").addClass("hero-popup-screen"),b.popupTemplate=_.template($("#popup-template").html()),b.$popup=$("<div/>"),$("#royal-rebel-question .royal").on("click",function(c){c.preventDefault(),c.stopPropagation(),b.changeRoyal(),b.$popup.html(b.popupTemplate(a.apple)),b.openModal(),b.positionModal()}),$("#royal-rebel-question .rebel").on("click",function(c){c.preventDefault(),c.stopPropagation(),b.changeRebel(),b.$popup.html(b.popupTemplate(a.raven)),b.openModal(),b.positionModal()}),b.$popup.on("click",".popup-close",function(a){a.preventDefault(),b.closeModal()}),b.$popup.on("click",function(a){a.stopPropagation()}),b.$screen.on("click",function(a){a.preventDefault(),b.closeModal()})},changeRoyal:function(){var b=this;a.MAT.mixins.localStorageHelpers.setLocal("tendency","royal"),b.$arrow.animate({left:"25%"}),b.$body.removeClass("rebel").addClass("royal")},changeRebel:function(){var b=this;a.MAT.mixins.localStorageHelpers.setLocal("tendency","rebel"),b.$arrow.animate({left:"75%"}),b.$body.removeClass("royal").addClass("rebel")},openModal:function(){var b=this;b.$body.on("click",b.closeModal),b.$body.append(b.$screen),b.$body.append(b.$popup),setTimeout(function(){b.$screen.addClass("on"),b.$popup.find(".hero-popup").addClass("on"),b.$popup.find("a").on("click",function(b){a.HOME.publish("linkClicked",b)})},500),b.positionModal(),a.SITE.ui.$window.on("touchmove",b.preventDefault)},positionModal:function(){var b=this,c=b.$popup.find(".hero-popup"),d=c.height()/a.SITE.ui.$window.height();d+.2>1&&c.css({top:"5%","font-size":parseInt(c.css("font-size"),10)/d*.9+"px"})},closeModal:function(){var a=this;a.$screen.removeClass("on"),a.$popup.find(".hero-popup").removeClass("on"),a.$body.off("click",a.closeModal),setTimeout(function(){a.$screen.detach(),a.$popup.detach()},500),SITE.ui.$window.off("touchmove",a.preventDefault)},preventDefault:function(a){a.preventDefault()}}})(this)
;(function(a){"use strict",a.BOOKMARK={}})(this)
;(function(a){function b(a,b){var c=this;c.init(a,b)}"use strict",b.prototype.init=function(a,b){var c=this,d=0;c.$el=$(a),c.data=new Backbone.Collection(b),c.currCard=c.data.at(0),c.timeOut=null,c.$cardContainer=c.$el.find(".slides"),c.$slider=c.$el.find(".cards-slider"),c.$screen=$('<div class="screen"></div>'),c.$modal=$('<div class="card-modal"></div>'),c.$tooltip=$("<div />").css({position:"absolute","pointer-events":"none"}),c.frontTemplate=_.template(c.$el.find("#card-front-template").html()),c.backTemplate=_.template(c.$el.find("#card-back-template").html()),c.tooltipTemplate=_.template(c.$el.find("#card-tooltip-template").html()),_.each(c.data.models,function(a){a.set("id",d),d++}),c.parseData(),c.render(),c.bindEvents()},b.prototype.parseData=function(){_.each(this.data.models,function(a){var b=a.get("bunchballName").split("-");b=b[0]+"."+b[1],a.set("bunchballAction","click.card."+b)})},b.prototype.bindEvents=function(){var a=this;_.bindAll(this),a.$el.on("click",".card-unlocked",a.onUnlockedClick),a.$el.on("mouseenter",".card-locked",a.onLockedMouseEnter),a.$el.on("mouseleave",".card-locked",a.onLockedMouseLeave),a.$el.on("mousemove",".card-locked",a.onLockedMouseMove),a.$screen.on("click",a.onScreenClick),a.$modal.on("click",".card-flip",a.onFlipClick),a.$modal.on("click",".modal-close",a.onCloseClick)},b.prototype.onUnlockedClick=function(a){this.currCard=this.data.get($(a.currentTarget).attr("data-card-id")),this.$modal.html(this.backTemplate(this.currCard.toJSON())),this.openCardModal()},b.prototype.onLockedMouseEnter=function(a){var b=this;b.currCard=b.data.get($(a.currentTarget).attr("data-card-id")),b.showTooltip(a)},b.prototype.onLockedMouseLeave=function(a){this.hideTooltip(a)},b.prototype.onLockedMouseMove=function(a){this.tooltipFollowMouse(a)},b.prototype.tooltipFollowMouse=function(a){this.$tooltip.css({left:a.pageX+"px",top:a.pageY+4+"px"})},b.prototype.onScreenClick=function(a){this.closeCardModal()},b.prototype.onFlipClick=function(a){a.preventDefault(),this.flipCard()},b.prototype.onCloseClick=function(a){a.preventDefault(),this.closeCardModal()},b.prototype.flipCard=function(){this.$modal.find(".card-container").toggleClass("flip")},b.prototype.openCardModal=function(){this.$screen.css({opacity:0}),this.$modal.css({opacity:0}),$("body").append(this.$screen),$("body").append(this.$modal),this.$screen.animate({opacity:1}),this.$modal.animate({opacity:1})},b.prototype.closeCardModal=function(){var a=this;a.$screen.animate({opacity:0},function(){a.$screen.detach()}),a.$modal.animate({opacity:0},function(){a.$modal.detach()})},b.prototype.showTooltip=function(b){function d(a){c.tooltipFollowMouse(a),c.hideTooltip(a,c.$lastHovered)}var c=this;if(!c.isToolTipVisible){c.$lastHovered=$(b.target),a.SITE.ui.$body.append(this.$tooltip),c.$tooltip.stop().html(c.tooltipTemplate(c.currCard.toJSON())).css({opacity:0}).animate({opacity:1},100,function(){c.isToolTipVisible=!0});var e=$.trim(c.$tooltip.find(".bookmark-tooltip").text()).length;e>115?c.$tooltip.find(".bookmark-tooltip").addClass("extremely-long-text"):e>100?c.$tooltip.find(".bookmark-tooltip").addClass("very-long-text"):e>80?c.$tooltip.find(".bookmark-tooltip").addClass("extra-long-text"):e>64?c.$tooltip.find(".bookmark-tooltip").addClass("longer-text"):e>50&&c.$tooltip.find(".bookmark-tooltip").addClass("long-text"),c.$tooltip.off("mousemove",d),c.$tooltip.on("mousemove",d)}},b.prototype.hideTooltip=function(a,b){function k(){d.stop().detach(),_.delay(function(){c.isToolTipVisible=!1},10)}var c=this,d=c.$tooltip,e,f,g,h,i,j;a?(e=a.pageX,f=a.pageY,g=b||$(a.target),h=g.offset(),i=h.left+g.outerWidth(),j=h.top+g.outerHeight(),(e<h.left||f<h.top||e>i||f>j)&&k()):k()},b.prototype.render=function(){var a=this;a.$cardContainer.append(a.frontTemplate({cards:a.data.toJSON()})),a.$slider.flexslider({animation:"slide",directionNav:!0,controlNav:!1,slideshow:!1,animationLoop:!1,pauseOnHover:!0,before:function(){a.hideTooltip()}})},a.BOOKMARK.Cards=b})(this)
;(function(a){"use strict";var b=a.BOOKMARK.challengeList={init:function(){$(".bookmark-challenges").each(function(){function m(a){switch(a){case"Experience Points":return"experience";case"Gold Charms":return"gold-charms";case"Gem Charms":return"gem-charms";default:return""}}function n(){var b={},d={};c.empty(),_.each(a.SITE.user.attrs.challenges,function(a){a=_.extend(a,{pointClass:m(a.pointCategory),className:a.completionCount===0?"incomplete":"completed",completed:a.completionCount===0?0:1,description:a.description||"",level:a.level||0})}),b=_.sortBy(a.SITE.user.attrs.challenges,function(a){return a.dateCompleted}),d=_.filter(b,function(b){return b.level<=a.SITE.user.attrs.level.name}),_.each(d,function(a){c.append(h(a))}),e.tinyscrollbar({sizethumb:71})}function o(){a.MAT.nitro.callProxyAPI({endPoint:"/site/level"},p)}function p(a){i=a,q()}function q(){var b=0,c=0;i&&a.SITE.user.attrs.level.description!="Level 1"&&_.each(i,function(d){d.description===a.SITE.user.attrs.level.description&&(c=b),b++}),r()}function r(){var b=(a.SITE.user.attrs.points.points-a.SITE.user.attrs.level.points)/(k-a.SITE.user.attrs.level.points)*100;g.css("width",b+"%")}function s(){n(),o(),f.html(a.SITE.user.attrs.level.name),l.hide().detach()}function t(b){b==="challenges"&&(s(),a.SITE.user.unsubscribe("attrSet",t))}var b=$(this),c,d,e=b.find(".scroll-window"),f=b.find(".level"),g=b.find(".bar"),h=_.template($("#challenge-item-template").html()),i,j=0,k=0,l=new a.SITE.ui.Spinner(".bookmark-challenges>.scroll-window");c=b.find("ul"),a.SITE.user.attrs.challenges?s():(a.SITE.user.subscribe("attributeSet",t),a.SITE.user.getChallenges())})}}})(this)
;(function(a){"use strict";var b=a.BOOKMARK.dailyQuestion={init:function(){var b=this;this.answer="",this.checkCompleted(),a.SITE.user.attrs.alliance.percentRebel?b.adjustMeter():(a.SITE.user.subscribe("getUserAttributes:complete",function(){b.adjustMeter()}),a.SITE.user.getUserAttributes())},adjustMeter:function(){$(".meter-arrow").show().css({left:a.SITE.user.attrs.alliance.percentRebel*100+"%"})},checkCompleted:function(){var b=this,c=!1,d="neutral";a.MAT.nitro.callProxyAPI({endPoint:"user/action/today"},function(a){_.each(a,function(a){a.tags.indexOf("answer.daily.question")!==-1&&(c=!0,a.tags.indexOf("rebel")!==-1?d="rebel":d="royal")}),c?b.showCompleted(d):b.setupQuestion()})},showCompleted:function(b){$(".tendency-question").each(function(){var c=$(this),d=c.find(".completed-question"),e=store.get("dailyQuestionAnswer:"+a.SITE.user.attrs.userID);e&&d.find("."+b).html(e.answer),d.fadeIn("fast"),d.find("."+b).show(),$(".tendency-question-link").hide()})},setupQuestion:function(){var b=this;$(".tendency-question").each(function(){function k(){d.detach(),e.animate({opacity:0},function(){e.detach()}),i.html(""),e.find("input[name=tendency]:checked").attr("checked",!1)}function l(c){c.Error?i.addClass("error").html("Something went wrong!"):(k(),a.MAT.mixins.localStorageHelpers.setLocal("dailyQuestionAnswer:"+a.SITE.user.attrs.userID,{answer:b.answer}),setTimeout(function(){b.checkCompleted(),a.SITE.nitro.showPendingNotifications("notificationsCallback")},500))}var c=$(this),d=$('<div class="screen"></div>'),e=c.find(".question-modal"),f=e.find("label"),g=e.find(".modal-close"),h=e.find("input[type=submit]"),i=e.find(".question-modal-message"),j=c.find(".tendency-question-link");e.detach().css({display:"block"}),j.show(),j.on("click",function(a){a.preventDefault(),$("body").append(d),$("body").append(e),e.css({top:$(window).height()/3-e.height()/2+"px"}),e.animate({opacity:1})}),g.on("click",function(a){a.preventDefault(),k()}),d.on("click",function(a){k()}),f.on("click",function(a){f.removeClass("checked"),$(a.target).addClass("checked").closest("input").attr("checked",!0)}),h.on("click",function(c){var d=e.find("input[name=tendency]:checked").val();c.preventDefault();if(!d)i.addClass("error").html(a.LOCALIZATION.boookmark.answerRequired);else{var f=d==="rebel"?"answer.daily.question.rebel":"answer.daily.question.royal";b.answer=e.find(".checked").text(),a.SITE.user.logAction(f,l)}})})}}})(this)
;(function(a){"use strict";var b=a.BOOKMARK.story={init:function(){var b=this,c=$(".unlocked-challenges h3"),d;a.SITE.user.subscribe("unlockedStories:set",function(){c.text(a.SITE.user.attrs.unlockedStories)}),$(".stories-slider").flexslider({directionNav:!0,controlNav:!1,slideshow:!1,start:b.showFirstUnlockedStory}),$(".story-locked").each(function(){function g(a,b){var c=a.pageX,e=a.pageY,g=b||$(a.target),h=g.offset(),i=h.left+g.outerWidth(),j=h.top+g.outerHeight();(c<h.left||e<h.top||c>i||e>j)&&d.stop().animate({opacity:0},100,function(){d.css("display","none"),f=!1})}function h(){f||(a.SITE.ui.$body.append(d),d.stop().css("display","block").animate({opacity:1},100,function(){f=!0}))}var b=$(this),c=b.find(".story-locked-graphic, .after-story"),d=b.find(".bookmark-tooltip"),e,f=!1,i=$.trim(d.text()).length;i>115?d.addClass("extremely-long-text"):i>100?d.addClass("very-long-text"):i>80?d.addClass("extra-long-text"):i>64?d.addClass("longer-text"):i>50&&d.addClass("long-text"),c.on("mouseenter",function(a){e=$(a.target),h()}),c.on("mouseleave",function(a){g(a)}),c.on("mousemove",function(a){d.css({left:a.pageX+"px",top:a.pageY+4+"px"})}),d.on("mousemove",function(a){d.css({left:a.pageX+"px",top:a.pageY+4+"px"}),g(a,e)})}),$(".story-unlocked").not(".clone").each(function(){function o(){$("body").append(c),$("body").append(e)}function p(){c.detach(),e.detach(),m.html(""),e.find("input[name=tendency]:checked").attr("checked",!1),f.removeClass("checked")}function q(c){var e=_.bind(a.SITE.user.getUnlockedStories,a.SITE.user);c.Error?m.addClass("error").html("Something went wrong!"):(p(),j.hide(),b.removeClass("story-unlocked").addClass("story-answered"),b.addClass(d),i.find("."+d).slideDown("slow"),_.delay(e,2e3))}function r(a){return}var b=$(this),c=$('<div class="screen"></div>'),e=b.find(".question-modal"),f=e.find("label"),g=b.find(".story-unlock"),h=b.find(".story-unlock-graphic"),i=b.find(".story-ending"),j=b.find(".story-unlock-container"),k=e.find(".modal-close"),l=e.find("input[type=submit]"),m=e.find(".question-modal-message"),n=b.attr("data-bunchball-name");e.detach().css({display:"block"}),g.on("click",function(a){a.preventDefault(),o()}),h.on("click",function(a){a.preventDefault(),o()}),k.on("click",function(a){a.preventDefault(),p()}),c.on("click",function(a){p()}),f.on("click",function(a){f.removeClass("checked"),$(a.target).addClass("checked").closest("input").attr("checked",!0)}),l.on("click",function(b){var c=e.find("input[name=tendency]:checked").val(),f="complete.story."+n.replace(/-/g,"."),g;b.preventDefault(),c?(g=c==="rebel"?f+".rebel":f+".royal",d=c,a.SITE.user.logAction(g,q)):m.addClass("error").html(a.LOCALIZATION.boookmark.answerRequired)})})},showFirstUnlockedStory:function(){var a=$(".stories-slider .slides li.story-unlocked").index();a>-1&&$(".stories-slider").flexslider(a)}}})(this)
;(function(a){"use strict",a.GAME={},_.extend(a.GAME,a.MAT.mixins.pubSub)})(this)
;(function(a){"use strict";var b={},c=a.GAME.cards={init:function(){var a=this,b=$(".unlocked .card-image");$(".cards-slider").flexslider({animation:"slide",directionNav:!0,controlNav:!1,slideshow:!1}),b.each(function(c){a.setupCard(b[c])})},setupCard:function(c){function h(b){var c=e.data("bunchballname").split("-"),d;c=c[0]+"."+c[1],a.SITE.user.logAction("click.card."+c),b.preventDefault(),$.modal(g,{zIndex:10,opacity:100,autoResize:!0,overlayClose:!0}),d=g.find("a.card-flip"),d.on("click",function(a){a.preventDefault(),g.toggleClass("flip")})}var d=this,e=$(c),f=_.template(b.cardModal),g=$(f({backImage:e.data("cardbackimage"),cardImage:e.attr("src"),cardLevel:e.data("cardlevel"),cardType:e.data("cardtype").toLowerCase(),characterDescription:e.data("characterdescription"),characterName:e.data("charactername"),levelHeading:e.data("levelheading"),subTitle:e.data("subtitle"),tagline:e.data("cardtagline"),flipCard:a.localizationText.flipCard}));e.on("click",function(a){h(a)}),e.on("touchend",function(a){var b=!1;$(window).one("characterNav:sliding",function(){b=!0}),_.delay(function(){b===!1&&h(a)},10)})}};b.cardModal=['<div class="card-container">','<div class="character-card card-<%= cardType %>">','<div class="card-front">','<img class="card-image" src="<%= cardImage %>">','<div class="card-level">','<h4 class="card-level-heading"><%= levelHeading %></h4>',"<%= cardLevel %>","</div>",'<div class="card-title">','<h1 class="card-heading"><%= characterName %></h1>','<small class="card-subheading"><%= subTitle %></small>',"</div>","</div>",'<div class="card-back" style="background-image: url(<%= backImage %>);">',"<section>",'<h2 class="card-back__heading"><%= characterName %></h2>',"<%= characterDescription %>",'<h4 class="card-back__tagline"><%= tagline %></h4>',"</section>","</div>","</div>",'<div><a class="card-flip" data-tealium-page="<%= characterName %> Flip" href="#"><%=flipCard%></a></div>',"</div>"].join("\n")})(this)
;(function(a){"use strict";var b=a.SITE.user,c=b.settings.catalogs.avatar.catalogName,d={width:540,height:670,debug:!1,name:"AvatarShopPreview",sliders:{hats:{activatedBy:"click",position:{x:64,y:0},hitArea:{x:287,y:40,width:121,height:80},allowEmpty:!0,itemAssetBaseUrl:"",sliderData:undefined},hand_accessory:{activatedBy:"click",position:{x:64,y:0},hitArea:{x:415,y:189,width:93,height:106},allowEmpty:!0,itemAssetBaseUrl:"",sliderData:undefined},neck_accessory:{activatedBy:"click",position:{x:64,y:0},hitArea:{x:329,y:178,width:48,height:31},allowEmpty:!0,itemAssetBaseUrl:"",sliderData:undefined},lips:{position:{x:64,y:0},allowEmpty:!1,itemAssetBaseUrl:"",sliderData:undefined},hair:{position:{x:64,y:0},width:150,height:150,hitArea:{x:213,y:69,width:230,height:100},allowEmpty:!1,itemAssetBaseUrl:"",sliderData:undefined},skins:{position:{x:64,y:0},itemAssetBaseUrl:"",allowEmpty:!1,sliderData:undefined},tops:{position:{x:64,y:0},itemAssetBaseUrl:"",hitArea:{x:235,y:176,width:231,height:69},allowEmpty:!1,sliderData:undefined},eyes:{position:{x:64,y:0},itemAssetBaseUrl:"",allowEmpty:!1,sliderData:undefined},bottoms:{position:{x:64,y:0},itemAssetBaseUrl:"",hitArea:{x:235,y:246,width:231,height:157},allowEmpty:!1,sliderData:undefined},leggings:{position:{x:64,y:0},itemAssetBaseUrl:"",hitArea:{x:297,y:339,width:92,height:242},allowEmpty:!0,sliderData:undefined},footwear:{position:{x:64,y:0},allowEmpty:!1,itemAssetBaseUrl:"",hitArea:{x:290,y:489,width:106,height:104},sliderData:undefined},capes:{position:{x:64,y:0},allowEmpty:!0,itemAssetBaseUrl:"",hitArea:{x:25,y:41,width:640,height:559},sliderData:undefined}}},e;e=function(e){var f=this;f.init=function(){var a=this,d=a.settings.sliders,e=b.attrs.ownedItems,f="avatar-shop-preview",g=new Kinetic.Stage({container:f,width:450,height:495,scale:.8}),h=new Kinetic.Layer({width:450,height:495});g.add(h),a.stage=g,a.container=h,d.hats.sliderData=a.bbCatalogItemsToAvatarItems(e.getItemsByCategory("hats",c),"fashion"),d.hand_accessory.sliderData=a.bbCatalogItemsToAvatarItems(e.getItemsByCategory("hand_accessory",c),"fashion"),d.neck_accessory.sliderData=a.bbCatalogItemsToAvatarItems(e.getItemsByCategory("neck_accessory",c),"fashion"),d.lips.sliderData=a.bbCatalogItemsToAvatarItems(e.getItemsByCategory("lips",c),"fashion"),d.hair.sliderData=a.bbCatalogItemsToAvatarItems(e.getItemsByCategory("hair",c),"fashion"),d.skins.sliderData=a.bbCatalogItemsToAvatarItems(e.getItemsByCategory("skins",c),"fashion"),d.tops.sliderData=a.bbCatalogItemsToAvatarItems(e.getItemsByCategory("tops",c),"fashion").concat(a.bbCatalogItemsToAvatarItems(e.getItemsByCategory("dresses",c),"fashion")),d.eyes.sliderData=a.bbCatalogItemsToAvatarItems(e.getItemsByCategory("eyes",c),"fashion"),d.bottoms.sliderData=a.bbCatalogItemsToAvatarItems(e.getItemsByCategory("bottoms",c),"fashion"),d.leggings.sliderData=a.bbCatalogItemsToAvatarItems(e.getItemsByCategory("leggings",c),"fashion"),d.footwear.sliderData=a.bbCatalogItemsToAvatarItems(e.getItemsByCategory("footwear",c),"fashion"),d.capes.sliderData=a.bbCatalogItemsToAvatarItems(e.getItemsByCategory("capes",c),"fashion"),a._state=a._state||{},a.initEditor(),a.bindEvents()},f.updateSliderWithCatalogItem=function(a,b){function i(){f._state.inTransition=!1,c.unsubscribe("slider:slideChanged",i),c.unsubscribe("slider:noSlideChangeNeeded",i)}if(f.sliders[b]===undefined)throw new Error('Slider with name: "'+b+'" not found. Options are: '+_.keys(f.sliders).join(", "));if(a===undefined)throw new Error("catalog item required.");f._state.inTransition=!0;var c=f.sliders[b],d=f.bbCatalogItemsToAvatarItems([a],"fashion"),e=c.slides,g=!1,h;_.each(e,function(b,c){if(b.id!=="empty"&&b.catalogItem.catalogItemId===a.catalogItemId)return g=!0,h=c,!1}),c.subscribe("slider:slideChanged",i),c.subscribe("slider:noSlideChangeNeeded",i),g!==!1?c.gotoSlide(h):(c.subscribeOnce("slider:allAssetsLoaded",function(){d=d[0],h=c.slides.push(d)-1,c.addSlideToStage(d),c.activeSlideID=!1,c.gotoSlide(h)}),c.getAllSlideAssets(d))},a.MAT.Avatar.call(f,e,d)},_.extend(e.prototype,a.MAT.Avatar.prototype),a.GAME.AvatarShopPreview=e})(this)
;(function(a){"use strict",a.PROMOS={addSlider:function(a){function d(){var a=b.find(".flex-active-slide a");c.attr("href",a.attr("href"))}var b=$(a),c;c=b.find(".anchor-overlay"),b.flexslider({animationLoop:!0,directionNav:!1,animation:"slide",start:d,after:d})}}})(this)
;(function(a){function b(a){this.selector=a,this.$el=$(this.selector),this.$spinner=this.$el.find(".spinner"),this.init()}"use strict",b.prototype={init:function(){var b=this;a.SITE.user.subscribe("unlockedStories:set",function(){b.$el.find(".story-unlocked-badge").html(a.SITE.user.attrs.unlockedStories)})}},a.PROMOS.UnlockedStory=b})(this)
;(function(a){"use strict",a.ONBOARDING={init:function(b,c){var d=this;HOME.preLaunchHero.init(b),ONBOARDING.codeEntry.init(c),a.HOME.subscribe("linkClicked",function(a){var b=$(a.currentTarget);b.hasClass("enter-code")&&(HOME.preLaunchHero.closeModal(),ONBOARDING.codeEntry.openModal())})}},_.extend(a.HOME,a.MAT.mixins.pubSub)})(this)
;(function(a){"use strict",ONBOARDING.codeEntry={$arrow:$(".meter-arrow"),$body:$("body"),popupClass:".code-entry-popup",init:function(a){var b=this;b.$screen=$("<div/>").addClass("code-entry-popup-screen"),b.popupTemplate=_.template($("#code-entry-popup-template").html()),b.$popup=$("<div/>"),b.$codeEnteredChallenge={},b.$settings=a,$("#code-entry .button").on("click",function(a){a.preventDefault(),a.stopPropagation(),b.openModal()}),b.$popup.on("click",".popup-close",function(a){a.preventDefault(),b.closeModal()}),b.$popup.on("click",function(a){a.stopPropagation()}),b.$screen.on("click",function(a){a.preventDefault(),b.closeModal()})},openModal:function(){var b=this;b.$popup.html(b.popupTemplate({})),b.populateWithUserData(),b.$body.on("click",b.closeModal),b.$body.append(b.$screen),b.$body.append(b.$popup),b.$screen.addClass("on"),b.$popup.find("button.add").on("click",function(a){b.addButtonClick.apply(b,arguments)}),b.$popup.find("button.remove").on("click",function(a){b.removeButtonClick.apply(b,arguments)}),b.$popup.find("button.submit").on("click",function(a){b.submitButtonClick.apply(b,arguments)}),b.$popup.find("div.code input").on("keypress",function(a){b.inputKeyPress.apply(b,arguments)}),b.$popup.find("div.code input").on("keyup",function(a){b.inputKeyup.apply(b,arguments)}),b.positionModal(),a.SITE.ui.$window.on("touchmove",b.preventDefault)},positionModal:function(){var b=this,c=b.$popup.find(b.popupClass),d=c.height()/a.SITE.ui.$window.height();d+.2>1&&c.css({top:"5%","font-size":parseInt(c.css("font-size"),10)/d*.9+"px"})},closeModal:function(){var a=this;a.$screen.removeClass("on"),a.$body.off("click",a.closeModal),a.$popup.find(a.popupClass).removeClass("on"),a.$screen.detach(),a.$popup.detach(),SITE.ui.$window.off("touchmove",a.preventDefault)},focusAndSelect:function(){var a=this;a.$popup.find("div.code input").first().focus().select()},preventDefault:function(a){a.preventDefault()},populateWithUserData:function(){function d(a){var c=a;b.setUserChallenge(c),b.renderCompletedActions(),b.$popup.find(b.popupClass).addClass("on"),b.setButtonStates(),b.setInputStates()}function e(){b.setErrorCondition("some error")}var b=this,c=b.$popup.find("div.code input");a.MAT.nitro.callProxyAPI({endPoint:"/user/challenge?challengeName=".concat("enter-onboarding-codes")},d,e)},renderCompletedActions:function(){function d(a){$.each(a,function(){var a=this;if(a.tags.indexOf("code.entered")==-1)return;var c=a.tags.split(".").pop();if(!b.isTagAlreadyRendered(c)){var d=b.$popup.find("input").first(),e=$("<div/>").html(b.$codeEnteredChallenge.pointAward).addClass("gem-charms"),f=$("<div/>").html(c).addClass("decorate");d.replaceWith(f[0].outerHTML+e[0].outerHTML)}}),b.setButtonStates(),b.setInputStates()}function e(a){console.log("Error getting user actions")}var b=this;if(!b.$codeEnteredChallenge||!b.$codeEnteredChallenge.rules)return;var c=[];$.each(b.$codeEnteredChallenge.rules.rule,function(){var a=this;c.push(a.actionTag)}),a.MAT.nitro.callProxyAPI({type:"GET",endPoint:"/user/action/",tags:c},d,e)},setButtonStates:function(){var a=this,b=a.$popup.find("button.submit"),c=a.$popup.find("button.add"),d=a.$popup.find("button.remove"),e=a.$popup.find("input");c.removeClass("disabled").removeAttr("disabled"),b.removeClass("disabled").removeAttr("disabled"),d.removeClass("disabled").removeAttr("disabled");var f=!1;e.filter(":visible").first().val()&&(f=e.filter(":visible").first().val().length>0),(e.filter(":visible").length!==0||e.length===0)&&c.addClass("disabled").attr("disabled","disabled"),f||b.addClass("disabled").attr("disabled","disabled")},setInputStates:function(){var a=this,b=a.$popup.find("input");b.not(":first").hide(),b.filter(":first").show().focus()},setUserChallenge:function(a){if(!a)return;var b=this,c=[];a instanceof Array&&a.length!==0&&(c=$.grep(a,function(a){return a.name==="enter-onboarding-codes"})),c.length!==0&&(b.$codeEnteredChallenge=c[0])},setErrorCondition:function(a){var b=this,c=b.$popup.find("div.code");if(c.find(".error").length!=0)return;var d=b.$popup.find("button.remove"),e=c.find("input:visible").first(),f=b.$popup.find("button.submit");c.find(e).before($("<div/>").addClass("error").html(a)),f.addClass("disabled").attr("disabled","disabled"),d.show(),e.addClass("error"),b.focusAndSelect()},removeErrorCondition:function(){var a=this,b=a.$popup.find("button.remove"),c=a.$popup.find("div.code"),d=c.find("input:visible").first();d.removeClass("error"),d.val("").focus(),c.find("div.error").remove(),b.hide()},isCodeAlreadyEntered:function(a){var b=this;if(b.$codeEnteredChallenge&&b.$codeEnteredChallenge.rules){var c=$.grep(b.$codeEnteredChallenge.rules.rule,function(b){return b.achieved&&b.actionTag===a});if(c&&c.length>0)return b.setErrorCondition(b.$settings.duplicateCodeErrorText),!0}return!1},isTagAlreadyRendered:function(a){var b=this,c=b.$popup.find("div.decorate"),d=!1;return $.each(c,function(){var b=$(this);b.html()===a&&(d=!0)}),d},addButtonClick:function(a){var b=this,c=b.$popup.find("div.code input");c.filter(":visible").length<1&&c.filter(":hidden").first().show().focus()},removeButtonClick:function(a){var b=this;b.removeErrorCondition(),b.setButtonStates()},submitButtonClick:function(b){function f(a){a.length===0?c.setErrorCondition(c.$settings.duplicateCodeErrorText):(c.setUserChallenge(a),c.renderCompletedActions())}function g(a,b){c.setErrorCondition(b)}var c=this,d=$.trim(c.$popup.find("input:visible").first().val());if(!d||d.length==0)return!1;var e="code.entered.".concat(d);if(c.isCodeAlreadyEntered(e))return!1;a.MAT.nitro.callProxyAPI({type:"POST",endPoint:"/user/action/".concat(e)},f,g)},inputKeyPress:function(a){var b=this;a.which==13&&(a.preventDefault(),b.submitButtonClick.apply(b,arguments))},inputKeyup:function(a){var b=this;b.setButtonStates()}}})(this)
