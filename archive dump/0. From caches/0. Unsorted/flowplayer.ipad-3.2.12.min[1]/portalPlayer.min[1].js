if(typeof console==="undefined"){console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}}}XDVideo.version="PP 1.0.07";XDVideo.minPlayerVersion="10.2.0";function XDVideo(){if(location===top.location){throw"You can't navigate here directly. I need to be loaded into an iframe!";return}else{if(typeof swfobject==="undefined"){throw"SWFObject is required";return}else{if(swfobject.hasFlashPlayerVersion(XDVideo.minPlayerVersion)!==true){throw"Flash Player "+XDVideo.minPlayerVersion+" or later is required";return}else{if(typeof $.fn.strobemediaplayback==="undefined"){throw"jquery.strobemediaplayback is required";return}else{if(typeof $.fn.strobemediaplaybackchrome==="undefined"){throw"jquery.strobemediaplaybackchrome is required";return}}}}}ProxyEvent={};ProxyEvent.onJavaScriptBridgeCreated="onJavaScriptBridgeCreated";ProxyEvent.Ready="ready";ProxyEvent.AdStart="adStart";ProxyEvent.AdStop="adStop";ProxyEvent.TimeUpdate="timeupdate";ProxyEvent.Progress="progress";ProxyEvent.Complete="complete";ProxyEvent.DurationChange="durationchange";ProxyEvent.VolumeChange="volumechange";ProxyEvent.Seeked="seeked";ProxyEvent.Seeking="seeking";ProxyEvent.LoadedMetadata="loadedmetadata";ProxyEvent.Waiting="waiting";ProxyEvent.Pause="pause";ProxyEvent.Play="play";ProxyEvent.LoadStart="loadstart";ProxyEvent.Emptied="emptied";ProxyEvents=[ProxyEvent.Ready,ProxyEvent.Complete,ProxyEvent.Seeked,ProxyEvent.Seeking,ProxyEvent.LoadedMetadata,ProxyEvent.Pause,ProxyEvent.Play,ProxyEvent.AdStart,ProxyEvent.AdStop];config={};options={};player={};chrome={};this.userInteractionEnabled=true;this.gameContainer=null;this.videoContainer=null;this.init=function(l,n,m){this.gameContainer=$(n);this.videoContainer=$(l);if(this.gameContainer.length===0){throw n+" not found! Unable to continue."}else{if(this.videoContainer.length===0){throw l+" not found! Unable to continue."}}this.gameContainer.hide();this.videoContainer.empty().html('<div id="strobemediaplayback"><div id="strobemediaplayback-video"></div></div>');$(this).bind("videoComplete",function(o){if(o.isDefaultPrevented()===true){return}this.removeVideoAndShowGame()});this.loadConfig(m)};this.normaliseUrlPaths=function(m){var l=this;$.each(m,function(n,o){console.log(n+" => "+o);if(typeof o==="string"){if(o.indexOf("/")===0){m[n]=window.location.protocol+"//"+window.location.host+o}}else{if(typeof o==="object"){l.normaliseUrlPaths(o)}}});return m};this.loadConfig=function(n){var p;var o=this;var q=document.location.search,l=this;if(q.charAt(0)==="?"){q=q.substring(1)}if(q&&q.length>0){var m=f(q);if(m.showVideo==="false"){this.handleConfig({showVideo:"false"})}else{if(typeof m.configURL==="undefined"){m.configURL=n}if(typeof m.configURL!=="undefined"){$.ajax({dataType:"json",url:m.configURL,success:function(t,u){var s=f(q);p=e(s,true);var r=$.extend(true,{},t,p);console.log("Config JSON loaded OK!",r);l.handleConfig(o.normaliseUrlPaths(r))},error:function(r,t,s){console.warn("Error loading config JSON - "+m.configURL+" - "+t);l.handleConfig(null)}})}else{p=e(m);this.handleConfig(o.normaliseUrlPaths(p))}}}else{throw"No valid config passed via query string, unable to continue."}};this.handleConfig=function(l){if(l===null){console.warn("Config failed, skipping video.");i()}else{if(l.showVideo==="false"){console.info("showVideo=false, skipping video set-up...");i()}else{console.info("XDVideo "+XDVideo.version);console.info("XDVideo playerName = "+l.playerName);c(l)}}};this.removeVideoAndShowGame=function(){this.gameContainer.show();var l=$("#strobemediaplayback object:first").attr("id");if(!!l){swfobject.removeSWF(l)}this.videoContainer.remove()};function f(r){var p,o,l={},m=r.split("&"),o,q=m.length;for(p=0;p<q;p++){o=m[p].split("=");l[o[0]]=o[1]}return l}function e(l,o){var n=null;if(typeof l.playerName==="undefined"){n="playerName not set, unable to continue"}else{if(typeof l.adXML==="undefined"){n="player adXML not set, unable to continue"}else{if(typeof l.progressive==="undefined"&&(typeof l.streamServer==="undefined"||typeof l.streamProgram==="undefined")){n="player progressive media path, and/or streaming path, not set. unable to continue"}}}if(n!==null&&o!==true){console.warn(n);return null}var m={showVideo:l.showVideo,playerName:l.playerName,swf:l.swf,expressInstall:l.expressInstall,adXML:l.adXML,copyXML:l.copyXML,mediaConfig:{stream:{server:l.streamServer,program:l.streamProgram},progressive:l.progressive}};return m}function c(o){o.width=$(window).width();o.height=$(window).height();g();var n=o.swf||"/CatalogueApplication/resources/iframe/xdPlayer_1.2.0.2.swf";var u=o.expressInstall||"/CatalogueApplication/resources/iframe/expressInstall.swf";var s=o.copyXML||"/CatalogueApplication/resources/iframe/default_copy.xml";$.fn.strobemediaplayback.defaults.swf=n;$.fn.strobemediaplayback.defaults.expressInstallSwfUrl=u;$.fn.strobemediaplayback.defaults.minimumFlashPlayerVersion=XDVideo.minPlayerVersion;options={id:"xdPlayer_pp_"+o.playerName,playerName:o.playerName,playerType:"default",copyXML:s,adXML:o.adXML,src:d(o.mediaConfig),width:o.width,height:o.height,controlBarMode:"docked",autoPlay:true,controlBarAutoHide:true,playButtonOverlay:false,enableStageVideo:true};var r={},m=window.location.search;if(m){m=m.substring(1);r=$.fn.strobemediaplayback.parseQueryString(m)}options=$.extend({},options,r);var p=$("#strobemediaplayback-video").strobemediaplayback(options);player=p[0];chrome=p.strobemediaplaybackchrome(options);var q=ProxyEvents.length;while(--q>-1){$(player).bind(ProxyEvents[q],function(v){h(v)})}var l=["strobemediaplayback","strobemediaplayback-video"];var t;while(t=l.shift()){$("div#"+t).css("width",options.width+"px").css("height",options.height+"px")}}function i(){k();j()}function a(){$($.xdVideo).trigger("adStart")}function k(){$($.xdVideo).trigger("adComplete")}function j(){$($.xdVideo).trigger("videoComplete")}function h(l){switch(l.type){case ProxyEvent.Ready:break;case ProxyEvent.AdStart:b(true);a();break;case ProxyEvent.AdStop:b(false);k();break;case ProxyEvent.Complete:i();break}}function b(l){this.userInteractionEnabled=(l===false);$.xdVideo.userInteractionEnabled=this.userInteractionEnabled}function g(){$.fn.adaptiveexperienceconfigurator.rules.push(function(m,l){if(m.isAndroid&&(m.isTablet||m.isPhone)){m.setOption(l,"controlBarType",m.isTablet?"tablet":"smartphone")}})}function d(p){var r=p.progressive;var q=p.stream.server?p.stream.server:null;var m=p.stream.program?p.stream.program:null;if(q!==null&&q.length>0&&m!==null&&m.length>0){var l=m.split(".");var n=l.length>0?l[0]:"";var o=l.length>1?l[1]:"";if(o==="flv"){r=q+"/"+n}else{if(o==="mp4"||o==="f4v"||o==="mov"||o==="m4v"||o==="mp4v"){r=q+"/mp4:"+m}else{console.warn("XDVideo::processMediaURL no file extension...")}}}if(r===null||r===undefined||r.length===0){console.warn("XDVideo::processMediaURL failed to find any media for this item!")}return r}};