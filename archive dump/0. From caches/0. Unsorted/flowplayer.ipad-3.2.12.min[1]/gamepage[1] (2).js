/*! Copyright (c) 2007-2012 SPIL GAMES. DO NOT COPY THIS CODE. */
(function(b){b.fn.dEllipsis=function(d){var f=this;var e={wordsInRow:1,overflowElement:"p",textElement:"p span",wordDelimiter:" ",textEnd:"...",shortSteps:false,wrapInWidth:false};d=b.extend(e,d);var g=null;var c=function(){f=b.makeArray(f);var h=function(n){var l=n.parent();var m=l.css("word-wrap");l.css("word-wrap","normal");n.css("word-wrap","normal");n.html(n.html().replace("-","_"));var j=parseInt(n.offset().left)+parseInt(n.width());n.css("word-wrap","");l.css("word-wrap",m);n.html(n.html().replace("_","-"));return j};b(f).each(function(){g=b(this).find(d.textElement+":first");if(g.length==0){return}if(g.text().length==0){return}var n=b(this).find(d.textElement);var m=b(this).find(d.overflowElement);var q=0;if(d.wrapInWidth){var p=parseInt(m.offset().left)+parseInt(m.width());var j=h(n);if(j>p){if(b(this).find(d.textElement).prev().length){b(this).find(d.textElement).before("<br />")}else{while(p<j){n.text(n.text().substring(0,n.text().length-(d.textEnd.length+1))+d.textEnd);j=h(n)}}}}if(m.css("height")!="auto"){q=parseInt(m.css("height"))}else{q=parseInt(m.height())}while(q<parseInt(n.height())){var o=Math.round(Math.abs(((parseInt(n.height())-parseInt(q))/parseInt(n.css("font-size").slice(0,-2)))))*-1*d.wordsInRow;var l=n.text().split(d.wordDelimiter).length;if(o>-2&&l>2&&!d.shortSteps){o=-2}n.text(b(this).find(d.textElement).text().split(d.wordDelimiter).slice(0,o).join(d.wordDelimiter)+d.textEnd)}})};return c()}})(jQuery);var intCheckCookies=function(){$.cookie("_spill_tst_cookie",123);tmp=parseInt($.cookie("_spill_tst_cookie"));$.cookie("_spill_tst_cookie",null);if(tmp==123){return 1}return 0};var intUrlSet=function(){if(intCheckCookies()==1){$.cookie("_intSPIL",document.location.href,{expires:10,path:"/"})}};var intUrlGet=function(b){if((intCheckCookies()==1)&&($.cookie("_intSPIL")!=null)){top.location.href=$.cookie("_intSPIL");return true}else{top.location.href=b;return true}};(function(b){b.fn.dcarousel=function(p){var m=this;var d=undefined;var j=0;var e={auto:1,size:1,scroll:1,width:100,beforeAnimate:"",afterAnimate:""};p=b.extend(e,p);var o=function(q){g();j=q;c()};var f=function(){clearTimeout(d);d=setTimeout(function(){c()},p.auto*1000)};var g=function(){clearTimeout(d)};var l=function(){d=setTimeout(function(){c()},p.auto*1000)};var c=function(){if(d){g()}if(j==p.size){j=0}b(m).find("li").find("a").unbind("mouseenter").unbind("mouseleave");b(m).find("li").eq(j).find("a").mouseenter(function(){g()}).mouseleave(function(){l()});b(".rotatorButtons li, .rotatorButtons li a").removeClass("current");b(".rotatorButtons li").eq(j).addClass("current").find("a").addClass("current");n(j);j++;l()};var n=function(q){b(m).animate({left:-1*q*p.width},500)};var h=function(){try{b(m).bind("animate",function(){c()});b(m).bind("setPos",function(r,s){o(s)});b(m).bind("stopAnimate",function(){g()});b(m).bind("startAnimate",function(){l()});b(m).bind("resetTimeout",function(){resetTimeout()});i=0;b(".rotatorButtons li a").each(function(){b(this).attr("No",i).click(function(){b(m).trigger("setPos",[b(this).attr("No")]);return false});i++});c()}catch(q){}};return h()}})(jQuery);$('a[rel~="external"]').attr("target","_blank");if($.browser.msie){$(".bookmarkButton").css("display","inline-block")}var clearText=function(b){if(b.defaultValue==b.value){b.value=""}};$("input#searchtext").focus(function(){clearText(this);$(this).addClass("is-focused")});$(".m-search a.btn").click(function(){$("form#search2").submit();return false});$("form#search2").submit(function(){return checkSFValid(this,"search",2)});$("a#searchlink").click(function(){$("form#search2").submit();return false});$(window).load(function(){$("img[src*='100x75']").imgError({noimage:"/img/noimage_small.gif"});$("img[src*='100X75']").imgError({noimage:"/img/noimage_small.gif"});$("img[src*='200x120']").imgError({noimage:"/img/noimage.gif"});$("img[src*='200X120']").imgError({noimage:"/img/noimage.gif"});$("img[src*='/cimg/subcatthumbnails/']").imgError({noimage:"/img/noimage.gif"})});CreateBookmarkLink=function(e){var b=document.location.href;if(window.sidebar&&!document.all){window.sidebar.addPanel(e,b,"")}else{if(window.external){window.external.AddFavorite(b,e)}else{if(window.opera&&window.print){return false}}}};function OAS_exibiuPropaganda(c){var b=document.getElementById(c).innerHTML.toString().toUpperCase();if(b.indexOf("OBJECT")!=-1||b.indexOf("EMBED")!=-1||b.indexOf("IMG")!=-1){return(b.indexOf("DEFAULT/EMPTY.GIF")==-1)}else{return false}}function CreateBookmarkLink(b,c){if(window.sidebar&&!document.all){window.sidebar.addPanel(c,b,"")}else{if(window.external){window.external.AddFavorite(b,c)}else{if(window.opera&&window.print){return false}}}}(function(b){b.Autocompleter.defaults.parse=function(d){var c=d;parsed=[];try{b.each(c.searchar.resultset.result,function(){parsed.push({data:[this.suggestion],value:this.suggestion,result:this.suggestion})})}catch(f){}return parsed};b.Autocompleter.defaults.getPhrase=function(){return b("#searchtext").val()}})(jQuery);var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";String.prototype.encodeBase64=function(q){q=(typeof q=="undefined")?false:q;var g,d,b,s,p,m,l,h,j=[],f="",o,r,n;r=q?this.encodeUTF8():this;o=r.length%3;if(o>0){while(o++<3){f+="=";r+="\0"}}for(o=0;o<r.length;o+=3){g=r.charCodeAt(o);d=r.charCodeAt(o+1);b=r.charCodeAt(o+2);s=g<<16|d<<8|b;p=s>>18&63;m=s>>12&63;l=s>>6&63;h=s&63;j[o/3]=b64.charAt(p)+b64.charAt(m)+b64.charAt(l)+b64.charAt(h)}n=j.join("");n=n.slice(0,n.length-f.length)+f;return n};String.prototype.decodeBase64=function(f){f=(typeof f=="undefined")?false:f;var g,e,b,p,m,j,h,r,l=[],q,o;o=f?this.decodeUTF8():this;for(var n=0;n<o.length;n+=4){p=b64.indexOf(o.charAt(n));m=b64.indexOf(o.charAt(n+1));j=b64.indexOf(o.charAt(n+2));h=b64.indexOf(o.charAt(n+3));r=p<<18|m<<12|j<<6|h;g=r>>>16&255;e=r>>>8&255;b=r&255;l[n/4]=String.fromCharCode(g,e,b);if(h==64){l[n/4]=String.fromCharCode(g,e)}if(j==64){l[n/4]=String.fromCharCode(g)}}q=l.join("");return f?q.decodeUTF8():q};String.prototype.encodeUTF8=function(){var b=this.replace(/[\u0080-\u07ff]/g,function(e){var d=e.charCodeAt(0);return String.fromCharCode(192|d>>6,128|d&63)});b=b.replace(/[\u0800-\uffff]/g,function(e){var d=e.charCodeAt(0);return String.fromCharCode(224|d>>12,128|d>>6&63,128|d&63)});return b};String.prototype.decodeUTF8=function(){var b=this.replace(/[\u00c0-\u00df][\u0080-\u00bf]/g,function(e){var d=(e.charCodeAt(0)&31)<<6|e.charCodeAt(1)&63;return String.fromCharCode(d)});b=b.replace(/[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g,function(e){var d=((e.charCodeAt(0)&15)<<12)|((e.charCodeAt(1)&63)<<6)|(e.charCodeAt(2)&63);return String.fromCharCode(d)});return b};bpe=0;mask=0;radix=mask+1;digitsStr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_=!@#$%^&*()[]{}|;:,.<>/?`~ \\'\"+-";for(bpe=0;(1<<(bpe+1))>(1<<bpe);bpe++){}bpe>>=1;mask=(1<<bpe)-1;radix=mask+1;one=int2bigInt(1,1,1);t=new Array(0);ss=t;s0=t;s1=t;s2=t;s3=t;s4=t;s5=t;s6=t;s7=t;T=t;sa=t;mr_x1=t;mr_r=t;mr_a=t;eg_v=t;eg_u=t;eg_A=t;eg_B=t;eg_C=t;eg_D=t;md_q1=t;md_q2=t;md_q3=t;md_r=t;md_r1=t;md_r2=t;md_tt=t;primes=t;pows=t;s_i=t;s_i2=t;s_R=t;s_rm=t;s_q=t;s_n1=t;s_a=t;s_r2=t;s_n=t;s_b=t;s_d=t;s_x1=t;s_x2=t,s_aa=t;function findPrimes(f){var c,d,e,b;d=new Array(f);for(c=0;c<f;c++){d[c]=0}d[0]=2;e=0;for(;d[e]<f;){for(c=d[e]*d[e];c<f;c+=d[e]){d[c]=1}e++;d[e]=d[e-1]+1;for(;d[e]<f&&d[d[e]];d[e]++){}}b=new Array(e);for(c=0;c<e;c++){b[c]=d[c]}return b}function millerRabin(d,c){var g,f,e,h;if(mr_x1.length!=d.length){mr_x1=dup(d);mr_r=dup(d);mr_a=dup(d)}copyInt_(mr_a,c);copy_(mr_r,d);copy_(mr_x1,d);addInt_(mr_r,-1);addInt_(mr_x1,-1);e=0;for(g=0;g<mr_r.length;g++){for(f=1;f<mask;f<<=1){if(d[g]&f){h=(e<mr_r.length+bpe?e:0);g=mr_r.length;f=mask}else{e++}}}if(h){rightShift_(mr_r,h)}powMod_(mr_a,mr_r,d);if(!equalsInt(mr_a,1)&&!equals(mr_a,mr_x1)){f=1;while(f<=h-1&&!equals(mr_a,mr_x1)){squareMod_(mr_a,d);if(equalsInt(mr_a,1)){return 0}f++}if(!equals(mr_a,mr_x1)){return 0}}return 1}function bitSize(b){var d,e,c;for(d=b.length-1;(b[d]==0)&&(d>0);d--){}for(e=0,c=b[d];c;(c>>=1),e++){}e+=bpe*d;return e}function expand(b,d){var c=int2bigInt(0,(b.length>d?b.length:d)*bpe,0);copy_(c,b);return c}function randTruePrime(c){var b=int2bigInt(0,c,0);randTruePrime_(b,c);return trim(b,1)}function mod(b,d){var c=dup(b);mod_(c,d);return trim(c,1)}function addInt(b,d){var c=expand(b,b.length+1);addInt_(c,d);return trim(c,1)}function mult(b,d){var c=expand(b,b.length+d.length);mult_(c,d);return trim(c,1)}function powMod(b,e,d){var c=expand(b,d.length);powMod_(c,trim(e,2),trim(d,2),0);return trim(c,1)}function sub(b,d){var c=expand(b,(b.length>d.length?b.length+1:d.length+1));sub_(c,d);return trim(c,1)}function add(b,d){var c=expand(b,(b.length>d.length?b.length+1:d.length+1));add_(c,d);return trim(c,1)}function inverseMod(b,e){var c=expand(b,e.length);var d;d=inverseMod_(c,e);return d?trim(c,1):null}function multMod(b,e,d){var c=expand(b,d.length);multMod_(c,e,d);return trim(c,1)}function randTruePrime_(s,h){var q,f,g,u,l,b,d,o,p,e,n;if(primes.length==0){primes=findPrimes(30000)}if(pows.length==0){pows=new Array(512);for(l=0;l<512;l++){pows[l]=Math.pow(2,l/511-1)}}q=0.1;f=20;recLimit=20;if(s_i2.length!=s.length){s_i2=dup(s);s_R=dup(s);s_n1=dup(s);s_r2=dup(s);s_d=dup(s);s_x1=dup(s);s_x2=dup(s);s_b=dup(s);s_n=dup(s);s_i=dup(s);s_rm=dup(s);s_q=dup(s);s_a=dup(s);s_aa=dup(s)}if(h<=recLimit){g=(1<<((h+2)>>1))-1;copyInt_(s,0);for(u=1;u;){u=0;s[0]=1|(1<<(h-1))|Math.floor(Math.random()*(1<<h));for(l=1;(l<primes.length)&&((primes[l]&g)==primes[l]);l++){if(0==(s[0]%primes[l])){u=1;break}}}carry_(s);return}d=q*h*h;if(h>2*f){for(b=1;h-h*b<=f;){b=pows[Math.floor(Math.random()*512)]}}else{b=0.5}n=Math.floor(b*h)+1;randTruePrime_(s_q,n);copyInt_(s_i2,0);s_i2[Math.floor((h-2)/bpe)]|=(1<<((h-2)%bpe));divide_(s_i2,s_q,s_i,s_rm);p=bitSize(s_i);for(;;){for(;;){randBigInt_(s_R,p,0);if(greater(s_i,s_R)){break}}addInt_(s_R,1);add_(s_R,s_i);copy_(s_n,s_q);mult_(s_n,s_R);multInt_(s_n,2);addInt_(s_n,1);copy_(s_r2,s_R);multInt_(s_r2,2);for(o=0,l=0;(l<primes.length)&&(primes[l]<d);l++){if(modInt(s_n,primes[l])==0){o=1;break}}if(!o){if(!millerRabin(s_n,2)){o=1}}if(!o){addInt_(s_n,-3);for(l=s_n.length-1;(s_n[l]==0)&&(l>0);l--){}for(e=0,w=s_n[l];w;(w>>=1),e++){}e+=bpe*l;for(;;){randBigInt_(s_a,e,0);if(greater(s_n,s_a)){break}}addInt_(s_n,3);addInt_(s_a,2);copy_(s_b,s_a);copy_(s_n1,s_n);addInt_(s_n1,-1);powMod_(s_b,s_n1,s_n);addInt_(s_b,-1);if(isZero(s_b)){copy_(s_b,s_a);powMod_(s_b,s_r2,s_n);addInt_(s_b,-1);copy_(s_aa,s_n);copy_(s_d,s_b);GCD_(s_d,s_n);if(equalsInt(s_d,1)){copy_(s,s_aa);return}}}}}function randBigInt(f,e){var d,c;d=Math.floor((f-1)/bpe)+2;c=int2bigInt(0,0,d);randBigInt_(c,f,e);return c}function randBigInt_(c,g,f){var e,d;for(e=0;e<c.length;e++){c[e]=0}d=Math.floor((g-1)/bpe)+1;for(e=0;e<d;e++){c[e]=Math.floor(Math.random()*(1<<(bpe-1)))}c[d-1]&=(2<<((g-1)%bpe))-1;if(f==1){c[d-1]|=(1<<((g-1)%bpe))}}function GCD(b,e){var c,d;c=dup(b);d=dup(e);GCD_(c,d);return c}function GCD_(n,m){var l,j,c,h,g,f,b,e,d;if(T.length!=n.length){T=dup(n)}d=1;while(d){d=0;for(l=1;l<m.length;l++){if(m[l]){d=1;break}}if(!d){break}for(l=n.length;!n[l]&&l>=0;l--){}j=n[l];c=m[l];h=1;g=0;f=0;b=1;while((c+f)&&(c+b)){e=Math.floor((j+h)/(c+f));qp=Math.floor((j+g)/(c+b));if(e!=qp){break}t=h-e*f;h=f;f=t;t=g-e*b;g=b;b=t;t=j-e*c;j=c;c=t}if(g){copy_(T,n);linComb_(n,m,h,g);linComb_(m,T,b,f)}else{mod_(n,m);copy_(T,n);copy_(n,m);copy_(m,T)}}if(m[0]==0){return}t=modInt(n,m[0]);copyInt_(n,m[0]);m[0]=t;while(m[0]){n[0]%=m[0];t=n[0];n[0]=m[0];m[0]=t}}function inverseMod_(b,d){var c=1+2*Math.max(b.length,d.length);if(!(b[0]&1)&&!(d[0]&1)){copyInt_(b,0);return 0}if(eg_u.length!=c){eg_u=new Array(c);eg_v=new Array(c);eg_A=new Array(c);eg_B=new Array(c);eg_C=new Array(c);eg_D=new Array(c)}copy_(eg_u,b);copy_(eg_v,d);copyInt_(eg_A,1);copyInt_(eg_B,0);copyInt_(eg_C,0);copyInt_(eg_D,1);for(;;){while(!(eg_u[0]&1)){halve_(eg_u);if(!(eg_A[0]&1)&&!(eg_B[0]&1)){halve_(eg_A);halve_(eg_B)}else{add_(eg_A,d);halve_(eg_A);sub_(eg_B,b);halve_(eg_B)}}while(!(eg_v[0]&1)){halve_(eg_v);if(!(eg_C[0]&1)&&!(eg_D[0]&1)){halve_(eg_C);halve_(eg_D)}else{add_(eg_C,d);halve_(eg_C);sub_(eg_D,b);halve_(eg_D)}}if(!greater(eg_v,eg_u)){sub_(eg_u,eg_v);sub_(eg_A,eg_C);sub_(eg_B,eg_D)}else{sub_(eg_v,eg_u);sub_(eg_C,eg_A);sub_(eg_D,eg_B)}if(equalsInt(eg_u,0)){if(negative(eg_C)){add_(eg_C,d)}copy_(b,eg_C);if(!equalsInt(eg_v,1)){copyInt_(b,0);return 0}return 1}}}function inverseModInt(d,g){var e=1,c=0,f;for(;;){if(d==1){return e}if(d==0){return 0}c-=e*Math.floor(g/d);g%=d;if(g==1){return c}if(g==0){return 0}e-=c*Math.floor(d/g);d%=g}}function inverseModInt_(b,c){return inverseModInt(b,c)}function eGCD_(d,l,h,e,c){var j=0;var f=Math.max(d.length,l.length);if(eg_u.length!=f){eg_u=new Array(f);eg_A=new Array(f);eg_B=new Array(f);eg_C=new Array(f);eg_D=new Array(f)}while(!(d[0]&1)&&!(l[0]&1)){halve_(d);halve_(l);j++}copy_(eg_u,d);copy_(h,l);copyInt_(eg_A,1);copyInt_(eg_B,0);copyInt_(eg_C,0);copyInt_(eg_D,1);for(;;){while(!(eg_u[0]&1)){halve_(eg_u);if(!(eg_A[0]&1)&&!(eg_B[0]&1)){halve_(eg_A);halve_(eg_B)}else{add_(eg_A,l);halve_(eg_A);sub_(eg_B,d);halve_(eg_B)}}while(!(h[0]&1)){halve_(h);if(!(eg_C[0]&1)&&!(eg_D[0]&1)){halve_(eg_C);halve_(eg_D)}else{add_(eg_C,l);halve_(eg_C);sub_(eg_D,d);halve_(eg_D)}}if(!greater(h,eg_u)){sub_(eg_u,h);sub_(eg_A,eg_C);sub_(eg_B,eg_D)}else{sub_(h,eg_u);sub_(eg_C,eg_A);sub_(eg_D,eg_B)}if(equalsInt(eg_u,0)){if(negative(eg_C)){add_(eg_C,l);sub_(eg_D,d)}multInt_(eg_D,-1);copy_(e,eg_C);copy_(c,eg_D);leftShift_(h,j);return}}}function negative(b){return((b[b.length-1]>>(bpe-1))&1)}function greaterShift(b,f,c){var e=b.length,d=f.length;k=((e+c)<d)?(e+c):d;for(i=d-1-c;i<e&&i>=0;i++){if(b[i]>0){return 1}}for(i=e-1+c;i<d;i++){if(f[i]>0){return 0}}for(i=k-1;i>=c;i--){if(b[i-c]>f[i]){return 1}else{if(b[i-c]<f[i]){return 0}}}return 0}function greater(b,e){var d;var c=(b.length<e.length)?b.length:e.length;for(d=b.length;d<e.length;d++){if(e[d]){return 0}}for(d=e.length;d<b.length;d++){if(b[d]){return 1}}for(d=c-1;d>=0;d--){if(b[d]>e[d]){return 1}else{if(b[d]<e[d]){return 0}}}return 0}function divide_(v,p,e,d){var l,h;var g,f,u,o,m,s,n;copy_(d,v);for(h=p.length;p[h-1]==0;h--){}n=p[h-1];for(s=0;n;s++){n>>=1}s=bpe-s;leftShift_(p,s);leftShift_(d,s);for(l=d.length;d[l-1]==0&&l>h;l--){}copyInt_(e,0);while(!greaterShift(p,d,l-h)){subShift_(d,p,l-h);e[l-h]++}for(g=l-1;g>=h;g--){if(d[g]==p[h-1]){e[g-h]=mask}else{e[g-h]=Math.floor((d[g]*radix+d[g-1])/p[h-1])}for(;;){o=(h>1?p[h-2]:0)*e[g-h];m=o>>bpe;o=o&mask;u=m+e[g-h]*p[h-1];m=u>>bpe;u=u&mask;if(m==d[g]?u==d[g-1]?o>(g>1?d[g-2]:0):u>d[g-1]:m>d[g]){e[g-h]--}else{break}}linCombShift_(d,p,-e[g-h],g-h);if(negative(d)){addShift_(d,p,g-h);e[g-h]--}}rightShift_(p,s);rightShift_(d,s)}function carry_(e){var g,f,h,d;f=e.length;h=0;for(g=0;g<f;g++){h+=e[g];d=0;if(h<0){d=-(h>>bpe);h+=d*radix}e[g]=h&mask;h=(h>>bpe)-d}}function modInt(b,f){var d,e=0;for(d=b.length-1;d>=0;d--){e=(e*radix+b[d])%f}return e}function int2bigInt(d,e,f){var c,b;b=Math.ceil(e/bpe)+1;b=f>b?f:b;buff=new Array(b);copyInt_(buff,d);return buff}function str2bigInt(o,e,c){var l,h,g,n,m,b;var f=o.length;if(e==-1){n=new Array(0);for(;;){m=new Array(n.length+1);for(h=0;h<n.length;h++){m[h+1]=n[h]}m[0]=parseInt(o,10);n=m;l=o.indexOf(",",0);if(l<1){break}o=o.substring(l+1);if(o.length==0){break}}if(n.length<c){m=new Array(c);copy_(m,n);return m}return n}n=int2bigInt(0,e*f,0);for(h=0;h<f;h++){l=digitsStr.indexOf(o.substring(h,h+1),0);if(e<=36&&l>=36){l-=26}if(l<e&&l>=0){multInt_(n,e);addInt_(n,l)}}for(f=n.length;f>0&&!n[f-1];f--){}f=c>f+1?c:f+1;m=new Array(f);b=f<n.length?f:n.length;for(h=0;h<b;h++){m[h]=n[h]}for(;h<f;h++){m[h]=0}return m}function equalsInt(b,d){var c;if(b[0]!=d){return 0}for(c=1;c<b.length;c++){if(b[c]){return 0}}return 1}function equals(b,e){var d;var c=b.length<e.length?b.length:e.length;for(d=0;d<c;d++){if(b[d]!=e[d]){return 0}}if(b.length>e.length){for(;d<b.length;d++){if(b[d]){return 0}}}else{for(;d<e.length;d++){if(e[d]){return 0}}}return 1}function isZero(b){var c;for(c=0;c<b.length;c++){if(b[c]){return 0}}return 1}function bigInt2str(b,f){var d,c,e="";if(s6.length!=b.length){s6=dup(b)}else{copy_(s6,b)}if(f==-1){for(d=b.length-1;d>0;d--){e+=b[d]+","}e+=b[0]}else{while(!isZero(s6)){c=divInt_(s6,f);e=digitsStr.substring(c,c+1)+e}}if(e.length==0){e="0"}return e}function dup(b){var c;buff=new Array(b.length);copy_(buff,b);return buff}function copy_(b,e){var d;var c=b.length<e.length?b.length:e.length;for(d=0;d<c;d++){b[d]=e[d]}for(d=c;d<b.length;d++){b[d]=0}}function copyInt_(b,f){var d,e;for(e=f,d=0;d<b.length;d++){b[d]=e&mask;e>>=bpe}}function addInt_(e,j){var g,f,h,d;e[0]+=j;f=e.length;h=0;for(g=0;g<f;g++){h+=e[g];d=0;if(h<0){d=-(h>>bpe);h+=d*radix}e[g]=h&mask;h=(h>>bpe)-d;if(!h){return}}}function rightShift_(b,e){var d;var c=Math.floor(e/bpe);if(c){for(d=0;d<b.length-c;d++){b[d]=b[d+c]}for(;d<b.length;d++){b[d]=0}e%=bpe}for(d=0;d<b.length-1;d++){b[d]=mask&((b[d+1]<<(bpe-e))|(b[d]>>e))}b[d]>>=e}function halve_(b){var c;for(c=0;c<b.length-1;c++){b[c]=mask&((b[c+1]<<(bpe-1))|(b[c]>>1))}b[c]=(b[c]>>1)|(b[c]&(radix>>1))}function leftShift_(b,e){var d;var c=Math.floor(e/bpe);if(c){for(d=b.length;d>=c;d--){b[d]=b[d-c]}for(;d>=0;d--){b[d]=0}e%=bpe}if(!e){return}for(d=b.length-1;d>0;d--){b[d]=mask&((b[d]<<e)|(b[d-1]>>(bpe-e)))}b[d]=mask&(b[d]<<e)}function multInt_(e,j){var g,f,h,d;if(!j){return}f=e.length;h=0;for(g=0;g<f;g++){h+=e[g]*j;d=0;if(h<0){d=-(h>>bpe);h+=d*radix}e[g]=h&mask;h=(h>>bpe)-d}}function divInt_(b,f){var c,e=0,d;for(c=b.length-1;c>=0;c--){d=e*radix+b[c];b[c]=Math.floor(d/f);e=d%f}return e}function linComb_(e,m,f,d){var h,l,g,j;g=e.length<m.length?e.length:m.length;j=e.length;for(l=0,h=0;h<g;h++){l+=f*e[h]+d*m[h];e[h]=l&mask;l>>=bpe}for(h=g;h<j;h++){l+=f*e[h];e[h]=l&mask;l>>=bpe}}function linCombShift_(e,m,d,h){var g,l,f,j;f=e.length<h+m.length?e.length:h+m.length;j=e.length;for(l=0,g=h;g<f;g++){l+=e[g]+d*m[g-h];e[g]=l&mask;l>>=bpe}for(g=f;l&&g<j;g++){l+=e[g];e[g]=l&mask;l>>=bpe}}function addShift_(b,j,f){var e,h,d,g;d=b.length<f+j.length?b.length:f+j.length;g=b.length;for(h=0,e=f;e<d;e++){h+=b[e]+j[e-f];b[e]=h&mask;h>>=bpe}for(e=d;h&&e<g;e++){h+=b[e];b[e]=h&mask;h>>=bpe}}function subShift_(b,j,f){var e,h,d,g;d=b.length<f+j.length?b.length:f+j.length;g=b.length;for(h=0,e=f;e<d;e++){h+=b[e]-j[e-f];b[e]=h&mask;h>>=bpe}for(e=d;h&&e<g;e++){h+=b[e];b[e]=h&mask;h>>=bpe}}function sub_(b,h){var e,g,d,f;d=b.length<h.length?b.length:h.length;for(g=0,e=0;e<d;e++){g+=b[e]-h[e];b[e]=g&mask;g>>=bpe}for(e=d;g&&e<b.length;e++){g+=b[e];b[e]=g&mask;g>>=bpe}}function add_(b,h){var e,g,d,f;d=b.length<h.length?b.length:h.length;for(g=0,e=0;e<d;e++){g+=b[e]+h[e];b[e]=g&mask;g>>=bpe}for(e=d;g&&e<b.length;e++){g+=b[e];b[e]=g&mask;g>>=bpe}}function mult_(b,d){var c;if(ss.length!=2*b.length){ss=new Array(2*b.length)}copyInt_(ss,0);for(c=0;c<d.length;c++){if(d[c]){linCombShift_(ss,b,d[c],c)}}copy_(b,ss)}function mod_(b,c){if(s4.length!=b.length){s4=dup(b)}else{copy_(s4,b)}if(s5.length!=b.length){s5=dup(b)}divide_(s4,c,s5,b)}function multMod_(b,e,d){var c;if(s0.length!=2*b.length){s0=new Array(2*b.length)}copyInt_(s0,0);for(c=0;c<e.length;c++){if(e[c]){linCombShift_(s0,b,e[c],c)}}mod_(s0,d);copy_(b,s0)}function squareMod_(o,b){var g,f,l,m,h,p,e;for(h=o.length;h>0&&!o[h-1];h--){}e=h>b.length?2*h:2*b.length;if(s0.length!=e){s0=new Array(e)}copyInt_(s0,0);for(g=0;g<h;g++){m=s0[2*g]+o[g]*o[g];s0[2*g]=m&mask;m>>=bpe;for(f=g+1;f<h;f++){m=s0[g+f]+2*o[g]*o[f]+m;s0[g+f]=(m&mask);m>>=bpe}s0[g+h]=m}mod_(s0,b);copy_(o,s0)}function trim(b,c){var d,e;for(d=b.length;d>0&&!b[d-1];d--){}e=new Array(d+c);copy_(e,b);return e}function powMod_(b,h,g){var f,e,c,d;if(s7.length!=g.length){s7=dup(g)}if((g[0]&1)==0){copy_(s7,b);copyInt_(b,1);while(!equalsInt(h,0)){if(h[0]&1){multMod_(b,s7,g)}divInt_(h,2);squareMod_(s7,g)}return}copyInt_(s7,0);for(c=g.length;c>0&&!g[c-1];c--){}d=radix-inverseModInt(modInt(g,radix),radix);s7[c]=1;multMod_(b,s7,g);if(s3.length!=b.length){s3=dup(b)}else{copy_(s3,b)}for(f=h.length-1;f>0&!h[f];f--){}if(h[f]==0){copyInt_(b,1);return}for(e=1<<(bpe-1);e&&!(h[f]&e);e>>=1){}for(;;){if(!(e>>=1)){f--;if(f<0){mont_(b,one,g,d);return}e=1<<(bpe-1)}mont_(b,b,g,d);if(e&h[f]){mont_(b,s3,g,d)}}}function mont_(m,h,b,o){var e,d,g,l,p;var q=b.length;var f=h.length;if(sa.length!=q){sa=new Array(q)}for(;q>0&&b[q-1]==0;q--){}copyInt_(sa,0);for(e=0;e<q;e++){p=sa[0]+m[e]*h[0];l=((p&mask)*o)&mask;g=(p+l*b[0])>>bpe;p=m[e];for(d=1;d<f;d++){g+=sa[d]+p*h[d]+l*b[d];sa[d-1]=g&mask;g>>=bpe}for(;d<q;d++){g+=sa[d]+l*b[d];sa[d-1]=g&mask;g>>=bpe}sa[d-1]=g&mask}if(!greater(b,sa)){sub_(sa,b)}copy_(m,sa)}function generateNonce(n){var j=new Array(n);var l=Math.floor(Math.random()*18446744073709552000);var m=Math.floor(l/4294967296);var h=l%4294967296;for(var g=0;g<4;g++){j[g]=(m>>>g*8)&255}for(var g=0;g<4;g++){j[g+4]=(h>>>g*8)&255}return j}function Cipher(p,l){var q=4;var m=l.length/q-1;var n=[[],[],[],[]];for(var o=0;o<4*q;o++){n[o%4][Math.floor(o/4)]=p[o]}n=AddRoundKey(n,l,0,q);for(var r=1;r<m;r++){n=SubBytes(n,q);n=ShiftRows(n,q);n=MixColumns(n,q);n=AddRoundKey(n,l,r,q)}n=SubBytes(n,q);n=ShiftRows(n,q);n=AddRoundKey(n,l,m,q);var j=new Array(4*q);for(var o=0;o<4*q;o++){j[o]=n[o%4][Math.floor(o/4)]}return j}function SubBytes(c,f){for(var h=0;h<4;h++){for(var g=0;g<f;g++){c[h][g]=Sbox[c[h][g]]}}return c}function ShiftRows(l,g){var c=new Array(4);for(var j=1;j<4;j++){for(var h=0;h<4;h++){c[h]=l[j][(h+j)%g]}for(var h=0;h<4;h++){l[j][h]=c[h]}}return l}function MixColumns(c,m){for(var b=0;b<4;b++){var n=new Array(4);var o=new Array(4);for(var l=0;l<4;l++){n[l]=c[l][b];o[l]=c[l][b]&128?c[l][b]<<1^283:c[l][b]<<1}c[0][b]=o[0]^n[1]^o[1]^n[2]^n[3];c[1][b]=n[0]^o[1]^n[2]^o[2]^n[3];c[2][b]=n[0]^n[1]^o[2]^n[3]^o[3];c[3][b]=n[0]^o[0]^n[1]^n[2]^o[3]}return c}function AddRoundKey(l,h,n,c){for(var m=0;m<4;m++){for(var j=0;j<c;j++){l[m][j]^=h[n*4+j][m]}}return l}function KeyExpansion(o){var q=4;var s=o.length/4;var n=s+6;var p=new Array(q*(n+1));var m=new Array(4);for(var r=0;r<s;r++){var u=[o[4*r],o[4*r+1],o[4*r+2],o[4*r+3]];p[r]=u}for(var r=s;r<(q*(n+1));r++){p[r]=new Array(4);for(var l=0;l<4;l++){m[l]=p[r-1][l]}if(r%s==0){m=SubWord(RotWord(m));for(var l=0;l<4;l++){m[l]^=Rcon[r/s][l]}}else{if(s>6&&r%s==4){m=SubWord(m)}}for(var l=0;l<4;l++){p[r][l]=p[r-s][l]^m[l]}}return p}function SubWord(d){for(var c=0;c<4;c++){d[c]=Sbox[d[c]]}return d}function RotWord(e){var f=e[0];for(var d=0;d<3;d++){e[d]=e[d+1]}e[3]=f;return e}var Sbox=[99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22];var Rcon=[[0,0,0,0],[1,0,0,0],[2,0,0,0],[4,0,0,0],[8,0,0,0],[16,0,0,0],[32,0,0,0],[64,0,0,0],[128,0,0,0],[27,0,0,0],[54,0,0,0]];function AESEncryptCtr(H,K,c){var y=16;if(!(c==128||c==192||c==256)){return""}H=H.encodeUTF8();var G=8;var C=generateNonce(y);var I=String.fromCharCode(G+8);for(var B=0;B<G;B++){I+=String.fromCharCode(C[B])}for(var B=0;B<8;B++){I+=String.fromCharCode(0)}var F=KeyExpansion(K);var J=Math.ceil(H.length/y);var z=new Array(J);for(var b=0;b<J;b++){for(var x=0;x<4;x++){C[15-x]=(b>>>x*8)&255}for(var x=0;x<4;x++){C[15-x-4]=(b/4294967296>>>x*8)}var A=Cipher(C,F);var D=b<J-1?y:(H.length-1)%y+1;var L=new Array(D);for(var B=0;B<D;B++){L[B]=A[B]^H.charCodeAt(b*y+B);L[B]=String.fromCharCode(L[B])}z[b]=L.join("")}var E=I+z.join("");E=E.encodeBase64();return E}function AESGetKey(h,m){if(!(m==128||m==192||m==256)){return""}h=h.encodeUTF8();var j=m/8;var l=new Array(j);for(var n=0;n<j;n++){l[n]=isNaN(h.charCodeAt(n))?0:h.charCodeAt(n)}var g=Cipher(l,KeyExpansion(l));g=g.concat(g.slice(0,j-16));return g}function AESBigKey(n,o){if(!(o==128||o==192||o==256)){return""}var l=o/8;var p=new Array(l);var m=bigInt2str(n,16);for(var h=Math.ceil(m.length/2);h>0;h--){var j=m.substring(m.length-2,m.length);p[h-1]=parseInt(j,16);m=m.substring(0,m.length-2)}if(n.length>l){p=p.slice(0,l-1)}else{if(n.length<l){for(h=n.length;h<l;h++){p[h]=0}}}var m="";for(h=0;h<p.length;h++){m+=p[h]+", "}return p}jQuery.DHExchange=(function(){var h={};var j=4000;var f=(-1*j);var d=[];var s=0;var m;var q=[3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997,1009,1013,1019,1021];var c=0,b=0,o=0,n=0,l=0,p=0;var e="";h.reset=function(){c=0;b=0;o=0;n=0;l=0;p=0;e=""};var r=function(y){var x;if(y==q[s]&&s<q.length-1){return q[++s]}if(y<q[q.length-1]){for(x=q.length-2;x>0;x--){if(q[x]<=y){s=x+1;return q[x+1]}}}var u,v;y++;if((y&1)==0){y++}for(;;){if(y-f>j||y<f){for(x=j-1;x>=0;x--){d[x]=0}f=y;m=q.concat()}if(d[y-f]==0){for(x=0;x<m.length;x++){if((u=m[x])&&y%u==0){for(v=y-f;v<j;v+=u){d[v]=u}y+=2;m[x]=0;break}}if(x>=m.length){return y}}else{y+=2}}};var g=function(){var u=0;do{u=r(Math.floor(Math.random()*1000000))}while(u<16385);return int2bigInt(u,128,2)};h.initialized=function(u){return p!=0&&e==u};h.initKey=function(){h.reset();c=g();b=g();o=g();l=powMod(c,o,b);return{p:bigInt2str(c,10),q:bigInt2str(b,10),d:bigInt2str(l,10)}};h.generateSharedKey=function(u){n=str2bigInt(u,-1,8*bpe);p=powMod(n,o,b)};h.encryptMessage=function(u){return AESEncryptCtr(new String(u),AESBigKey(p,128),128)};return h})();SPI.geoip=(function($){var config={settings:{url:"/lc/pb/1/country",geoiprule_url:"/geoip/%1$s.json",timeout:7000,cookieName:"_SPI_geoip",cookieDisplayedName:"_SPI_geoip_displayed",cookieRules:{path:"/",expires:365}}};var that={};var redirectTo="-1";var ruleDomain=null;var getRedirectCookie=function(){redirectTo=$.cookie(config.settings.cookieName)||null;return redirectTo};var canPop=function(){return !(getRedirectCookie()||$.cookie(config.settings.cookieDisplayedName))};that.getRules=function(){try{if(canPop()===true){checkUserLocation(function(data){if(data&&data.locatar){country_code=data.locatar.country_code;checkRules(country_code)}})}else{if(redirectTo&&redirectTo!="-1"){SPI.geoip.redirectMe(redirectTo)}}}catch(e){}};that.readInclusions=function(currentPageType){try{checkUserLocation(function(data){if(data&&data.locatar){country_code=data.locatar.country_code;executeInclusions(country_code,currentPageType)}})}catch(e){}};var executeInclusions=function(currentCountryCode,currentPageType){if(SPI._settings.geoip.length<=0){return}for(var i=0;i<SPI._settings.geoip.length;i++){if(currentCountryCode in SPI._settings.geoip[i]){if(currentPageType in SPI._settings.geoip[i][currentCountryCode]){codeToExecute=SPI._settings.geoip[i][currentCountryCode][currentPageType];try{eval(codeToExecute)}catch(e){}}else{if("other" in SPI._settings.geoip[i][currentCountryCode]){codeToExecute=SPI._settings.geoip[i][currentCountryCode]["other"];try{eval(codeToExecute)}catch(e){}}}}}};var setRedirectCookie=function(value){$.cookie(config.settings.cookieName,value,config.settings.cookieRules)};that.dontAskAgain=function(){setRedirectCookie("-1")};that.setDisplayed=function(){$.cookie(config.settings.cookieDisplayedName,1,{path:"/"})};var checkRules=function(country_code){var callback=function(data){if(data&&data.domain&&data.domain!=""){ruleDomain=data.domain;showGeoIpBox(data)}};if(country_code!=""){var url=SPI.sprintf(config.settings.geoiprule_url,country_code);$.ajax({global:false,cache:true,timeout:config.settings.timeout,url:url,type:"GET",dataType:"json",success:callback})}};that.redirectMe=function(domain,set_cookie){if(domain!=null){window.top.location.href=domain}else{if(set_cookie){setRedirectCookie(ruleDomain)}window.top.location.href=ruleDomain}};that.getFullJsonObject=function(){var data;if($.cookie("geoIPLocation")){data=JSON.parse($.cookie("geoIPLocation"));return data.locatar}else{$.ajax({async:false,global:false,cache:true,timeout:config.settings.timeout,url:config.settings.url,type:"GET",dataType:"json",success:handleResponse,error:function(xml,mesg,error){handleResponse.call(this,{locatar:{}},"")},data:{outputtype:"json"}});data=JSON.parse($.cookie("geoIPLocation"));return data.locatar}};var checkUserLocation=function(callback){if($.cookie("geoIPLocation")){var data=JSON.parse($.cookie("geoIPLocation"));callback.call(null,data);return}$.ajax({global:false,cache:true,timeout:config.settings.timeout,url:config.settings.url,type:"GET",dataType:"json",success:handleResponse,error:function(xml,mesg,error){handleResponse.call(this,{locatar:{}},"")},after_call:callback,data:{outputtype:"json"}})};that.getData=function(callback){checkUserLocation(callback)};var handleResponse=function(data,mesg){if(data&&data.locatar&&data.locatar.errorcode!==undefined){data={locatar:{}}}$.cookie("geoIPLocation",JSON.stringify(data));if(typeof this.after_call!="undefined"){this.after_call(data)}};return that})(jQuery);var hideFlashMessage=function(){var b=$("div#flashMessage");if(b.length>0){b.fadeOut("slow")}};var showLoginPopup=function(){SpilGames.Events.publish("SPI.LoginPopup.open")};var showNotificationForSignIn=function(){$("#topBox").hide();$("#middlePinkBox").hide();$("#middleWhiteBox, .gallery-top").hide();$("#bottomLeftBox").hide();$("#bottomRightBox1").hide();$("#bottomRightBox2").hide();$("#additionalBox").hide();$(".hidenotlogged").hide();$(".profile-twocolumns").hide();$("#inboxLayout").hide();$(".unregister").hide();$('<div class="bad"><div class="text">'+SPI._langStrings.sf_global.have_to_sign_in+"</div></div>").appendTo("#flashMessage");$("#flashMessage").show();$('a[name="show_login_popup"]').click()};var redirectToPublicGalleryImage=function(b){window.location.href=SPI.sprintf(SPI._settings.myGallery.mygallery_url_details_game,b)};var redirectToParentsReminder=function(){window.location.href=SPI._settings.attention.parents_reminder_url};var redirectToSelfReminder=function(){};var redirectToProfilePage=function(){window.location.href=SPI._settings.myprofile.pageurl};var redirectToMainPage=function(){window.location.href="/"};var showPublicProfile=function(){$("#publicContainer").removeAttr("style")};var showPrivateProfile=function(){$("#publicContainer").remove();$("#privateContainer").append(SPI.render(SPI._templates.private_profile_tpl,{})).show()};var attachAvatarHovers=function(){$("div.ul_container ul li").hover(function(){$(this).addClass("hover");$(this).find(".button_group").css("display","inline-block")},function(){$(this).removeClass("hover");$(this).find(".button_group").hide()})};var loginButton=$("div#shadow .logmein");$.profilar.addInitHandler(function(){var b=$.profilar.loggedIn();changeLoginBox(b);connectRegisterButtons()});SpilGames.Events.subscribe("SPI.LoginPopup.open",function(){sendSpilEvent("login","start",window._gaPageType);$("#flashobj").css("visibility","hidden");$("#ap_preroll").css("visibility","hidden");$("#socialgame_iframe").css("visibility","hidden");$("select").css("visibility","hidden");$("#gameiframe_js").css("visibility","hidden");$("#shadow, #login_background").css("width","100%");$("#shadow, #login_background").css("height",$(document).height());setTopMarginForLoginBox();$("#shadow, #login_background").css("display","block");SpilGames.Events.publish("SPI.LoginPopup.show");$("div#shadow .error").css("display","none");$("div#shadow #loginslogan").css("display","block");$("div#shadow input").removeAttr("disabled");$("div#shadow input[name=username], div#shadow input[name=password]").val("");$("div#shadow input:text:visible:first").focus()});$('a[name="show_login_popup"]').click(function(b){b.preventDefault();SpilGames.Events.publish("SPI.LoginPopup.open")});$(".close_login_popup").bind("click",function(c,b){c.preventDefault();$("#shadow, #login_background").css("display","none");if(typeof b=="undefined"){$("#flashobj").css("visibility","visible");$("#ap_preroll").css("visibility","visible");$("#socialgame_iframe").css("visibility","visible");$("select").css("visibility","visible");$("#gameiframe_js").css("visibility","visible");$("#gameiframe, #socialgame").contents().find("#flashobj_mc").width("100%");$("#flashobj").css("vertical-align","top");sendSpilEvent("login","button-close",window._gaPageType)}});changeLoginBox=function(f){$(".m-user_navigation div.loading").hide();$(".m-user_navigation div.loaded").show();if(f){var e=$.profilar.getPref("avatar");if(e!=""){var d=SPI.sprintf(SPI._settings.avatars.small_avatar,e);$(".m-user_navigation-avatarnormal").attr("src",domain_pool.getURL(d),"cimg")}$("#avatardummy").hide();$(".m-user_navigation-avatarnormal").show();$(".m-user_navigation-logout-links").hide();$(".m-user_navigation-login-links").show();var j=$.profilar.get("username");$("#userloggedin").text(j);$.profilar.addLogoutHandler(function(l){if(typeof redirect=="undefined"){SPI.reloadSite(window.top.location.href.split("#")[0])}else{SPI.reloadSite(SPI.sprintf(redirect,l))}});var g={username:$.profilar.forService().username,hash:$.profilar.forService().hash,flags:"undeleted,unread",outputtype:"json"};var b=spil.adapters.babblar.notificationsCategories.all;var c=spil.adapters.babblar({channelId:SPI._settings.global.channel_id,siteId:SPI._settings.global.site_id,userName:$.profilar.forService().username,hash:$.profilar.forService().hash});var h=function(l){var m=l.count;if(m>0){$("div.tabs a .un_notifications_counter").show().text(m);$("div.tabs a .un_notifications_counter_right").show();$(".un_notifications_counter").show();var n=$(".un_notifications_counter").html();n=SPI.sprintf(n,m);$(".un_notifications_counter").html(n);$(".un_notifications_counter_right").show()}};c.waitUntil("countsReceived.byCategory."+b,h);c.getCountsByCategory(b)}else{$(".m-user_navigation-avatarnormal").hide();$("#avatardummy").show();$(".m-user_navigation-login-links").hide();$(".m-user_navigation-logout-links").show()}adjustSize()};var adjustSize=function(){$minWidth=$("#search_bar .m-buttonRight").width()+$("#search_bar .m-buttonLeft").width()+$("#search_bar .m-search-buttontext").width();if($(".m-user_navigation .body").width()+63<$minWidth){$(".m-user_navigation .body").width($minWidth)}};var clickActionLoginBox=function(){sendSpilEvent("login","button-login",window._gaPageType);$("div#shadow .error").css("display","none");$("div#shadow #loginslogan").css("display","block");$("div#shadow .loginIndicator").show();var d=$("div#shadow input[name=username]").removeAttr("disabled").val();var b=$("div#shadow input[name=password]").val();$("div#shadow input[name=username]").add("div#shadow input[name=password]").attr("disabled","true");loginButton.unbind("click");var c=true;if(d.length<3){c=false;sendSpilEvent("login","error-username_too_short",window._gaPageType)}if(b.length<6||$("div#shadow input#f_password_lb").is(":hidden")){c=false;sendSpilEvent("login","error-password_too_short",window._gaPageType)}if(c){$.profilar.login(d,b,$("div#shadow input[name=remember]")[0].checked,function(f){if(f){var e=f[0];$("div#shadow #loginslogan").css("display","none");if(e.code==403&&e.element=="banned"){$("div#shadow .loginsalert_banned").css("display","block")}else{$("div#shadow .loginsalert_auth").css("display","block");sendSpilEvent("login","error-username_password_unknown",window._gaPageType)}$("div#shadow input[name=username]").add("div#shadow input[name=password]").removeAttr("disabled");loginButton.click(clickActionLoginBox);$("div#shadow .loginIndicator").hide()}else{sendSpilEvent("login","success",window._gaPageType);$.profilar.checkActivation(true);if($.profilar.needActivation()){if($.profilar.needParentsConfirmation()){redirectToParentsReminder()}else{redirectToSelfReminder()}}else{window.location.reload()}}})}else{$("div#shadow #loginslogan").css("display","none");$("div#shadow .loginsalert_auth").css("display","block");$("div#shadow input[name=username]").add("div#shadow input[name=password]").removeAttr("disabled");loginButton.click(clickActionLoginBox);$("div#shadow .loginIndicator").hide()}return false};var checkLoginFBConnection=function(){$("div#shadow .error").css("display","none");$("div#shadow #loginslogan").show();if(SPI._settings.global.fbc_enabled){loginButton.unbind("click");var c=$("div#shadow input[name=username]").removeAttr("disabled").val();$("div#shadow input[name=username]").add("div#shadow input[name=password]").attr("disabled","true");var b=true;if(c.length<3){b=false;loginButton.click(clickActionLoginBox)}if(b){$.profilar.login(c,"",false,function(e){var d=true;if(typeof(e)=="object"&&e){$.each(e,function(){if(this.code==401&&this.element=="fbc"){$("div#shadow .loginsalert_fbc_only").show();$("div#shadow #loginslogan").hide()}})}if(d){loginButton.click(clickActionLoginBox)}})}$("div#shadow input[name=username]").add("div#shadow input[name=password]").removeAttr("disabled");return false}else{return true}};var setTopMarginForLoginBox=function(){var c=415;var b;var d;if(typeof(window.innerWidth)=="number"){d=window.innerHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){d=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){d=document.body.clientHeight}else{d=0}}}if(d>c){b=Math.floor((d-c)/2)}else{b=0}$("#shadow .loginbox_wrapper").attr("style","margin: "+b+"px auto 0")};loginButton.click(clickActionLoginBox);$("div#shadow form input").keypress(function(b){if((b.which&&b.which==13)||(b.keyCode&&b.keyCode==13)){return clickActionLoginBox()}else{return true}});$("div#shadow #f_login_lb").change(checkLoginFBConnection);$("#logoutbtn").click(function(){$.profilar.clearAll();return false});var flashMessage=SPI.flashMessage.get();if(flashMessage!=="undefined"&&flashMessage.length==2&&flashMessage[0]!=""){var layer=$("div#flashMessage");if(layer.length>0){layer.empty().html('<div class="'+(flashMessage[1]=="true"?"bad":"good")+'"><div class="text">'+flashMessage[0]+"</div></div>").show();setTimeout("hideFlashMessage()",5000)}}$(".f_forgotten a").click(function(){sendSpilEvent("login","link-forgot_password",window._gaPageType);setTimeout(function(){window.location=$(".f_forgotten a").attr("href")},1000);return false});$("#f_remember_lb").click(function(){if($("#f_remember_lb").attr("checked")==true){sendSpilEvent("login","keep_me_logged_in_checked",window._gaPageType)}else{sendSpilEvent("login","keep_me_logged_in_unchecked",window._gaPageType)}});function connectRegisterButtons(){$(".tc-register-url:not(.bindedOpenPopup)").click(function(){sendSpilEvent("register","link-register",window._gaPageType);SPI.sg_register.open_popup();return false});$(".tc-register-url:not(.bindedOpenPopup)").addClass("bindedOpenPopup");$('#cf_guest a[name!="show_login_popup"]:not(.bindedOpenPopup)').click(function(){sendSpilEvent("register","link-register",window._gaPageType);return false});$('#cf_guest a[name!="show_login_popup"]:not(.bindedOpenPopup)').addClass("bindedOpenPopup");$(".sign-in-button:not(.bindedOpenPopup)").click(function(){sendSpilEvent("register","link-register",window._gaPageType);return false});$(".sign-in-button:not(.bindedOpenPopup)").addClass("bindedOpenPopup");$("#registration_link").click(function(){sendSpilEvent("login","button-register",window._gaPageType);$(".close_login_popup").trigger("click","hide");SPI.sg_register.open_popup();return false});var c=function(){sendSpilEvent("register","link-register",window._gaPageType);SPI.sg_register.open_popup();return false};var b=$('.link_to_register_popup:not(.bindedOpenPopup), a[href*="'+SPI._pages.pages_map.registration+'"]:not(.bindedOpenPopup)');b.click(c);b.addClass("bindedOpenPopup")}function getAbsoluteLeft(c){var d=c.offsetLeft;var b=c.offsetParent;while(b!=null){d+=b.offsetLeft;b=b.offsetParent}return d}var _isFF=false;var _isIE=false;var _isOpera=false;var _isKHTML=false;var _isMacOS=false;if(navigator.userAgent.indexOf("Macintosh")!=-1){_isMacOS=true}if((navigator.userAgent.indexOf("Safari")!=-1)||(navigator.userAgent.indexOf("Konqueror")!=-1)){var _KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5));if(_KHTMLrv>525){_isFF=true;var _FFrv=1.9}else{_isKHTML=true}}else{if(navigator.userAgent.indexOf("Opera")!=-1){_isOpera=true;_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))}else{if(navigator.appName.indexOf("Microsoft")!=-1){_isIE=true;if(navigator.appVersion.indexOf("MSIE 8.0")!=-1&&document.compatMode!="BackCompat"){_isIE=8}}else{_isFF=true;var _FFrv=parseFloat(navigator.userAgent.split("rv:")[1])}}}dhtmlxEventable=function(obj){obj.dhx_SeverCatcherPath="";obj.attachEvent=function(name,catcher,callObj){name="ev_"+name.toLowerCase();if(!this[name]){this[name]=new this.eventCatcher(callObj||this)}return(name+":"+this[name].addEvent(catcher))};obj.callEvent=function(name,arg0){name="ev_"+name.toLowerCase();if(this[name]){return this[name].apply(this,arg0)}return true};obj.checkEvent=function(name){return(!!this["ev_"+name.toLowerCase()])};obj.eventCatcher=function(obj){var dhx_catch=[];var z=function(){var res=true;for(var i=0;i<dhx_catch.length;i++){if(dhx_catch[i]!=null){var zr=dhx_catch[i].apply(obj,arguments);res=res&&zr}}return res};z.addEvent=function(ev){if(typeof(ev)!="function"){ev=eval(ev)}if(ev){return dhx_catch.push(ev)-1}return false};z.removeEvent=function(id){dhx_catch[id]=null};return z};obj.detachEvent=function(id){if(id!=false){var list=id.split(":");this[list[0]].removeEvent(list[1])}}};function dhtmlxSlider(l,n,m,c,d,h,j,b){if(_isIE){try{document.execCommand("BackgroundImageCache",false,true)}catch(f){}}if(!l){var g="slider_div_"+(new Date()).valueOf()+Math.random(1000);var l=document.createElement("div");l.setAttribute("id",g);document.body.appendChild(l)}else{if(typeof(l)!="object"){l=document.getElementById(l)}}if(typeof(n)=="object"){m=n.skin;d=n.min;h=n.max;b=n.step;c=n.vertical;j=n.value;n=n.size}this.size=n;this.value=j||0;this.vMode=c||false;this.skin=m||"";this.parent=l;this.isInit=false;this.value=j||d||0;this.inputPriority=true;this.stepping=false;this.imgURL=window.dhx_globalImgPath||domain_pool.getURL("/img/zoomslider/");this._def=[d,h,b,j,n];dhtmlxEventable(this);return this}dhtmlxSlider.prototype.createStructure=function(){if(this.con){this.con.parentNode.removeChild(this.con);this.con=null}if(this.vMode){this._sW="height";this._sH="width";this._sL="top";this._sT="left";var b=this.imgURL}else{this._sW="width";this._sH="height";this._sL="left";this._sT="top";var b=this.imgURL}this.con=document.createElement("DIV");this.con.onselectstart=function(){return false};this.con._etype="slider";this.con.className="dhtmlxSlider"+(this.skin?"_"+this.skin:this.skin);this.drag=document.createElement("DIV");this.drag._etype="drag";this.drag.className="selector";var e=document.createElement("DIV");e.className="leftSide";this.leftZone=document.createElement("DIV");this.leftZone.className="leftZone";this.leftZone.style.width=Math.abs(this.value)+"px";var f=document.createElement("DIV");f.className="rightSide";this.rightZone=document.createElement("DIV");this.rightZone.className="rightZone";this.con.appendChild(e);this.con.appendChild(this.leftZone);this.con.appendChild(this.rightZone);this.con.appendChild(f);this.con.appendChild(this.drag);this.parent.appendChild(this.con);if(!this.parent.parentNode||!this.parent.parentNode.tagName){document.body.appendChild(this.parent)}if(this.vMode){this._sW="height";this._sH="width";this._sL="top";this._sT="left";this.con.style.width=this.con.offsetHeight+"px";for(var d=0;d<this.con.childNodes.length;d++){this.con.childNodes[d].style.fontSize="0";var c=this.con.childNodes[d].offsetWidth;this.con.childNodes[d].style.width=this.con.childNodes[d].offsetHeight+"px";this.con.childNodes[d].style.height=c+"px";c=this.con.childNodes[d].offsetLeft;this.con.childNodes[d].style.left=this.con.childNodes[d].offsetTop+"px";this.con.childNodes[d].style.top=c+"px"}f.style.top=this.size-f.offsetHeight+"px";this.zoneSize=this.size-f.offsetHeight;this.dragLeft=this.drag.offsetTop;this.dragWidth=this.drag.offsetHeight;this.rightZone.style.height=this.zoneSize+"px"}else{this.zoneSize=this.size-f.offsetWidth;this.dragLeft=this.drag.offsetLeft+3;this.dragWidth=this.drag.offsetWidth+12;this.rightZone.style.width=this.zoneSize+"px"}this.con.style[this._sW]=this.size+"px";this.con.onmousedown=this._onMouseDown;this.con.onmouseup=this.con.onmouseout=function(){clearInterval(this.that._int)};this.con.that=this;this._aCalc(this._def);this.setValue(this.value)};dhtmlxSlider.prototype._aCalc=function(b){if(!this.isInit){return}this.shift=b[0]||0;this.limit=(b[1]||100)-this.shift;this._mod=(b[4]-this.dragLeft*2-this.dragWidth)/this.limit;this._step=(b[2]||1);this.step=this._step*this._mod;this._xlimit=b[4]-this.dragLeft*2-this.dragWidth;if(!this.posX){this.posX=this._xlimit*((b[3]||0)-this.shift)/this.limit}this._applyPos(true);return this};dhtmlxSlider.prototype.setMin=function(b){this._def[0]=b;this._aCalc(this._def)};dhtmlxSlider.prototype.setMax=function(b){this._def[1]=b;this._aCalc(this._def)};dhtmlxSlider.prototype.setStep=function(b){this._def[2]=b;this._aCalc(this._def)};dhtmlxSlider.prototype._applyPos=function(d){if(!this.isInit){return}if(this.posX<0){this.posX=0}if(this.value<(this._def[0]||0)){this.value=this._def[0]||0}if(this.value>this._def[1]){this.value=this._def[1]}if(this.posX>this._xlimit){this.posX=this._xlimit}if(this.step!=1){this.posX=Math.round(this.posX/this.step)*this.step}var c=this.drag.style[this._sL];this.drag.style[this._sL]=this.posX+this.dragLeft*1+"px";this.leftZone.style[this._sW]=this.posX+this.dragLeft*1+"px";this.rightZone.style[this._sL]=this.posX+this.dragLeft*1+1+"px";this.rightZone.style[this._sW]=this.zoneSize-(this.posX+this.dragLeft*1)+"px";var b=this.getValue();if(this._link){if(this._linkBoth){this._link.value=b}else{this._link.innerHTML=b}}d=false;if((!d)&&this.checkEvent("onChange")&&(c!=this.drag.style[this._sL])){this.callEvent("onChange",[b,this])}this.value=this.getValue();if(!this._dttp){this._setTooltip(b)}};dhtmlxSlider.prototype._setTooltip=function(b){this.con.title=b};dhtmlxSlider.prototype.setSkin=function(b){this.skin=(b?b:"");if(this.isInit){this.createStructure()}};dhtmlxSlider.prototype.startDrag=function(c){if(this._busy){return}if((c.button===0)||(c.button===1)){this.drag_mx=c.clientX;this.drag_my=c.clientY;this.drag_cx=this.posX;this.d_b_move=document.body.onmousemove;this.d_b_up=document.body.onmouseup;var b=this;document.body.onmouseup=function(d){b.stopDrag(d||event);b=null};document.body.onmousemove=function(d){b.onDrag(d||event)};this._busy=true}};dhtmlxSlider.prototype.onDrag=function(b){if(this._busy){if(!this.vMode){this.posX=this.drag_cx+b.clientX-this.drag_mx}else{this.posX=this.drag_cx+b.clientY-this.drag_my}this._applyPos()}};dhtmlxSlider.prototype.stopDrag=function(b){var b=b||event;document.body.onmousemove=this.d_b_move?this.d_b_move:null;document.body.onmouseup=this.d_b_up?this.d_b_up:null;this.d_b_move=this.d_b_up=null;this._busy=false;this.callEvent("onSlideEnd",[this.getValue()])};dhtmlxSlider.prototype.getValue=function(){if((!this._busy)&&(this.inputPriority)){return Math.round(this.value/this._step)*this._step}return Math.round((Math.round((this.posX/this._mod)/this._step)*this._step+this.shift*1)*10000)/10000};dhtmlxSlider.prototype.setValue=function(b){this.value=b;this._applyPos(this.posX=(Math.round(((b||0)-this.shift)*this._mod)))};dhtmlxSlider.prototype._getActionElement=function(b){if(b._etype){return b}if(b.parentNode){return this._getActionElement(b.parentNode)}return null};dhtmlxSlider.prototype._onMouseDown=function(d){d=d||event;var c=this.that;var b=c._getActionElement(_isIE?d.srcElement:d.target);switch(b._etype){case"slider":if(c.vMode){var f=d.clientY-(getAbsoluteTop(c.con)-document.body.scrollTop)}else{var f=d.clientX-(getAbsoluteLeft(c.con)-document.body.scrollLeft)}var g=c.posX;c.posX=f-c.dragLeft-c.dragWidth/2;c.direction=c.posX>g?1:-1;if(c.stepping){clearInterval(c._int);c.setValue(c.value+c._step*c.direction);c._int=setInterval(function(){c.setValue(c.value+c._step*c.direction)},600)}else{c._busy=true;c._applyPos();c._busy=false;c.callEvent("onSlideEnd",[c.getValue()])}break;case"drag":c.startDrag(d||event);break}return false};dhtmlxSlider.prototype.setOnChangeHandler=function(b){this.attachEvent("onChange",b)};dhtmlxSlider.prototype._linkFrom=function(){this.setValue(parseFloat(this._link.value))};dhtmlxSlider.prototype.linkTo=function(e){e=(typeof(e)!="object")?document.getElementById(e):e;this._link=e;var c=e.tagName.toString().toLowerCase();this._linkBoth=(((c=="input")||(c=="select")||(c=="textarea"))?1:0);if(this._linkBoth){var b=this;var d=function(){if(this._nextSlider){window.clearTimeout(this._nextSlider)}this._nextSlider=window.setTimeout(function(){b._linkFrom()},500)};e.onblur=e.onkeypress=e.onchange=d}this._applyPos()};dhtmlxSlider.prototype.enableTooltip=function(b){this._dttp=(!convertStringToBoolean(b));this._setTooltip(this._dttp?"":this.getValue())};dhtmlxSlider.prototype.setImagePath=function(b){this.imgURL=b};dhtmlxSlider.prototype.init=function(){this.isInit=true;this.createStructure()};dhtmlxSlider.prototype.setInputPriority=function(b){this.inputPriority=b};dhtmlxSlider.prototype.setSteppingMode=function(b){this.stepping=b};
/*! jquery.swfobject.license.txt */
(function(b){b.flashPlayerVersion=function(){var e,c=null,l=false,j="ShockwaveFlash.ShockwaveFlash";if(!(e=navigator.plugins["Shockwave Flash"])){try{c=new ActiveXObject(j+".7")}catch(h){try{c=new ActiveXObject(j+".6");e=[6,0,21];c.AllowScriptAccess="always"}catch(g){if(e&&e[0]===6){l=true}}if(!l){try{c=new ActiveXObject(j)}catch(f){e="X 0,0,0"}}}if(!l&&c){try{e=c.GetVariable("$version")}catch(d){}}}else{e=e.description}e=e.match(/^[A-Za-z\s]*?(\d+)(\.|,)(\d+)(\s+r|\s+d|,)(\d+)/);return[e[1]*1,e[3]*1,e[5]*1]}();b.flashExpressInstaller="expressInstall.swf";b.hasFlashPlayer=(b.flashPlayerVersion[0]!==0);b.hasFlashPlayerVersion=function(d){var c=b.flashPlayerVersion;d=(/string|integer/.test(typeof d))?d.toString().split("."):d;return(d)?(c[0]>=(d.major||d[0]||c[0])&&c[1]>=(d.minor||d[1]||c[1])&&c[2]>=(d.release||d[2]||c[2])):(c[0]!==0)};b.flash=function(v){var e=false;if(!b.hasFlashPlayer){e=true}var g=v.url||"",s=v.type||"swf",r=v.params||{},l=document.createElement("body"),f,u,o,h,q,p,n,m;var j=v.urlParams||false;delete v.urlParams;if(typeof(j)=="object"){str=[];for(up in j){str.push(up+"="+j[up])}j=str.join("&")}v.height=v.height||180;v.width=v.width||320;if(e||(v.hasVersion&&!b.hasFlashPlayerVersion(v.hasVersion))){b.extend(v,{id:"SWFObjectExprInst",height:Math.max(v.height,137),width:Math.max(v.width,214)});g=v.expressInstaller||b.flashExpressInstaller;r={flashvars:{MMredirectURL:window.location.href,MMplayerType:(b.browser.msie&&b.browser.win)?"ActiveX":"PlugIn",MMdoctitle:document.title.slice(0,47)+" - Flash Player Installation"}}}if(v.flashvars&&typeof r==="object"){b.extend(r,{flashvars:v.flashvars})}for(q in (p=["url","type","expressInstall","hasVersion","params","flashvars"])){delete v[p[q]]}f=[];for(q in v){if(typeof v[q]==="object"){u=[];for(p in v[q]){u.push(p.replace(/([A-Z])/,"-$1").toLowerCase()+":"+v[q][p]+";")}v[q]=u.join("")}f.push(q+'="'+v[q]+'"')}v=f.join(" ");if(typeof r==="object"){f=[];for(q in r){if(typeof r[q]==="object"){u=[];for(p in r[q]){if(typeof r[q][p]==="object"){o=[];for(n in r[q][p]){if(typeof r[q][p][n]==="object"){h=[];for(m in r[q][p][n]){h.push(m.replace(/([A-Z])/,"-$1").toLowerCase()+":"+r[q][p][n][m]+";")}r[q][p][n]=h.join("")}o.push(n+"{"+r[q][p][n]+"}")}r[q][p]=o.join("")}u.push(window.escape(p)+"="+window.escape(r[q][p]))}r[q]=u.join("&amp;")}f.push('<PARAM NAME="'+q+'" VALUE="'+r[q]+'">')}r=f.join("")}if(s=="swf"){if(!(/style=/.test(v))){v+=' style="vertical-align:text-top;"'}if(!(/style=(.*?)vertical-align/.test(v))){v=v.replace(/style="/,'style="vertical-align:text-top;')}}if(b.browser.msie){if(s=="swf"){v+=' classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"';r='<PARAM NAME="movie" VALUE="'+g+'">'+r}else{if(j){if(g.indexOf("?")==-1){g+="?"+j}else{g+="&"+j}}v+=' classid="clsid:233C1507-6A77-46A4-9443-F871F945D258" codebase="http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=11,0,0,0"';r='<param name=PlayerVersion value=11><PARAM NAME="src" VALUE="'+g+'">'+r}}else{if(s=="swf"){v+=' type="application/x-shockwave-flash" data="'+g+'"'}else{if(j){if(g.indexOf("?")==-1){g+="?"+j}else{g+="&"+j}}v+=' codebase="http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=11,0,0,0" type="application/x-director" data="'+g+'"';r='<param name=PlayerVersion value=11><PARAM NAME="src" VALUE="'+g+'">'+r}}return e==true?false:"<OBJECT "+v+">"+r+"</OBJECT>"};b.fn.flash=function(d){if(!b.hasFlashPlayer){return this}var c=0,e;while((e=this.eq(c++))[0]){e.html(b.flash(b.extend({},d)));if(e[0].firstChild.getAttribute("id")==="SWFObjectExprInst"){c=this.length}}return this}}(jQuery));(function(m,l,o){var h="object",f=true;function p(r,q){var e=(r[0]||0)-(q[0]||0);return e>0||(!e&&r.length>0&&p(r.slice(1),q.slice(1)))}function g(r){if(typeof r!=h){return r}var e=[],s="";for(var q in r){if(typeof r[q]==h){s=g(r[q])}else{s=[q,(f)?encodeURI(r[q]):r[q]].join("=")}e.push(s)}return e.join("&")}function j(r){var e=[];for(var q in r){if(r[q]){e.push([q,'="',r[q],'"'].join(""))}}return e.join(" ")}function d(r){var e=[];for(var q in r){e.push(['<param name="',q,'" value="',g(r[q]),'" />'].join(""))}return e.join("")}try{var c=o.description||(function(){return(new o("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}())}catch(n){c="Unavailable"}var b=c.match(/\d+/g)||[0];m[l]={available:b[0]>0,activeX:o&&!o.name,version:{original:c,array:b,string:b.join("."),major:parseInt(b[0],10)||0,minor:parseInt(b[1],10)||0,release:parseInt(b[2],10)||0},hasVersion:function(e){var q=(/string|number/.test(typeof e))?e.toString().split("."):(/object/.test(typeof e))?[e.major,e.minor]:e||[0,0];return p(b,q)},encodeParams:true,expressInstall:"expressInstall.swf",expressInstallIsActive:false,create:function(r){var e=this;if(!r.swf||e.expressInstallIsActive||(!e.available&&!r.hasVersionFail)){return false}if(!e.hasVersion(r.hasVersion||1)){e.expressInstallIsActive=true;if(typeof r.hasVersionFail=="function"){if(!r.hasVersionFail.apply(r)){return false}}r={swf:r.expressInstall||e.expressInstall,height:137,width:214,flashvars:{MMredirectURL:location.href,MMplayerType:(e.activeX)?"ActiveX":"PlugIn",MMdoctitle:document.title.slice(0,47)+" - Flash Player Installation"}}}attrs={data:r.swf,type:"application/x-shockwave-flash",id:r.id||"flash_"+Math.floor(Math.random()*999999999),width:r.width||320,height:r.height||180,style:r.style||""};f=typeof r.useEncode!=="undefined"?r.useEncode:e.encodeParams;r.movie=r.swf;r.wmode=r.wmode||"opaque";delete r.fallback;delete r.hasVersion;delete r.hasVersionFail;delete r.height;delete r.id;delete r.swf;delete r.useEncode;delete r.width;var q=document.createElement("div");q.innerHTML=["<object ",j(attrs),">",d(r),"</object>"].join("");return q.firstChild}};m.fn[l]=function(e){var q=this.find(h).andSelf().filter(h);if(/string|object/.test(typeof e)){this.each(function(){var s=m(this),r;e=(typeof e==h)?e:{swf:e};e.fallback=this;r=m[l].create(e);if(r){s.children().remove();s.html(r)}})}if(typeof e=="function"){q.each(function(){var r=this,s="jsInteractionTimeoutMs";r[s]=r[s]||0;if(r[s]<660){if(r.clientWidth||r.clientHeight){e.call(r)}else{setTimeout(function(){m(r)[l](e)},r[s]+66)}}})}return q}}(jQuery,"flashdet",navigator.plugins["Shockwave Flash"]||window.ActiveXObject));(function(f){var D={adWidth:300,adHeight:250,resizeBar:0,showAd:true,forcePreroll:false,usePercentsInPreroll:true,loadingBar:true,fileType:"swf",contentId:"#flashobj",preloadId:"#flashobj_mc",beforeCallback:null,afterCallback:null,skipCallback:null,gameInsertCallback:null,textOnProgressVisible:false,loadingText:"Loading game...",afterLoadingText:"Game loaded. Click here to start the game\u2026",progressbarText:"The game will start in %d seconds",closeText:"Close the advertisement and go on to the game.",advertisementText:"Advertisement",tickInterval:500,progressTime:20000,showSkipTime:0,barWidth:300,adType:"iframe",adCode:"",loadGameAfterPreloader:false,loaderStartTime:new Date().getTime()};var b=0;var e=0;var C=0;var l=this;var o=0;var y=false;var u=false;var q=false;var B,H,g,z,p,F,G,d;var s=(SPI._settings.global.site_id==94);var v=function(){f("#new-game-wrapper").css("height","");if(B!=null){clearInterval(B);B=null}if(d!=null){clearTimeout(d);d=null}if(g!=null){clearTimeout(g);g=null}if(s){f(H).hide();f("#bannerHolder").hide()}else{f(H).remove()}if(D.afterCallback!=null){D.afterCallback.call(l,D)}if(D.fileType!="swf"||D.forcePreroll){D.gameInsertCallback.call(l)}else{f(D.contentId).css({width:p,height:F});if(D.loadGameAfterPreloader){D.gameInsertCallback.call(l)}}if(!s){connectRegisterButtons()}};var x=function(){if(D.skipCallback!=null){D.skipCallback.call(l,D)}v()};var n=function(I){y=I?false:y;if(C<=0&&!y){if(G){if(!u){f("#ap_skiptext").empty().append(f('<a href="javascript:void(0);">'+D.closeText+"</a>").click(x));u=true}}else{if(I){if(!u){f("#ap_skiptext").empty().append(f('<a href="javascript:void(0);">'+D.afterLoadingText+"</a>").click(x));u=true}}else{if(s){f("#ap_skiptext").empty().append(D.loadingText)}}}y=true;return}else{if(s&&C>0&&!G&&!I&&!y){f("#ap_skiptext").empty().append(D.loadingText);y=true}}C-=D.tickInterval};var E=function(){if(s){f(H).css({width:(D.adWidth+50+"px"),height:(D.adHeight+70+"px")});f("#ap_border").css({width:(D.adWidth)+"px",height:(D.adHeight+20+"px")});f("#ap_border").prepend('<div id="ap_adtext">'+D.advertisementText.toUpperCase()+"</div>")}else{f(H).css({width:(D.adWidth+"px")});f(H).prepend('<div id="ap_adtext">'+D.advertisementText+"</div>")}if(D.adType=="iframe"){if(!s){f(H).append('<div id="ap_adframe"></div>')}f("#ap_adframe").css({width:(D.adWidth+"px"),height:(D.adHeight+"px")});f("#ap_adframe").append(D.adCode)}else{f("#ap_adframe").css({width:(D.adWidth+"px"),height:(D.adHeight+"px")})}if(D.loadingBar&&!q){if(s){f(H).after('<div id="bannerHolder"></div>');f("#bannerHolder").width(D.adWidth);f("#bannerHolder").append('<div id="ap_progressbar"></div>');f("#ap_progressbar").css({width:D.barWidth+"px"})}else{f(H).append('<div id="ap_progressbar"></div>');f("#ap_progressbar").hide();f("#ap_progressbar").css("width",D.barWidth+D.resizeBar+"px")}if(G&&!D.usePercentsInPreroll){if(D.textOnProgressVisible){f("#ap_progressbar").reportprogress(0,100,SPI.sprintf(D.progressbarText,Math.ceil(D.progressTime/1000)),D.barWidth)}else{f("#ap_progressbar").reportprogress(0,100,false,D.barWidth)}}else{if(D.textOnProgressVisible){f("#ap_progressbar").reportprogress(0,100,"0%",D.barWidth)}else{f("#ap_progressbar").reportprogress(0,100,false,D.barWidth)}}}if(!q){if(s){f("#bannerHolder").append('<div id="ap_skiptext"></div>')}else{f(H).append('<div id="ap_skiptext"></div>');f("#ap_skiptext").empty().append(D.loadingText)}}if(!s){f("#ap_adframe, #ap_progressbar").show()}n()};var r=function(){e+=D.tickInterval;b=Math.round(100*e/D.progressTime);if(D.usePercentsInPreroll){if(D.textOnProgressVisible){f("#ap_progressbar").reportprogress(b,100,b+"%")}else{f("#ap_progressbar").reportprogress(b,100,false)}}else{if(D.textOnProgressVisible){f("#ap_progressbar").reportprogress(b,100,SPI.sprintf(D.progressbarText,Math.ceil((D.progressTime-e)/1000)))}else{f("#ap_progressbar").reportprogress(b,100,false)}}n();if(b>=100){if(!q){v()}}};var m=function(J){var I=j();if(J==I){if(!q){v()}if(g!=null){clearTimeout(sometime);g=null}}};var h=function(){var J=parseInt((D.progressTime-z)*100/D.progressTime);var L=j();if(L<0){L=100}b=J<L?J:L;if(D.textOnProgressVisible){f("#ap_progressbar").reportprogress(b,100,b+"%")}else{f("#ap_progressbar").reportprogress(b,100,false)}z-=D.tickInterval;if(J>=100){g=setTimeout(function(){m(L)},2500)}if(b<100){var I=false;if(D.loadGameAfterPreloader){var K=new Date().getTime()-D.loaderStartTime;if(K>D.showSkipTime){I=true}}if(L>=100||I){n(true)}else{n()}}else{if(!q){v()}}};var c=function(){o++;try{var I=j();B=setInterval(h,D.tickInterval);E()}catch(J){if(o<=3){setTimeout(c,1000)}else{if(!q){v()}}}};var j=function(){if(true===D.loadGameAfterPreloader){var I=new Date().getTime()-D.loaderStartTime;var J=Math.round(((I*100)/D.progressTime));return J}return f(D.preloadId)[0].PercentLoaded()};var A=function(){if(D.beforeCallback!=null){D.beforeCallback.call(l,D)}C=D.showSkipTime;if(D.fileType!="swf"||D.forcePreroll){G=true;B=setInterval(r,D.tickInterval);E()}else{if(!D.loadGameAfterPreloader){D.gameInsertCallback.call(l)}F=f(D.contentId).css("height");p=f(D.contentId).css("width");f(D.contentId).css({width:"0px",height:"0px"});G=false;c();z=D.progressTime}};f.spiPreloaderNeoEdge=function(I){return function(J){if(J=="AD_STARTED"){if(parent){q=true}d=setTimeout(v,I||30000)}if(J=="AD_COMPLETED"){v()}}};f.fn.spiPreloader=function(I){H=f(this);f.extend(true,D,I);var J=function(){if(D.showAd==true){if(I.preroll_adtech=="1"&&f('a[href*="/170/AdId=-3"]',f("#ap_preroll")).length>0){return false}return true}return false};if(J()){A()}else{f("#new-game-wrapper").css("height","");if(s){f("#ap_preroll").hide()}if(D.beforeCallback!=null){D.beforeCallback.call(l,D)}D.gameInsertCallback.call(l,D);if(D.afterCallback!=null){D.afterCallback.call(l,D)}}}})(jQuery);(function(b){b.fn.reportprogress=function(f,h,e,g){var c=100;var d=g||300;if(h){c=h}return this.each(function(){var m=b(this);var l=m.find(".progress");if(l.length!=1){l=b("<div class='progress'></div>");m.append("<div class='text'>&nbsp;</div>");b("<span class='text'>&nbsp;</span>").css("width",m.css("width")).appendTo(l);m.append(l)}var j=Math.round(f/c*100);l.css("width",j+"%");if(e){m.find(".text").html(e)}})}})(jQuery);jQuery.fn.pRating=function(e){var e=$.extend(true,{author:"Piotr",version:"1.0",url:"/rt/pb/%d/add/%d/%d/%d/%d",outputtype:"xml",method:"POST",timeout:2000,channel:3,api:2,itemtype:1,siteid:0,gameid:0,visibility:0,sentRating:-1,author:"notloggedin",newRating:false,ratingCookie:{name:"_spilVote[%s][%s]",options:{path:"/",expires:1}},buttonLike:"#i-like-this-game",buttonDontLike:"#i-dont-like-this-game",buttonRatingHearts:"#rating-display",buttonThanks:"#rating-question",langstrings:{ilikeit:"I like this game",ihateit:"I don't like this game",thanks:"Thanks for your rating!",saveerror:"Oops! An error.. try again later!",alreadyrated:"You can't vote right now"}},e);var l=$(this);if(!e.siteid&&!e.gameid){return false}else{e.ratingCookie.name=SPI.sprintf(e.ratingCookie.name,e.siteid,e.gameid)}var j=function(){var n=$.cookie(e.ratingCookie.name)||"";if(n==""){return true}return(n==e.siteid+"|"+e.gameid)?false:true};var m=function(){if($.profilar.forService().username==e.author){d(false);return}if(j()===false){g({message:"",placeholder:e.langstrings.buttonThanks});d(false)}else{d(true)}};var f=function(){if(j()===true){var n=e.siteid+"|"+e.gameid;$.cookie(e.ratingCookie.name,""+n,e.ratingCookie.options)}};var d=function(p){var o="";var n="";if(p){o="rating-hidden";n="rating-show";$(e.whatToHide).show()}else{o="rating-show";n="rating-hidden";if(e.newRating){$(e.whatToHide).hide()}}$(e.buttonLike).removeClass(o).addClass(n);$(e.buttonDontLike).removeClass(o).addClass(n);$(e.buttonRatingHearts).removeClass(n).addClass(o)};var g=function(o){var n=o.message||"";var p=o.placeholder||e.buttonThanks;if(n=="nextpic"||n==""){$(e.buttonLike+" .middle").html(SPI._langStrings.myGallery.ilikepic);$(e.buttonDontLike+" .middle").html(SPI._langStrings.myGallery.idontlikepic)}else{if(n!=""&&p){if(e.visibility==0){$("#game-rating").height("45px");$(p+" .middle").html(n+'<span class="minwidth"></span>');window.setTimeout(function(){$(p+" .middle").hide();$("#game-rating").height("45px")},10000)}else{$(p+" .middle").html(n+'<span class="minwidth"></span>');window.setTimeout(function(){$(p+" .middle").hide()},10000)}}else{if(e.visibility==0){$(p+" .middle").hide();$("#game-rating").height("45px")}else{$(p+" .middle").hide()}}}};var h=function(p,o){var n=$("errorcode",p).text();if(n!=""&&n!=0){g({message:e.langstrings.saveerror,placeholder:e.buttonThanks})}else{sendSpilEvent("Game","Vote",""+e.gameid,e.sentRating);g({message:"nextpic",placeholder:""});f()}d(false)};var c=function(){g({message:e.langstrings.saveerror,placeholder:e.buttonThanks});d(false)};var b=function(n){if(n==10){e.sentRating=10}else{e.sentRating=1}if($.profilar.loggedIn()==false){var o={rating:n}}else{var o={username:$.profilar.forService().username,hash:$.profilar.forService().hash,rating:n}}try{$.ajax({url:SPI.sprintf(e.url,e.api,e.channel,e.siteid,e.itemtype,e.gameid),global:false,type:e.method,dataType:e.outputtype,success:h,error:c,timeout:e.timeout,data:o})}catch(p){showMessage({message:e.langstrings.saveerror})}};return this.each(function(){m();$(e.buttonLike,l).unbind("click").bind("click",function(){if(j()===true){b(10)}else{g({message:e.langstrings.alreadyrated,placeholder:e.buttonThanks});d(false)}return false});$(e.buttonDontLike,l).unbind("click").bind("click",function(){if(j()===true){b(0)}else{g({message:e.langstrings.alreadyrated,placeholder:e.buttonThanks});d(false)}return false});$(e.buttonRatingHearts,l).click(function(){return false})})};SPI.getURLparam=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b={default_:"[\\?&]"+e+"=([^&#]*)",username:"https?://[^/]+/[^/]+/([a-zA-Z0-9_-]+).*",gamatarid:"/[^,]+,([0-9]+).html"},d=window.location.href;var g=new RegExp(b.default_);var f=g.exec(d),c=null;if(f==null){if(b[e]){g=new RegExp(b[e]);c=g.exec(d);if(c!=null&&c[1]){return c[1]}}return""}else{return f[1]}};SPI.comments=(function(C,r){var J={settings:{list_url:"/rt/pb/2/list/%s/%s/1/%s",list_url_profile:"/rt/pb/2/list/%s/%s/1/%s",list_url_image:"/rt/pb/2/list/%s/%s/10/%s",report_url:"/rp/pb/1/add/%s/%s/11/%s",report_url_image:"/rp/pb/1/add/%s/%s/11/%s",reportar_url:"/rp/pb/1/add/%s/%s/11/%s",send_url:"/rt/pb/2/add/%s/%s/1/%s",send_url_image:"/rt/pb/2/add/%s/%s/10/%s",timeout:7000,channel:3,noimage:domain_pool.getURL("/img/userprofile/dummy_small.gif"),li_id:"cmid_",report_weight:1,initializeRte:true,clearCommentCache:false,friendship_disabled:false}};var s=-1;var I=false;var e;var y=[];var E=false;var Q=0;var x=0;var G={};var U=[],f=0;var z=(function(){var W=navigator.userAgent.toLowerCase();var V=(W.match(/.+(?:firefox)[\/: ]([\d.]+)/)||[0,"0"])[1];if(/mozilla/.test(W)&&!/(compatible|webkit)/.test(W)&&(V.substr(0,3)=="3.0"||V.substr(0,1)=="2")){return true}return false})();G.fixWrap=function(aa,V,Z){if(!z){return aa}V=V||"\n";Z=Z===undefined?J.settings.wrap_words_limit:Z;var Y=aa.split(/[\s]+/);var W,X;for(W=0;W<Y.length;++W){X="";while(Y[W].length>Z){X+=Y[W].substr(0,Z)+V;Y[W]=Y[W].substr(Z)}Y[W]=X+Y[W]}return Y.join(" ")};var g=function(){if(!I){C(J.settings.comments_more).text(r.sprintf(J.langStrings.read_all_folded,s))}};var p=function(V){C.ajax({url:V.data("report_url"),data:{username:""},global:false,timeout:J.settings.timeout,type:"POST",success:function(W){alert(J.langStrings.report_popup)}})};var j=function(){if(!confirm(J.langStrings.report_question)){return false}var V=C.profilar.forService();V.reporteduser=C(this).data("reportar_data").reporteduser;V.reporttype="comment";V.reportweight=J.settings.report_weight;var W=C(this);C.ajax({url:W.data("reportar_url"),data:V,global:false,timeout:J.settings.timeout,type:"POST"});return false};var v=function(X){X.date=r.formatDate(parseInt(X.timestamp),r._langStrings.relative_date_plain);X.commentClass="";X.show_report_button=true;if(C.profilar.loggedIn()){if(C.profilar.get("username")==X.username){X.show_report_button=false;X.friendship_status="no_invite"}else{if(y[X.username]=="accepted"||y[X.username]=="pending"){X.friendship_status=y[X.username]}else{X.friendship_status="invite"}}}if(J.settings.friendship_disabled){X.friendship_status="no_invite"}var W;switch(X.friendship_status){case"invite":W=J.templates.li_comment_invite;break;case"accepted":W=J.templates.li_comment_accepted;break;case"pending":W=J.templates.li_comment_pending;break;case"no_invite":default:W=J.templates.li;break}var V=C(r.render(W,X));V.find(J.settings.comments_report).data("comment",X.ratorid).data("username",X.username).data("avatar",X.avatar_id||null).click(function(){r.report.reportGameCommentExtended(this);return false});r.friends.addAvatarTooltip(V,".iconlink",X.avatar_id,X.username);V.mouseenter(function(){C(J.settings.comments_invite_container,this).show()});V.mouseleave(function(){C(J.settings.comments_invite_container,this).hide()});V.find(J.settings.comments_invite_class).data("username",X.username).click(function(){var Y=this;r.friends.friendInviteWithMail(C(this).data("username"),function(Z,aa){if(!aa){r.popup.show(r.render(r._templates.popup.content_simple,{header:r.sprintf(r._langStrings.friends.invitefriend_title,C(Y).data("username")),highlightclass:""}),function(){C(J.settings.comments_box).find('a[rel="'+C(Y).data("username")+'"]').each(function(ab){C(this).parent().find("span").show();C(this).remove()});y[C(Y).data("username")]="pending"},{title:r._langStrings.friends.popup_friendship_request_send,titleIcon:"",close:false})}});return false});return V};var B=function(V){C(".commentsBox").hide();C("#unavailableComments").show()};var h=function(V){C(".commentsBox").hide()};var R=function(V){C(".commentsBox").hide();C(".commentsUnav").show()};var S=function(W){var V=C().parseEmo(r._settings.emoticons,W);if(W!=V){return V}return false};var q=function(V){C(V).find("result").each(function(){var W=C(this).find(">friendstatus").text();var X=C(this).find(">username").text();switch(W){case"sent":case"received":y[X]="pending";break;case"accepted":y[X]="accepted";break}});if(++Q==x){E=true;P(e)}};var O=function(){++x;C.profilar.friendList(C.profilar.get("username"),function(V){q(V)},false,"accepted");++x;C.profilar.friendList(C.profilar.get("username"),function(V){q(V)},false,"sent");++x;C.profilar.friendList(C.profilar.get("username"),function(V){q(V)},false,"received")};var m=function(V){r.friends.init();if(J.settings.friendship_disabled||!C.profilar.loggedIn()){E=true}if(E){P(V)}else{e=V;P(V);O()}};var P=function(ae){C("#pagination_top").empty();C("#pagination_bottom").empty();if(ae.rator==undefined||ae.rator.total==undefined){B(ae);return}if(C("#gameCommentsWrapper .boxheader #commentsCounter").length==0){C("#gameCommentsWrapper .boxheader").append('(<span id="commentsCounter">'+parseInt(ae.rator.total)+"</span>)")}if(ae.rator.total=="0"){ae.rator.resultset=[]}G.limit=parseInt(C("#gameCommentsWrapper .selectedTxt").text());G.to=Math.min(ae.rator.total,G.page*G.limit);if(G.page==1){G.to=G.to+G.increased_number}G.from=(G.page-1)*G.limit+1;var V=G.from+"-"+G.to;var W=parseInt(C("#commentsCounter").text());C(".counter-selector-numbers").html(r.sprintf(J.langStrings.comments_from_to,W,V));var ab=[];f=0;if(U.length>0&&G.page==1){if(ae.rator.resultset.length>0){var Z=0,X=0,aa=0,ac=0;for(var ad=0;ad<U.length;++ad){X=parseInt(U[ad].timestamp);while(ae.rator.resultset.length>ac&&parseInt(ae.rator.resultset[ac].timestamp)>X){ab.push(ae.rator.resultset[ac]);ac+=1}if(ae.rator.resultset.length>ac){if(ae.rator.resultset[ac].username.toLowerCase()==U[ad].username.toLowerCase()&&Math.abs(parseInt(ae.rator.resultset[ac].timestamp)-X)<5){ab.push(ae.rator.resultset[ac]);ac+=1}else{ab.push(U[ad]);f+=1}}}for(var ad=ac;ad<ae.rator.resultset.length;ad++){ab.push(ae.rator.resultset[ad])}s=parseInt(ae.rator.total)}else{ab=U;s=U.length}}else{ab=ae.rator.resultset;s=parseInt(ae.rator.total)}if(s==0){C(J.settings.comments_box).empty();if(C.profilar.loggedIn()){C("iframe.commentText2").contents().find(".frameBody").addClass("noCommentsBox").data("clicked",false).text(J.langStrings.nocomments);C("iframe.commentText2").contents().find(".frameBody").click(function(){if(C(this).data("clicked")==false){l();C(this).data("clicked",true)}});C("#emoHolder a").click(function(){if(C("iframe.commentText2").contents().find(".frameBody").data("clicked")==false){l();C("iframe.commentText2").contents().find(".frameBody").data("clicked",true)}})}else{C("#noCommentsBox").hide()}C(".counter-selector").hide();return}else{C(".counter-selector").show()}var Y=[];for(var ad in ab){ab[ad].avatar_url=J.settings.noimage;Y.push(ab[ad].username)}C.profilar.loadExternalPrefs(Y,function(am,an){for(var ai in ab){for(var ag in am){if(am[ag].username&&am[ag].username.toLowerCase()==ab[ai].username.toLowerCase()&&am[ag].avatar){ab[ai].avatar_id=am[ag].avatar;ab[ai].avatar_url=r.sprintf(r._settings.global.avatar_url_big,am[ag].avatar)||J.settings.noimage}}}var ah=C(J.settings.comments_box);ah.empty();var aj,ak,ao;for(aj=0;aj<ab.length;++aj){if(ab[aj].reported>=J.settings.reported_limit){continue}ab[aj].comment=ab[aj].comment.replace(/(\s|\xa0)/g," ").replace(/( )+/g," ");var al=S(ab[aj].comment);ah.append(v(ab[aj]));al?ah.find(".commentBody:last").html(al):null}C.each(C("commentsBody"));var af=r.paginatorString(s,G.page,J.settings.comments_per_page,4,b,J.langStrings);C("#pagination_top").empty();C("#pagination_bottom").empty();if(af!=""){C("#pagination_top").append(af).show();C("#pagination_bottom").append(af.clone(true)).show()}else{C("#pagination_top").hide();C("#pagination_bottom").hide()}},["avatar"])};var b=function(X){G.page=X;var W="";if(J.settings.image_id!=undefined){var V=L(J.settings.image_id);W=r.sprintf(J.settings.list_url_image,J.settings.channel,r._settings.global.site_id,V)}else{W=r.sprintf(J.settings.list_url,J.settings.channel,r._settings.global.site_id,J.settings.game_id)}C(J.settings.comments_box).empty().append('<li class="comments_info">'+J.langStrings.loading_start+"</li>");C("#noCommentsBox").hide();s=-1;C.ajax({cache:true,url:W,data:{authenticated:"1",pagesize:J.settings.comments_per_page,pagenr:X,type:"comments",outputtype:"json"},dataType:"json",global:false,timeout:J.settings.timeout,type:"GET",error:B,success:m})};var M=function(){var V=true;var X=C("textarea.commentText2").val();var W=C("#noCommentsBox").text();C(J.settings.comments_form).find("div.error").remove();C(J.settings.comments_form).find("p.error").removeClass("error");if(C.trim(X).length==0||X.length>J.settings.max_chars||X==W){V=false;C(".commentButton").before('<div class="error cb tc_comment_error_msg">'+J.langStrings.error_comment+"</div>").parent().addClass("error")}return V};var H=function(W){C(J.settings.comments_form).find("div.error").remove();C(J.settings.comments_form).find("p.error").removeClass("error");var V=C("errorcode",W).text();if(V!=""&&V=="503"){C(".commentButton").before('<div class="error cb tc_comment_error_msg">'+J.langStrings.error_over_quota+"</div>").parent().addClass("error")}else{C(".commentButton").before('<div class="error cb tc_comment_error_msg">'+J.langStrings.error_submit+"</div>").parent().addClass("error")}K()};var A=function(){var W=C("textarea.commentText2").val();var V=C("#noCommentsBox").text();if(W==V){W=""}else{if(W.length>J.settings.max_chars){C("#cf_chars_left").addClass("counterror")}else{C("#cf_chars_left").removeClass("counterror")}}C("#cf_chars_left").text(r.sprintf(J.langStrings.charactersleft,J.settings.max_chars-W.length))};var l=function(){C("iframe.commentText2").contents().find(".frameBody").removeClass("noCommentsBox").empty()};var o=function(W,V){l();if(W&&W.hyscor&&W.hyscor.errorcode!==undefined){K();return}var X=0;if(J.settings.image_id!=undefined){X=J.settings.image_id}else{X=J.settings.game_id}U.unshift({timestamp:W.hyscor.time,comment:this.comment,authenticated:1,ratorid:-1,itemid:X,username:C.profilar.forService().username,siteid:r._settings.global.site_id,reported:"0",reviewed:0,remote_addr:"0.xxx.xxx.xxx"});b(1);K()};var n=function(){F();C(J.settings.comments_form).find("span.error").remove();if(C.find("iframe.commentText2").length){C("iframe.commentText2").contents().find(".frameBody").keyup()}var V="";if(J.settings.image_id!=undefined){V=r.sprintf(J.settings.send_url_image,J.settings.channel,r._settings.global.site_id,J.settings.image_id)}else{V=r.sprintf(J.settings.send_url,J.settings.channel,r._settings.global.site_id,J.settings.game_id)}if(M()){C("#cf_comment",C(J.settings.comments_form)).val(C("#cf_comment",C(J.settings.comments_form)).val().replace(/(\xa0)/g," "));C.ajax({cache:false,url:V,data:C(J.settings.comments_form).serialize(),dataType:"xml",global:false,timeout:J.settings.timeout,type:"POST",error:H,success:function(Z){var W=C("errorcode",Z).text();if(W!=""&&W!="0"){H();return}if(J.settings.image_id==undefined){sendSpilEvent("Game","Comment",""+J.settings.game_id)}var X=parseInt(C("#gameCommentsWrapper .boxheader #commentsCounter").text());C("#gameCommentsWrapper .boxheader #commentsCounter").empty().text(++X);G.increased_number=G.increased_number+1;var Y=C("#cf_comment").val();C("#cf_comment").val("").change();C.ajax({cache:false,timeout:2000,url:J.settings.timeurl,type:"GET",dataType:"json",success:o,error:function(ac,aa,ab){o.call(this,{hyscor:[]},"")},data:{outputtype:"json"},comment:Y})}})}else{K()}return false};var F=function(){C("#cf_submit").unbind()};var K=function(){C("#cf_submit").unbind("click").click(n)};var d=function(){if(I){I=false;C(this).text(r.sprintf(J.langStrings.read_all_folded,s));C(J.settings.comments_box).find("li:gt("+(J.settings.max_folded-1)+")").hide()}else{I=true;C(this).text(J.langStrings.read_all_unfolded);if(C(J.settings.comments_box).find("li").length>J.settings.max_folded+f){C(J.settings.comments_box).find("li:gt("+(J.settings.max_folded-1)+")").show()}else{b()}}};var c=function(){C("#loginform").show();C("#comment_add").hide()};var u=function(Y,W,X){Y.date=r.formatDate(parseInt(Y.timestamp),r._langStrings.relative_date_plain);if(typeof(W.id)!="object"){Y.gameurl=W.gamelink;Y.gamename=W.title;Y.thumbnail=W.thumbnail;Y.i=X+1;var V=C(r.render(J.templates.li_game_profile,Y))}else{Y.gamename=r._langStrings.comments.game_removed_from_site;Y.i=X+1;var V=C(r.render(J.templates.li_game_profile_empty,Y))}if((typeof(G.targetUser)!="undefined")&&(G.targetUser!=C.profilar.forService().username)){V.data("comment",Y.ratorid).data("username",Y.username).data("avatar",Y.avatar_id||null).click(function(){r.report.reportGameCommentExtended(this);return false})}else{C("a.report-icon",V).remove()}return V};var N=function(X,W){X.date=r.formatDate(parseInt(X.timestamp),r._langStrings.relative_date_plain);X.url=r.sprintf(J.settings.gameZoomUrl,X.itemid);X.itemname=G.getTitleForGamatarid(X.itemid);if(typeof(X.itemname)=="undefined"){X.itemname="untitled"}X.i=W+1;var V=C(r.render(J.templates.li_ugc_profile,X));if((typeof(G.targetUser)!="undefined")&&(G.targetUser!=C.profilar.forService().username)){V.data("comment",X.ratorid).data("username",X.username).data("avatar",X.avatar_id||null).click(function(){r.report.reportGameCommentExtended(this);return false});V.parent().find(".cmnt_report a").data("report_url",r.sprintf(J.settings.report_url_image,X.siteid,X.itemid,X.ratorid)).data("reportar_url",r.sprintf(J.settings.reportar_url,X.siteid,X.ratorid)).data("reportar_data",{reporteduser:X.username}).click(j)}else{C("a.report-icon",V).remove()}return V};var D=function(X){if(X.rator==undefined||X.rator.total==undefined){h(X);return}var V=X.rator.total;if(V==0){R();return}var W=C("ul#commentsHolder");W.empty();if(parseInt(X.rator.total)==0){for(Y in [1,2,3,4,5]){C(W).append('<li><p class="cmnt_report noreport">&nbsp;</p><div class="icon"></div><div class="commentWrapper"><div class="commentText">'+J.langStrings.emptyinlist+"</div></div></li>")}return}var Y,Z,ad,ac;for(Y=0;Y<X.rator.resultset.length;++Y){W.append('<li id="cmnt'+Y+'">&nbsp;</li>');ac=X.rator.resultset[Y];ac.comment=r.wordWrap(ac.comment,33);if(parseInt(ac.itemtype)==1){r.gameCache.getGame(ac.itemid,function(ag,af,ae){return function(ai){if(ai){W.find("#cmnt"+af).empty().append(u(ag,ai,af));var ah=S(ag.comment);ah?W.find("#cmnt"+af).find(".commentBody").html(ah):null}}}(X.rator.resultset[Y],Y,J.settings.li_id+Y))}if(parseInt(ac.itemtype)==10){ad=X.rator.resultset[Y];W.find("#cmnt"+Y).empty().append(N(ad,Y));var ab=W.find("#cmnt"+Y+" div.commentDate a").text();if(ab=="untitled"){W.find("#cmnt"+Y+" div.commentDate a").attr("href","#")}var aa=S(ad.comment);aa?W.find("#cmnt"+Y).find(".commentBody").html(aa):null}}};G.getTitleForGamatarid=function(X){var V=r.sprintf(r._settings.myGallery.mygallery_url_get,X);var W=false;C.ajax({global:false,async:false,cache:false,timeout:7000,url:V,type:"GET",dataType:"json",data:{outputtype:"json"},success:function(Y){W=Y.gamatar.result.title},error:function(Y){W=false}});return W};var L=function(Y){var V=window.top.location.href;var W=new RegExp(/#i(\d+)/i);var X=V.match(W);if(X!=null&&X.length>0){galleryTick=X[0];actualId=X[1];if(actualId!=Y){return actualId}}return Y};G.renderLatestsComments=function(X,W){G.page=X;G.targetUser=W||G.targetUser;r.getAndUpdateConfig("comments",J);C("ul#commentsHolder").empty().append('<li class="comments_info">'+J.langStrings.loading_start+"</li>");var V={authenticated:"1",pagesize:5,pagenr:X||1,outputtype:"json"};if(G.targetUser){V.targetuser=G.targetUser}else{V.username=C.profilar.forService().username;V.hash=C.profilar.forService().hash}C.ajax({cache:true,url:r.sprintf(J.settings.list_url_profile,J.settings.channel,r._settings.global.site_id,0),data:V,targetUser:G.targetUser,dataType:"json",global:false,timeout:J.settings.timeout,type:"GET",error:h,success:D})};G.init=function(V){r.getAndUpdateConfig("comments",J,V);if(J.settings.initializeRte){C("#cf_form textarea").rte(C.extend(r._settings.emoticons,{disablePaste:true}));G.increased_number=0}if(J.settings.clearCommentCache){U=[]}C("#"+r._settings.emoticons.iconlist_div).hover(function(){var W=230;if(C.browser.msie&&C.browser.version=="6.0"){W+=30}C(this).height(W)}).mouseleave(function(){C(this).height(88)});K();C("textarea.commentText2").change(A).keyup(A).change();b(1)};return G})(jQuery,SPI);var userprofiledebug=1;var _trgetuserPrivacyValue="";var _getTargetuserPrivacy=function(){return parseInt(_trgetuserPrivacyValue)};var __showError=function(errorsObj,pagetype,options){var options=$.extend(true,{errorElement:null,isAlert:false,callback:null},options);var mesg="";var page=pagetype||null;if(page==null){alert("No pagetype provided!");return false}if(typeof errorsObj!="object"){mesg=errorsObj}else{var codeObj=errorsObj[0];if(codeObj.code=="500"){mesg=SPI._langStrings.userprofile.errorcode_503+""}else{if(!codeObj.element){codeObj.element="__empty"}codeObj.operation=codeObj.operation.replace(".","_");var lstrings={register:{register:{password:{code_406:SPI._langStrings.userprofile.validation.password_notacceptable},username:{code_406:SPI._langStrings.userprofile.validation.username_notacceptable,code_409:SPI._langStrings.userprofile.errorcode_409},email:{code_409:SPI._langStrings.userprofile.validation.registration_email_exists}}},unregister:{authenticate:{username:{code_401:SPI._langStrings.userprofile.validation.username_wrong},password:{code_401:SPI._langStrings.userprofile.validation.password_wrong}},deregister:{username:{code_401:SPI._langStrings.userprofile.validation.username_wrong},password:{code_401:SPI._langStrings.userprofile.validation.password_wrong}}},new_password:{followup:{__empty:{code_404:SPI._langStrings.userprofile.validation.new_password_reset_passlink_used,code_503:SPI._langStrings.userprofile.errorcode_503}},followup_modify:{password:{code_406:SPI._langStrings.userprofile.validation.new_password_password_not_acceptable}}},changepass:{authenticate:{password:{code_401:SPI._langStrings.userprofile.validation.password_wrong,code_406:SPI._langStrings.userprofile.validation.password_notacceptable}},modify:{password:{code_406:SPI._langStrings.userprofile.validation.password_notacceptable}}},forgot_password:{trigger:{email:{code_404:SPI._langStrings.userprofile.validation.forgot_password_email_not_exists}}},profile:{authenticate:{password:{code_401:SPI._langStrings.userprofile.validation.password_wrong,code_406:SPI._langStrings.userprofile.validation.password_notacceptable}},modify:{email:{code_409:SPI._langStrings.userprofile.validation.email_exists}}},emailconfirm:{followup:{__empty:{code_404:"Your email was already confirmed or used url is not valid.",code_503:SPI._langStrings.userprofile.errorcode_503}}}};try{mesg=eval("lstrings."+page+"."+codeObj.operation+"."+codeObj.element+".code_"+codeObj.code)}catch(e){}}if(typeof codeObj=="object"&&page=="changepass"&&codeObj.operation=="authenticate"&&codeObj.element=="password"){codeObj.element="old_password"}}if(mesg!=""){if(options.isAlert===true){alert(""+mesg)}else{if(options.errorElement!=null&&options.errorElement.length){options.errorElement.empty().html(""+mesg).show()}else{if(codeObj&&codeObj.element&&$("#"+pagetype+" #f_"+codeObj.element+"_error").length>0){$("#"+pagetype+" #f_"+codeObj.element+"_error div.errorbox div.content").empty().html(""+mesg+"").show()}else{if($("#"+pagetype+" .validationErrors").length>0){$("#"+pagetype+" .validationErrors:first").addClass("error").html(""+mesg).show()}}}}}if(options.callback!=null&&typeof options.callback=="function"){if(page=="forgot_password"||page=="new_password"){options.callback.call(this,mesg)}else{if(page=="register"){options.callback.call(this,codeObj)}else{options.callback.call(this)}}}};var showForm=function(b){switch(b){default:case"register":$("div#register").show();break;case"profile":$("div#profile-update").show();break;case"changepass":$("div#pass-change").show();break}};var ageCheck=function(d,h){var e=parseInt(d.year);var f=parseInt(d.month)-1;var c=parseInt(d.day);h=parseInt(h);var g=new Date((e+h),f,c);var b=new Date;return((b.getTime()-g.getTime())<0)?false:true};jQuery.checkUserprofileField=function(c){var c=$.extend(true,{author:"nez",version:"1.0",formType:null,fieldName:null,fieldId:null,fieldValue:null,username_minLength:3,password_minLength:6},c);if(c.formType==null||c.fieldName==null||c.fieldId==null||c.fieldValue==null){}else{var f=new Array();var g=c.fieldName;var b=c.fieldId;var d=c.fieldValue;switch(c.formType){case"profile":switch(g){case"old_password":case"password":if(d.length<c.password_minLength){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.password_isempty+""})}break;case"givenname":if($.profilar.get("givenname").length>0&&d.length<1){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.firstname_isempty+""})}break;case"surname":if($.profilar.get("surname").length>0&&d.length<1){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.lastname_isempty+""})}break;case"email":if(!validateEmail(d)){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.email_invalid+""})}break}break;case"register":switch(g){case"username":if(d.length<c.username_minLength){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.username_minlength+""})}else{if(!SPI.user.validateUsername(d)){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.username_badchar+""})}else{}}break;case"password":if(d.length<c.password_minLength){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.password_minlength+""})}break;case"password_repeat":if(d!=$("#register input[name=password]").val()||d.length<c.password_minLength){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.password_mustmatch+""})}break;case"email":if(!validateEmail(d)){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.email_invalid+""})}break;case"dob_month":if(d=="-1"){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.dob_selectmonth+""})}break;case"dob_day":if(d=="-1"){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.dob_selectday+""})}break;case"dob_year":if(d=="-1"){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.dob_selectyear+""})}break;case"gender":if($("#register input[name=gender]:checked").length==0){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.gender_choose+""})}break;case"parent_email":if($("div#up_registration_parent_email").is(":visible")&&!validateEmail(d)){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.parent_email_invalid+""})}else{if($("input#f_parent_email").val()==$("input#f_email").val()){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.parent_email_eq_child_email+""})}}break;case"privacy_policy":if($("div.privacy_policy_check").is(":visible")&&$("#register input[name=privacy_policy]:checked").length==0){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.privacy_policy_unchecked+""})}break}break;case"changepass":switch(g){case"old_password":if(d.length<c.password_minLength){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.old_password_minlength+""})}break;case"password":if(d.length<c.password_minLength){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.password_minlength+""})}break;case"password_repeat":if(d==""){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.changepass_password_repeat_minlength+""})}else{if(d!=$("#password input[name=password]").val()){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.changepass_password_mustmatch+""})}}break}break;case"forgot_password":switch(g){case"email":if(!validateEmail(d)){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.forgot_password_email_invalid+""})}break}break;case"new_password":switch(g){case"password":if(d.length<c.password_minLength){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.new_password_password_minlength+""})}break;case"password_repeat":if(d==""){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.new_password_password_repeat_minlength+""})}else{if(d!=$("#new_password_form #f_password").val()){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.new_password_password_repeat_must_match+""})}}break}break;case"unregister":switch(g){case"username":if(d.length<c.username_minLength){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.username_minlength+""})}else{if(!SPI.user.validateUsername(d)){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.username_badchar+""})}else{}}break;case"password":if(d.length<c.password_minLength){f.push({id:b,mesg:SPI._langStrings.userprofile.validation.password_minlength+""})}break}break}var e=f.length>0?false:true;return[e,f]}};jQuery.nValidateRegistrationRT=function(d){var d=$.extend(true,{author:"nez",version:"1.0",formType:"register",classname:"validateMe",notAllowedAge:7,parentConfirmationAge:14},d);var c=function(){var h=parseInt($("select[name=dob_year]").val());var l=parseInt($("select[name=dob_month]").val());var g=parseInt($("select[name=dob_day]").val());var e="";$("#dob select.validationError").removeClass("validationError");if(h>0&&l>0&&g>0){if(ageCheck({year:h,month:l,day:g},d.notAllowedAge)==false||ageCheck({year:h,month:l,day:g},d.parentConfirmationAge)==true){if(ageCheck({year:h,month:l,day:g},d.notAllowedAge)==false){e=SPI._langStrings.userprofile.validation.too_young+""}$("#up_registration_parent_email input.validationError").removeClass("validationError");$("#up_registration_parent_email").hide();parentEmailOkay=true}else{if(ageCheck({year:h,month:l,day:g},d.parentConfirmationAge)==false){$("#up_registration_parent_email").show();$("#up_registration_parent_email input[name=parent_email]").trigger("focus");parentEmailOkay=false}}var f=true;if((l==4||l==6||l==9||l==11)&&g==31){f=false}if(l==2){var j=(h%4==0&&(h%100!=0||h%400==0));if(g>29||(g==29&&!j)){f=false}}if(!f){e=SPI._langStrings.userprofile.validation.invalid_date+"";$("#dob input").addClass("validationError")}dateOkay=f;$("div#error_f_dob div#f_dob_age_or_date_error_text").empty().append(e);$(".dob_dmy").hide();if($("div#f_dob_age_or_date_error_text").text().length==0){$("#dob_validationCorrectImage").show();$("#dob_validationErrorImage").hide()}else{$("#dob_validationCorrectImage").hide();$("#dob_validationErrorImage").show();$("#dob select").addClass("validationError");dateOkay=false}}else{if(h<=0){$("#error_f_dob_year").show();$("#f_dob_year").addClass("validationError")}else{$("#error_f_dob_year").hide()}if(l<=0){$("#error_f_dob_month").show();$("#f_dob_month").addClass("validationError")}else{$("#error_f_dob_month").hide()}if(g<=0){$("#error_f_dob_day").show();$("#f_dob_day").addClass("validationError")}else{$("#error_f_dob_day").hide()}$("#dob_validationCorrectImage").hide();$("#dob_validationErrorImage").show();dateOkay=false}b()};var b=function(){if(usernameOkay===false||emailOkay===false||passwordOkay===false||repeatOkay===false||parentEmailOkay===false){$("#registration_form .moveButtonRight").addClass("disabled").unbind("click")}else{$("#registration_form .moveButtonRight").removeClass("disabled").unbind("click").click(function(){executeBlurs();saveActionReg()})}};$("."+d.classname).each(function(){var f=$(this);var g=$(f).attr("name");var e=$(f).attr("id");$(f).blur(function(){var j=$(f).val();var l=new Array();var h=$.checkUserprofileField({formType:d.formType,fieldName:g,fieldId:e,fieldValue:j});if(h[0]==false){l=h[1]}if(l.length>0){if(e!="f_dob_month"&&e!="f_dob_year"&&e!="f_dob_day"){$("div#"+e+"_ok.ok").hide();$("div#"+e+"_help div.reghelpbox").hide();$("div#"+e+"_error div.regerrorbox").show();$("div#"+e+"_error div.regerrorbox div.content").empty().append(l[0].mesg)}else{$("div#f_dob_age_or_date_error_text div.regerrorbox").hide();$("div#f_dob_ok.ok").hide();$("div#f_dob_noselect_error_text div.regerrorbox").show();if($("div#f_dob_noselect_error_text div.regerrorbox div.content div#"+e+"_error").text().length==0){$("div#f_dob_noselect_error_text div.regerrorbox div.content").append('<div id="'+e+'_error">'+l[0].mesg+"</div>")}if($("div#f_dob_noselect_error_text div.content").text().length==0){$("div#f_dob_noselect_error_text div.regerrorbox").hide();$("div#"+e+"_ok.ok").show()}else{$("div#f_dob_noselect_error_text div.regerrorbox").show()}}$(this).addClass("validationError")}else{$(this).removeClass("validationError");if(e!="f_dob_month"&&e!="f_dob_year"&&e!="f_dob_day"&&g!="gender"){if(e!="f_email"&&e!="f_username"){$("div#"+e+"_error div.regerrorbox").hide();$("div#"+e+"_help div.reghelpbox").hide();$("div#"+e+"_ok.ok").show()}}else{if(g=="gender"){$("#register input[name="+g+"]").removeClass("validationError");$("div#f_male_error div.regerrorbox").hide();$("div#f_male_help div.reghelpbox").hide();$("div#f_male_ok.ok").show()}else{$("div#f_dob_error div#f_dob_noselect_error_text div.content div#"+e+"_error").empty()}}}})})};loadExternalPrefs_callback=function(d,b){_trgetuserPrivacyValue=d[0]?d[0].privacy:6;if(d.length==0){window.location="/";return}if(d[0].avatar!==undefined){$("img.userAvatar").css("background-image","url('"+domain_pool.getURL(SPI.sprintf(SPI._settings.global.avatar_url_big,d[0].avatar),"cimg")+"')")}else{$("img.userAvatar").css("background-image","url('"+domain_pool.getURL("/img/_/profile/dummy_big.jpg","cimg")+"')")}$("div.avatar img.userAvatar").load(function(){$("div.avatar img.userAvatar").css("visibility","visible")});var c=new Array();c.push(SPI.getURLparam("username"));$("div#maincontent div.breadcrumb h4,span#up_leftbox_username, #profilecontent span.username").text(c[0]);$("div.navigation a").each(function(){$(this).attr("href",SPI.sprintf($(this).attr("href"),c[0]))});if(d[0].privacy=="0"){$.profilar.loadExternalProfiles(c,function(e,f){$("div#profilecontent").show();if(isNaN(e[0].age)){$("td#up_leftbox_age").text("Unknown")}else{$("td#up_leftbox_age").text(e[0].age)}if(e[0].gender=="m"){$("td#up_leftbox_gender").text(SPI._langStrings.userprofile.male)}else{$("td#up_leftbox_gender").text(SPI._langStrings.userprofile.female)}},["username","gender","age"]);SPI.handlers.run("userprofile",[])}else{if(c[0]==$.profilar.forService().username){SPI.reloadSite(SPI._settings.global.my_profile_page)}$("#leftbox_privacybox,div#privateprofile").show();$("table#profileData").hide();$.profilar.loadExternalProfiles(c,function(e,f){$("div#maincontent div.breadcrumb h4").text(e[0].username)},["username"])}SPI.achievements.init();SPI.achievements.getAchievementsCountForUser(function(f){try{tmp=f.hyscor.resultset.total||0}catch(g){tmp=0}$("div#userinfo span#awardsCount, #profilecontent span.awardsCount").html(tmp)},c);SPI.highscore.init();SPI.highscore.getUserLevel(function(f){try{tmp=f.hyscor.level||0}catch(g){tmp=0}fillPoints(tmp,false,true,false)},c);$("#userinfo").show()};SpilGames.Events.subscribe("invitefriends.request",function(){SpilGames.Users.getCurrentUser({onsuccess:function(b){if(b.is_app_user===true){SPI.inviteToGame.openPopup()}else{SpilGames.Events.publish("portal.forceauthentication")}},onfailure:function(b){}})});SpilGames.Events.subscribe("portal.adjustheight",function(c){var b=c.height;if(b!=null&&typeof b!="undefined"){$("#socialgame").height(b)}});SpilGames.Events.subscribe("activities.request",function(b){SpilGames.Users.getCurrentUser({onsuccess:function(c){if(c.is_app_user===true){SpilGames.Events.publish("activities.post",{status:"success",comment:b.comment})}else{SpilGames.Events.publish("portal.forceauthentication")}},onfailure:function(c){}})});SpilGames.Events.subscribe("auth.request",function(c){if(c&&c.force===true){SpilGames.Events.publish("portal.forceauthentication")}var b="";if($.cookie("_profilar")!=null&&typeof $.cookie("_profilar")!="undefined"){b=$.cookie("_profilar").decodeBase64(true).split("|")[1]}else{SpilGames.Users.getCurrentUser({onsuccess:function(d){if($.cookie("guestdata")==null){$.cookie("guestdata",JSON.stringify(d.uid),{path:"/"})}}})}});var toggleGame=SpilGames(function(){this.subscribe("api.portal.overlay.show",function(){$("#socialgame_iframe").hide()});this.subscribe("api.portal.overlay.hide",function(){$("#socialgame_iframe").show()})});SPI.inviteToGameOld=(function(g){var c={};var f={};var h=[];f.init=function(j){g.extend(c,j);g(".invite_friend_checkbox").change(function(){e()});g("#socialgame_searchbutton_left, #socialgame_searchbutton_right").hover(function(){g("#socialgame_searchbutton_left, #socialgame_searchbutton_right").addClass("hover")},function(){g("#socialgame_searchbutton_left, #socialgame_searchbutton_right").removeClass("hover")});g("#socialgame_invitebutton_left, #socialgame_invitebutton_right").hover(function(){g("#socialgame_invitebutton_left, #socialgame_invitebutton_right").addClass("hover")},function(){g("#socialgame_invitebutton_left, #socialgame_invitebutton_right").removeClass("hover")});g("#friends_search_username").focus(function(){g(this).attr("value","");g("#friends_search_username").addClass("searchBold")});g("#socialgame_searchbutton_left").click(function(){var l=SPI.inviteToGame.friendsSearch(g("#friends_search_username").attr("value"));SPI.inviteToGame.printFriends(l)});g("#socialgames_selectall_cb").click(function(l){l.stopPropagation();g("#socialgames_selectall_cb").attr("checked")?g("input[type='checkbox']:not([id='socialgames_selectall_cb'])").attr("checked",true):g("input[type='checkbox']:not([id='socialgames_selectall_cb'])").attr("checked",false);e();return});g("#socialgames_selectall").click(function(){g("#socialgames_selectall_cb").attr("checked")?g("input[type='checkbox']:not([id='socialgames_selectall_cb'])").attr("checked",false):g("input[type='checkbox']:not([id='socialgames_selectall_cb'])").attr("checked",true);g("#socialgames_selectall_cb").attr("checked")?g("#socialgames_selectall_cb").attr("checked",false):g("#socialgames_selectall_cb").attr("checked",true);e()})};f.openPopup=function(){g.profilar.friendList(g.profilar.get("username"),function(l){h=[];var j=new Array();g(l).find("result").each(function(){thisUser=g(this).find(">username").text();h.push(thisUser);j[thisUser]=g(this).find("getprefs > avatar").text()});g.profilar.loadExternalProfiles(h,function(m,n){g(m).each(function(){this.avatar=j[this.username]?SPI.sprintf(SPI._settings.global.avatar_url_small,j[this.username]):SPI._settings.highscore.noimage});h=m;b()},["givenname","surname"])},false,"accepted")};var e=function(){if(g(".invite_friend_checkbox:checked").length){g("#socialgame_invitefriends_button").removeClass("standard-forms-button-disabled")}else{g("#socialgame_invitefriends_button").addClass("standard-forms-button-disabled")}};var b=function(){f.printFriends(h);var l=0,j=0;if(typeof(window.innerWidth)=="number"){l=window.innerWidth;j=window.innerHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){l=document.documentElement.clientWidth;j=document.documentElement.clientHeight}}g("div#shadow_socialgames").css("display","block");g("div.socialgames_friendsWrapper").css("display","block");newMargin=Math.round((parseInt(j)-g("#socialgames_friendsPopup").height())/2);if(newMargin<0){newMargin=0}g("div.socialgames_friendsWrapper").css("margin-top",newMargin+"px");g("#friends_search_username").attr("value",g("#friendfinder_inputfield").attr("value"));g("#friends_search_username").attr("class","friends_search_username");var m=g("#friends_container");if(!g(".jScrollPaneContainerBlocked #friends_container").length){m.jScrollPane({scrollbarWidth:15,showArrows:true,arrowSize:15,scrollbarMargin:0});if(g(".jScrollPaneTrack").is(":visible")){g("#message_under_friendlist").css("padding-right","10px")}else{if(g.browser.msie&&g.browser.version<=7){g("#friend_list_invite li").css("width","272px")}}}return};f.printFriends=function(q){g("#friend_list_invite").empty();g("#socialgames_selectall_cb").attr("checked",false);if(h.length<1){g("#siteInviteFirstStep").hide();g("#siteInviteNoFriends").show()}var p=0;var o=0;var n="blue";var r="";var m="";var l=SPI._settings.avatarImages.anonymousIcon;g.each(q,function(j,u){if(typeof u.givenname=="undefined"){u.givenname=""}if(typeof u.surname=="undefined"){u.surname=""}m='<li id="socialfriend_li_'+o+'" class="socialgame_friends_li_'+n+'" cb="'+o+'">';var s=u.givenname+" "+u.surname;m+='<div class="friend_invite_cb"><input type="checkbox" id="socialfriend_cb_'+o+'" value="'+u.username+'" class="invite_friend_checkbox"></div>';m+='<div id="socialinvite_avatar_'+o+'" class="friend_invite_avatar"><img height="50" border="0" width="50" onerror="javascript:if(this.src!=\''+l+"') this.src='"+l+'\';" alt="'+u.username+'" class="social_friend_avatar" src="'+domain_pool.getURL(u.avatar)+'" /></div>';m+='<div id="socialinvite_data_'+o+'" class="friend_invite_data"><p class="social_friend_username">'+u.username+"</p>";m+=d(s.replace(/<\/?[^>]+>/gi,""))+"</div></span>";m+="</li>";r+=m;p++;o++});g("#friend_list_invite").append(r);g.each(g("#friend_list_invite li"),function(){g(this).find("input").click(function(j){j.stopPropagation();e();return});g(this).click(function(){g(this).find("input").attr("checked")?g(this).find("input").attr("checked",false):g(this).find("input").attr("checked",true);e()})});g("#socialgame_invitefriends_button").addClass("standard-forms-button-disabled")};var d=function(j){if(j.length>15){return j.substr(0,15)+"..."}return j};f.friendsSearch=function(j){var l=[];j=j.toLowerCase();for(key in h){userInfo=h[key].givenname+" "+h[key].surname+" "+h[key].username;if(userInfo.toLowerCase().indexOf(j)!=-1){l.push(h[key])}}return l};f.invitefriendsboxclose=function(){g("div#shadow_socialgames").css("display","none");g("div.socialgames_friendsWrapper").css("display","none");g("div.harvestBody").hide();g("div.harvestFirstBody").show();g(".no_contacts_message").hide();g(".success_message").hide();g(".skip_message").show();return};f.sendInvite=function(){var l=0;var j=g(".invite_friend_checkbox:checked");if(j.length>0){g.each(j,function(){g.profilar.triggerEvent({cheetah_ebm:{aid:c.aid,eid:c.eid},userName:this.value,emptyEmail:true,level:"site",fields:[{name:"username",value:this.value},{name:"friend_username",value:g.profilar.get("username")},{name:"gametitle",value:c.game_name},{name:"gamenicename",value:c.nice_name},{name:"game_id",value:gameHarvestingId},{name:"avatar_id",value:g.profilar.getPref("avatar")}]});l++});g("#siteInviteFirstStep").hide();g("#siteInviteSecondStep .number_of_friends .counter").text(l);g("#siteInviteSecondStep").show()}return};return f})(jQuery);SPI.guests=(function(f){var e={};e.getStoredData=function(){var g=null;if(f.cookie("guestdata")!=null){g=JSON.parse(f.cookie("guestdata"))}return g};e.setStoredData=function(g){f.cookie("guestdata",JSON.stringify(g),{path:"/",expires:3650})};e.deleteStoredData=function(){f.cookie("guestdata",null,{expires:-100,path:"/"})};var d=function(){f("#flashobj, #socialgame_iframe, #gameiframe_js, #ap_preroll").css("visibility","hidden")};var c=function(){f("#flashobj, #socialgame_iframe, #gameiframe_js, #ap_preroll").css("visibility","visible")};var b=function(){f("#login_backgroundSocial").hide();c();return false};e.openPopup=function(){if(f(".facebook-popup").is(":visible")){return false}d();f(".socialWrapper .socialClose").click(function(){return b()});f(".socialWrapper .socialLogin").click(function(){b();f(".tc-login-url, a[name=show_login_popup]").click();return false});f("#shadowSocial").css("width",f(window).width());f("#shadowSocial").css("height",f(document).height());f("#login_backgroundSocial").show();var h=f("#login_backgroundSocial .socialWrapper").height();var g;var j;if(typeof(window.innerWidth)=="number"){j=window.innerHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){j=document.documentElement.clientHeight}else{j=0}}if(j>h){g=Math.floor((j-h)/2-40)}else{g=0}f("#login_backgroundSocial .socialWrapper").css("margin-top",g+"px");if(f.browser.msie&&parseInt(f.browser.version.split(".")[0])<8){f("#login_backgroundSocial .socialWrapper").css("top",g+"px")}return true};return e})(jQuery);SPI.SocialGateway=(function($,SPI){var SGHash=false;var SG_is_app_user=false;var that=this;that.isAppUser=function(){return SG_is_app_user};that.getUsersData=function(users,p_fCallBack){if(users=="current"){if($.profilar.loggedIn()){SPI.guests.deleteStoredData();guestData=false}else{guestData=SPI.guests.getStoredData()}if(guestData){SG_is_app_user=false;_callBack(p_fCallBack,guestData)}else{_doSGRequest("getUsers",{params:JSON.stringify({hash:SGHash})},function(data){var obj;if(obj=JSON.parse(data)){SG_is_app_user=obj.data.users[0].is_app_user;if(SG_is_app_user==false){SPI.guests.setStoredData(obj.data.users)}_callBack(p_fCallBack,obj.data.users)}})}}else{if(users!=null&&users.constructor==Array){_doSGRequest("getUsers",{params:JSON.stringify({hash:SGHash,users:users})},function(data){var obj;if(obj=JSON.parse(data)){_callBack(p_fCallBack,obj.data.users)}})}else{if(users==null){_callBack(p_fCallBack,[])}}}};var _callBack=function(fCallBack,p_vResult){switch(typeof fCallBack){case"string":with(oCallBackObject){try{eval(fCallBack+"("+JSON.stringify(p_vResult)+")")}catch(oError){}}break;default:fCallBack(p_vResult);break}};that.linkGuestUserAfterRegister=function(username,hash,callback){console.error("socialgateway.js");var guestData=null;if($.cookie("guestdata")!=null){guestData=JSON.parse($.cookie("guestdata"))}if(guestData){var afterLinkAccount=function(){$.cookie("guestdata",null,{expires:-100,path:"/"});if(typeof callback=="function"){callback.call()}};SpilGames.Auth.linkGuestAccount({data:{profilarhash:$.profilar.forService().hash,guestid:guestData,uid:username},onsuccess:afterLinkAccount,onfailure:afterLinkAccount})}else{if(typeof callback=="function"){callback.call()}}};return that})(jQuery,SPI);var profilar_token="";if($.cookie("_profilar")!=null&&typeof $.cookie("_profilar")!="undefined"){profilar_token=$.cookie("_profilar").decodeBase64(true).split("|")[1]}function ZapapaJSApi_old(e,c,b,d){if(SPI.SocialGateway.SGHash===false){setTimeout(function(){ZapapaJSApi(e,c,b,d)},10);return}switch(e){case"users":SPI.SocialGateway.getUsersData(c.users,b);break;case"invitefriends":if(SPI.SocialGateway.isAppUser()){SPI.inviteToGame.openPopup()}else{window.openPopupReminder()}break;case"wallpost":if(SPI.SocialGateway.isAppUser()==false){window.openPopupReminder()}else{SPI.ZapapajsAPI.wallpost(c.message)}break;case"adjustHeight":break;case"group":break;case"socialnetwork":break;case"info":break;case"message":break;case"geturl":break;case"signedrequest":break;default:if(SPI.SocialGateway.isAppUser()==false){window.openPopupReminder()}break}}SPI.zapapa=(function(d){var c={};var b={};c.init=function(e){d.extend(b,e)};c.get=function(e){return b[e]};return c})(jQuery,SPI);(function(b){if(typeof b.fn.parseEmo==="undefined"){var c={smileys:{}};b.fn.parseEmo=function(p,o){var d=b.extend(c,p);var g=b.browser.msie;var f=b.browser.opera;var j=0;escapeFoo=function(r){var q=new RegExp("[.*+?|()\\[\\]{}\\\\]","g");return r.replace(q,"\\$&")};var m="";for(var h in d.smileys){m+=escapeFoo(h)+"|"}m+="\n";var e={regexp:new RegExp(m,"i")};var d=b.extend(d,e);var n=function n(s){var u=s.match(d.regexp);if(u){if(u[0]=="\n"){s=s.replace(new RegExp("\n","ig"),"<br />")}else{var q='<img title = "'+d.smileys[u[0].toLowerCase()]["desc"]+'" src="'+((typeof(domain_pool)!="undefined")?domain_pool.getURL(d.smileys_path+d.smileys[u[0].toLowerCase()]["url"]):d.smileys_path+d.smileys[u[0].toLowerCase()]["url"])+'" />';var r=new RegExp(escapeFoo(u[0]),"ig");s=s.replace(r,q)}return n(s)}else{return s}};var l=SPI.escapeHTML(o);return n(l)}}})(jQuery);SPI.gameBar=(function(e){var c={settings:{textRotateTime:15000}};var f={achievement:{won:0,of:0,points:0},highscore:{tenthPlace:-1,firstplace:-1,points:0,position:0,newpoints:0,newposition:0},image:{count:0}};var l=null;var h={};h.loggedDefaultTexts=[];h.root=null;h.username=null;h.gender=null;h.init=function(p,q){SPI.getAndUpdateConfig("gamebar",c,null);h.gamebarOptions=q;var o=e(p+":first");if(o.length==0){return}h.root=o;h.username=e.profilar.forService().username;h.gender=e.profilar.get("gender");e("div#gamebar div.gamebar_content",o).addClass("default");e("div.icons a",o).unbind("click").click(function(){return false});if(e.profilar.loggedIn()==false){h.username=c.langStrings.guest.guest+"";e("div#gamebar",o).removeClass("logged").addClass("guest");e("div.icons a",o).hover(function(){var r=e(this).parent().attr("class");g();e("div#gamebar div.gamebar_content",o).addClass("hover_"+r);e("div.left div:first",o).empty().html(j(r))},function(){var r=e(this).parent().attr("class");e("div#gamebar div.gamebar_content",o).removeClass("hover_"+r);e("div.left div:first",o).empty().html(m(r));SPI.gameBar.setGuestDefaults()});return}else{e("div#gamebar",o).removeClass("guest").addClass("logged");SPI.gameBar.rotateText();l=setInterval("SPI.gameBar.rotateText()",c.settings.textRotateTime);e("div.icons a",o).hover(function(){n();var r=e(this).parent().attr("class");g();e("div#gamebar div.gamebar_content",o).addClass("hover_"+r);e("div.left div:first",o).empty().html(m(r))},function(){var r=e(this).parent().attr("class");e("div#gamebar div.gamebar_content",o).removeClass("hover_"+r);SPI.gameBar.rotateText();l=setInterval("SPI.gameBar.rotateText()",c.settings.textRotateTime)})}};var g=function(){e("div#gamebar div.icons li a.active",h.root).removeClass("active");e("div#gamebar div.unlocked",h.root).removeClass("unlocked").removeClass("achievement").removeClass("highscore").removeClass("image").addClass("default")};var m=function(o){var p={achievement:SPI.sprintf(c.langStrings.logged.hover_achievement,f.achievement.won,f.achievement.of),highscore:SPI.sprintf(c.langStrings.logged.hover_highscore,SPI.number_format(f.highscore.points),f.highscore.position),image:SPI.sprintf(c.langStrings.logged.hover_image,f.image.count)};return""+p[o]};var j=function(p){var p=p||"";var s={achievement:{type:"achievement",text:SPI.sprintf(c.langStrings.logged.default_achievement,'href="#"')},highscore:{type:"highscore",text:SPI.sprintf(c.langStrings.logged.default_highscore,SPI.number_format(f.highscore.tenthPlace))},image:{type:"image",text:SPI.sprintf(c.langStrings.logged.default_image,h.username)}};var r=[];if(h.gamebarOptions.length>0){for(var q in h.gamebarOptions){if(s&&s[h.gamebarOptions[q]]){if(h.gamebarOptions[q]=="highscore"&&f.highscore.tenthPlace==-1){r.push({type:"highscore",text:SPI.sprintf(c.langStrings.logged.default_highscore,1)});continue}r.push(s[h.gamebarOptions[q]])}}}if(p!=""&&e.inArray(p,h.gamebarOptions)!=-1){if(s[p]){return""+s[p].text}else{return""}}if(r.length>0){var o=0;if(r.length>1){o=SPI.rand(r.length)-1}return""+r[o].text}return""};h.rotateText=function(){g();var o=j();if(o!=""){b(o)}else{n()}};var b=function(p,o){if(p&&p.length>0){if(o=="right"){e("div.right",h.root).empty().html(""+p)}else{e("div.left div:first",h.root).empty().html('<div id="gamebarText">'+p+"</div>")}}};var n=function(){if(l){clearInterval(l);l=null}};var d=function(o){return c.langStrings.gender[o]};h.initData=function(o,p){f[o]=e.extend({},p)};h.unlock=function(o,q){if(e.inArray(o,h.gamebarOptions)<0){return}n();f[o]=e.extend(f[o],q);var p="";if(e.profilar.loggedIn()){switch(o){case"achievement":p=SPI.sprintf(c.langStrings.logged.unlocked_achievement,f[o].points);break;case"highscore":p=SPI.sprintf(c.langStrings.logged.unlocked_highscore,SPI.number_format(f[o].newpoints),f[o].newposition);break;case"image":p=c.langStrings.logged.unlocked_image;break}}else{switch(o){case"achievement":p=SPI.sprintf(c.langStrings.guest.unlocked_achievement,f[o].points);break;case"highscore":p=c.langStrings.guest.unlocked_highscore;break;case"image":p=c.langStrings.guest.unlocked_image;break}b(SPI.sprintf(c.langStrings.guest.unlocked_right,'href="'+c.settings.register_url+'"','href="'+c.settings.login_url+'"'),"right")}g();e("div#gamebar div.gamebar_content",h.root).removeClass("default").addClass("unlocked").addClass(""+o);e("div#gamebar div.gamebar_content div.icons li."+o+" a",h.root).addClass("active");b(p);e("#gamebarText").effect("pulsate",{times:3},500);e(".icons ."+o).effect("pulsate",{times:3},500);if(e.profilar.loggedIn()){l=setInterval("SPI.gameBar.rotateText()",c.settings.textRotateTime)}else{setTimeout("SPI.gameBar.setGuestDefaults()",c.settings.textRotateTime)}};h.setGuestDefaults=function(){g();b(SPI.sprintf(c.langStrings.guest.default_message,'href="'+c.settings.register_url+'"','href="'+c.settings.login_url+'"'))};return h})(jQuery);SPI.lastPlayedGames=(function(f){var d={settings:{splitter:".",targetUser:"",profilarName:"myrecent"}};var j={};var l=null;var g=function(q){try{if(q==null||q==""){q=new Array()}else{q=q.split(d.settings.splitter);for(var p=0;p<q.length;++p){q[p]=parseInt(q[p])}}}catch(r){q=new Array()}return q};var m=function(q){if(q.length>d.settings.maxGames){q=q.slice(0,d.settings.maxGames)}var p=q.join(d.settings.splitter);if(q.length==0){p=""}return p};var c=function(q,p){if(l!==null&&p!==true){q.call(this,l)}if(d.settings.targetUser==""){if(f.profilar.loggedIn()){f.profilar.loadPref(function(){l=g(f.profilar.getPref(d.settings.profilarName));q.call(this,l)},[d.settings.profilarName])}else{q.call(this,[])}}else{f.profilar.loadExternalPrefs([d.settings.targetUser],function(r,u){try{l=g(r[0][d.settings.profilarName]||"")}catch(s){l=g("")}q.call(this,l)},[d.settings.profilarName])}};var h=function(p){if(d.settings.targetUser==""&&f.profilar.loggedIn()){f.profilar.setPref(d.settings.profilarName,m(l));f.profilar.submitPref(function(q){if(q){p.call(this,false)}else{p.call(this,true)}},[d.settings.profilarName])}};var e=function(p){l=[];h(p)};var n=function(p,r,q){c(function(v){var s=jQuery.inArray(p,v);if(s!=-1){v.splice(s,1)}var u=v.unshift(p);l=v;h(function(x){if(x){r.call(this,u)}else{r.call(this,null)}})},q)};var o=function(){e(function(p){if(p){j.renderAtFavsPage()}else{alert(d.langStrings.clear_error)}})};var b=function(q,p,r){SPI.gameCache.getGame(q,function(u){if(u!=null){u.i=p+1;var s=f(SPI.render(r,u));f("#myrec_"+p).append(s).removeClass("indicator")}else{f("#myrec_"+p).remove()}})};j.hasGames=function(){return l.length>0};j.renderAtOverviewPage=function(){c(function(q){if(q.length==0){f("#bottomRightBox2").hide();return}for(var p=0;p<d.settings.maxOnOverview&&p<q.length;p++){f("#recentlyGames").append('<li id="myrec_'+p+'" class="'+(p%2?"":"odd-row")+'"></li>')}for(var p=0;p<d.settings.maxOnOverview&&p<q.length;p++){b(q[p],p,d.templates.overview_li)}})};j.renderAtFavsPage=function(){c(function(q){if(q.length==0){f("#bottomRightBox1").hide();f("#bottomRightBox2").css("background","none");f("#bottomRightBox2 .boxheader").css("margin-top","0");return}for(var p=0;p<d.settings.maxOnFavs&&p<q.length;p++){f("#recentlyGames").append('<li id="myrec_'+p+'" '+(p%2?"":'class="odd-row"')+"></li>")}for(var p=0;p<d.settings.maxOnFavs&&p<q.length;p++){b(q[p],p,d.templates.favs_li)}});f("#deleteLink").click(function(){o();return false})};j.addGameAfterTimeframe=function(q,p){return setTimeout(function(){n(q,function(){})},p)};j.init=function(p,q){SPI.getAndUpdateConfig("lastPlayedGames",d,p);f("#recentlyGames").empty()};return j})(jQuery);var actualWidth=0;var actualHeight=0;var startWidth=0;var startHeight=0;var ratio=1.1;function zoom(f){var e=$("div#flashobj");actualWidth=$(e).width();actualHeight=$(e).height();startWidth=actualWidth;startHeight=actualHeight;switch(f){case 1:var d=actualWidth;actualWidth=Math.ceil(ratio*actualWidth);actualHeight=Math.ceil((actualHeight*actualWidth)/d);break;case -1:var d=actualWidth;actualWidth=Math.ceil(actualWidth/ratio);actualHeight=Math.ceil((actualHeight*actualWidth)/d);break}if(actualWidth>835||startWidth>835){diff=actualWidth-startWidth;if(actualWidth<838){$("#l-mainContent").width(980);$("div.catcontainerLeft").width(835);$(e).width(actualWidth);$(e).height(actualHeight);$("#l-wrapperleft, #l-wrapperright").width(Math.round($(document).width()/2));return false}$("#l-mainContent").width(parseInt($("#l-mainContent").width())+diff);$("div.catcontainerLeft").width(parseInt($("div.catcontainerLeft").width())+diff);$("#l-wrapperleft").width(($(document).width()+(980-$("#l-mainContent").width()))/2);$("#l-wrapperright").width(($(document).width()+(980-$("#l-mainContent").width()))/2)}$(e).width(actualWidth);$(e).height(actualHeight)}function resetZoom(){if(startWidth>0&&startHeight>0){var b=$("#flashobj");actualWidth=0;actualHeight=0;$(b).width(GameWidth);$(b).height(GameHeight);$("#l-mainContent").width(980);$("div.catcontainerLeft").width(835);$("#l-wrapperleft, #l-wrapperright").width(Math.round($(document).width()/2))}}fixsize=function(){};SPI.paginatorString=function(b,j,f,m,o,n,c,l){j=j||1;f=f||20;m=m||9;if(typeof l=="undefined"){l={buttonPrevInactive:'<span class="paginationButtonPrev paginationButtonPreviousPage"><span class="disabled">%s</span></span>',buttonPrev:'<span class="paginationButtonPrev paginationButtonPreviousPage"><a href="#%d">%s</a></span>',buttonNumberCurrent:'<span class="number">%d</span>',buttonNumber:'<span class="number"><a class="pagingNumbers" href="#%1$d">%1$d</a></span>',buttonNextInactive:'<span class="paginationButtonNext paginationButtonNextPage"><span class="disabled">%s</span></span>',buttonNext:'<span class="paginationButtonNext paginationButtonNextPage"><a href="#%d">%s</a></span>'}}var g=Math.ceil(b/f);if(g<=1){return""}var h="";var d=Math.min(j-Math.floor(m/2),Math.ceil(b/f-m));var d=Math.max(d,1);if(j==1){if(l.buttonPrevInactive){h+=SPI.sprintf(l.buttonPrevInactive,n.prev)}}if(j>1){if(l.buttonPrev){h+=SPI.sprintf(l.buttonPrev,(Math.max(1,j-1)),n.prev)}}for(var e=d;e<=g&&e<=m+d;e++){if(e==j&&l.buttonNumberCurrent){h+=SPI.sprintf(l.buttonNumberCurrent,e)}else{if(l.buttonNumber){h+=SPI.sprintf(l.buttonNumber,e)}}}if(j<g&&l.buttonNext){h+=SPI.sprintf(l.buttonNext,(Math.min(j+1,g)),n.next)}if(j==g&&l.buttonNextInactive){h+=SPI.sprintf(l.buttonNextInactive,n.next)}if(o){h=$(h);$("a",h).click(function(){if(typeof c=="undefined"){o.call(this,parseInt($(this).attr("href").replace(/[^\#]*#/,"")))}else{o.call(c,parseInt($(this).attr("href").replace(/[^\#]*#/,"")))}return false})}return h};(function(){SPI.addslashes=function(e){return(str+"").replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")};SPI.stripslashes=function(e){return(e+"").replace(/\\(.?)/g,function(g,f){switch(f){case"\\":return"\\";case"0":return"\u0000";case"":return"";default:return f}})};var c={lt:"<",gt:">",quot:'"',apos:"'",amp:"&"};var d={};for(var b in c){d[c[b]]=b}SPI.escapeHTML=function(e){if(e==null){return""}return String(e).replace(/[&<>"']/g,function(f){return"&"+d[f]+";"})};SPI.unescapeHTML=function(e){if(e==null){return""}return String(e).replace(/\&([^;]+);/g,function(f,h){var g;if(h in c){return c[h]}else{if(g=h.match(/^#x([\da-fA-F]+)$/)){return String.fromCharCode(parseInt(g[1],16))}else{if(g=h.match(/^#(\d+)$/)){return String.fromCharCode(~~g[1])}else{return f}}}})}}());SPI.formatDate=function(e,d,c){var f=d||SPI._langStrings.relative_date;var g=c||false;var h=((new Date()).getTime()/1000-e),b=Math.floor(h/86400);if(isNaN(b)){return""}if(g===true){if(h<86400||b<1){return f[13]}}if(h<0||b<0){return f[0]}if(b>=730){return SPI.sprintf(f[12],Math.ceil(b/365))}if(b==0){return h<60&&f[0]||h<120&&f[1]||h<3600&&SPI.sprintf(f[2],Math.floor(h/60))||h<7200&&f[3]||h<86400&&SPI.sprintf(f[4],Math.floor(h/3600))}return b==1&&f[5]||b<7&&SPI.sprintf(f[6],b)||b<14&&f[7]||b<31&&SPI.sprintf(f[8],Math.ceil(b/7))||b<60&&f[9]||b<365&&SPI.sprintf(f[10],Math.ceil(b/30))||b<730&&f[11]};SPI.formatAbsDate=function(c,h,f){h=h===undefined?true:h;f=f===undefined?SPI._langStrings.formatabsdate:f;var b,g,e;if(h){var d=new Date();d.setTime(parseInt(c)*1000);b=d.getDate();g=d.getMonth()+1;e=d.getFullYear()}else{b=c.substr(6,2);g=c.substr(4,2);e=c.substr(0,4)}return SPI.sprintf(f,e,g,b)};SPI.report=(function(){var e={settings:{reportarUrl:"/rp/pb/1/add/%d/%d/%d/%d",reportweight:{avatar:1,username:1,aboutme:1,chat:1,comment:1,ugc:1},itemtypes:{avatar:10,username:12,comment:11,images:5,ugc:10},popupExtraClass:"",popupTitle:""}};var g={};g.initialised=false;g.reportProfile=function(j){c("profile",j)};g.reportGameComment=function(j){c("gamecomment",j)};g.reportGameCommentExtended=function(j){c("gamecommentextended",j)};g.reportUGC=function(j){c("ugc",j)};var c=function(m,l){h();var o=l;var n="";var q="";var r="";var j="";var s="";switch(m){case"ugc":n=SPI.render(e.templates.report_ugc,{highlightclass:""});q=SPI.render(SPI._templates.popup.content_doublelined,{header:e.langStrings.report_profile.success_header,info:e.langStrings.report_profile.success_info,highlightclass:"popup_ok_highlight"});r=SPI.render(SPI._templates.popup.content_doublelined,{header:e.langStrings.report_profile.error_header,info:e.langStrings.report_profile.error_info,highlightclass:"popup_bad_highlight"});j=e.langStrings.report_profile.send;s=e.langStrings.report_profile.cancel;_title=e.langStrings.report_profile.title;break;case"profile":n=SPI.render(e.templates.report_profile,{highlightclass:""});q=SPI.render(SPI._templates.popup.content_doublelined,{header:e.langStrings.report_profile.success_header,info:e.langStrings.report_profile.success_info,highlightclass:"popup_ok_highlight"});r=SPI.render(SPI._templates.popup.content_doublelined,{header:e.langStrings.report_profile.error_header,info:e.langStrings.report_profile.error_info,highlightclass:"popup_bad_highlight"});j=e.langStrings.report_profile.send;s=e.langStrings.report_profile.cancel;_title=e.langStrings.report_profile.title;break;case"gamecomment":n=SPI.render(e.templates.report_gamecomment,{highlightclass:""});q=SPI.render(SPI._templates.popup.content_doublelined,{header:e.langStrings.report_gamecomment.success_header,info:e.langStrings.report_gamecomment.success_info,highlightclass:"popup_ok_highlight"});r=SPI.render(SPI._templates.popup.content_doublelined,{header:e.langStrings.report_gamecomment.error_header,info:e.langStrings.report_gamecomment.error_info,highlightclass:"popup_bad_highlight"});j=e.langStrings.report_gamecomment.send;s=e.langStrings.report_gamecomment.cancel;_title=e.langStrings.report_gamecomment.title;break;case"gamecommentextended":n=SPI.render(e.templates.report_gamecomment_extended,{highlightclass:""});q=SPI.render(SPI._templates.popup.content_doublelined,{header:e.langStrings.report_gamecommentextended.success_header,info:e.langStrings.report_gamecommentextended.success_info,highlightclass:"popup_ok_highlight"});r=SPI.render(SPI._templates.popup.content_doublelined,{header:e.langStrings.report_gamecommentextended.error_header,info:e.langStrings.report_gamecommentextended.error_info,highlightclass:"popup_bad_highlight"});j=e.langStrings.report_gamecommentextended.send;s=e.langStrings.report_gamecommentextended.cancel;_title=e.langStrings.report_gamecommentextended.title;break}SPI.popup.show(n,function(){var x=$("#reporttype").val();var v=$("form.reportThis textarea[name=comment]").val();if(!v){v="-"}if(v==e.langStrings.defaultreporttext){v=""}if(!d(x,e.settings.itemtypes[x],$(o).data(x),$(o).data("username"),v,{ok:function(){return p()},fail:function(){return u()}})){p()}},{type:"confirm",title:e.settings.popupTitle,titleIcon:"popup_report",blueButtonText:j,bottomLinkText:s,close:false,autoClose:false,extraClass:e.settings.popupExtraClass,afterRiseCallback:function(v){$("textarea",v).keyup(function(x){if($(this).val().length>254){$(this).val($(this).val().slice(0,254))}}).focus(function(){$(this).addClass("reportBlack");if($(this).val()==e.langStrings.defaultreporttext){$(this).val("")}}).blur(function(){if($(this).val()==e.langStrings.defaultreporttext||$(this).val()==""){$(this).val(e.langStrings.defaultreporttext).removeClass("reportBlack")}});$(".popup-select .select",v).focus(function(x){$(this).parents(".popup-select").addClass("popup-select-focused")}).blur(function(x){$(this).parents(".popup-select").removeClass("popup-select-focused")});$(".popup-textarea .textarea",v).focus(function(x){$(this).parents(".popup-textarea").addClass("popup-textarea-focused")}).blur(function(x){$(this).parents(".popup-textarea").removeClass("popup-textarea-focused")})}});var p=function(){SPI.popup.show(q,function(){},{type:"alert",title:_title,extraClass:"with_icon",titleIcon:"popup_report",closeAfterTimeout:true,close:false})};var u=function(){SPI.popup.show(r,function(){},{type:"alert",title:e.langStrings.report_profile.title,titleIcon:"popup_report",closeAfterTimeout:true,close:false})}};var d=function(n,l,o,j,p,q){var m={};if($.inArray(n,["avatar","username","aboutme","chat","comment","ugc"])==-1){return false}if(n=="comment"&&o==-1){return false}m.reporteduser=j;m.reporttype=n;m.reason=SPI.escapeHTML(p).slice(0,254)||"";m.reportweight=e.settings.reportweight[n]||1;if(n=="username"){m.itemname=o;o=0}if(n=="avatar"){o=parseInt(o);if(isNaN(o)){o=0}}if($.profilar.forService().username!=""){m.username=$.profilar.forService().username;m.hash=$.profilar.forService().hash}$.ajax({type:"POST",url:SPI.sprintf(e.settings.reportarUrl,parseInt(SPI._settings.global.channel_id),parseInt(SPI._settings.global.site_id),parseInt(l),parseInt(o)),data:m,success:function(r){b(r,q)},error:function(r){f(q)},dataType:"xml"});return true};var b=function(j,l){if($("reportar result reportid",j).length){l.ok.call(this)}else{l.fail.call(this)}};var f=function(j){j.fail.call(this)};var h=function(){if(!g.initialised){SPI.getAndUpdateConfig("reports",e);g.initialised=true}};return g})();SPI.iff=function(d,c,b){if(d){return c}return b};SPI.myGames=(function(d){var s={settings:{game_url:"/gamedata/%s.json",timeout:7000,li_id:"mygame",splitter:".",maxGames:100,gamesPerPage:25,gamesPerPageShort:15,maxPages:5}};var c={games:null,targetUser:null,currentRender:null,currentPage:null};var h={};var q=function(y){try{if(y==null||y==""){y=[]}else{y=y.split(s.settings.splitter);for(var x=0;x<y.length;++x){y[x]=parseInt(y[x])}}}catch(z){y=[]}return y};SPI.getAndUpdateConfig("myGames",s);h.init=function(z,y,x){if(c.targetuser||c.games){z.call(this,y);return}c.targetuser=x;if(c.targetuser==null){if(d.profilar.loggedIn()){d.profilar.loadPref(function(){c.games=q(d.profilar.getPref("mygames"));var A=c.games.join(s.settings.splitter);d.cookie("my_games_copy",A,{path:"/"});z.call(this,y)},["mygames"])}else{z.call(this,y)}}else{d.profilar.loadExternalPrefs([c.targetuser],function(A,B){targetUsertmpgames=A[0].mygames||"";c.games=q(targetUsertmpgames);z.call(this,y)},["mygames"])}return};var b=function(y,x,z){SPI.gameCache.getGame(y,function(C){if(C==null||C.is_available===false){if(z!=-1){var B=SPI.render(s.templates.faves_error,{gameId:y})}else{var B=s.langStrings.notAvailable}d("#"+s.settings.li_id+"_"+x).html(B)}else{C.new_one=C["new"];C.gameId=y;var A=d(SPI.render((z==-1?s.templates.home:s.templates.faves),C)).ntooltip({extraClass:"pretty",showBody:"| ",fancyImages:SPI._settings.tooltipFancyImagesArray}).spiIeh();d("#"+s.settings.li_id+"_"+x).empty().append(A)}})};var m=function(y,x,z,A){SPI.gameCache.getGame(y,function(B){if(B==null||B.is_available===false){var B=new Object();B.gameId=y;B.active=false;p("#"+s.settings.li_id+"_"+x+"_"+z,B)}else{if(B.id){B.active=true}else{B.active=false}B.new_one=B["new"];B.gameId=y;p("#"+s.settings.li_id+"_"+x+"_"+z,B)}if(A!==undefined){A.call()}})};var n=function(x){var y={};if(x.indexOf("onclick")){y.onclick=x.match('onclick="(.*?)"');y.href=x.replace(/\s*onclick=".*?"\s*/,"")}y.href=y.href.replace('<a href="',"").replace('"',"");return y};var p=function(D,z){var A=c.currentPage;if(A>1){var E=c.games.length-((A-1)*s.settings.gamesPerPage);if(E==1){--A}}d(D+" .delete-action").click((function(F,G){return function(I){if(confirm(SPI._langStrings.myGames.removeConfirmation)){var H;if(d.cookie("my_games_copy")!=="undefined"&&d.cookie("my_games_copy")!=null){H=d.cookie("my_games_copy");var J=H.split(s.settings.splitter);if(jQuery.browser.msie){c.games=j(J)}else{c.games=J.map(function(K){return parseInt(K)})}}SPI.myGames.removeFromMyGames(F);SPI.myGames.renderAtMyfavesPage(G)}I.preventDefault()}})(z.gameId,A)).show();if(z.active){var B=n(z.gamelink);y=B.href;var C=B.onclick;if(z.new_one){d(D+" #gameNew").show()}}else{z.title=s.langStrings.gameNotFound;z.game_description=s.langStrings.gameNotFound;z.subcategory_name=s.langStrings.gameNotFoundDescription;z.rating2=0;z.thumbnail=domain_pool.getURL("/img/userprofile/gameNotFound.gif","thumbnail");var y="javascript:void(0);"}d(D).removeClass("is-empty");d(D+" .thmb").attr("src",z.thumbnail).show();d(D+" .gameTitle").html(z.title).show();var x=d(D+" .profileGameItem").attr("href",y).css("display","block");if(C){x.click(new Function(C[1]))}d(D+" .tooltipDescription").html(z.game_description);d(D+" .tooltipSubcategory").html(z.subcategory_name);d(D+" .tooltipRatingValue").html(z.rating2);d("#profileFaveGames li#"+D).dEllipsis({overflowElement:".thmb-description",textElement:".gameTitle",shortSteps:true,wrapInWidth:true});d("#profileFaveGames li#"+D+".ttR").dTooltip({eventHandler:".profileGameItem",displayDiv:"tltright",content:".tltcontent",track:true,position:"right",x:-216,y:5,drawItemCallback:"drawNeboxItem"});d("#profileFaveGames li#"+D+".ttL").dTooltip({eventHandler:".profileGameItem",displayDiv:"tltleft",content:".tltcontent",track:true,position:"left",x:10,y:5,drawItemCallback:"drawNeboxItem"});d("#profileFaveGames li#"+D+" img").attr("alt","").attr("title","");d("#profileFaveGames li#"+D+" a").attr("alt","").attr("title","");d(D+" .indicator_fav").remove()};var e=function(y,x,z){SPI.gameCache.getGame(y,function(C){if(C==null||C.is_available===false){var B=d(SPI.render((s.templates.userprofile_error),{game_Id:y,error:s.langStrings.notAvailable}));d("#"+s.settings.li_id+"_"+x).html(B)}else{C.new_one=C["new"];C.gameId=y;var A=d(SPI.render((s.templates.userprofile),C)).ntooltip({extraClass:"pretty",showBody:"| ",fancyImages:SPI._settings.tooltipFancyImagesArray}).spiIeh();d("#"+s.settings.li_id+"_"+x).empty().append(A)}})};h.hasGames=function(){return};h.renderMyGames=function(z){if(games.length==0){return}d("ol#favorite-list").empty();var A=Math.ceil(games.length/s.settings.itemsPerPage);for(var y=(z*s.settings.itemsPerPage)-s.settings.itemsPerPage;y<(z*s.settings.itemsPerPage)&&y<games.length;y++){d("ol#favorite-list").append('<li id="'+s.settings.li_id+"_"+y+'">'+s.langStrings.loading+"</li>");b(games[y],y,z)}var x=SPI.paginatorString(games.length,z,s.settings.itemsPerPage,s.settings.maxPages,h.renderMyGames,s.langStrings);d("#paging_center").empty();if(x!=""){d("#paging_center").append(x)}return false};h.convertGames=function(){var x=d.cookie(s.settings.cookieName)||"";if(x!=""){d.profilar.setPref("mygames",x);d.profilar.submitPref(function(y){if(y){}else{d.cookie(s.settings.cookieName,null)}})}};h.renderAtHomePage=function(){if(d.profilar.loggedIn()){c.currentRender="renderAtHomePage";c.currentPage=0;var y=c.games;if(y.length==0){d("#favorite_box .moreIn").hide();return}if(y.length<7){d("#favorite_box .moreIn").css("display","none")}d(".no-faves-text").remove();for(var x=0;x<s.settings.itemsAtHomePage&&x<y.length;x++){d("#favorite_box ol").append('<li id="'+s.settings.li_id+"_"+x+'">'+s.langStrings.loading+"</li>");b(y[x],x,-1)}}else{d(".no-faves-text").text(s.langStrings.not_logged_in).show()}};var r;var v;var u=function(B,A){var z=r[B];var E="#profileGameFrame"+A;var x="javascript:if(confirm('"+SPI._langStrings.myGames.removeConfirmation+"')){SPI.myGames.removeFromMyGames("+z.gid+");SPI.myGames.renderAtMyprofilePage();}";d(E+" .delete-action").attr("href",x);d(E+" .delete-action").show();d(E).removeClass("is-empty");if(!z.active){z.title=s.langStrings.gameNotFound;z.game_description=s.langStrings.gameNotFound;z.subcategory_name=s.langStrings.gameNotFoundDescription;z.rating2=0;z.thumbnail=domain_pool.getURL("/img/userprofile/gameNotFound.gif","thumbnail");z.isNew=false;var y="javascript:void(0);"}else{var C=n(z.gamelink);y=C.href;var D=C.onclick}d(E+" .tooltipDescription").html(z.game_description);d(E+" .tooltipSubcategory").html(z.subcategory_name);d(E+" .tooltipRatingValue").html(z.rating2);E+=" .profileGameItem";d(E).attr("href",y);if(z.thumbnail!=""){d(E+" .thmb").attr("src",z.thumbnail)}d(E+" .gameTitle").html(z.title);if(z.isNew){d(E+" #gameNew").show()}d(E).show();if(D){d(E).click(new Function(D[1]))}};var o=function(){var x=0;var B=false;for(var A=0;(A<v.length)&&!B;++A){var z=v[A];for(var y=0;y<r.length;++y){if(r[y].gid==z){u(y,x++);if(x>=4){B=true;break}}}}d("#profileOverviewFavGames li").dEllipsis({overflowElement:".thmb-description",textElement:".gameTitle",shortSteps:true,wrapInWidth:true})};h.renderAtMyprofilePage=function(){d("#profileOverviewFavGames .game-thumb").addClass("is-empty");d("#profileOverviewFavGames .delete-action").hide();d("#profileOverviewFavGames .profileGameItem").hide();d("#profileOverviewFavGames #gameNew").hide();r=new Array();v=c.games;var A=c.games;var x=Math.min(A.length,4);var z=x;for(var y=0;y<z;++y){SPI.gameCache.getGame(A[y],(function(B){return function(C){if(C!=null&&C.is_available===true){C.active=true}else{C={};C.gid=B;C.active=false}r.push(C);if(--x==0){o()}}})(A[y]))}d(".moreLinkFavorites").text(SPI.sprintf(d(".moreLinkFavorites").text(),v.length))};h.renderAtUserprofilePage=function(){c.currentRender="renderAtUserprofilePage";c.currentPage=0;d(".myfavesmorelink").hide();var y=c.games;if(y.length==0){d("#usersfaves").empty();for(x=1;x<=5;x++){d("#usersfaves").append('<li class="no-myfaves-empty"></li>')}d(".myfavesmorelink").hide();return}d("#usersfaves").empty();d(".no-faves-text").remove();for(var x=0;x<5&&x<y.length;x++){d("#usersfaves").append('<li id="'+s.settings.li_id+"_"+x+'">'+s.langStrings.loading+"</li>");e(y[x],x,-1)}};h.renderAtUserfavesPage=function(y){c.currentRender="renderAtUserfavesPage";c.currentPage=y||1;if(!y){y=c.currentPage}var z=s.settings.gamesPerPage;var A=c.games;if(A.length==0){z=s.settings.gamesPerPageShort;d("#middlePinkBoxSmall").addClass("pinkShort");c.targetuser?d("#additionalBox").hide():d("#additionalBox").show()}l(z,y);if(A.length==0){return}f(A,y,z);var x=SPI.paginatorString(A.length,y,z,s.settings.maxPages-1,h.renderAtUserfavesPage,s.langStrings);g(x,A,z,y)};h.renderAtMyfavesPage=function(z){c.currentRender="renderAtMyfavesPage";c.currentPage=z||1;if(!z){z=c.currentPage}var A=s.settings.gamesPerPage;var B=c.games;if(B.length==0){A=s.settings.gamesPerPageShort;d("#middlePinkBoxSmall").addClass("pinkShort");c.targetuser?d("#additionalBox").hide():d("#additionalBox").show()}l(A,z);if(B.length==0){return}pageGames=B.slice((parseInt(z)-1)*A,(parseInt(z)-1)*A+A);while(pageGames.length==0||z<=0){z--;pageGames=B.slice((parseInt(z)-1)*A,(parseInt(z)-1)*A+A)}c.currentPage=z;for(var y=0;y<pageGames.length;y++){d("#"+s.settings.li_id+"_"+y+"_"+z).append(s.templates.myprofile_indicator);m(pageGames[y],y,z)}var x=SPI.paginatorString(B.length,z,A,s.settings.maxPages-1,h.renderAtMyfavesPage,s.langStrings);g(x,B,A,z)};var l=function(A,z){d("#profileFaveGames").empty();for(i=0;i<A;i++){var x="ttL";if((i+1)%5==0){x="lastInRow ttR"}else{if((i+1)%5==4){x="ttR"}else{x="ttL"}}var y=d(SPI.render(s.templates.myprofile_empty,{li_id:s.settings.li_id,ndx:i+"_"+z,ttclass:x}));d("#profileFaveGames").append(y)}d("#profileFaveGames .game-thumb").addClass("is-empty");d("#profileFaveGames .delete-action").hide();d("#profileFaveGames .profileGameItem").hide();d("#profileFaveGames #gameNew").hide()};var g=function(x,B,A,z){d(".pagination").empty();if(x!=""){d("#pagination_top").append(x);d("#pagination_bottom").append(x.clone(true));var y=Math.ceil(B.length/A);d("#pagination_pages_top, #pagination_pages_bottom").html(SPI.sprintf(SPI._langStrings.sf_global.pagination_counter,z,y))}};var f=function(A,y,z){pageGames=A.slice((parseInt(y)-1)*z,(parseInt(y)-1)*z+z);while(pageGames.length==0||y<=0){y--;pageGames=A.slice((parseInt(y)-1)*z,(parseInt(y)-1)*z+z)}c.currentPage=y;for(var x=0;x<pageGames.length;x++){d("#"+s.settings.li_id+"_"+x+"_"+y).append(s.templates.myprofile_indicator);m(pageGames[x],x,y,function(){d("#profileFaveGames .delete-action").hide()})}};h.isAdded=function(x){return d.inArray(x,c.games)!=-1};h.addToMyGames=function(A,z){var x=c.games;if(d.cookie("my_games_copy")!=="undefined"&&d.cookie("my_games_copy")!=null){var y=d.cookie("my_games_copy");x=y.split(s.settings.splitter);if(jQuery.browser.msie){x=j(x)}else{x=x.map(function(B){return parseInt(B)})}}if(d.inArray(z,x)!=-1){alert(SPI.sprintf(s.langStrings.alreadyInMyGames,A));return}else{if(isNaN(x[0])){x[0]=z}else{x.unshift(z)}x.unshift(z);if(x.length>s.settings.maxGames){x=x.slice(0,s.settings.maxGames)}c.games=x;x=x.join(s.settings.splitter);d.profilar.setPref("mygames",x);d.profilar.submitPref(function(B){if(B){alert("2"+s.langStrings.error_html);return}else{d.cookie("my_games_copy",x,{path:"/"})}});SPI.popup.show(SPI.sprintf(s.langStrings.addedToMyGames,A),function(){SPI.popup.close()},{close:false});sendSpilEvent("Game","Favorites",""+z);d("#game-add").hide();d("#game-added").show()}};h.removeFromMyGames=function(z,y){if(c.targetuser==null){var x=c.games;if(d.inArray(z,x)==-1){return}else{x.splice(d.inArray(z,x),1);c.games=x;x=x.join(s.settings.splitter);d.profilar.setPref("mygames",x);d.profilar.submitPref(function(A){if(A){alert(s.langStrings.error_html);return}else{d.cookie("my_games_copy",x,{path:"/"})}});if(y){alert(SPI.sprintf(s.langStrings.removedFromMyGamesWithName,y))}else{alert(SPI._langStrings.myGames.removedFromMyGames)}}}};h.getCountForUser=function(y,x){if(d.profilar.loggedIn()){d.profilar.loadPref(function(){var z=q(d.profilar.getPref("mygames"));x.call(this,z)},["mygames"])}else{x.call(this)}};var j=function(x){var y=x.length;var z=new Array();for(i=0;i<y;i++){z[i]=parseInt(x[i])}return z};return h})(jQuery);SPI.highscore=(function(h){var K={settings:{timeout:3000,ajaxCacheGeneral:true,ajaxCacheUser:true,ajaxCacheUserHighscore:true,highscorebox_title_length:16,usernameLenght:14,anonymousIcon:domain_pool.getURL("/img/userprofile/dummy_small.gif")}};var n={};var M;var r=[];var v={};var d=true;var f=10;var u={};var b=0;var q=0;var z={score:0,position:0};var l=function(R,Q){var Q=Q||false;var N=0;for(var P in u){if(parseInt(R)>parseInt(u[P].score)){N=parseInt(u[P].position);break}else{if(parseInt(R)==parseInt(u[P].score)){N=parseInt(u[P].position)+(Q?0:0);var O=parseInt(P)+1;if(u[O]!==undefined&&parseInt(R)!=parseInt(u[O].score)){break}}}}if(N<=f){if(u.length<=f){N=f+1}else{if(typeof(u.length)!="undefined"){N=parseInt(u[u.length-1].position)+1}}}if(N>100){N=""+N+"+"}return N};var D=function(Q,Y,ad){var P=[],aa=[],ab=false;if(Q.hyscor[M]!==undefined&&Q.hyscor[M].result){u=Q.hyscor[M].result.concat()}else{u={}}if(Q.hyscor&&Q.hyscor[M]&&Q.hyscor[M].result.length>0){aa=Q.hyscor[M].result.splice(0,f);for(var Z in aa){aa[Z].avatar_url=K.settings.noimage;aa[Z].current=false;if(aa[Z].authenticated=="1"){P.push(aa[Z].username)}}}if(P.length>0){h.profilar.loadExternalPrefs(P,function(ao,ap){for(var am in aa){for(var al in ao){if(ao[al].username&&ao[al].username.toLowerCase()==aa[am].username.toLowerCase()&&ao[al].avatar&&ao[al].avatar!=""&&ao[al].avatar!=undefined){aa[am].avatar_url=SPI.sprintf(SPI._settings.global.avatar_url_small,ao[al].avatar)||K.settings.noimage}aa[am].current=(h.profilar.forService().username.toLowerCase()==aa[am].username.toLowerCase());if(aa[am].current){ab=true}}}if(ab==false&&Y&&Y.hyscor&&Y.hyscor[M]&&Y.hyscor[M].result.length>0){var aj=Y.hyscor[M].result[0];aj.current=true;var ag=h.profilar.getPref("avatar");if(ag!=""){ag=SPI.sprintf(SPI._settings.global.avatar_url_small,ag)}else{ag=K.settings.noimage}aj.avatar_url=ag;aa.push(aj)}if(aa.length>f+1){aa=aa.splice(0,f+1)}var aq=aa.concat();var af=0;var ae=0;var ai=0;if(r.length>0){var ah=r.concat();for(var an in aq){ae=parseInt(aq[an].timestamp);if(aq[an].current==true){var ak=aq[an];for(var am in ah){af=parseInt(ah[am].timestamp);ai=Math.abs(af-ae);if(ak.score==ah[am].score&&ai<=10){ah.splice(am,1)}}}}if(ah.length>0){for(var al in ah){aq.push(ah[al])}aq.sort(G);s(aq);aq=aq.splice(0,f+1);if(aq.length>f&&aq[f].current!=true){aq.pop()}else{if(aq.length>f){for(an=0;an<f;an++){if(aq[an].current==true){aq.pop();break}}}}}}aq.sort(G);s(aq);ad.call(this,aq)},["avatar"])}else{if(Y&&Y.hyscor&&Y.hyscor[M]&&Y.hyscor[M].result.length>0){var U=Y.hyscor[M].result[0];U.current=true;U.avatar_url=SPI.sprintf(SPI._settings.global.avatar_url_small,h.profilar.getPref("avatar"))||K.settings.noimage;aa.push(U)}var ac=aa.concat();var O=0;var N=0;var S=0;if(r.length>0){var R=r.concat();for(var Z in ac){N=parseInt(ac[Z].timestamp);if(ac[Z].current==true){var V=ac[Z];for(var X in R){O=parseInt(R[X].timestamp);S=Math.abs(O-N);if(V.score==R[X].score&&S<=10){R.splice(X,1)}}}}if(R.length>0){for(var W in R){ac.push(R[W])}ac.sort(G);s(ac);ac=ac.splice(0,f+1);if(ac.length>f&&ac[f].current!=true){ac.pop()}else{if(ac.length>f){for(Z=0;Z<f;Z++){if(ac[Z].current==true){ac.pop();break}}}}}}ac.sort(G);s(ac);ad.call(this,ac)}};var x=function(O){if(O&&O.length>0){for(var P in O){if(O[P].current==true){var N;if(P==f){N=l(O[P].score)}else{N=O[P].position}return{score:O[P].score,position:N}}}}return{score:0,position:0}};var y=function(P,R){if(P&&P.length>0){for(var Q in P){if(P[Q].current==true&&P[Q].score==R){var N;if(Q==f){N=l(P[Q].score,true)}else{N=P[Q].position}return{score:P[Q].score,position:N}}}}var O=l(R,true);return{score:R,position:O}};var I=function(O,N){K.settings.ajaxCacheGeneral=true;if(O&&O.hyscor&&O.hyscor.errorcode!==undefined){O={hyscor:[]}}this.after_call(O)};var A=function(N){h.ajax({global:false,cache:K.settings.ajaxCacheGeneral,timeout:K.settings.timeout,url:SPI.sprintf(K.settings.url,SPI._settings.global.site_id,K.settings.gameId),type:"GET",dataType:"json",success:I,error:function(Q,O,P){if(O=="timeout"){n.renderHighScores()}else{I.call(this,{hyscor:[]},"")}},after_call:N,data:{group:M,order:K.settings.order,authenticated:"1",outputtype:"json"}})};var F=function(O,N){K.settings.ajaxCacheUser=true;if(O&&O.hyscor&&O.hyscor.errorcode!==undefined){O={hyscor:[]}}this.after_call(O)};var o=function(N){h.ajax({global:false,cache:K.settings.ajaxCacheUser,timeout:K.settings.timeout,url:SPI.sprintf(K.settings.url,SPI._settings.global.site_id,K.settings.gameId),type:"GET",dataType:"json",success:F,error:function(Q,O,P){F.call(this,{hyscor:[]},"")},after_call:N,data:{group:M,order:K.settings.order,authenticated:"1",outputtype:"json",username:h.profilar.forService().username,hash:h.profilar.forService().hash}})};n.getUserLevel=function(P,O){var N={outputtype:"json"};if(O){N.targetuser=O}else{N.username=h.profilar.forService().username;N.hash=h.profilar.forService().hash}h.ajax({global:false,cache:K.settings.ajaxCacheUser,timeout:K.settings.timeout,url:K.settings.gamelevelurl,type:"GET",dataType:"json",success:function(Q){P.call(this,Q)},error:function(S,Q,R){F.call(this,{hyscor:[]},"")},after_call:P,data:N})};n.init=function(N){SPI.getAndUpdateConfig("highscore",K,N);M=K.settings.defaultView;h("div#highscore_box div.viewbar a").live("click",function(){if(d===true){d=false;M=""+h(this).attr("href").replace(/[^#]*#/g,"");h("div#highscore_box div.viewbar a").removeClass("active");h("div#highscore_box div.viewbar a").unbind("click");n.renderHighScores()}return false});if(h.profilar.loggedIn()){h(".highscore_login_info").hide()}};var j=function(O,P){if(O>0){var N=h.profilar.getPref("avatar")!=""?SPI.sprintf(SPI._settings.global.avatar_url_small,h.profilar.getPref("avatar")):K.settings.noimage;var Q={notLogged:false,position:1,timestamp:P+"",username:h.profilar.get("username"),current:true,authenticated:1,score:O,gamelevel:"",country:"",avatar_url:N};v=Q;r.push(Q);r.sort(G)}};var m=function(O,P){if(O>0){var N=K.settings.anonymousIcon;var Q={notLogged:true,position:1,timestamp:P+"",username:K.langStrings.guest,current:true,authenticated:1,score:O,gamelevel:"",country:"",avatar_url:N};v=Q;r.push(Q);r.sort(G)}};var G=function(P,O){var N=parseInt(P.score);var Q=parseInt(O.score);return(Q-N)};var s=function(N){if(N.length>0){for(i=0;i<N.length;i++){N[i].position=i+1}}};var J=function(O,N){if(O&&O.hyscor&&O.hyscor.errorcode!==undefined){return}j(this.score,O.hyscor.time);n.renderHighScores(true,this.score)};var C=function(O,N){if(O&&O.hyscor&&O.hyscor.errorcode!==undefined){return}m(this.score,O.hyscor.time);n.renderHighScores(true)};n.newScoreCallback=function(N){M="daily";if(N>0){h.ajax({cache:false,timeout:3000,url:K.settings.timeurl,type:"GET",dataType:"json",success:J,error:function(Q,O,P){J.call(this,{hyscor:[]},"")},data:{outputtype:"json"},score:N})}};n.notLoggedScoreCallback=function(N){M="daily";if(N>0){h.ajax({cache:false,timeout:3000,url:K.settings.timeurl,type:"GET",dataType:"json",success:C,error:function(Q,O,P){J.call(this,{hyscor:[]},"")},data:{outputtype:"json"},score:N})}};n.drawHighscores=function(Q,O){h("div#highscore_box div.accordion-highscore-box-content").removeClass("highscore_indicator").empty();h("div#highscore_box div.viewbar a."+M).addClass("active");var P=false;if(Q.length>0){h("#highscore_box div.accordion-highscore-box-content").append("<ol></ol>");var Y="",N="";var U=false;var R=1;var V="";var X=true;for(var S in Q){V="";if(X===true&&Q[S].current==true&&v.score&&v.score>0&&Q[S].score==v.score){V=' cuser="1"';X=false}if(Q[S].current==true&&!U){extraClass=' class="current"';U=true}else{extraClass=""}if(S==f){liData={liExtra:extraClass+V,position:l(Q[S].score),userLink:(Q[S].notLogged!=true&&Q[S].authenticated==1?SPI.sprintf(K.settings.userprofile_link,Q[S].username):""),avatarUrl:Q[S].avatar_url,username:Q[S].username,userNameCutted:SPI.cutStringPlease(Q[S].username,K.settings.usernameLenght),score:Q[S].score,date:SPI.formatDate(Q[S].timestamp,SPI._langStrings.relative_date_plain)};h("#highscore_box ol").append(SPI.render(K.templates.game_my_highscore,liData))}else{liData={liExtra:extraClass+V,position:Q[S].position||"",userLink:(Q[S].notLogged!=true&&Q[S].authenticated==1?SPI.sprintf(K.settings.userprofile_link,Q[S].username):""),avatarUrl:Q[S].avatar_url,username:Q[S].username,userNameCutted:SPI.cutStringPlease(Q[S].username,K.settings.usernameLenght),score:Q[S].score,date:SPI.formatDate(Q[S].timestamp,SPI._langStrings.relative_date_plain)};h("#highscore_box ol").append(SPI.render(K.templates.game_highscore_li,liData))}R++}h("#highscore_box ol li:even").addClass("odd");h("#highscore_box ol li:odd").addClass("even")}else{P=true}if(P){var W="";if(!h.profilar.loggedIn()){W=" not_logged"}h("#highscore_box div.accordion-highscore-box-content").append('<div class="noitems'+W+'">'+K.langStrings.no_results+"</div>")}n.animateCurrentScore(O);d=true};n.renderHighScores=function(O,N){h("div#highscore_box div.viewbar a").removeClass("active");h("div#highscore_box div.accordion-highscore-box-content").empty();A(function(P){if(h.profilar.loggedIn()){o(function(Q){D(P,Q,function(R){n.drawHighscores(R,O);if(M=="daily"){if(R&&R[0]){b=parseInt(R[0].score)}if(R&&R[9]){q=parseInt(R[9].score)}z=x(R.concat());SPI.gameBar.initData("highscore",{tenthPlace:(q+1),firstplace:(b+1),points:z.score,position:z.position,newpoints:0,newposition:0})}if(O==true){userActual=y(R.concat(),N);if(userActual.score>b){b=userActual.score}SPI.gameBar.unlock("highscore",{firstplace:(b+1),newpoints:userActual.score,newposition:userActual.position})}})})}else{D(P,null,function(Q){n.drawHighscores(Q,O);if(M=="daily"){if(Q&&Q[0]){b=parseInt(Q[0].score)}if(Q&&Q[9]){q=parseInt(Q[9].score)}SPI.gameBar.initData("highscore",{tenthPlace:(q+1),firstplace:(b+1)})}if(O==true){userActual=y(Q.concat(),N);if(userActual.score>b){b=userActual.score}SPI.gameBar.unlock("highscore",{firstplace:(b+1),newpoints:userActual.score,newposition:userActual.position})}})}})};n.animateCurrentScore=function(N){if(h("#highscore_box .my_highscore_top[cuser=1]").length>0){h("#highscore_box .my_highscore_top[cuser=1]").addClass("my_highscore_top_anim").animate({opacity:0.2},150).animate({opacity:1},100).animate({opacity:0.2},100).animate({opacity:1},100).animate({opacity:0.2},100).animate({opacity:1},100).animate({opacity:0.2},100).animate({opacity:1},100).animate({opacity:0.2},350,function(){h("#highscore_box .my_highscore_top[cuser=1]").removeClass("my_highscore_top_anim").css("opacity","")})}else{if(h("#highscore_box ol li[cuser=1]").hasClass("current")){h("#highscore_box ol li[cuser=1]").animate({opacity:0.5},150).animate({opacity:1},100).animate({opacity:0.5},100).animate({opacity:1},100).animate({opacity:0.5},100).animate({opacity:1},100).animate({opacity:0.5},100).animate({opacity:1},350,function(){h("#highscore_box ol li[cuser=1]").css("opacity","")})}else{h("#highscore_box ol li[cuser=1]").addClass("current").animate({opacity:0.5},150).animate({opacity:1},100).animate({opacity:0.5},100).animate({opacity:1},100).animate({opacity:0.5},100).animate({opacity:1},100).animate({opacity:0.5},100).animate({opacity:1},100).animate({opacity:0.2},350,function(){h("#highscore_box ol li[cuser=1]").removeClass("current").css("opacity","")})}}v={}};n.UserLevel=function(N){if(h.profilar.loggedIn()){n.getUserLevel(function(O){try{tmp=O.hyscor.level||0}catch(P){tmp=0}N.call(this,tmp)})}else{N.call(this,0)}};var L=function(O,N){if(O&&O.hyscor&&O.hyscor.errorcode!==undefined){O={hyscor:[]}}this.after_call(O)};var H=function(P,O){var N=P||h.profilar.forService().username;h.ajax({global:false,cache:K.settings.ajaxCacheUserHighscore,timeout:K.settings.timeout,url:SPI.sprintf(K.settings.userhighscoresurl,SPI._settings.global.site_id),type:"GET",dataType:"json",success:L,error:function(S,Q,R){L.call(this,{hyscor:[]},"")},after_call:O,data:{outputtype:"json",targetuser:N,pagesize:50}})};var E=function(Q){var Y=[];try{Y=Q.hyscor.resultset.result}catch(S){}var U=Y.concat();var W=[];if(U.length>0){h("div#highscores div.noresults").hide();h("div#highscores div.results").empty().show();h("div#highscores div.results").append("<ul></ul>");var O="";for(var R in U){O="";h("div#highscores div.results ul").append('<li id="hsid_'+R+'" class="noresult indicator'+(R%2==0?" even":" odd")+'">'+O+"</li>");W.push({loggedIn:U[R].loggedIn,game_id:U[R].itemid,score:U[R].score,timestamp:U[R].timestamp})}var N=7;if(U.length<N){var X='<div class="image noresult"></div><div class="infotext">'+SPI._langStrings.highscore.hsbox_nohighscoresyet+"</div>";for(var V=U.length;V<N;V++){h("div#highscores div.results ul").append('<li id="hsid_'+V+'" class="noresult'+(V%2==0?" even":" odd")+'">'+X+"</li>")}}}else{h("div#highscores div.results").empty().hide();h("div#highscores div.noresults").show()}if(W.length>0){for(var P in W){p(P,W[P])}}};var e=function(R,P){var Y=[];try{if(R&&R.hyscor&&R.hyscor.resultset&&R.hyscor.resultset.result){Y=R.hyscor.resultset.result}}catch(U){}var V=Y.concat();var W=5;V=V.slice(0,W);var X=[];if(V.length>0){h("#UserHighScore .latestscores-none").hide();h(".latestscores").show();h(".latestscores").empty();h(".latestscores").append('<ul class="ordered-list list-numbers"></ul>');var N="",S=null;for(var Q in V){S=h(SPI.render(K.templates.highscorebox_profile_emptyrow,{extraClass:(Q%2==0?"odd-row":""),index:(+Q+1)})).attr("id","hsid_"+Q);h(".latestscores ul").append(S);X.push({loggedIn:V[Q].loggedIn,game_id:V[Q].itemid,score:V[Q].score,timestamp:V[Q].timestamp})}if(V.length<=W){Q++;for(Q;Q<W;Q++){S=h(SPI.render(K.templates.highscorebox_profile_emptyrow,{extraClass:(Q%2==0?"odd-row":""),index:(+Q+1)})).attr("id","hsid_"+Q);h(".latestscores ul").append(S)}}}if(X.length>0){for(var O in X){B(O,X[O])}if(X.length>5){P.call(this,false)}else{h(".latestscores").css("");P.call(this,true)}}};var p=function(O,N){SPI.gameCache.getGame(N.game_id,function(P){c(P,O,N)})};var B=function(O,N){SPI.gameCache.getGame(N.game_id,function(P){g(P,O,N);h(".latestscores ul").dTooltip({drawItemCallback:"drawPopularItem",eventHandler:"li.tooltip",y:-10,ellipsis:{overflowElement:"span.tooltipOverflow",textElement:"span.dtooltip",shortSteps:true,textEnd:"... )"}})})};var c=function(O,R,Q){h("div#highscores div.results ul li[id=hsid_"+R+"]").removeClass("indicator").removeClass("noresult");if(O==null){return}var N=SPI.escapeHTML(O.description);var P='<span class="time" style="display:none;"><span class="highscoresbox_time">'+SPI.formatDate(Q.timestamp,SPI._langStrings.relative_date_plain,true)+"</span></span>";var U="";U='<div class="image" title="'+N+'" style="position: relative;">'+O.url+'<span class="cropper"><img src="'+O.thumbnail+'" width="43" height="32" alt="'+SPI.escapeHTML(O.title+"")+'" /><span class="rounder">&nbsp;</span></span></a>'+P+'</div><div class="infotext" title="'+N+'"><span class="gametitle">'+O.url+SPI.cutStringPlease(O.title,K.settings.highscorebox_title_length)+"</a></span>"+P+'</div><div class="gamescore">'+SPI.number_format(Q.score)+"</div>";h("div#highscores div.results ul li[id=hsid_"+R+"]").empty().append(U);var S=R%2==0?"even":"odd";h("div#highscores div.results ul li[id=hsid_"+R+"]").addClass(S);spiApplyTooltip2(h("div#highscores div.results ul li[id=hsid_"+R+"] div.infotext"),"| ");spiApplyTooltip2(h("div#highscores div.results ul li[id=hsid_"+R+"] div.image"),"| ")};var g=function(O,Q,P){h(".latestscores ul li[id=hsid_"+Q+"]").removeClass("indicator");if(O==null){return}if(O.title.indexOf("&amp;")!=-1){O.title=O.title.replace("&amp;","&")}var N=h(SPI.render(K.templates.highscorebox_profile_rowcontent,{link:""+O.gamelink,score:""+SPI.number_format(P.score),title:""+O.title,thumbnail:""+O.thumbnail,subcategory:""+O.subcategory_name,rating:""+O.rating2}));h(".latestscores ul li[id=hsid_"+Q+"]").empty().append(N)};n.renderHighScoresBox=function(N){var O=N||null;H(O,function(P){E(P)})};n.renderHighScoresBoxProfile=function(P,N){var O=N||null;H(O,function(Q){e(Q,P)})};return n})(jQuery);SPI.achievements=(function(h){var E={settings:{timeout:7000,awardsbox_gametitle_length:30,awardsbox_awardtitle_length:75,gamerPointsOverviewItemsPerPage:5,latest_limit:5,animationCycleTimes:30,latest_li:"latawa_"}};var m={};var e=[];var C=0;var j=0;var f=null;m.init=function(G){SPI.getAndUpdateConfig("achievement",E,G)};m.renderAchievements=function(){v(function(G){if(h.profilar.loggedIn()){n(function(H){x(G,H,function(I){m.drawAchievements(I);j=I.length;C=e.length;s("normal_logged");SPI.gameBar.initData("achievement",{won:C,of:j})})})}else{x(G,null,function(H){m.drawAchievements(H);j=H.length;s("normal_guest");SPI.gameBar.initData("achievement",{won:0,of:j})})}})};var s=function(G){switch(G){case"normal_logged":case"unlock_logged":h(".gameawards_awards h4").text(SPI.sprintf(E.langStrings.award_count_info,C,j));h(".gameawards_login_info").hide();break;case"normal_guest":h(".gameawards_awards h4").text(SPI.sprintf(E.langStrings.award_count_info,C,j));h(".gameawards_login_info").show().find("p:eq(0)").show().end().find("p:eq(1)").hide();break;case"unlock_guest":h(".gameawards_awards h4").text(SPI.sprintf(E.langStrings.award_count_info,C,j));h(".gameawards_login_info").show().find("p:eq(1)").show().end().find("p:eq(0)").hide();break}};var A=function(H,G){if(H&&H.hyscor&&H.hyscor.errorcode!==undefined){H={hyscor:[]}}if(H.hyscor.resultset&&H.hyscor.resultset.result&&H.hyscor.resultset.result.length>5){H.hyscor.resultset.result=H.hyscor.resultset.result.splice(0,5)}this.after_call(H)};var v=function(G){h.ajax({global:false,cache:true,timeout:E.settings.timeout,url:SPI.sprintf(E.settings.url,0,E.settings.gameId),type:"GET",dataType:"json",success:A,error:function(J,H,I){if(H=="timeout"){m.renderAchievements()}else{A.call(this,{hyscor:[]},"")}},after_call:G,data:{outputtype:"json",locale:SPI._settings.global.lang_id}})};var y=function(H,G){if(H&&H.hyscor&&H.hyscor.errorcode!==undefined){H={hyscor:[]}}this.after_call(H)};var n=function(G){h.ajax({global:false,cache:true,timeout:E.settings.timeout,url:SPI.sprintf(E.settings.url,SPI._settings.global.site_id,E.settings.gameId),type:"GET",dataType:"json",success:y,error:function(J,H,I){y.call(this,{hyscor:[]},"")},after_call:G,data:{outputtype:"json",username:h.profilar.forService().username,hash:h.profilar.forService().hash,locale:SPI._settings.global.lang_id}})};m.getAchievementsCountForUser=function(I,H){var G={outputtype:"json",pagesize:"1",pagenr:"1",outputtype:"json"};if(H){G.targetuser=H}else{G.username=h.profilar.forService().username;G.hash=h.profilar.forService().hash}h.ajax({global:false,cache:true,timeout:E.settings.timeout,url:SPI.sprintf(E.settings.url,SPI._settings.global.site_id,0),type:"GET",dataType:"json",success:y,error:function(L,J,K){A.call(this,{hyscor:[]},"")},after_call:I,data:G})};var x=function(G,I,N){var H=[];if(G.hyscor&&G.hyscor.resultset&&G.hyscor.resultset.result&&G.hyscor.resultset.result.length>0){H=G.hyscor.resultset.result.splice(0,5)}if(H.length>1){for(var K=H.length-2;K>=0;K--){for(var J=0;J<=K;J++){if(parseInt(H[J+1].difficulty)<parseInt(H[J].difficulty)){var L=H[J];H[J]=H[J+1];H[J+1]=L}}}}if(I!=null){if(I.hyscor&&I.hyscor.resultset&&I.hyscor.resultset.result&&I.hyscor.resultset.result.length>0){for(var K in I.hyscor.resultset.result){for(var M in H){if(H[M].tag==I.hyscor.resultset.result[K].tag){e.push(I.hyscor.resultset.result[K].tag)}}}}}N.call(this,H)};var d=function(H,I){var K=I!=undefined;var J="";var G={_0:E.langStrings.difficulty_easy,_5:E.langStrings.difficulty_medium,_10:E.langStrings.difficulty_hard};if(K){J=SPI.sprintf(E.langStrings.difficultyPoints,G["_"+H],I)}else{J=SPI.sprintf(E.langStrings.difficulty,G["_"+H])}return J};var u=function(H,G){var I=G!==undefined;var J={_0:E.langStrings.difficulty_easy,_5:E.langStrings.difficulty_medium,_10:E.langStrings.difficulty_hard};if(I){return SPI.sprintf(E.langStrings.points_with_difficulty,H,J["_"+G])}else{return SPI.sprintf(E.langStrings.points,H)}};var D=function(G){if(e.length>0){for(var H in e){if(e[H].toLowerCase()==G.toLowerCase()){return true}}}return false};m.drawAchievements=function(I){if(I.length>0){for(var H=0;H<I.length;H++){var G=h("#gameawa_"+H);G.attr("tag","tag_"+I[H].tag);G.attr("raise",I[H].raise);G.find("img.thumb").attr("src",domain_pool.getURL(SPI.sprintf(E.settings.thumb_template,I[H].awardid),"thumbnail"));G.find("span.awardname").text(I[H].title);G.find("span.awname").text(I[H].title);G.find("span.desc").text(I[H].description);G.find("span.points").text(u(I[H].raise));G.dEllipsis({overflowElement:".thmb-description",textElement:".creation-title",shortSteps:false,wrapInWidth:true});G.dTooltip({eventHandler:"a",displayDiv:"tltleft",content:".tltcontent",track:true,position:"left",x:10,y:5,drawItemCallback:"drawAchievementItem"});if(D(I[H].tag)){G.addClass("ga_active")}else{G.addClass("ga_inactive")}}}h("#tab_achievements_content").css("visibility","visible")};m.newAchievementCallback=function(H){if(C<j){C++}var G=h("ul.gameawards_awardslist li[tag=tag_"+H+"]");s("unlock_logged");SPI.gameBar.unlock("achievement",{won:C,of:j,points:G.attr("raise")});G.addClass("ga_just_won");G.addClass("ga_active").removeClass("ga_inactive");var J=E.settings.animationCycleTimes;var I=function(){if(J){--J;h(this).animate({opacity:1},500).animate({opacity:0},500,I)}else{s("normal_logged");G.removeClass("ga_just_won").addClass("ga_active").removeClass("ga_inactive")}};h("img.icon",G).animate({opacity:0},500,I)};m.notLoggedAchievementCallback=function(H){var G=h("ul.gameawards_awardslist li[tag=tag_"+H+"]");s("unlock_guest");SPI.gameBar.unlock("achievement",{won:C,of:j,points:G.attr("raise")});h("ul.gameawards_awardslist li[tag=tag_"+H+"]").addClass("ga_just_won");var J=E.settings.animationCycleTimes;var I=function(){if(J){--J;h(this).animate({opacity:1},500).animate({opacity:0},500,I)}else{s("normal_guest");h("ul.gameawards_awardslist li[tag=tag_"+H+"]").removeClass("ga_just_won")}};h("ul.gameawards_awardslist li[tag=tag_"+H+"] img.icon").animate({opacity:0},500,I)};m.UserAwardsCount=function(G){if(h.profilar.loggedIn()){m.getAchievementsCountForUser(function(H){try{tmp=H.hyscor.resultset.total||0}catch(I){tmp=0}G.call(this,tmp)},h.profilar.forService().username)}else{G.call(this,0)}};var g=function(H,G){if(H&&H.hyscor&&H.hyscor.errorcode!==undefined){H={hyscor:[]}}this.after_call(H,this.page)};var c=function(I,H){var G={};if(f==null){G={pagesize:E.settings.achievementItemsPerPage,pagenr:H,locale:SPI._settings.global.lang_id,outputtype:"json",username:h.profilar.forService().username,hash:h.profilar.forService().hash}}else{G={pagesize:E.settings.achievementItemsPerPage,pagenr:H,locale:SPI._settings.global.lang_id,outputtype:"json",targetuser:f}}h.ajax({global:false,cache:true,timeout:E.settings.timeout,url:SPI.sprintf(E.settings.url,SPI._settings.global.site_id,0),type:"GET",dataType:"json",success:g,error:function(L,J,K){g.call(this,{hyscor:[]},"")},after_call:I,data:G,page:H})};var r=function(K,P){var S=[];try{S=K.hyscor.resultset.result}catch(N){S=[]}var Q=S.concat();var P=P||1;if(Q.length==0){h("#myawards_content div.noresults").show();h("#myawards_content div.results").empty().hide();return}var R=Math.ceil(m.userAchievementsLength/E.settings.achievementItemsPerPage);h("#myawards_content div.noresults").hide();h("#myawards_content div.results").empty();h("#paging_center1>span, #paging_center2>span").empty().parent().hide();h("#myawards_content div.results").append('<ul id="aul_0"></ul>');for(var L=(P*E.settings.achievementItemsPerPage)-E.settings.achievementItemsPerPage,J=0;L<(P*E.settings.achievementItemsPerPage)&&L<m.userAchievementsLength;L++,J++){var U="ttL";if((J+1)%8==0||(J+1)%8==7){U=((J+1)%8==0)?"last_in_row ttR":"ttR"}else{U="ttL"}insertString='<li id="awid_'+L+'" class="award-thumb '+U+'"><div class="indicator"></div></li>';h("#myawards_content div.results ul").append(insertString);o(L,Q[J])}var O=J;if(O!=E.settings.achievementItemsPerPage&&O>8){var G=8-(O%8)}else{var G=0}if(G!=0){for(var I=0;I<G;I++,J++,L++){var U=((J+1)%8==0?"last_in_row":"");insertString=h(SPI.render(E.templates.myawards_li_empty,{liid:L,extraclass:U}));h("#myawards_content div.results ul").append(insertString)}}var H=SPI.paginatorString(m.userAchievementsLength,P,E.settings.achievementItemsPerPage,E.settings.maxPages,function(V){c(function(W,X){r(W,X)},V)},{next:E.langStrings.next,prev:E.langStrings.prev});h("#paging_center1>span, #paging_center2>span").empty();if(H!=""){h("#paging_center1>span").append(H).parent().show();h("#paging_center2>span").append(H.clone(true)).parent().show();var M=Math.ceil(m.userAchievementsLength/E.settings.achievementItemsPerPage);h("#pagination_pages_bottom").show().html(SPI.sprintf(SPI._langStrings.sf_global.pagination_counter,P,M))}else{h("#paging_center1>span, #paging_center2>span, #pagination_pages_bottom").hide()}h("#paging_center2 > span > span a").click(function(){var V=h("#myawards_content > h2");h.scrollTo(V);return false})};var z=function(K,M){var R=[];try{R=K.hyscor.resultset.result}catch(L){R=[]}var N=R.concat();var M=M||1;h(".myAllAwards").html(SPI.sprintf(h(".myAllAwards").html(),N.length));var O=Math.ceil(m.userAchievementsLength/E.settings.achievementItemsPerPage);h("#myawards_content div.noresults").hide();h("#myawards_content div.results").empty();var H=2;var Q=Math.ceil(E.settings.latest_limit/H);for(J=0;J<Q;J++){h("#myawards_content div.results").append('<ul id="aul_'+J+'"></ul>')}var P=0;var G="";for(var J=(M*E.settings.achievementItemsPerPage)-E.settings.achievementItemsPerPage,I=0;J<(M*E.settings.latest_limit)&&J<m.userAchievementsLength;J++,I++){if(I%H==0&&I!=0){P++}G='<li id="awid_'+J+'" class="indicator"></li>';h("#myawards_content div.results ul[id=aul_"+P+"]").append(G);o(J,N[I])}if(J<E.settings.latest_limit){emptyItem='<li id="awid_%d"><div class="thumb"><img height="38" width="38" src="'+domain_pool.getURL("/img/_/layout/ha/award_small_white.gif")+'"/></div><span class="noaward">%s</span></li>';for(J,I;J<=E.settings.latest_limit;J++,I++){if(I%H==0&&I!=0){P++}G=SPI.sprintf(emptyItem,J,E.langStrings.emptyaward);h("#myawards_content div.results ul[id=aul_"+P+"]").append(G)}}};var o=function(H,G){SPI.gameCache.getGame(G.itemid,function(I){b(I,H,G)})};var b=function(J,L,K){var H,M,G={};H=h("#myawards_content div.results li[id=awid_"+L+"]");H.removeClass("indicator");h("div.indicator",H).remove();if(J==null){return}G.thumbPath=SPI.sprintf(E.settings.thumb_template,K.awardid);G.pointsWithDifficultyString=u(K.raise);G.awardTitle=SPI.cutStringPlease(K.title,22);G.gameTitle=SPI.cutStringPlease(J.title,22);G.gameUrl=J.gamelink.slice(0,J.gamelink.length-1);G.desc=K.description;M=h(SPI.render(E.templates.myawards_li,G));H.append(M);var I=h(H).className||"ttL";if(h(H).hasClass("ttL")){h(H).dTooltip({eventHandler:"a",displayDiv:"tltleft",content:".tltcontent",track:true,position:"left",x:10,y:5,drawItemCallback:"drawAchievementItem"})}else{h(H).dTooltip({eventHandler:"a",displayDiv:"tltright",content:".tltcontent",track:true,position:"right",x:-216,y:5,drawItemCallback:"drawAchievementItem"})}h("img, a",H).attr("alt","").attr("title","");h(H).dEllipsis({overflowElement:".thmb-description",textElement:".creation-title",shortSteps:true,wrapInWidth:true})};m.renderUserAchievements=function(G){f=G||null;c(function(H){m.userAchievementsLength=0;try{m.userAchievementsLength=H.hyscor.resultset.total}catch(I){}r(H)},1)};m.renderUserAwardsBox=function(G){f=G||null;c(function(H){m.userAchievementsLength=0;try{m.userAchievementsLength=H.hyscor.resultset.total}catch(I){}z(H)},1)};var B=function(K,I,J){var G={};G.thumbPath=SPI.sprintf(E.settings.thumb_template,K.awardid);G.pointsWithDifficultyString=u(K.raise);G.awardTitle=K.title;G.gameTitle=I.title;G.gameUrl=I.gamelink.slice(0,I.gamelink.length-1);G.desc=K.description;var H=h(SPI.render(E.templates.latest_li,G));return H};var p=function(K,G){if(K&&K.hyscor&&K.hyscor.errorcode!==undefined){K={hyscor:{resultset:{result:[]}}}}if(K&&K.hyscor&&K.hyscor.resultset&&K.hyscor.resultset.result){var I=K.hyscor.resultset.result.splice(0,E.settings.latest_limit);if(I.length==0){return}if(K.hyscor.resultset.total>E.settings.latest_limit){h("#moreLinkAwards").text(SPI.sprintf(E.langStrings.see_all_x_awards,K.hyscor.resultset.total))}var J,H,L;for(J=0;J<I.length;++J){h("#"+E.settings.latest_li+J).addClass("indicator").empty().append('<div class="indicator"></div>');SPI.gameCache.getGame(I[J].itemid,function(O,N,M){return function(P){if(P){h("#"+M).removeClass("indicator").empty().append(B(O,P,N)).dEllipsis({overflowElement:".thmb-description",textElement:".creation-title",shortSteps:true,wrapInWidth:true});if(h("#"+M).hasClass("ttR")){h("#"+M).dTooltip({eventHandler:"a",displayDiv:"tltright",content:".tltcontent",track:true,position:"right",x:-216,y:5,drawItemCallback:"drawAchievementItem"})}else{h("#"+M).dTooltip({eventHandler:"a",displayDiv:"tltleft",content:".tltcontent",track:true,position:"left",x:10,y:5,drawItemCallback:"drawAchievementItem"})}}}}(I[J],J,E.settings.latest_li+J))}}};m.renderLatestsAwards=function(H){var G={pagesize:E.settings.achievementItemsPerPage,pagenr:1,locale:SPI._settings.global.lang_id,outputtype:"json"};if(H){G.targetuser=H}else{G.username=h.profilar.forService().username;G.hash=h.profilar.forService().hash}h.ajax({global:false,cache:true,timeout:E.settings.timeout,url:SPI.sprintf(E.settings.url,SPI._settings.global.site_id,0),type:"GET",dataType:"json",success:p,error:function(K,I,J){p.call(this,{hyscor:{resultset:{result:[]}}},"")},data:G})};var l=function(J,I,H){var K=J||h.profilar.forService().username;var L=(H>0)?H:0;var G={locale:SPI._settings.global.lang_id,outputtype:"json",targetuser:K,pagesize:E.settings.gamerPointsOverviewItemsPerPage,pagenr:L};h.ajax({global:false,cache:true,timeout:E.settings.timeout,url:SPI.sprintf(E.settings.url,SPI._settings.global.site_id,0),type:"GET",dataType:"json",success:g,error:function(O,M,N){g.call(this,{hyscor:[]},"")},after_call:I,page:L,data:G})};var F=function(G,I,H){h("div#gamepointbox div.results ul li[id=awid_"+I+"]").removeClass("indicator");if(G==null){return}var K="";var J={date:SPI.formatAbsDate(H.timestamp),gamename:G.url+SPI.cutStringPlease(G.title,E.settings.awardsbox_gametitle_length),gameurl:G.url.slice(0,G.url.length-1),gamedesc:SPI.escapeHTML(H.description+""),gametitle:SPI.addslashes(G.title+""),awardtitle:SPI.cutStringPlease(H.title,E.settings.awardsbox_awardtitle_length),awarddesc:H.description,points:H.raise,thumbnail:thumbPath=SPI.sprintf(E.settings.thumb_template,H.awardid),diff:d(H.difficulty)};var K=h(SPI.render(E.templates.gamepoint_li,J));h("div#gamepointbox div.results ul li[id=awid_"+I+"]").append(K)};var q=function(H,G){SPI.gameCache.getGame(G.itemid,function(I){F(I,H,G)})};return m})(jQuery);SPI.myGallery=(function(e){var v={settings:{screen_url:"/gamedata/%s.json",timeout:7000,li_id:SPI._templates.myGallery.mygallery_item_tpl,empty_li_id:SPI._templates.myGallery.mygallery_empty_item_tpl,ul_id:SPI._templates.myGallery.galleryAtGamePage,splitter:".",moreLinkItem:".moreGalleriesLink",pagesize:1,pagenr:1,disableDefaultSorting:false,gamegalleryRoute:"",type:"user",targetuser:null,sortBy:"date",order:2,noCreationsNum:2,loginbar:"#gallery_box .loginbar",title_li_id:"accordion-gallery-title",noitems_li_id:"accordion-gallery-empty",animationCycleTime:250,animationAddClass:"first-image",animationRemoveClass:"new-image",renderThumbnail:false,thumbnail:"",ratingbgimage:"/img/_/backgrounds/stars_on_blue.gif",tooltip:true,popupType:"confirm",ellipsis:true,average_rating:true,callback:null,callbackRenderGalleryPage:null,popupClassName:"",comment_max_chars:160,sortingWhenMore:null,next:"",prev:"",customTooltips:false,tooltipsCallback:function(){},scaleCallback:function(){},customRating:false,ratingCallback:function(){},overrideLiTemplate:false,renderDescription:false,description:"",fillNiceName:false,nicename:"",hideBottomWhenNoComments:true,renderBottom:true,manualSwitch:false,scrollToImage:false,paginationTargets:false,markLastRow:false,sortingPostition:false,noemptyGalleryExtraElems:false,emptyGalleryExtraElems:false,rating_url:"/rt/pb/2/add/%d/%d/10/%d",deleteImageOption:false}};var l={};SPI.getAndUpdateConfig("myGallery",v);l.init=function(C,D){if(C.ul_filled){e(C.ul_filled).hide()}if(C.ul_default){e(C.ul_default).show()}if(parseInt(C.gamatarid)>0){C.gamatarid=s(C.gamatarid)}v.settings=e.extend({},v.settings,C);v.settings.callback=D;var B=v.settings;x(function(H){if(v.settings.type=="singleitem"){if(H.gamatar&&H.gamatar.result){l.items=H.gamatar.result;l.totalItems=1}else{l.items={}}}else{if(H.gamatar&&H.gamatar.resultset&&H.gamatar.resultset.result&&H.gamatar.resultset.result.length>0){var E=null,G=null;var F=H.gamatar.resultset.result;l.totalItems=H.gamatar.resultset.total;if(F.length>0){l.mygalleryLength=F.length;l.items=F}}else{l.items={}}}if(D!=null&&typeof D=="function"){D.call(this,l.items,l.totalItems,B)}});return};var x=function(F,E){var B={};var D={};if(E){v.settings.pagenr=E}B.sortby=v.settings.sortBy;B.order=v.settings.order;B.pagenr=v.settings.pagenr;B.pagesize=v.settings.pagesize;B.outputtype="json";if(v.settings.targetuser!=null){B.username=v.settings.targetuser;D=SPI.sprintf(v.settings.mygallery_url_list_user,SPI._settings.global.site_id)}else{if(v.settings.type=="user"){var C=""+SPI.getURLparam("username");if(C!=""){B.username=C;B.targetuser=C}else{B.username=e.profilar.forService().username;B.hash=e.profilar.forService().hash}D=SPI.sprintf(v.settings.mygallery_url_list_user,SPI._settings.global.site_id)}else{if(v.settings.type=="game"){D=SPI.sprintf(v.settings.mygallery_url_list_game,SPI._settings.global.site_id,v.settings.gameid)}else{if(v.settings.type=="user_game"){B.username=e.profilar.forService().username;B.hash=e.profilar.forService().hash;D=SPI.sprintf(v.settings.mygallery_url_list_game,SPI._settings.global.site_id,v.settings.gameid)}else{if(v.settings.type=="singleitem"){D=SPI.sprintf(v.settings.mygallery_url_get,v.settings.gamatarid)}}}}}e.ajax({global:false,cache:false,timeout:v.settings.timeout,url:D,type:"GET",dataType:"json",success:q,error:function(I,G,H){if(G=="timeout"){}else{q.call(this,{gamatar:[]},"")}},after_call:F,data:B})};var q=function(C,B){if(C&&C.gamatar){if(C.gamatar&&C.gamatar.errorcode!==undefined){C={gamatar:[]}}this.after_call(C)}};var u=function(D){var C=/(<([^>]+)>)/ig;if(typeof D=="object"&&D.title&&D.title!==""){var E=e("<div />").html(D.title).text();if(E!==""){D.title=E.replace(C,"")}}if(typeof D=="object"&&D.description&&D.description!==""){var B=e("<div />").html(D.description).text();if(B!==""){D.description=B.replace(C,"")}}return D};var j=function(D,C,B){B=u(B);return e("#"+D).append(SPI.render(C,B))};var r=function(B,C){B.li_id=C;B.imgsrc=((typeof(domain_pool)!="undefined")?domain_pool.getURL(SPI.sprintf(v.settings.mygallery_url_small,B.id)):SPI.sprintf(v.settings.mygallery_url_small,B.id));B.bigimgsrc=((typeof(domain_pool)!="undefined")?domain_pool.getURL(SPI.sprintf(v.settings.mygallery_url_big,B.id)):SPI.sprintf(v.settings.mygallery_url_big,B.id));if(v.settings.average_rating){B.average_rating=Math.round(B.average_rating)}else{B.average_rating=Math.round(B.average_rating*100)/10}B.galleryGameUrl=SPI.sprintf(v.settings.mygallery_url_details,B.id);B.userGalleryGameUrl=SPI.sprintf(v.settings.mygallery_url_details_public,B.username,B.id);B.myGalleryGameUrl=SPI.sprintf(v.settings.mygallery_url_details_private,B.id);B.userUrl=SPI.sprintf(v.settings.mygallery_url_userprofile,B.username);B.dateFormatted=SPI.formatDate(B.created,SPI._langStrings.relative_date_plain,true);return B};var A=function(H,F,D){var C=F.pagesize,G=F.empty_li_id,E=F.ul_id,B;updateLiClass=false;if(typeof(D)=="undefined"){D={li_class:""};updateLiClass=true}for(B=H;B<F.pagesize;++B){if(updateLiClass){D.li_class=B%2?"even":"odd"}j(E,G,D)}};var m=function(B){B=u(B);if(!v.settings.ellipsis){return B}B.title=SPI.cutStringPlease(B.title,10);B.username=SPI.cutStringPlease(B.username,10);return B};var g=function(B){p(B)};var p=function(D,C){if(!v.settings.tooltip){return}var B=e.extend({},{eventHandler:"a",displayDiv:"dgtlt",content:".tltcontent",track:true,position:"right",x:-5,y:21,drawItemCallback:"drawProfileGalleryOverview",fixedTooltipWidth:235},C);e(D).dTooltip(B);y(D)};var y=function(B){e(B).attr("alt","").attr("title","");e("img",B).attr("alt","").attr("title","");e("a",B).attr("alt","").attr("title","")};l.renderAtGamepage=function(B,C,D){e("#"+D.ul_id).empty();for(i=0;i<B.length;i++){B[i].index=i;B[i]=r(B[i],"creationFrame_"+i);B[i]=m(B[i]);j(D.ul_id,D.li_id,B[i]);if(D.customTooltips==true){if(D.tooltipsCallback!=null&&typeof D.tooltipsCallback=="function"){D.tooltipsCallback.call(this,"creationFrame_"+i)}}if(D.scaleCallback!=null&&typeof D.scaleCallback=="function"){D.scaleCallback.call(this,"#creationFrame_"+i)}if(D.deleteImageOption){c(B[i],"#creationFrame_"+i,D)}}A(i,D);if(D.pagesize<C){e(D.moreLinkItem).show()}};var c=function(C,B,D){e(B+" > a.imageDelete").click(function(E){SPI.myGallery.remove(C.id,{title:SPI._langStrings.myGallery.removeConfirmation_title,question:SPI._langStrings.myGallery.removeConfirmation,buttonYes:SPI._langStrings.myGallery.removeConfirmation_yes,buttonNo:SPI._langStrings.myGallery.removeConfirmation_no},function(){l.init(D,l.renderAtGamepage)});return false})};l.renderAtGalleryBoxAtProfile=function(C,D,F,E){var B=e("#"+F.ul_id+" li");var E=E||false;e("#"+F.ul_id).empty();if(!C.length){if(E==false){e(F.ul_filled).hide();e(F.ul_default).show();SPI.myGallery.init({type:"game",pagesize:2,gameid:F.gameid,ul_id:"mygallery_profile_ul",li_id:"old_mygallery_item_tpl"},SPI.myGallery.renderLatestImagesFromSite);return}else{e(F.ul_filled).show();e(F.ul_default).hide()}}for(i=0;(i<C.length&&!!C.length);i++){C[i]=r(C[i],"profileGalleryBoxLi_"+i);if(typeof F.hideDelete=="undefined"){C[i].hideDelete=false}else{C[i].hideDelete=F.hideDelete}C[i]=m(C[i]);p(j(F.ul_id,F.li_id,C[i]),{drawItemCallback:"drawProfileMygallerybox",track:true});e(".creation-remove:last","#"+F.ul_id).click(function(G){var H=parseInt(e(this).parents("a.game").attr("href").replace(/[^0-9]/g,""));SPI.myGallery.remove(H,{title:SPI._langStrings.myGallery.removeConfirmation_title,question:SPI._langStrings.myGallery.removeConfirmation,buttonYes:SPI._langStrings.myGallery.removeConfirmation_yes,buttonNo:SPI._langStrings.myGallery.removeConfirmation_no},function(){e("#"+F.ul_id).empty();l.init(F,v.settings.callback)});return false})}A(i,F,{li_class:{toString:(function(I){var G=["odd","even"];var H=0;if(!I%2){H+=1;H%=2}return function(){H+=1;H%=2;return G[H]}})(i)}});e("#"+F.ul_id).append(B)};l.renderLatestImagesFromSite=function(B,C,D){e("#"+D.ul_id).empty();for(i=0;i<B.length;i++){B[i]=r(B[i],"creationFrame_"+i);B[i]=m(B[i]);B[i].li_class=((i%2)?"even":"odd");p(j(D.ul_id,D.li_id,B[i]),{drawItemCallback:"drawProfileMygallerybox",track:true})}A(i,D)};l.renderGalleryDetailUserCreations=function(B,C,D){e(D.listSelector).empty();for(i=0;i<B.length;i++){B[i]=r(B[i],"creationFrame_"+i);B[i].title;B[i].index=i;j(D.listSelector,D.li_id,B[i]);if(D.customTooltips==true){if(D.tooltipsCallback!=null&&typeof D.tooltipsCallback=="function"){D.tooltipsCallback.call(this,"creationFrame_"+i)}}}D.ul_id=D.listSelector;A(i,D);e(D.listSelector+" li").dEllipsis({overflowElement:".title",textElement:".title span",shortSteps:true,wrapInWidth:true});if(D.pagesize<C){e(D.moreLinkSelector).show()}if(!B.length){e(D.noCreationsMessageSelector).show()}};l.renderGalleryDetailUserCreationsEmpty=function(B){e(B.listSelector).empty();for(i=0;i<B.pagesize;i++){j(B.listSelector,B.empty_li_id,{})}e(B.signupMessageSelector).show()};l.renderGallery=function(B,D,E){e("#"+E.ul_id).empty();e(E.loginbar).hide();if(B.length>0){j(E.ul_id,v.templates.gallery_title,{title:SPI.sprintf(v.langStrings.acc_title,B.length)});for(C=0;C<B.length;C++){B[C]=r(B[C],"gamepanelGalleryLi_"+C);if(C==0){B[C].extraClass=E.extraClass}else{B[C].extraClass=""}j(E.ul_id,v.templates.gallery_image_li,l.items[C]);if(E.scaleCallback!=null&&typeof E.scaleCallback=="function"){E.scaleCallback.call(this,"#gamepanelGalleryLi_"+C)}}A(C,E)}else{e("#"+E.ul_id).append(SPI.render(v.templates.gallery_noitems,{}));var C=0;for(;C<v.settings.noCreationsNum;C++){e("#"+E.ul_id).append(SPI.render(v.templates.gallery_empty_image_li,{}))}}if(E.isTweens){e("#"+E.ul_id).after(SPI.render(v.templates.gallery_logged_in_links,{}));spiApplyTooltip(e("#"+E.ul_id+" a.tooltipd"))}if(E.customTooltips==true){if(E.tooltipsCallback!=null&&typeof E.tooltipsCallback=="function"){E.tooltipsCallback.call()}}};l.renderGalleryNotLogged=function(D){e("#"+D.ul_id).empty();if(!D.isTweens){var B=e(SPI.render(v.templates.login_trigger,{above_text:v.langStrings.not_logged_info}))}else{var C=e("div#gallery_box div.loginbar");C.empty();var B=e(SPI.render(v.templates.login_trigger,{did:"ha_award_normal_guest1"}));e("a.login",B).hover(function(){e(this).next().addClass("hover")},function(){e(this).next().removeClass("hover")});C.append(B);e(".accordionLogin",C).append(SPI.sprintf(v.langStrings.not_logged_in_info,"#"));e(".accordionLogin a",C).click(function(){loginboxraise();return false})}e("a.login",B).hover(function(){e(this).next().addClass("hover")},function(){e(this).next().removeClass("hover")});e(v.settings.loginbar).append(B).show();e("#"+D.ul_id).append(SPI.render(v.templates.gallery_noitems,{}));e("#"+D.ul_id).append(SPI.render(v.templates.gallery_empty_image_li,{}));e("#"+D.ul_id).append(SPI.render(v.templates.gallery_empty_image_li,{}));if(D.isTweens){e("#"+D.ul_id).after(SPI.render(v.templates.gallery_not_logged_in_links,{}))}};l.newImageCallback=function(C,B){v.settings.type="singleitem";v.settings.gamatarid=C;x(function(H){if(H.gamatar&&H.gamatar.result){var G=H.gamatar.result;G=r(G,"gamepanelGalleryLi_"+C);G.extraClass=B.extraClass;var E=e("#"+B.ul_id+" li:last").attr("id");var D=e("#"+B.ul_id+" li").length;if(D!=3){e("#"+B.ul_id+" li:last").remove()}var F=e("#"+B.ul_id+" li:first").next();e(F).removeClass(B.classToRemove);e("#"+B.ul_id+" li:first").before(SPI.render(v.templates.gallery_title,{title:v.langStrings.acc_new_creation})).remove();e("#"+B.ul_id+" li:first").after(SPI.render(v.templates.gallery_new_image_li,G));if(B.customTooltips==true){if(B.tooltipsCallback!=null&&typeof B.tooltipsCallback=="function"){B.tooltipsCallback.call()}}l.scaleImages("li#gamepanelGalleryLi_"+C+" .creation-thumb .image-holder img",".creation-thumb .image-holder","fill");if(B.isTweens){spiApplyTooltip(e("#gamepanelGalleryLi_"+C+" a.tooltipd"))}e("#gamepanelGalleryLi_"+C).animate({opacity:0.5},v.settings.animationCycleTime).animate({opacity:1},v.settings.animationCycleTime).animate({opacity:0.5},v.settings.animationCycleTime).animate({opacity:1},v.settings.animationCycleTime).animate({opacity:0.5},v.settings.animationCycleTime).animate({opacity:1},v.settings.animationCycleTime).animate({opacity:0.5},v.settings.animationCycleTime).animate({opacity:1},v.settings.animationCycleTime).animate({opacity:0},v.settings.animationCycleTime,function(){e(this).removeClass(v.settings.animationRemoveClass).addClass(v.settings.animationAddClass)}).animate({opacity:1},v.settings.animationCycleTime)}})};l.notLoggedNewImageCallback=function(B,C){};l.renderGalleryDetail=function(D,C,F){if(!D.itemid){window.location.href="/"}D=r(D,"gdMainImage");D=u(D);e(F.mainbox+" "+F.title).text(D.title);if(F.isTweens){e(F.mainbox+" "+F.topcontent).empty().append(SPI.render(v.templates.gallerydetail_top_content,D))}else{e.profilar.loadExternalPrefs([""+D.username],function(H){if(H.length){if(typeof H[0].avatar!="undefined"){D.userAvatarUrl=SPI.sprintf(SPI._settings.avatars.small_avatar,H[0].avatar)}else{D.userAvatarUrl=false}var I=e(F.mainbox+" "+F.topcontent);I.empty().append(SPI.render(v.templates.gallerydetail_top_content,D));SPI.friends.addAvatarTooltip(I,".avatar",H[0].avatar,D.username);if(e.profilar.forService().username==D.username){var G=true}else{var G=false}}if(!F.customRating){e(F.dynamicRating).nratingStars({siteId:SPI._settings.global.site_id,gameId:D.id,bgimage:((typeof(domain_pool)!="undefined")?domain_pool.getURL("/img/_/backgrounds/stars_on_blue.gif"):"/img/_/backgrounds/stars_on_blue.gif"),rating:D.average_rating,width:71,height:14,stepX:14,stepY:14,itemType:10,labels:false,rtl:false,username:e.profilar.forService().username,hash:e.profilar.forService().hash,readOnly:G,ratorType:2,langstrings:{star:[v.langStrings.star_one,v.langStrings.star_two,v.langStrings.star_three,v.langStrings.star_four,v.langStrings.star_five],cookies_disabled_message:"You can't rate this game because your cookies are disabled."}})}else{if(F.ratingCallback!=null&&typeof F.ratingCallback=="function"){F.ratingCallback.call(this,D,G)}}},["avatar"])}e(F.mainbox+" "+F.imagecontent).empty().append(SPI.render(v.templates.gallerydetail_image_content,D));e(F.mainbox+" "+F.bottomcontent).empty().append(SPI.render(v.templates.gallerydetail_bottom_content,D));SPI.gameCache.getGame(D.itemid,function(I){if(I==null||(I&&I.title=="")){var J="Game doesnt exists";e(F.gameurl).text(J);e(F.breadcrumb).html(SPI.sprintf(e(F.breadcrumb).html(),J));e(F.gameurl+", "+F.backurl).removeAttr("href");e(".fill-gametitle").each(function(){e(this).html(SPI.sprintf(e(this).html(),J))})}else{e(F.gameurl).html(I.title);if(F.isTweens){var G={title:D.title,gamename:I.nice_name};e(F.maincontent+" "+F.breadcrumb).next().remove();e(F.maincontent+" "+F.breadcrumb).next().remove();e(F.maincontent+" "+F.breadcrumb).remove();e(F.maincontent+" "+F.useralertpromo).before(SPI.render(v.templates.gallerydetails_breadcrump_tpl,G));e(F.breadcrumb).html(SPI.sprintf(e(F.breadcrumb).html(),I.nice_name))}else{e(F.breadcrumb).html(SPI.sprintf(e(F.breadcrumb).html(),I.title))}var H=e(F.backurl).attr("href");e(F.gameurl+", "+F.backurl).each(function(){e(this).attr("href",SPI.sprintf(e(this).attr("href"),I.nice_name))});if(F.renderThumbnail){e(F.thumbnail).each(function(){e(this).attr("src",I.thumbnail)})}if(F.renderDescription){e(F.description).each(function(){e(this).text(I.game_description)})}if(F.customTooltips==true){if(F.tooltipsCallback!=null&&typeof F.tooltipsCallback=="function"){F.tooltipsCallback.call()}}if(F.isTweens){e(F.backurl).attr("href",SPI.sprintf(H,I.nice_name))}e(".fill-gametitle").each(function(){e(this).html(SPI.sprintf(e(this).html(),I.title))});if(typeof SPI.customPageTitle=="function"){SPI.customPageTitle({type:"gamealbum_details",vars:{username:""+D.username,gametitle:""+I.title}})}}if(e.profilar.forService().username==D.username){e(F.reportButton).hide()}else{e(F.reportButton).live("click",function(){l.reportPicture(F.reportButton,D.id,D.username)})}});e(F.arrowleft).hide();e(F.arrowright).hide();e(F.mainPicture).mousemove(function(){e(F.arrowleft).show();e(F.arrowright).show()});e(F.mainPicture).hover(function(){e(F.arrowleft).show();e(F.arrowright).show()},function(){e(F.arrowleft).hide();e(F.arrowright).hide()});var E=e(document);e(F.arrowleft).unbind("click").bind("click",function(){l.navigate("left",D,F)});e(F.arrowright).unbind("click").bind("click",function(){l.navigate("right",D,F)});E.unbind("keypress").bind("keypress",function(G){if(e(G.target).attr("name")!=""){if(G.keyCode=="37"){l.navigate("left",D,F);E.unbind("keypress")}else{if(G.keyCode=="39"){l.navigate("right",D,F);E.unbind("keypress")}}}});if(!SPI._settings.global.comments_enabled){e(F.commentsButton).hide()}if(F.isTweens){if((!e.profilar.loggedIn()||(e.profilar.forService().username==D.username))){var B=true}else{var B=false}e(F.dynamicRating).nratingStars({siteId:SPI._settings.global.site_id,gameId:D.id,bgimage:((typeof(domain_pool)!="undefined")?domain_pool.getURL("/img/_/backgrounds/stars.gif"):"/img/_/backgrounds/stars.gif"),rating:D.average_rating,width:71,height:14,stepX:14,stepY:14,itemType:10,labels:false,rtl:false,username:e.profilar.forService().username,hash:e.profilar.forService().hash,readOnly:B,ratorType:2,langstrings:{star:[v.langStrings.star_one,v.langStrings.star_two,v.langStrings.star_three,v.langStrings.star_four,v.langStrings.star_five],cookies_disabled_message:"You can't rate this game because your cookies are disabled."}})}if(F.hideBottomWhenNoComments){if((!SPI._settings.global.comments_enabled)&&(e.profilar.forService().username==D.username)){e(F.mainbox+" "+F.bottomcontent).hide()}}};l.checkSafety=function(C){if(!C.itemid){window.location.href="/";return}if(SPI.getURLparam("username")==""){if(e.profilar.forService().username!=""&&e.profilar.forService().username!=C.username){if(v.settings.mygallery_redirect2usercreation&&v.settings.mygallery_redirect2usercreation===true){var B=SPI.sprintf(v.settings.mygallery_url_details_public,C.username,C.id);window.location.href=""+B;return}window.location.href="/";return}}else{if(SPI.getURLparam("username")!=C.username){window.location.href="/";return}}};l.renderUserGalleryDetail=function(D,C,E){l.checkSafety(D);D=r(D,"gdMainImage");e(E.mainbox+" "+E.title).text(D.title);e(E.mainbox+" "+E.topcontent).empty().append(SPI.render(v.templates.gallerydetail_top_content_noavatar,D));if(!e.profilar.loggedIn()||(SPI.getURLparam("username")!=D.username)||(D.username==e.profilar.forService().username)){var B=true}else{var B=false}e(E.mainbox+" "+E.imagecontent).empty().append(SPI.render(v.templates.gallerydetail_image_content,D));if(SPI.getURLparam("username")!=D.username){e(E.mainbox+" "+E.bottomcontent).empty().append(SPI.render(v.templates.gallerydetail_bottom_content_myprofile,D));e(E.backurl).attr("href",SPI._settings.myGallery.mygallery_url_mygallery);e("#deleteHref").unbind("click").click(function(){SPI.myGallery.remove(D.id,{title:SPI._langStrings.myGallery.removeConfirmation_title,question:SPI._langStrings.myGallery.removeConfirmation,buttonYes:SPI._langStrings.myGallery.removeConfirmation_yes,buttonNo:SPI._langStrings.myGallery.removeConfirmation_no},function(){window.location.href=SPI._settings.myGallery.mygallery_url_mygallery});return false})}else{e(E.mainbox+" "+E.bottomcontent).empty().append(SPI.render(v.templates.gallerydetail_bottom_content_userprofile,D));e(E.backurl).attr("href",SPI.sprintf(SPI._settings.myGallery.mygallery_url_galleryofuser,D.username))}e(E.arrowleft).hide();e(E.arrowright).hide();e(E.mainPicture).hover(function(){e(E.arrowleft).show();e(E.arrowright).show()},function(){e(E.arrowleft).hide();e(E.arrowright).hide()});e(E.breadcrumb).html(SPI.sprintf(e(E.breadcrumb).html(),D.username));SPI.gameCache.getGame(D.itemid,function(H){if(H.title==""){e(E.gameurl).parent().hide()}else{if(E.fillNiceName){e(E.nicename).each(function(){e(this).attr("href",SPI.sprintf(e(this).attr("href"),H.nice_name))})}e(E.gameurl).text(H.title);e(E.gameurl).each(function(){e(this).attr("href",SPI.sprintf(e(this).attr("href"),H.nice_name))});if(E.renderThumbnail){e(E.thumbnail).each(function(){e(this).attr("src",H.thumbnail)})}if(E.renderDescription){e(E.description).each(function(){e(this).text(H.game_description)})}if(E.customTooltips==true){if(E.tooltipsCallback!=null&&typeof E.tooltipsCallback=="function"){E.tooltipsCallback.call()}}var G=f(H);if(G){e(E.gameurl).attr("onclick",G)}}if(typeof SPI.customPageTitle=="function"){var F=SPI.getURLparam("username"),I="useralbum_details";if(F==""){F=e.profilar.forService().username;I="myalbum_details"}if(F!=""){SPI.customPageTitle({type:I,vars:{gametitle:H.title||"",username:""+F}})}}});e(E.arrowleft).unbind("click").click(function(){l.navigate("left",D,E);e(document).unbind("keypress")});e(E.arrowright).unbind("click").click(function(){l.navigate("right",D,E);e(document).unbind("keypress")});e(document).bind("keypress",function(F){if(e(F.target).attr("name")!=""){if(F.keyCode=="37"){l.navigate("left",D,E);e(document).unbind("keypress")}else{if(F.keyCode=="39"){l.navigate("right",D,E);e(document).unbind("keypress")}}}});if(!SPI._settings.global.comments_enabled){e(E.commentsButton).hide()}if(e.profilar.forService().username==D.username){e(E.reportButton).hide()}else{e(E.reportButton).click(function(){l.reportPicture(E.reportButton,D.id,D.username)})}if(!E.customRating){e(E.dynamicRating).nratingStars({siteId:SPI._settings.global.site_id,gameId:D.id,bgimage:v.settings.ratingbgimage,rating:D.average_rating,width:71,height:14,stepX:14,stepY:14,itemType:10,labels:false,rtl:false,username:e.profilar.forService().username,hash:e.profilar.forService().hash,readOnly:B,ratorType:2,langstrings:{star:[v.langStrings.star_one,v.langStrings.star_two,v.langStrings.star_three,v.langStrings.star_four,v.langStrings.star_five],cookies_disabled_message:"You can't rate this game because your cookies are disabled."}})}else{if(E.ratingCallback!=null&&typeof E.ratingCallback=="function"){E.ratingCallback.call(this,D,B)}}};l.navigate=function(C,B,D){v.settings.type=D.detailstype;v.settings.gameid=B.itemid;v.settings.pagesize=1000;if(l.cachedItems){z(l.cachedItems,C,B,D)}else{x(function(E){z(E,C,B,D)})}};var s=function(E){var B=window.top.location.href;var C=new RegExp(/#i(\d+)/i);var D=B.match(C);if(D!=null&&D.length>0){galleryTick=D[0];actualId=D[1];if(actualId!=E){return actualId}}return E};var d=function(G){var C=window.top.location.href;var D=new RegExp(/#i(\d+)/i);var B=G;var F="";var E=C.match(D);if(E!=null&&E.length>0){F=E[0];B=E[1];if(F!=""){C=C.replace(D,"");C+="#i"+G;window.top.location.href=C}}else{C+="#i"+G;window.top.location.href=C}};var z=function(E,F,B,C){if(E.gamatar&&E.gamatar.resultset&&E.gamatar.resultset.result&&E.gamatar.resultset.result.length>0){var H=null,I=null;var D=E.gamatar.resultset.result}else{var D=E}l.cachedItems=D;var J=false;for(i=0;i<D.length;i++){if(D[i].id==B.id){if(F=="left"&&i!=0){J=true;var G=D[i-1].id}else{if(F=="right"&&i!=(e(D).length-1)){J=true;var G=D[i+1].id}}if(i==0&&F=="left"){var G=D[e(D).length-1].id;J=true}else{if(i==(e(D).length-1)&&F=="right"){var G=D[0].id;J=true}}l.switchGalleryDetailImage(G,C);break}}if(!J){e(C.arrowleft).hide();e(C.arrowright).hide();e(C.mainPicture).unbind("hover")}};l.switchGalleryDetailImage=function(D,C){if(C.manualSwitch){var B=window.location.href;B=B.replace(/(.*?[,\/])([0-9]+)((\.html(#image)?))$/,"$1"+D+"$3");if(C.scrollToImage&&B.indexOf("#image")==-1){B+="#image"}window.location.href=B}else{d(D);v.settings=C;v.settings.gamatarid=D;v.settings.type="singleitem";x(function(F){if(F.gamatar&&F.gamatar.result){var E=F.gamatar.result}else{var E={}}if(C.detailstype=="game"){l.renderGalleryDetail(E,1,C)}else{l.renderUserGalleryDetail(E,1,C)}e(".wall_nomessages").prev().remove();e(".wall_nomessages").next().remove();e(".wall_nomessages").remove();e("#gameCommentsWrapper .boxheader #commentsCounter").remove();var G=e("#gameCommentsWrapper .boxheader");G.html(G.html().replace("()",""));SPI.comments.init({settings:{clearCommentCache:true,initializeRte:false,image_id:E.id,max_chars:v.settings.comment_max_chars}})})}};l.reportPicture=function(B,D,C){e(B).data("ugc",D).data("username",C);SPI.report.reportUGC(B);return false};l.remove=function(E,B,D){if(SPI._templates.popup.confirm_delete===undefined||typeof SPI.popup!=="object"){var C=confirm(""+B.question);if(C){n(E,D)}return false}else{SPI.popup.show(SPI.render(SPI._templates.popup.confirm_delete,{question:B.question}),{_ok:function(){n(E,D)},_cancel:function(){}},{type:v.settings.popupType,title:B.title,titleIcon:"",close:false,blueButtonText:B.buttonYes,bottomLinkText:B.buttonNo,className:v.settings.popupClassName})}return false};var n=function(C,B){e.ajax({global:false,cache:false,beforeSend:function(){},timeout:v.settings.timeout,url:SPI.sprintf(v.settings.mygallery_url_delete,C),type:"POST",dataType:"json",success:B,error:function(F,D,E){alert("Error while deleting image")},data:{username:e.profilar.forService().username,hash:e.profilar.forService().hash,outputtype:"json"}})};l.renderGalleryPage=function(J,U,R){var I=e(""+R.target),F=null,C=null,E="",H="creationFrame_",O="",D=null,P={},L="",S=[],G=R.pagesize;e(".anchor").removeClass("active");if(I.length>0){I.show();if(J.length>0){e(".noresults",I).hide();e(".results",I).empty().show();if(e(".results ul",I).length==0){e(".results",I).append('<ul class="thumbnail-list"></ul>')}e(".results ul",I).empty();if(R.paginationTargets){e(R.paginationTargets).empty()}if(R.columns&&J.length<R.pagesize){G=J.length+(R.columns-(J.length%R.columns))}if((G>J.length)&&(G>R.columns)){G=J.length}for(var N=0;N<G;N++){L="";if(R.columns){if((N+1)%R.columns==0){L="last-in-row"}}E=e(SPI.render(v.templates.profile_results_empty_item,{extraClass:L})).attr("id",H+""+N);e(".results ul",I).append(E)}if(R.markLastRow){var B=e(".results ul li",I);var K=B.length%R.columns;if(K==0){K=R.columns}for(var Q=B.length-1;Q>B.length-K-1;Q--){e(B[Q]).addClass("last-row")}}for(var N in J){J[N]=u(J[N]);E=e(SPI.render(v.templates.profile_results_loading_item,[]));e(".results li#"+H+""+N,I).empty().append(E);J[N]=r(J[N],H+""+N);S.push(J[N])}if(S.length>0){for(var M in S){o(H+""+M,S[M],I,R)}}if(U>R.pagesize&&R.pagination&&e.inArray(R.pagination,["top","bottom","both"])>=0){D=SPI.paginatorString(U,R.pagenr,R.pagesize,4,function(V){if(R.disableDefaultSorting&&R.disableDefaultSorting===true){window.top.location.href=SPI.sprintf(R.gamegalleryRoute,V)}else{x(function(Z){if(Z.gamatar&&Z.gamatar.resultset&&Z.gamatar.resultset.result&&Z.gamatar.resultset.result.length>0){var W=null,Y=null;var X=Z.gamatar.resultset.result;l.totalItems=Z.gamatar.resultset.total;if(X.length>0){l.mygalleryLength=X.length;l.items=X}}else{l.items={}}l.renderGalleryPage(l.items,l.totalItems,R);var aa=v.settings.callbackRenderGalleryPage;if(aa!=null&&typeof aa=="function"){aa.apply(this)}},V)}},{next:R.next,prev:R.prev,separator:v.langStrings.separator},undefined,SPI._templates.pagination);P={from:((R.pagenr-1)*R.pagesize)+1,to:((R.pagenr)*R.pagesize)>U?U:R.pagenr*R.pagesize,total:U,pagesize:R.pagesize};F=e(SPI.render(SPI._templates.myGallery.profile_results_paging_tpl,P));if(!R.paginationTargets){e(".paging-numbers",F).append(D);if(R.pagination=="top"||R.pagination=="both"){e(".results",I).prepend(F.clone(true).addClass("pages-top"))}if(R.pagination=="bottom"||R.pagination=="both"){e(".results",I).append(F.clone(true).addClass("pages-bottom"))}}else{e(R.paginationTargets).each(function(V,W){e(W).append(F.clone(true));e(".paging-numbers",W).append(D.clone(true))})}}if(e.inArray(R.sorting,["top","bottom","both"])>=0){if(R.disableDefaultSorting&&R.disableDefaultSorting===true){C=e(SPI.render(SPI.sprintf(SPI._templates.myGallery.profile_results_sorting_nojs_tpl,SPI.sprintf(R.gamegalleryRouteSortType,"1"),SPI.sprintf(R.gamegalleryRouteSortType,"2")),[]))}else{C=e(SPI.render(v.templates.profile_results_sorting,[]));e("a",C).not(".active").click(function(){v.settings.sortBy=e(this).attr("sortby");v.settings.order=2;x(function(Y){if(Y.gamatar&&Y.gamatar.resultset&&Y.gamatar.resultset.result&&Y.gamatar.resultset.result.length>0){var V=null,X=null;var W=Y.gamatar.resultset.result;l.totalItems=Y.gamatar.resultset.total;if(W.length>0){l.mygalleryLength=W.length;l.items=W}}else{l.items={}}l.renderGalleryPage(l.items,l.totalItems,R);var Z=v.settings.callbackRenderGalleryPage;if(Z!=null&&typeof Z=="function"){Z.apply(this)}},1);return false});e("a",C).removeClass("active");e("a[sortby="+v.settings.sortBy+"]",C).addClass("active").parent().addClass("active")}if(R.sortingPostition!=undefined&&R.sortingPostition!=""){e(R.sortingPostition).html(C.clone(true))}else{if(R.sorting=="top"||R.sorting=="both"){e(".results",I).prepend(C.clone(true).addClass("sorting-top"));if(R.sortingExtras!==false){e(".results ul",I).before('<div class="solid-line">&nbsp;</div>')}}if(R.sorting=="bottom"||R.sorting=="both"){e(".results",I).append(C.clone(true).addClass("sorting-bottom"));if(R.sortingExtras!==false){e(".results ul",I).after('<div class="solid-line">&nbsp;</div>')}}}}}else{e(".results",I).empty().hide();e(".noresults",I).show();e(".hasresults",I).hide()}}};l.renderAtProfile=function(J,W,U){var I=e(""+U.target),F=null,C=null,E="",H="creationFrame_",P="",D=null,Q={},L="",V=[],G=U.pagesize;if(I.length>0){I.show();if(J.length>0){e(".noresults",I).hide();e(".results",I).empty().show();e(".hasresults",I).show();if(U.emptyGalleryExtraElems){e(U.emptyGalleryExtraElems).hide()}if(U.noemptyGalleryExtraElems){e(U.noemptyGalleryExtraElems).show()}if(e(".results ul",I).length==0){e(".results",I).append('<ul id="latestCreations" class="thumbnail-list"></ul>')}e(".results ul",I).empty();if(U.columns&&J.length<U.pagesize){G=J.length+(U.columns-(J.length%U.columns))}if(U.paginationTargets){e(U.paginationTargets).empty()}if(J.length%U.columns==0&&J.length<U.pagesize){G=J.length}if((G>J.length)&&(G>U.columns)){G=J.length}for(var O=0;O<G;O++){L="";if(U.columns){if((O+1)%U.columns==0){L="last-in-row"}}E=e(SPI.render(v.templates.profile_results_empty_item,{extraClass:L})).attr("id",H+""+O);e(".results ul",I).append(E)}if(U.markLastRow){var B=e(".results ul li",I);var K=B.length%U.columns;if(K==0){K=U.columns}for(var S=B.length-1;S>B.length-K-1;S--){e(B[S]).addClass("last-row")}}for(var O in J){E=e(SPI.render(v.templates.profile_results_loading_item,[]));e(".results li#"+H+""+O,I).empty().append(E);J[O]=r(J[O],H+""+O);J[O]=u(J[O]);if(typeof U.hideDelete=="undefined"){J[O].hideDelete=false}else{J[O].hideDelete=U.hideDelete}V.push(J[O])}if(V.length>0){for(var M in V){o(H+""+M,V[M],I,U)}}if(W>U.pagesize&&U.pagination&&e.inArray(U.pagination,["top","bottom","both"])>=0){D=SPI.paginatorString(W,U.pagenr,U.pagesize,4,function(X){x(function(ab){if(ab.gamatar&&ab.gamatar.resultset&&ab.gamatar.resultset.result&&ab.gamatar.resultset.result.length>0){var Y=null,aa=null;var Z=ab.gamatar.resultset.result;l.totalItems=ab.gamatar.resultset.total;if(Z.length>0){l.mygalleryLength=Z.length;l.items=Z}}else{l.items={}}l.renderAtProfile(l.items,l.totalItems,U)},X)},{next:U.next,prev:U.prev,separator:v.langStrings.separator},undefined,SPI._templates.pagination);Q={from:((U.pagenr-1)*U.pagesize)+1,to:((U.pagenr)*U.pagesize)>W?W:U.pagenr*U.pagesize,pagesize:U.pagesize,total:W};F=e(SPI.render(SPI._templates.myGallery.profile_results_paging_tpl,Q));if(!U.paginationTargets){e(".paging-numbers",F).append(D);if(U.pagination=="top"||U.pagination=="both"){e(".results",I).prepend(F.clone(true).addClass("pages-top"))}if(U.pagination=="bottom"||U.pagination=="both"){e(".results",I).append(F.clone(true).addClass("pages-bottom"))}}else{e(U.paginationTargets).each(function(X,Y){e(Y).append(F.clone(true));e(".paging-numbers",Y).append(D.clone(true))})}}if(e.inArray(U.sorting,["top","bottom","both"])>=0&&(!v.settings.sortingWhenMore||(v.settings.sortingWhenMore&&W>=v.settings.sortingWhenMore))){C=e(SPI.render(v.templates.profile_results_sorting,[]));e("a",C).not(".active").click(function(){v.settings.sortBy=e(this).attr("sortby");v.settings.order=2;x(function(aa){if(aa.gamatar&&aa.gamatar.resultset&&aa.gamatar.resultset.result&&aa.gamatar.resultset.result.length>0){var X=null,Z=null;var Y=aa.gamatar.resultset.result;l.totalItems=aa.gamatar.resultset.total;if(Y.length>0){l.mygalleryLength=Y.length;l.items=Y}}else{l.items={}}l.renderAtProfile(l.items,l.totalItems,U)},1);return false});e("a",C).removeClass("active");e("a[sortby="+v.settings.sortBy+"]",C).addClass("active");if(U.sortingPostition!=undefined&&U.sortingPostition!=""){e(U.sortingPostition).html(C.clone(true))}else{if(U.sorting=="top"||U.sorting=="both"){e(".results",I).prepend(C.clone(true).addClass("sorting-top"));if(U.sortingExtras!==false){e(".results ul",I).before('<div class="solid-line">&nbsp;</div>')}}if(U.sorting=="bottom"||U.sorting=="both"){e(".results",I).append(C.clone(true).addClass("sorting-bottom"));if(U.sortingExtras!==false){e(".results ul",I).after('<div class="solid-line">&nbsp;</div>')}}}}}else{e(".results",I).empty().hide();e(".noresults",I).show();e(".hasresults",I).hide();if(U.emptyGalleryExtraElems){e(U.emptyGalleryExtraElems).show()}if(U.noemptyGalleryExtraElems){e(U.noemptyGalleryExtraElems).hide()}}if(typeof SPI.customPageTitle=="function"){var R=SPI.getURLparam("username"),N="useralbum";if(R==""){R=e.profilar.forService().username;N="myalbum"}if(R!=""){SPI.customPageTitle({type:N,vars:{username:R}})}}}};var b=function(B,H,F,D,I){if(B==null){return}var G=F;G.gamelink=B.gamelink;G.gametitle=B.title;var E=v.templates.profile_results_item;if(I.overrideLiTemplate){E=I.li_id}var C=e(SPI.render(E,G)).data("id",G.id);if(e.browser.msie&&parseInt(e.browser.version)==6){e("a",C).hover(function(){e(".creation-remove",this).show()},function(){e(".creation-remove",this).hide()})}e(".creation-remove",C).click(function(J){SPI.myGallery.remove(F.id,{title:SPI._langStrings.myGallery.removeConfirmation_title,question:SPI._langStrings.myGallery.removeConfirmation,buttonYes:SPI._langStrings.myGallery.removeConfirmation_yes,buttonNo:SPI._langStrings.myGallery.removeConfirmation_no},function(){var K=e(".image-filled",".results ul").length;if(K==1&&I.pagenr>1){I.pagenr--}l.init(I,l.renderAtProfile)});return false});e(".results li#"+H,D).empty().append(C);l.scaleImages(".results li#"+H+" .creation-thumb div img",".creation-thumb div","fill");e(".results li#"+H,D).dEllipsis({overflowElement:".dell-overflow",textElement:"span.dell",shortSteps:true,wrapInWidth:true});if(I.scaleCallback!=null&&typeof I.scaleCallback=="function"){I.scaleCallback.call(this,".results li#"+H)}if(!I.customTooltips){g(e(".results li#"+H,D))}if(I.customTooltips==true){if(I.tooltipsCallback!=null&&typeof I.tooltipsCallback=="function"){I.tooltipsCallback.call(this,H)}}};var o=function(E,D,C,F,B){SPI.gameCache.getGame(D.itemid,function(G){b(G,E,D,C,F);var H=v.settings.callback_load_game;if(H!=null&&typeof H=="function"){H.apply(this,new Array(E))}})};l.getCountForUser=function(C,B){data_param={pagesize:1,pagenr:1,outputtype:"json"};if(typeof(C)=="undefined"){data_param.username=e.profilar.forService().username;data_param.hash=e.profilar.forService().hash}else{if(e.profilar.forService().username!=C&&e.profilar.forService().username!=""){data_param.username=e.profilar.forService().username;data_param.targetuser=C}else{data_param.username=C}}url_param=SPI.sprintf(SPI._settings.myGallery.mygallery_url_list_user,SPI._settings.global.site_id);e.ajax({global:false,cache:true,timeout:7000,url:url_param,type:"GET",dataType:"json",data:data_param,success:B,error:function(F,D,E){B.call(this,{gamatar:[]},"")},after_call:B})};l.scaleImages=function(D,B,G){e(D).addClass("notScaled");if(h(D,B,G)){var C=500;var E="scaling timer";var F=20;e(document).everyTime(C,E,function(){if(!h(D,B,G)){e(document).stopTime(E)}},F)}};var h=function(C,B,E){e(C+".notScaled").cjObjectScaler({destObj:e(C).parent(B),method:E});var D=0;e(C+".notScaled").each(function(){++D;if(e(this).attr("height")!=undefined){--D;e(this).removeClass("notScaled")}});return D>0};var f=function(B){if(B.gamelink){onclick=B.gamelink.match('onclick="(.*?)"');if(onclick){return onclick[1]}}return null};l.renderGamesAlbum=function(B,C,D){if(typeof(B[0])!="undefined"){e("img","#gid_"+D.gameid).attr("src",SPI.sprintf(v.settings.mygallery_url_small,B[0].id))}else{e("#gid_"+D.gameid).addClass("empty-album")}};l.renderMyGalleryAtGamePage=function(B,C,D){if(l.items.length!==undefined){l.savedImages=l.items.length}SPI.gameBar.initData("image",{count:l.savedImages});if(!B.length){return}e("#"+D.ul_id).empty();for(i=0;i<B.length;i++){B[i].index=i;B[i]=r(B[i],"creationFrame_"+i);B[i]=m(B[i]);j(D.ul_id,D.li_id,B[i]);if(D.customTooltips==true){if(D.tooltipsCallback!=null&&typeof D.tooltipsCallback=="function"){D.tooltipsCallback.call(this,"creationFrame_"+i)}}}e("#"+D.ul_id).show();A(i,D);if(D.pagesize<C){e(D.moreLinkItem).show();e(D.moreLinkItem).attr("style",null)}};l.gamebarNewImageCallback=function(){++l.savedImages;SPI.gameBar.unlock("image",{count:l.savedImages})};l.gamebarNewImageCallbackNotLogged=function(){++l.savedImages;SPI.gameBar.unlock("image",{count:l.savedImages})};l.setDefaultRating=function(B){if(B&&B.gamatarid&&B.is_enabled&&B.initial_rating&&(+B.is_enabled)==1&&(+B.initial_rating)>=0){var C=(+B.gamatarid);if(C==0){return}e.ajax({url:SPI.sprintf(v.settings.rating_url,+SPI._settings.global.channel_id,+SPI._settings.global.site_id,C),global:false,type:"post",dataType:"json",success:function(){},error:function(){},timeout:3000,data:{username:e.profilar.forService().username,hash:e.profilar.forService().hash,rating:(+B.initial_rating)}})}};return l})(jQuery);SPI.customPageTitle=function(d,h){if(typeof d==="undefined"){return}var b={settings:{}},g="",c=""+SPI._settings.global.domainname,j="",f="",l="";SPI.getAndUpdateConfig("customPageTitle",b);if(d.type&&b.settings[d.type]&&b.settings[d.type]!=""){g=""+b.settings[d.type];if(d.vars){if(d.vars){for(var e in d.vars){l=new RegExp("<"+e+">","gi");g=g.replace(l,d.vars[e])}}}c=c.charAt(0).toUpperCase()+c.substr(1);l=new RegExp("<sitename>","gi");g=g.replace(l,c);if(g!=""){document.title=g}}if(typeof h=="function"){h.call(this,d,g)}};function SWFtoJS(b){this.m_oCallFuntions=new Object();this.m_bDebug=false;if(b!=null){SWFtoJS.instance().parse(b)}}SWFtoJS.m_oSWFtoJS=null;SWFtoJS.instance=function(b){if(SWFtoJS.m_oSWFtoJS==null){SWFtoJS.m_oSWFtoJS=new SWFtoJS();if(b){SWFtoJS.m_oSWFtoJS.m_bDebug=true}}return SWFtoJS.m_oSWFtoJS};SWFtoJS.prototype.addCallFunction=function(b,c){if(typeof c=="function"){this.m_oCallFuntions[b]=c}};SWFtoJS.prototype.parse=function(c){try{if(c.call){switch(c.call){case"MULTI":for(i=0;i<p_oData.calls.length;i++){SWFtoJS(c.calls[i])}break;default:if(this.m_oCallFuntions[c.call]){if(!c.params){c.params={}}this.m_oCallFuntions[c.call](c.params)}else{throw"call: "+c.call+" not found in call functions!"}break}}else{throw"call attribute not found in CallObject!"}}catch(b){if(this.m_bDebug){alert(b)}}};SPI.cutStringPlease=function(d,c,e,b){var c=c||0;var e=e||false;var b=b||"...";var d=d||"";if(c==0){return d}if(e==true){d=this.escape(d)}if(d.length>c){d=d.substring(0,c-1)+""+b}return d};jQuery.fn.cutStringPlease=function(c,d,b){this.each(function(){$(this).text(SPI.cutStringPlease($(this).text(),c,d,b))})};SPI.number_format=function(g,d,o,f){var d=d||0;var o=o||SPI._settings.global.number_format_decimalseparator;var f=f||SPI._settings.global.number_format_thousandsseparator;var c=g,b=d;var j=function(v,u){var s=Math.pow(10,u);return(Math.round(v*s)/s).toString()};c=!isFinite(+c)?0:+c;b=!isFinite(+b)?0:Math.abs(b);var r=(typeof f==="undefined")?",":f;var e=(typeof o==="undefined")?".":o;var q=(b>0)?j(c,b):j(Math.round(c),b);var p=j(Math.abs(c),b);var m,h;if(p>=1000){m=p.split(/\D/);h=m[0].length%3||3;m[0]=q.slice(0,h+(c<0))+m[0].slice(h).replace(/(\d{3})/g,r+"$1");q=m.join(e)}else{q=q.replace(".",e)}var l=q.indexOf(e);if(b>=1&&l!==-1&&(q.length-l-1)<b){q+=new Array(b-(q.length-l-1)).join(0)+"0"}else{if(b>=1&&l===-1){q+=e+new Array(b).join(0)+"0"}}return q};SPI.reloadSite=function(b,c){b=b||SPI.getURLparam("r")||SPI._settings.global.static_domain||"/";c=c||"";if(c!=""){b+=(/\?/.test(b)?"&":"?")+c}try{window.top.location.href=b}catch(d){}};SPI.friends=(function(h,b){var e={settings:{anonymousIcon:b._settings.avatarImages.anonymousIcon,anonymousIconBig:b._settings.avatarImages.anonymousIconBig,exposeGivennameMinAge:13,search:{usersLimit:10,formId:"friends_search",resultsClass:"friends_search_results",noResultsClass:"friends_search_no_results",resultsElementsId:"frsr_",paginationClass:"friends_search_pagination",paginationStringClass:b._settings.friends.search.paginationStringClass,paginationBlueButtons:false,type:"simple",typeSwich:"friends_search_extended_switch",extendedHolder:"friends_search_extended",externalPrefs:["avatar","username","privacy"],externalProfiles:["gender","age","givenname"],loadHigscoreData:true,loadAwardsData:true,beforeRender:null,onBeforeSearchHideObj:b._settings.friends.search.onBeforeSearchHideObj},additionalUserData:{gc:b._settings.friends.additionalUserData.gc,fc:b._settings.friends.additionalUserData.fc},profilePanel:{targetElement:".profilePanelHolder"},friendList:{received:{pagesize:3,sortby:"friendtime",order:2,pagecount:3},sent:{pagesize:5,sortby:"friendtime",order:2,pagecount:3},accepted:{pagesize:5,sortby:"username",order:1,pagecount:3},latest:{pagesize:6,sortby:"friendtime",order:2,include:[],renderNoFriends:b._settings.friends.friendList.renderNoFriends,noFriendsCallback:""}},myFriends:{usersLimit:10,paginationClass:"my_friends_pagination",paginationStringClass:b._settings.friends.myFriends.paginationStringClass,paginationBlueButtons:false,resultsClass:"my_friends_results",resultsElementsId:"myfr_",loadHigscoreData:true,loadAwardsData:true,externalPrefs:["avatar","privacy"],externalProfiles:["gender","age","givenname"]},userFriends:{usersLimit:10,paginationClass:"user_friends_pagination",paginationStringClass:b._settings.friends.userFriends.paginationStringClass,paginationBlueButtons:false,resultsClass:"user_friends_results",resultsElementsId:"usfr_",loadHigscoreData:true,loadAwardsData:true,externalPrefs:["avatar","privacy"],externalProfiles:["gender","age","givenname"]},renderSettings:{decorateFriendCounter:b._settings.renderSettings.decorateFriendCounter}}};var m={};m.search={};m.friendList={};m.myFriends={};m.targetuser=null;function d(v,x){var u=v.constructor.prototype,s=v.hasOwnProperty,r;for(r in v){if((s&&s.call(v,r))||u[r]!==v[r]){a=x(r,v[r]);if(a=="break"){break}}}}function o(v,u,r,s){tmpstart=((parseInt(u)-1)*parseInt(r))+1;tmpstop=(parseInt(u)*parseInt(r));if(tmpstop>parseInt(s)){tmpstop=parseInt(s)}return b.sprintf(v,tmpstart,tmpstop,parseInt(s))}var l=function(s,v,u,r){h.profilar.friendInvite(s,function(x,y){if(y===null||y.length==0){h.profilar.triggerEvent({cheetah_ebm:{aid:e.settings.inviteMailAid,eid:e.settings.inviteMailEventId},email:"",userName:s,emptyEmail:true,level:"channel",fields:r},function(z,A){v(x,A)})}else{v(x,y)}})};m.showMyFriendsLimitPopup=function(){b.popup.show(b._templates.friends.friendList.limit.reach_myself,function(){},{type:"alert",title:b._langStrings.friends.limit_reach_myself,titleIcon:"popup_error",closeAfterTimeout:false,close:true,extraClass:"with_icon with_bigicon"})};m.showUserFriendsLimitPopup=function(r){b.popup.show(b.sprintf(b._templates.friends.friendList.limit.reach_friend,r),function(){},{type:"alert",title:b._langStrings.friends.limit_reach_friend,titleIcon:"popup_error",closeAfterTimeout:false,close:true,extraClass:"with_icon with_bigicon"})};m.showUserFriendsLimitInvitationPopup=function(){b.popup.show(b._templates.friends.friendList.limit.reach_friend_invitation,function(){},{type:"alert",title:b._langStrings.friends.limit_reach_friend_invitation,titleIcon:"popup_error",closeAfterTimeout:false,close:true,extraClass:"with_icon with_bigicon"})};m.friendInviteWithMail=function(s,v,u){var r=[{name:"username",value:s},{name:"friend_username",value:h.profilar.forService().username},{name:"avatar_id",value:h.profilar.getPref("avatar")}];return l(s,v,u,r)};m.friendInviteWithMailToGame=function(s,v,u){var r=[{name:"username",value:s},{name:"friend_username",value:h.profilar.forService().username},{name:"gametitle",value:gameTitle},{name:"gamenicename",value:gameNicename},{name:"avatar_id",value:h.profilar.getPref("avatar")}];return l(s,v,u,r)};m.updateTabsBar=function(){h.profilar.friendListAccepted(h.profilar.get("username"),function(r,s){h("div#userinfo span.friendsCount, #profilecontent span.friendsCount").html(h("profilar total:first",r).text()||0)},{pagenr:1,pagesize:1})};var n={data:{},addType:function(r){n.data[r]=[]},set:function(r,s){n.data[s].push(r)},reverse:function(r){n.data[r].reverse()},get:function(r){if(typeof(n.data[r])!="undefined"&&this.data[r].length){hsItem=n.data[r].pop();g(hsItem.user,function(s){hsItem.callback.call(this,s);n.get(r)},hsItem.hs,hsItem.aw,hsItem.pc,hsItem.gc,hsItem.fc)}}};var g=function(u,H,D,r,B,G,s){var v=D||false;var A=r||false;var y=G||false;var F=s||false;var C=B||true;var z=false;var E={};if(typeof(u)=="object"){var x=u.username;E=u}if(typeof(u)=="string"){var x=u;E={username:u}}if(C){if(typeof(E.privacy)!="undefined"&&parseInt(E.privacy)==0){z=true}}if((!v&&!A&&!y&&!F)||(!z&&C)){return H.call(this,E)}if(F){h.profilar.friendListAccepted(x,function(I){try{E.friendsCount=parseInt(h("total",I).text())||0}catch(J){E.friendsCount=0}F=false;if(v||A||y||F){g(E,H,v,A,C,y,F)}else{H.call(this,E)}},{pagenr:1,pagesize:1});return}if(v){b.highscore.getUserLevel(function(J){try{E.points=J.hyscor.level||0}catch(I){E.points=0}v=false;if(v||A||y||F){g(E,H,v,A,C,y,F)}else{H.call(this,E)}},x);return}if(A){b.achievements.getAchievementsCountForUser(function(J){try{E.awardsCount=J.hyscor.resultset.total||0}catch(I){E.awardsCount=0}A=false;if(v||A||y||F){g(E,H,v,A,C,y,F)}else{H.call(this,E)}},x);return}if(y){b.myGallery.getCountForUser(x,function(I){try{E.galeryCount=I.gamatar.resultset.total||0}catch(J){E.galeryCount=0}y=false;if(v||A||y||F){g(E,H,v,A,C,y,F)}else{H.call(this,E)}});return}};m.getCountForUser=function(s,r){h.profilar.friendListAccepted(r,function(x){var v=0;try{v=parseInt(h("total",x).text())||0}catch(u){v=0}if(typeof s=="function"){s.call(this,v)}},{pagenr:1,pagesize:1});return};var c=function(D,B,A,r,v){var z=[];var x={};var s={};var u={};var y={};var C;for(C in D.username){s={};d(A,function(E,F){if(typeof(F.username)!="undefined"&&F.username.toLowerCase()==D.username[C].toLowerCase()){s=F;delete (A[E]);return"break"}});u={};d(r,function(E,F){if(typeof(F.username)!="undefined"&&F.username.toLowerCase()==D.username[C].toLowerCase()){u=F;delete (r[E]);return"break"}});if(v.length){y={};d(v,function(E,F){if(typeof(F.username)!="undefined"&&F.username.toLowerCase()==D.username[C].toLowerCase()){y=F;delete (v[E]);return"break"}});z.push(h.extend(s,u,y,{username:D.username[C]}))}else{z.push(h.extend(s,u,{username:D.username[C]}))}}B.call(this,{users:z,total:D.total,returned:D.returned})};var f=function(D,B,x,r,u){var s=u||false;var z=r||["avatar","username","privacy"];var C=x||["gender"];var y;var E;var v;h.profilar.loadExternalPrefs(D[0].username,function(F,G){y=F;A()},z);h.profilar.loadExternalProfiles(D[0].username,function(F,G){E=F;A()},C);if(s){h.profilar.checkFriends(D[0].username,function(F,G){v=F;A()})}var A=function(){if(typeof(y)=="undefined"){return}if(typeof(E)=="undefined"){return}if(s){if(typeof(v)!="undefined"){c(D[0],B,y,E,v)}return}else{c(D[0],B,y,E,{})}}};m.search.options={channel:b._settings.global.channel_id,siteid:b._settings.global.site_id,pagesize:e.settings.search.usersLimit};m.search.rawSearchField="";m.search.handleErrors=function(r){return true};m.search.beforeSearch=function(){h("."+e.settings.search.resultsClass).empty();h("."+e.settings.search.paginationClass).empty();h(e.settings.search.onBeforeSearchHideObj).hide();return true};m.search.noResults=function(){h("#"+e.settings.search.formId).data("canSubmit",true);h("."+e.settings.search.noResultsClass).show();h(".friends_search_results_box").hide();h(".friends_search_total_holder").hide();h("."+e.settings.search.resultsClass).hide();h("."+e.settings.search.paginationClass).hide();h(".friends_search_pagination").empty();if(e.settings.search.paginationStringClass){h("."+e.settings.search.paginationStringClass).hide()}return true};m.search.formIsValid=function(){h("[name=friends_search_username]","#"+e.settings.search.formId).removeClass("searchError");if(!h("#"+e.settings.search.formId).data("canSubmit")){return false}var r=true;h(".friends_search_uname_error").text("").hide();h(".friends_search_gname_error").text("").hide();h(".friends_search_sname_error").text("").hide();uname=h("[name=friends_search_username]","#"+e.settings.search.formId).val();gname=h("[name=friends_search_givenname]","#"+e.settings.search.formId).val();sname=h("[name=friends_search_surname]","#"+e.settings.search.formId).val();gender=h("[name=friends_search_gender]:checked","#"+e.settings.search.formId).val();if((e.settings.search.type=="extended"&&uname==""&&gname==""&&sname==""&&(gender==""||typeof(gender)=="undefined"))||uname==b._langStrings.friends.search.defaultText){h(".friends_search_uname_error").text(e.langStrings.search.textToShort).show();h("[name=friends_search_username]","#"+e.settings.search.formId).addClass("searchError");r=false}else{if(e.settings.search.type=="simple"&&uname==""){h(".friends_search_uname_error").text(e.langStrings.search.textToShort).show();h("[name=friends_search_username]","#"+e.settings.search.formId).addClass("searchError");r=false}}if(uname.length!=0&&((uname.indexOf("*")>=0&&(uname.length<4||uname.indexOf("*")!=uname.length-1))||uname.length<3)){if(uname.length<3){h(".friends_search_uname_error").text(e.langStrings.search.textToShort).show()}else{h(".friends_search_uname_error").text(e.langStrings.search.incorrectAsterixFormat).show()}h("[name=friends_search_username]","#"+e.settings.search.formId).addClass("searchError");r=false}if(e.settings.search.type=="extended"&&gname.length!=0&&(gname.indexOf("*")>=0&&(gname.length<4||gname.indexOf("*")!=gname.length-1)||gname.length<3)){if(gname.length<3){h(".friends_search_gname_error").text(e.langStrings.search.textToShort).show()}else{h(".friends_search_gname_error").text(e.langStrings.search.incorrectAsterixFormat).show()}h("[name=friends_search_username]","#"+e.settings.search.formId).addClass("searchError");r=false}if(e.settings.search.type=="extended"&&sname.length!=0&&(sname.indexOf("*")>=0&&(sname.length<4||sname.indexOf("*")!=sname.length-1)||sname.length<3)){if(sname.length<3){h(".friends_search_sname_error").text(e.langStrings.search.textToShort).show()}else{h(".friends_search_sname_error").text(e.langStrings.search.incorrectAsterixFormat).show()}h("[name=friends_search_username]","#"+e.settings.search.formId).addClass("searchError");r=false}if(r){h(".friends_search_total").text("")}return r};m.search.drawRow=function(r){var u=m.prepareFriendsRow(r);switch(r.friendstatus){case"error":u.actionLink="";break;case"self":acL=b.render(e.templates.search.action_self,u);u.actionLink=acL;break;case"none":case"declined":case"deleted":u.actionLink=b.render(e.templates.search.action_invite,u);break;case"sent":u.actionLink=b.render(e.templates.search.action_pending,u);break;case"received":u.actionLink=b.render(e.templates.search.action_accept,u);break;case"accepted":acL=b.render(e.templates.search.action_delete,u);u.actionLink=acL}if(typeof(r.privacy)!="undefined"&&parseInt(r.privacy)==0){var s=h(b.render(e.templates.search.resultBodyPublic,u))}else{var s=h(b.render(e.templates.search.resultBodyPrivate,u))}switch(r.friendstatus){case"error":case"self":case"sent":break;case"none":case"declined":case"deleted":h(s).find("a.friends_search_result_action").data("username",u.username).click(function(){var v=this;m.friendInviteWithMail(h(this).data("username"),function(x,y){if(!y){b.popup.show(b.render(b._templates.popup.content_simple,{header:b.sprintf(b._langStrings.friends.invitefriend_title,h(v).data("username")),highlightclass:""}),function(){h(v).parent().before(b.render(e.templates.search.action_pending,u));h(v).parent().remove()},{title:b._langStrings.friends.invitefriend_pending,close:false})}});return false});break;case"received":h(s).find(".friends_search_result_action_accept").data("username",u.username).click(function(){var v=this;h.profilar.friendAccept(h(this).data("username"),function(y,z){if(!z){var x=h(v).data("username");h(v).wrap('<span class="friends_search_result_action">'+e.langStrings.search.userConfirmed+"</span>");h(v).remove();b.handlers.run("friends_changed",[],false);b.notice.renderMessage(x,"accepted");m.updateTabsBar()}});return false});h(s).find(".friends_search_result_action_reject").data("username",u.username).click(function(){var v=this;h.profilar.friendDecline(h(this).data("username"),function(y,z){if(!z){var x=h(v).data("username");h(v).wrap('<span class="friends_search_result_action">'+e.langStrings.search.userDeclined+"</span>");h(v).remove();b.handlers.run("friends_changed",[],false);b.notice.renderMessage(x,"rejected")}});return false});break;case"accepted":h(s).find(".friends_search_result_action").data("username",u.username).click(function(){var v=this;b.popup.show(b.render(b._templates.popup.content_simple,{header:b._langStrings.friends.enfriend_extrastep1,highlightclass:""}),{_ok:function(){b.popup.close()},_cancel:function(){h.profilar.friendDelete(h(v).data("username"),function(x,y){if(!y){h(v).wrap('<span class="friends_search_result_action">'+e.langStrings.search.userDeleted+"</span>");h(v).remove();b.handlers.run("friends_changed",[],false);m.updateTabsBar()}});b.popup.show(b.render(b._templates.popup.content_doublelined,{header:b._langStrings.friends.endfriend_suceess,highlightclass:"",info:b._langStrings.friends.indfriend_extrastep_desc}),function(){b.popup.close()},{title:b._langStrings.friends.popup_end_friendship,titleIcon:"popup_friends",close:true})}},{type:"confirm",title:b._langStrings.friends.popup_end_friendship,blueButtonText:b._langStrings.friends.endfriend_no,bottomLinkText:b._langStrings.friends.endfriend_yes,close:true,autoClose:false});return false});break}h("#"+e.settings.search.resultsElementsId+r.no,"."+e.settings.search.resultsClass).empty().append(s);if(typeof e.settings.search.drawRowCallback=="function"){e.settings.search.drawRowCallback.call(this,s)}};m.search.renderResults=function(v){h("."+e.settings.search.paginationClass).show();if(parseInt(v.total)>parseInt(e.settings.search.usersLimit)){if(e.settings.search.paginationBlueButtons==true){var s=b.paginatorString(v.total,m.search.options.pagenr,e.settings.search.usersLimit,4,m.search.users,{next:"",prev:"",separator:e.langStrings.separator},undefined,b._templates.pagination)}else{var s=b.paginatorString(v.total,m.search.options.pagenr,e.settings.search.usersLimit,4,m.search.users,e.langStrings)}if(e.settings.search.paginationStringClass){h(".friends_search_pagination_string").html(o(b._langStrings.friends.paginationString,m.search.options.pagenr,e.settings.search.usersLimit,v.total))}h("."+e.settings.search.paginationClass).each(function(){try{h(this).append(s.clone(true))}catch(y){}});var u=0;h(":visible","."+e.settings.search.paginationClass+":first").find("span:visible").each(function(){u+=h(this).width()+(parseInt(h(this).css("margin-left").slice(0,-2))||0)+(parseInt(h(this).css("margin-right").slice(0,-2))||0)});if(b._settings.friends.calculatePaginationWidth){h("."+e.settings.search.paginationClass).width(u)}}else{h("."+e.settings.search.paginationClass).hide();if(e.settings.search.paginationStringClass){h("."+e.settings.search.paginationStringClass).hide()}}h(".friends_search_total_holder .friends_search_total").empty().html(b.sprintf(b._langStrings.friends.search.friend_finder_search_results_summary,parseInt(v.total),m.search.rawSearchField));if(parseInt(v.total)>0){h(".friends_search_total_holder").show()}h("."+e.settings.search.resultsClass).empty().show();var x;var r=v.users;n.addType("search");for(x in r){n.set({user:r[x],callback:m.search.drawRow,hs:false,aw:false,pc:false,gc:false,fc:e.settings.additionalUserData.fc},"search");n.get("search")}for(x in r){r[x].no=x;if(x%2){r[x].extraClass="odditem"}else{r[x].extraClass="evenitem"}n.set({user:r[x],callback:m.search.drawRow,hs:e.settings.search.loadHigscoreData,aw:e.settings.search.loadAwardsData,pc:e.settings.additionalUserData.pc,gc:e.settings.additionalUserData.gc,fc:e.settings.additionalUserData.fc},"search");h("."+e.settings.search.resultsClass).append(h(b.render(e.templates.search.resultHolder,{extraClass:r[x].extraClass,i:e.settings.search.resultsElementsId+x})))}n.reverse("search");n.get("search");h("#"+e.settings.search.formId).data("canSubmit",true);h("."+e.settings.search.noResultsClass).hide()};m.search.usersForm=function(s,r){h.extend(e.settings.search,r);h("#"+e.settings.search.formId).data("canSubmit",true);h("[name=friends_search_username]").focus(function(){if(h(this).val()==b._langStrings.friends.search.friendfinder_inputfield){h(this).val("");h(this).addClass("searchBold")}}).blur(function(){if(h(this).val()==""){h(this).removeClass("searchBold");h(this).val(b._langStrings.friends.search.friendfinder_inputfield)}});h(".friends_search_total_holder").hide();h("."+e.settings.search.typeSwich).click(function(){return m.search.switchSearchType()});if(s!=e.settings.search.formId&&typeof(s)!="undefined"&&s!=null){e.settings.search.formId=s}if(!h("input[type=submit]","#"+e.settings.search.formId).length){h("a.submit","#"+e.settings.search.formId).click(function(){h("#"+e.settings.search.formId).submit();return false})}h("#"+e.settings.search.formId).submit(function(){if(m.search.formIsValid()){h(".showMyFriends").css("display","block");h("#"+e.settings.search.formId).data("canSubmit",false);delete (m.search.options.username);delete (m.search.options.givenname);delete (m.search.options.surname);delete (m.search.options.gender);if(h("[name=friends_search_username]","#"+e.settings.search.formId).val()){m.search.options.username=h("[name=friends_search_username]","#"+e.settings.search.formId).val()}m.search.rawSearchField=m.search.options.username;if(m.search.options.username.indexOf("*")==-1){m.search.options.username+="*"}if(m.search.options.username.indexOf("*")!=0){m.search.options.username="*"+m.search.options.username}if(e.settings.search.type=="extended"){if(h("[name=friends_search_givenname]","#"+e.settings.search.formId).val()){m.search.options.givenname=h("[name=friends_search_givenname]","#"+e.settings.search.formId).val()}if(h("[name=friends_search_surname]","#"+e.settings.search.formId).val()){m.search.options.surname=h("[name=friends_search_surname]","#"+e.settings.search.formId).val()}if(h("[name=friends_search_gender]:checked","#"+e.settings.search.formId).val()){m.search.options.gender=h("[name=friends_search_gender]:checked","#"+e.settings.search.formId).val()}}m.search.users(1)}return false})};m.search.switchSearchType=function(){if(e.settings.search.type=="simple"){e.settings.search.type="extended";h("."+e.settings.search.typeSwich).text(e.langStrings.search.less);h("."+e.settings.search.extendedHolder).show()}else{e.settings.search.type="simple";h("."+e.settings.search.typeSwich).text(e.langStrings.search.more);h("."+e.settings.search.extendedHolder).hide()}return false};m.search.users=function(r){if(e.settings.search.loadHigscoreData){b.highscore.init()}if(e.settings.search.loadAwardsData){b.achievements.init()}m.search.options.pagenr=parseInt(r)||1;m.search.beforeSearch();h.profilar.userSearch(m.search.options,function(s,u){if(!u){if(typeof e.settings.search.beforeRender=="function"){e.settings.search.beforeRender.call(this)}if(parseInt(s[0].total)){return f(s,m.search.renderResults,e.settings.search.externalProfiles,e.settings.search.externalPrefs,true)}return m.search.noResults()}else{return m.search.noResults()}})};m.setOrder=function(r){if("ASC"===r){m.myFriends.options.order=1}else{m.myFriends.options.order=2}};m.getOrder=function(){return m.myFriends.options.order};m.setSortby=function(r){m.myFriends.options.sortby=r};m.getSortby=function(){return m.myFriends.options.sortby};m.friendList=function(v,r,A){var r=h.extend(e.settings.friendList[v],r);if(r.anonymousIcon){e.settings.anonymousIcon=r.anonymousIcon}var x=r.forceRender||false;r.pagenr=A||1;var B="",y=[],z=0,s=0;if(x!==true&&(h(r.element).length==0||h(r.element+":visible").length==0)){return}h(r.element).show();h(r.element).empty();switch(v){case"received":h.profilar.friendListReceived(function(D){z=h("profilar friendlist total:first",D).text()||0;s=h("profilar friendlist returned:first",D).text()||0;if(s>0&&z>0){h(r.element).append("<ul></ul>");h("profilar friendlist resultset result",D).each(function(){var G=h("getprefs avatar:first",this).text();var F="";if(typeof G=="undefined"||G==""){F=e.settings.anonymousIcon}else{F=b.sprintf(b._settings.avatarImages.small_avatar,G)}var E=h(b.render(e.templates.friendList.received.content,{username:h("username:first",this).text(),avatar_url:F}));E.data("username",h("username:first",this).text());h("a.accept:first",E).click(function(){var H=E.data("username");h.profilar.friendAccept(H,function(){E.remove();b.notice.renderMessage(H,"accepted");b.handlers.run("friends_changed",[],false);m.updateTabsBar()});return false});h("a.decline:first",E).click(function(){var H=E.data("username");h.profilar.friendDecline(H,function(){E.remove();b.notice.renderMessage(H,"rejected");b.handlers.run("friends_changed",[],false)});return false});h("ul",r.element).append(E)});if(e.settings.myFriends.paginationBlueButtons==true){var C=b.paginatorString(z,r.pagenr,r.pagesize,r.pagecount,function(E){b.friends.friendList(v,r,E)},{next:"",prev:"",separator:e.langStrings.separator},undefined,b._templates.pagination)}else{var C=b.paginatorString(z,r.pagenr,r.pagesize,r.pagecount,function(E){b.friends.friendList(v,r,E)},e.langStrings)}h(r.element).append(C)}else{}},r);break;case"sent":h.profilar.friendListSent(function(D){z=h("profilar friendlist total:first",D).text()||0;s=h("profilar friendlist returned:first",D).text()||0;if(s>0&&z>0){h(r.element).append("<ul></ul>");h("profilar friendlist resultset result",D).each(function(){var G=h("getprefs avatar:first",this).text();var F="";if(typeof G=="undefined"||G==""){F=e.settings.anonymousIcon}else{F=b.sprintf(b._settings.avatarImages.small_avatar,G)}var E=h(b.render(e.templates.friendList.sent.content,{username:h("username:first",this).text(),avatar_url:F}));E.data("username",h("username:first",this).text());h("ul",r.element).append(E)});if(e.settings.myFriends.paginationBlueButtons==true){var C=b.paginatorString(z,r.pagenr,r.pagesize,r.pagecount,function(E){b.friends.friendList(v,r,E)},{next:"",prev:"",separator:e.langStrings.separator},undefined,b._templates.pagination)}else{var C=b.paginatorString(z,r.pagenr,r.pagesize,r.pagecount,function(E){b.friends.friendList(v,r,E)},e.langStrings)}h(r.element).append(C)}else{}},r);break;case"accepted":var u=b.getURLparam("username")||null;b.friends.init(u);h.profilar.friendCheck(u,function(E){var C=h("profilar friendcheck friendstatus",E).text();switch(C.toLowerCase()){case"accepted":var D=h(b.render(e.templates.friendList.accepted.manage_accepted,{}));break;case"sent":var D=h(b.render(e.templates.friendList.accepted.manage_sent,{}));break;default:case"none":var D=h(b.render(e.templates.friendList.accepted.manage_none,{}));break}D.data("username",h("profilar friendcheck username:first",E).text());h("a.invite:first",D).click(function(){var F=this;var G=D.data("username");m.friendInviteWithMail(G,function(H,I){if(!I){h(F).remove();b.handlers.run("friends_changed",[],false)}});return false});h("a.cancel:first",D).click(function(){var F=this;var G=D.data("username");h.profilar.friendDelete(G,function(){h(F).remove();b.handlers.run("friends_changed",[],false)});return false});h(r.element).prepend(D)});h.profilar.friendListAccepted(u,function(D){z=h("profilar friendlist total:first",D).text()||0;s=h("profilar friendlist returned:first",D).text()||0;if(s>0&&z>0){h(r.element).append("<ul></ul>");h("profilar friendlist resultset result",D).each(function(){var G=h("getprefs avatar:first",this).text();var F="";if(typeof G=="undefined"||G==""){F=e.settings.anonymousIcon}else{F=b.sprintf(b._settings.avatarImages.small_avatar,G)}var E=h(b.render(e.templates.friendList.accepted.content,{username:h("username:first",this).text(),avatar_url:F}));E.data("username",h("username:first",this).text());h("ul",r.element).append(E)});if(e.settings.myFriends.paginationBlueButtons==true){var C=b.paginatorString(z,r.pagenr,r.pagesize,r.pagecount,function(E){b.friends.friendList(v,r,E)},{next:"",prev:"",separator:e.langStrings.separator},undefined,b._templates.pagination)}else{var C=b.paginatorString(z,r.pagenr,r.pagesize,r.pagecount,function(E){b.friends.friendList(v,r,E)},e.langStrings)}h(r.element).append(C)}else{}},r);break;case"latest":var u=b.getURLparam("username")||null;b.friends.init(u);h.profilar.friendListAccepted(u,function(F){z=h("profilar friendlist total:first",F).text()||0;s=h("profilar friendlist returned:first",F).text()||0;if(s>0&&z>0){h(r.element).append('<ul class="media-list media-user"></ul>');var H="",J="",M=null,I="",D=0,L=null;var G=h("profilar friendlist resultset result",F);for(var E=0;E<G.length;E++){$this=G[E];H=h("request gender:first",$this).text()||"";J=(H=="m")?""+b._langStrings.friends.male:""+b._langStrings.friends.female;M=h("getprefs avatar:first",$this).text();I=(typeof M=="undefined"||M=="")?e.settings.anonymousIcon:b.sprintf(b._settings.avatarImages.small_avatar,M);extraClass=p(E,D,G.length);L=h(b.render(e.templates.friendList.latest.content,{username:h("username:first",$this).text(),avatar_url:I,extraClass:extraClass,gender:J,allfriendsUrl:r.allfriendsUrl,searchfriendsUrl:r.searchfriendsUrl}));L.data("username",h("username:first",$this).text());m.addAvatarTooltip(L,".lf-avatar",M,h("username:first",$this).text());h("ul",r.element).append(L);if(E%2){D++}}if(z<r.pagesize&&r.fillPagesize===true){for(var C=E;C<r.pagesize;C++){extraClass=p(C,D,G.length);emptyLi=h(b.render(e.templates.friendList.latest.emptyrow,{extraClass:extraClass,avatar_url:e.settings.anonymousIcon,allfriendsUrl:r.allfriendsUrl,searchfriendsUrl:r.searchfriendsUrl}));h("ul",r.element).append(emptyLi);if(C%2){D++}}}}else{if(u==null){if(r.friendList.latest.renderNoFriends==true){if(r.friendList.latest.fillWhenEmpty===true){h(r.element).append('<ul class="media-list media-user"></ul>');j(h("ul",r.element),r.pagesize,e.templates.friendList.latest.emptyrow)}else{var I=e.settings.anonymousIcon;h(r.element).append(h(b.render(e.templates.friendList.latest.nofriends,{avatar_url:I,username:u,allfriendsUrl:r.allfriendsUrl,searchfriendsUrl:r.searchfriendsUrl})))}}}else{if(r.friendList.latest.renderNoFriends){if(r.friendList.latest.fillWhenEmpty===true){h(r.element).append('<ul class="media-list media-user"></ul>');j(h("ul",r.element),r.pagesize,b._templates.friends.friends_friendlist_empty_row)}else{h(r.element).append(h(b.render(e.templates.friendList.latest.nofriends_public,{avatar_url:I,username:u,allfriendsUrl:r.allfriendsUrl,searchfriendsUrl:r.searchfriendsUrl})))}}else{if(r.boxelement&&h(r.boxelement).length>0){h(r.boxelement).remove()}}}if(r.friendList.latest.noFriendsCallback!=""){callback=r.friendList.latest.noFriendsCallback;if(typeof callback=="function"){callback.call()}}}if(parseInt(z)>0||r.friendList.latest.forceShowTotal===true){var K=h(b.render(e.templates.friendList.latest.total,{total:z,username:u,allfriendsUrl:r.allfriendsUrl,searchfriendsUrl:r.searchfriendsUrl}));h(r.element).append(K)}},r);break}};var p=function(s,r,u){var v="media";if(r%2==0){v+=" odd-row"}return v};var j=function(s,x,v){if(s.length==0){return}var A=null,r=0,y=0,z="";for(var u=0;u<x;u++){z="media";if(y%2==0){z+=" odd-row"}A=h(b.render(""+v,{extraClass:z,avatar_url:e.settings.anonymousIcon}));A.attr("id","lf_"+u);s.append(A);if(r%2){y++}r++}};m.myFriends.options={channel:b._settings.global.channel_id,pagesize:e.settings.myFriends.usersLimit,level:"channel",username:h.profilar.forService().username,includePref:e.settings.myFriends.externalPrefs};m.myFriends.init=function(s,r){m.setOrder("ASC");m.setSortby("activity");h.extend(m.myFriends.options,s);if(r!==undefined){h.extend(true,e,r)}h(".friends-sort-by-username").click(function(){if(m.myFriends.renderStart&&m.myFriends.renderStart===true){return true}m.setSortby("username");var u=m.getOrder();if(u===1){m.setOrder("DESC");h("strong.sort-down",this).removeClass("sort-down").addClass("sort-up")}else{m.setOrder("ASC");h("strong.sort-up",this).removeClass("sort-up").addClass("sort-down")}h(this).addClass("friends-sorting-current");h(".friends-sort-by-lastvisit").removeClass("friends-sorting-current");m.myFriends.showList(1)});h(".friends-sort-by-lastvisit").click(function(){if(m.myFriends.renderStart&&m.myFriends.renderStart===true){return true}m.setSortby("activity");var u=m.getOrder();if(u===1){m.setOrder("DESC");h("strong.sort-down",this).removeClass("sort-down").addClass("sort-up")}else{m.setOrder("ASC");h("strong.sort-up",this).removeClass("sort-up").addClass("sort-down")}h(this).addClass("friends-sorting-current");h(".friends-sort-by-username").removeClass("friends-sorting-current");m.myFriends.showList(1)})};m.myFriends.noFriends=function(){if(typeof(m.myFriends.options.noFriendsCallback)=="function"){m.myFriends.options.noFriendsCallback()}h(".my_friends_no_friends").show();h(".my_friends_results_holder").hide()};m.myFriends.noUserFriends=function(){h(".user_friends_no_friends").show();h(".user_friends_results_holder").hide()};m.myFriends.showList=function(s,r){m.myFriends.renderStart=true;e.settings.myFriends._targetuser=r||m.targetuser||undefined;e.settings.myFriends._friendcheck=false;if(typeof e.settings.myFriends._targetuser!=="undefined"){e.settings.myFriends._friendcheck=true}if((e.settings.myFriends._friendcheck)&&(h("."+e.settings.userFriends.resultsClass).length==0)){return}if(e.settings.myFriends.loadHigscoreData){b.highscore.init()}if(e.settings.myFriends.loadAwardsData){b.achievements.init()}m.myFriends.options.pagenr=parseInt(s)||1;h.profilar.friendListAccepted(e.settings.myFriends._targetuser,function(u,v){if(!v){if(parseInt(h("profilar friendlist total",u).text())){h(".my_friends_no_friends").hide();h(".my_friends_results_holder").show();if(e.settings.myFriends._friendcheck){return m.myFriends.renderUserList(h("profilar friendlist",u))}return m.myFriends.renderList(h("profilar friendlist",u))}else{m.myFriends.renderStart=false;if(e.settings.myFriends._friendcheck){return m.myFriends.noUserFriends()}return m.myFriends.noFriends()}}else{m.myFriends.showError()}},m.myFriends.options)};m.myFriends.renderList=function(x){h("."+e.settings.myFriends.paginationClass).empty();if(e.settings.myFriends.paginationStringClass){h("."+e.settings.myFriends.paginationStringClass).empty().html("")}if(parseInt(h("total",x).text())>parseInt(e.settings.myFriends.usersLimit)){if(e.settings.myFriends.paginationBlueButtons==true){var r=b.paginatorString(h("total",x).text(),m.myFriends.options.pagenr,e.settings.myFriends.usersLimit,4,m.myFriends.showList,{next:"",prev:"",separator:e.langStrings.separator},undefined,b._templates.pagination)}else{var r=b.paginatorString(h("total",x).text(),m.myFriends.options.pagenr,e.settings.myFriends.usersLimit,4,m.myFriends.showList,e.langStrings)}h("."+e.settings.myFriends.paginationClass).each(function(){try{h(this).append(r.clone(true))}catch(z){}});var u=0;h(":visible","."+e.settings.myFriends.paginationClass+":first").find("span:visible").each(function(){u+=h(this).width()+(parseInt(h(this).css("margin-left").slice(0,-2))||0)+(parseInt(h(this).css("margin-right").slice(0,-2))||0)});if(b._settings.friends.calculatePaginationWidth){h("."+e.settings.myFriends.paginationClass).width(u)}if(e.settings.myFriends.paginationStringClass){h("."+e.settings.myFriends.paginationStringClass).html(o(b._langStrings.friends.paginationString,m.myFriends.options.pagenr,e.settings.myFriends.usersLimit,h("total",x).text()));h("."+e.settings.myFriends.paginationStringClass).show()}h("."+e.settings.myFriends.paginationClass).show()}else{h("."+e.settings.myFriends.paginationClass).hide();if(e.settings.myFriends.paginationStringClass){h("."+e.settings.myFriends.paginationStringClass).hide()}}h(".my_friends_total_extern").html(parseInt(h("total",x).text()));if(parseInt(h("total",x).text())>1){h(".my_friends_total_holder .my_friends_total").empty().html(b.sprintf(b._langStrings.friends.myFriends.friends_title_number_of_friends,parseInt(parseInt(h("total",x).text()))))}else{h(".my_friends_total_holder .my_friends_total").empty().html(b._langStrings.friends.myFriends.friends_1_friends)}if(parseInt(h("total",x).text())>0){h(".my_friends_total_holder").show()}h("."+e.settings.myFriends.resultsClass).empty();var v=0;h("."+e.settings.myFriends.resultsClass).empty();var y=[];var s={returned:h("returned",x).text(),total:h("total",x).text(),username:[]};h("resultset result",x).each(function(){var z={};z.no=v;if(v%2){z.extraClass="odditem"}else{z.extraClass="evenitem"}z.username=h("username:first",this).text();s.username.push(h("username:first",this).text());z.friendtime=h("friendtime:first",this).text()||"";z.friendstatus=h("friendstatus:first",this).text()||"";z.friendsCount=h("friendscount:first",this).text()||"";z.avatar=h("getprefs avatar:first",this).text()||"";z.privacy=h("getprefs privacy:first",this).text()||"";y.push(z);h("."+e.settings.myFriends.resultsClass).append(h(b.render(e.templates.myFriends.resultHolder,{extraClass:z.extraClass,i:e.settings.myFriends.resultsElementsId+v})));v++});h.profilar.loadExternalProfiles(s.username,function(z,A){c(s,function(B){if(typeof(n.data.myFriends)=="undefined"){n.addType("myFriends")}var C,D;for(C in B.users){n.set({user:B.users[C],callback:m.myFriends.drawRow,hs:e.settings.myFriends.loadHigscoreData,aw:e.settings.myFriends.loadAwardsData,pc:false,gc:e.settings.additionalUserData.gc,fc:false},"myFriends")}for(C in B.users){D=(B.users[C].friendsCount=="")?e.settings.additionalUserData.fc:false;n.set({user:B.users[C],callback:function(){},hs:false,aw:false,pc:false,gc:false,fc:D},"myFriends");n.get("myFriends")}n.reverse("myFriends");n.get("myFriends");if(typeof(m.myFriends.options.afterRenderCallback)=="function"){m.myFriends.options.afterRenderCallback()}m.myFriends.renderStart=false},y,z,false)},e.settings.myFriends.externalProfiles)};m.myFriends.renderUserList=function(v){h("."+e.settings.userFriends.resultsClass).empty();h("."+e.settings.userFriends.paginationClass).empty();if(parseInt(h("total",v).text())>parseInt(e.settings.userFriends.usersLimit)){if(e.settings.myFriends.paginationBlueButtons==true){var r=b.paginatorString(h("total",v).text(),m.myFriends.options.pagenr,e.settings.userFriends.usersLimit,4,m.myFriends.showList,{next:"",prev:"",separator:e.langStrings.separator},undefined,b._templates.pagination)}else{var r=b.paginatorString(h("total",v).text(),m.myFriends.options.pagenr,e.settings.userFriends.usersLimit,4,m.myFriends.showList,e.langStrings)}h("."+e.settings.userFriends.paginationClass).each(function(){try{h(this).append(r.clone(true))}catch(x){}});var s=0;h(":visible","."+e.settings.userFriends.paginationClass+":first").find("span:visible").each(function(){s+=h(this).width()+(parseInt(h(this).css("margin-left").slice(0,-2))||0)+(parseInt(h(this).css("margin-right").slice(0,-2))||0)});if(b._settings.friends.calculatePaginationWidth){h("."+e.settings.userFriends.paginationClass).width(s)}if(e.settings.search.paginationStringClass){h(".friends_search_pagination_string").html(o(b._langStrings.friends.paginationString,m.myFriends.options.pagenr,e.settings.userFriends.usersLimit,h("total",v).text()))}}else{h("."+e.settings.userFriends.paginationClass).hide()}var u={total:h("total",v).text(),returned:h("returned",v).text(),username:[]};if(parseInt(h("total",v).text())>1){h(".my_friends_total_holder .my_friends_total").empty().html(b.sprintf(b._langStrings.friends.myFriends.friends_title_number_of_friends,parseInt(parseInt(h("total",v).text()))))}else{h(".my_friends_total_holder .my_friends_total").empty().html(b._langStrings.friends.myFriends.friends_1_friends)}h("resultset result",v).each(function(){u.username.push(h("username:first",this).text())});f([u],function(x){m.myFriends.renderUserResults(x)},e.settings.myFriends.externalProfiles,e.settings.myFriends.externalPrefs,true)};m.myFriends.renderUserResults=function(s){var u;var r=s.users;n.addType("userFriends");for(u in r){r[u].no=u;n.set({user:r[u],callback:function(){},hs:false,aw:false,pc:true,fc:e.settings.additionalUserData.fc,gc:false},"userFriends");n.get("userFriends")}for(u in r){r[u].no=u;if(u%2){r[u].extraClass="odditem"}else{r[u].extraClass="evenitem"}n.set({user:r[u],callback:m.myFriends.drawUserRow,hs:e.settings.search.loadHigscoreData,aw:e.settings.search.loadAwardsData,pc:true,fc:false,gc:e.settings.additionalUserData.gc},"userFriends");h("."+e.settings.userFriends.resultsClass).append(h(b.render(e.templates.userFriends.resultHolder,{extraClass:r[u].extraClass,i:e.settings.userFriends.resultsElementsId+u})))}n.reverse("userFriends");n.get("userFriends")};m.prepareFriendsRow=function(s){var r={no:s.no,username:s.username,userprofilelink:b.sprintf(b._settings.highscore.userprofile_link,s.username),points:s.points||0,awardsCount:s.awardsCount||0,galeryCount:s.galeryCount||0,friendsCount:s.friendsCount||0,gender:s.gender||"",age:parseInt(s.age,10)||0,friendtime:s.friendtime,actionLink:""};r.level=b.sprintf(b._langStrings.loginbar.level,checkLevel(userLevels,r.points).level);if(r.gender=="m"){r.gender=e.langStrings.male}if(r.gender=="f"){r.gender=e.langStrings.female}if(r.age>=e.settings.exposeGivennameMinAge){r.givenname=s.givenname||""}else{r.givenname=""}if(typeof(s.avatar)=="undefined"||s.avatar==""){r.avatar=e.settings.anonymousIcon;r.avatarBig=e.settings.anonymousIconBig}else{r.avatar=b.sprintf(b._settings.avatarImages.small_avatar,s.avatar);r.avatarBig=b.sprintf(b._settings.avatarImages.big_avatar,s.avatar)}return r};m.myFriends.drawUserRow=function(u){var s=m.prepareFriendsRow(u);switch(u.friendstatus){case"error":s.actionLink="";break;case"self":acL=b.render(e.templates.userFriends.action_self,s);s.actionLink=acL;break;case"none":case"declined":case"deleted":s.actionLink=b.render(e.templates.userFriends.action_invite,s);break;case"sent":s.actionLink=b.render(e.templates.userFriends.action_pending,s);break;case"received":s.actionLink=b.render(e.templates.userFriends.action_accept,s);break;case"accepted":acL=b.render(e.templates.userFriends.action_delete,s);s.actionLink=acL}if(typeof(u.privacy)!="undefined"&&parseInt(u.privacy)==0){var r=h(b.render(e.templates.userFriends.resultBodyPublic,s))}else{var r=h(b.render(e.templates.userFriends.resultBodyPrivate,s))}switch(u.friendstatus){case"error":case"self":case"sent":break;case"none":case"declined":case"deleted":h(r).find("a.user_friends_result_action").data("username",s.username).click(function(){var v=this;m.friendInviteWithMail(h(this).data("username"),function(x,y){if(!y){b.popup.show(b.render(b._templates.popup.content_simple,{header:b.sprintf(b._langStrings.friends.invitefriend_title,h(v).data("username")),highlightclass:""}),function(){h(v).wrap('<span class="user_friends_result_action">'+e.langStrings.userFriends.userInvited+"</span>");h(v).remove();b.handlers.run("friends_changed",[{pagenr:b.friends.myFriends.options.pagenr}],false)},{title:b._langStrings.friends.popup_friendship_request_send,titleIcon:"",close:false})}});return false});break;case"received":h(r).find(".user_friends_result_action_accept").data("username",s.username).click(function(){var v=this;h.profilar.friendAccept(h(this).data("username"),function(y,z){var x=h(v).data("username");h(v).wrap('<span class="user_friends_result_action">'+e.langStrings.userFriends.userConfirmed+"</span>");h(v).remove();b.handlers.run("friends_changed",[],false);b.notice.renderMessage(x,"accepted");m.updateTabsBar()});return false});h(r).find(".user_friends_result_action_reject").data("username",s.username).click(function(){var v=this;h.profilar.friendDecline(h(this).data("username"),function(y,z){var x=h(v).data("username");h(v).wrap('<span class="user_friends_result_action">'+e.langStrings.userFriends.userDeclined+"</span>");h(v).remove();b.handlers.run("friends_changed",[],false);b.notice.renderMessage(x,"rejected")});return false});break;case"accepted":h(r).find(".user_friends_result_action").data("username",s.username).click(function(){var v=this;b.popup.show(b.render(b._templates.popup.content_simple,{header:b._langStrings.friends.enfriend_extrastep1,highlightclass:""}),{_ok:function(){b.popup.close()},_cancel:function(){h.profilar.friendDelete(h(v).data("username"),function(x,y){if(!y){h(v).wrap('<span class="friends_search_result_action">'+e.langStrings.search.userDeleted+"</span>");h(v).remove();b.handlers.run("friends_changed",[],false);m.updateTabsBar()}});b.popup.show(b.render(b._templates.popup.content_doublelined,{header:b._langStrings.friends.endfriend_suceess,highlightclass:"popup_ok_highlight",info:b._langStrings.friends.indfriend_extrastep_desc}),function(){b.popup.close()},{title:b._langStrings.friends.popup_end_friendship,titleIcon:"popup_friends",close:true})}},{type:"confirm",title:b._langStrings.friends.popup_end_friendship,titleIcon:"popup_friends",blueButtonText:b._langStrings.friends.endfriend_no,bottomLinkText:b._langStrings.friends.endfriend_yes,close:true,autoClose:false});return false});break}m.addAvatarTooltip(r,".avatar a",u.avatar,u.username);h("#"+e.settings.userFriends.resultsElementsId+u.no,"."+e.settings.userFriends.resultsClass).empty().append(r);if(typeof m.myFriends.options.drawRowCallback=="function"){m.myFriends.options.drawRowCallback.call(this,r)}};m.myFriends.drawRow=function(u){var s=m.prepareFriendsRow(u);s.actionLink=b.render(e.templates.myFriends.action_delete,s);if(typeof(u.privacy)!="undefined"&&parseInt(u.privacy)==0){var r=h(b.render(e.templates.myFriends.resultBodyPublic,s))}else{var r=h(b.render(e.templates.myFriends.resultBodyPrivate,s))}m.addAvatarTooltip(r,".avatar a",u.avatar,u.username);h(r).find("a.friends_search_result_action").data("username",s.username).click(function(){var v=this;b.popup.show(b.render(b._templates.popup.content_simple,{header:b._langStrings.friends.enfriend_extrastep1,highlightclass:""}),{_ok:function(){b.popup.close()},_cancel:function(){h.profilar.friendDelete(h(v).data("username"),function(x,y){if(!y){h(v).wrap('<span class="friends_search_result_action">'+e.langStrings.search.userDeleted+"</span>");h(v).remove();b.handlers.run("friends_changed",[],false);m.updateTabsBar()}});b.popup.show(b.render(b._templates.popup.content_doublelined,{header:b._langStrings.friends.endfriend_suceess,highlightclass:"",info:b._langStrings.friends.indfriend_extrastep_desc}),function(){b.popup.close()},{title:b._langStrings.friends.popup_end_friendship,titleIcon:"",close:false})}},{type:"confirm",title:b._langStrings.friends.popup_end_friendship,titleIcon:"",blueButtonText:b._langStrings.friends.endfriend_no,bottomLinkText:b._langStrings.friends.endfriend_yes,close:false,autoClose:false});return false});h("#"+e.settings.myFriends.resultsElementsId+u.no,"."+e.settings.myFriends.resultsClass).empty().append(r);if(typeof m.myFriends.options.drawRowCallback=="function"){m.myFriends.options.drawRowCallback.call(this,r)}};m.myFriends.showError=function(){return};var q=function(r){alert(""+r)};m.profilePanel={};m.profilePanel.options={};m.addAvatarTooltipEx=function(u,r,s){var v=((typeof s.data!="undefined")?s.data.sender.avatar:s.avatarId),x=((typeof s.data!="undefined")?s.data.sender.username:s.username);return m.addAvatarTooltip(u,r,v,x)};m.addAvatarTooltipEy=function(u,r,s){var v=((typeof s.data!="undefined")?s.data.reciever.avatar:s.avatarId),x=((typeof s.data!="undefined")?s.data.reciever.username:s.username);return m.addAvatarTooltip(u,r,v,x)};m.addAvatarTooltip=function(s,r,u,v){if(typeof u!="undefined"&&u!=""&&typeof s!="undefined"&&h(s).find(r).length>0&&!isNaN(parseFloat(u))){h(s).find(r).data("avatar_url",b.sprintf(b._settings.avatarImages.big_avatar,u));h(s).find(r).data("username",v||"username");h(s).dTooltip({eventHandler:r,displayDiv:"tlt-avatar",content:".tltcontent-avatar",hideWhenNoText:false,track:true,position:"left",autoOffset:{x:7,y:20},x:7,y:20,drawItemCallback:"drawBigAvatar",waitForImageLoaded:true,timeout:5000})}};m.profilePanel.render=function(v){switch(v.friendstatus){case"error":case"self":break;case"none":case"declined":case"deleted":var r=h(b.render(e.templates.profilePanel.holder,{acl:b.render(e.templates.profilePanel.actionnone,{})}));r.append(b.render(e.templates.profilePanel.msgBox,{message:b.sprintf(e.langStrings.profilePanel.confirmInvite,m.targetuser)}));r.find("a.friends_profilePanel_closelink").click(function(){return b.friends.profilePanel.hideMsg()});var u=r.find("a.friends_profilePanel_actionlink");h(u).data("canClick",true).data("username",m.targetuser).click(function(){if(h(u).data("canClick")==true){h(u).data("canClick",false)}else{return false}var y=this;m.friendInviteWithMail(h(u).data("username"),function(z,A){b.handlers.run("friends_changed",[{ommitPanel:true}],false);h(".friends_profilePanel_msgBox").show();h(r).find(".friends_profilePanel_header").remove();h(r).find(".friends_profilePanel_none").before(b.render(e.templates.profilePanel.acctionpending,{})).remove();h(s).find(".friends_profilePanel_header").remove();h(s).find(".friends_profilePanel_none").remove();h(".pendingButton").css("display","block");h(".inviteButton").css("display","none")});m.profilePanel.show();return false});var s=h(b.render(e.templates.profilePanel.holder,{acl:b.render(e.templates.profilePanel.actionnone,{})}));s.find("a.friends_profilePanel_actionlink").click(function(){if(h(u).data("canClick")==true){h(u).data("canClick",false)}else{return false}var y=this;m.friendInviteWithMail(h(u).data("username"),function(z,A){if(!A){b.handlers.run("friends_changed",[{ommitPanel:true}],false);h(".friends_profilePanel_msgBox").show();h(r).find(".friends_profilePanel_header").remove();h(r).find(".friends_profilePanel_none").before(b.render(e.templates.profilePanel.acctionpending,{})).remove();h(s).find(".friends_profilePanel_header").remove();h(s).find(".friends_profilePanel_none").remove();h(".pendingButton").css("display","block");h(".inviteButton").css("display","none")}else{h(u).data("canClick",true)}});return false});break;case"sent":case"received":var r=h(b.render(e.templates.profilePanel.holder,{acl:b.render(e.templates.profilePanel.acctionpending,{})}));break;case"accepted":h("#deleteFriendProfile").css("display","inline-block");var r=h(b.render(e.templates.profilePanel.holder,{acl:b.render(e.templates.profilePanel.actionaccepted,{})}));r.append(b.render(e.templates.profilePanel.msgBox,{message:b.sprintf(e.langStrings.profilePanel.confirmDelete,m.targetuser)}));r.find("a.friends_profilePanel_closelink").click(function(){return b.friends.profilePanel.hideMsg()});var x=function(){if(h(this).data("canClick")==true){h(this).data("canClick",false)}else{return false}if(h(this).data("titleIcon")==undefined){h(this).data("titleIcon","popup_friends")}var y=this;b.popup.show(b.render(b._templates.popup.content_simple,{header:b._langStrings.friends.enfriend_extrastep1,highlightclass:""}),{_ok:function(){b.popup.close();h(y).data("canClick",true)},_cancel:function(){h.profilar.friendDelete(h(y).data("username"),function(z,A){return b.reloadSite(window.top.location.href)});b.popup.show(b.render(b._templates.popup.content_doublelined,{header:b._langStrings.friends.endfriend_suceess,highlightclass:"popup_ok_highlight",info:b._langStrings.friends.indfriend_extrastep_desc}),function(){b.popup.close()},{title:b._langStrings.friends.popup_end_friendship,titleIcon:h(y).data("titleIcon"),close:true})}},{type:"confirm",title:b._langStrings.friends.popup_end_friendship,titleIcon:"",blueButtonText:b._langStrings.friends.endfriend_no,bottomLinkText:b._langStrings.friends.endfriend_yes,close:true,beforeCloseCallback:function(){h(y).data("canClick",true)},autoClose:false});return false};h("#deleteFriendProfile").data("canClick",true).data("username",m.targetuser).data("titleIcon","").click(x);r.find("a.friends_profilePanel_actionlink").data("canClick",true).data("username",m.targetuser).click(x);break}h(e.settings.profilePanel.targetElement).append(r);if(typeof m.profilePanel.options.afterRender=="function"){m.profilePanel.options.afterRender.call(this,r);m.profilePanel.options.afterRender.call(this,s)}};m.profilePanel.show=function(s,r){if(typeof r!="undefined"){h.extend(m.profilePanel.options,r)}h(".friends_profilePanel_holder").remove();m.targetuser=s||m.targetuser;if(typeof(m.targetuser)=="undefined"||m.targetuser==null){return false}if(h.profilar.forService().username!=""){h.profilar.friendCheck(m.targetuser,function(u,v){if(typeof m.profilePanel.options.beforeRender=="function"){m.profilePanel.options.beforeRender.call(this)}if(!v){m.profilePanel.render(u)}})}};m.profilePanel.hideMsg=function(){h(".friends_profilePanel_msgBox").hide();return false};m.sendSiteInvitation=function(z,y,u){if(z===undefined){return false}var s="";var v="";var x="";if(u!==undefined||u!=""){x=""+b.escapeHTML(u)+""}if(y===undefined||y==""){y=z}var r=e.settings.inviteSiteMinAge;if(h.profilar.get("age")>r){s=h.profilar.get("givenname")+" ("+h.profilar.forService().username+")"}if(s==""){s=h.profilar.forService().username}h.profilar.triggerEvent({cheetah_ebm:{aid:e.settings.inviteSiteMailAid,eid:e.settings.inviteSiteMailEventId},email:z,userName:false,emptyEmail:false,level:"channel",fields:[{name:"givenname",value:s},{name:"friendname",value:y},{name:"message",value:x},{name:"avatar_id",value:h.profilar.getPref("avatar")}]})};m.friendshipAcceptedEmail=function(x){if(x===undefined){return false}var u=h.profilar.forService().username;var v=e.settings.inviteSiteMinAge;var y=h.profilar.forService().username,s=h.profilar.get("givenname"),r=y;if(h.profilar.get("age")>v&&s!==undefined&&y!=s){r=b.sprintf("%1$s (%2$s)",s,y)}f([{username:[x]}],function(B){var z=x,A=B.users[0].givenname,C=z;if(A!==undefined&&A!=""){C=A}h.profilar.triggerEvent({cheetah_ebm:{aid:e.settings.inviteAcceptedMailAid,eid:e.settings.inviteAcceptedMailEventId},email:"",userName:x,emptyEmail:true,level:"channel",fields:[{name:"username",value:z},{name:"displayname",value:C},{name:"friend_username",value:y},{name:"friend_displayname",value:r},{name:"avatar_id",value:h.profilar.getPref("avatar")}]})},["givenname","age"],["avatar"],true)};m.updateFriendsCounter=function(s){var r=h.extend({full:".un_friendscounter",plain:".un_friendscounter_plain"},s);var u=r.full&&h(r.full).length>0,v=r.plain&&h(r.plain).length>0;if(u||v){h.profilar.friendListReceived(function(y,B){var x=parseInt(h("profilar friendlist total",y).text());if(x>0){var z="+"+x,A=""+x;if(u){h(r.full).text(z).show();if(e.settings.renderSettings.decorateFriendCounter){h(r.full).append('<span class="right">&nbsp;</span>')}}if(v){h(r.plain).text(A).show()}}else{if(u){h(r.full).text("").hide()}if(v){h(r.plain).text("0")}}},{pagenr:1,pagesize:1})}};m.init=function(s,r){r=r||{};b.getAndUpdateConfig("friends",e);e=h.extend(true,e,r);m.targetuser=s||m.targetuser||null};return m})(jQuery,SPI);(function(d){var b=false,c=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,e=function(j,f,h){h=h||j;for(var g in j){h[g]=typeof j[g]=="function"&&typeof f[g]=="function"&&c.test(j[g])?(function(l,m){return function(){var o=this._super,n;this._super=f[l];n=m.apply(this,arguments);this._super=o;return n}})(g,j[g]):j[g]}};jQuery.Class=function(){if(arguments.length){jQuery.Class.extend.apply(jQuery.Class,arguments)}};d.extend(d.Class,{callback:function(g){var h=jQuery.makeArray(arguments),f;g=h.shift();if(!jQuery.isArray(g)){g=[g]}f=this;return function j(){var p=h.concat(jQuery.makeArray(arguments)),l,n=g.length,o=0,m;for(;o<n;o++){m=g[o];if(!m){continue}l=typeof m=="string";if(l&&f._set_called){f.called=m}p=(l?f[m]:m).apply(f,p||[]);if(o<n-1){p=!jQuery.isArray(p)||p._use_call?[p]:p}}return p}},getObject:function(j,h){var h=h||window,g=j?j.split(/\./):[],f=0;for(;f<g.length;f++){h=h[g[f]]||(h[g[f]]={})}return h},newInstance:function(){var g=this.rawInstance(),f;if(g.setup){f=g.setup.apply(g,arguments)}if(g.init){g.init.apply(g,d.isArray(f)?f:arguments)}return g},setup:function(f,g){this.defaults=d.extend(true,{},f.defaults,this.defaults);return arguments},rawInstance:function(){b=true;var f=new this();b=false;return f},extend:function(h,p,m){if(typeof h!="string"){m=p;p=h;h=null}if(!m){m=p;p=null}m=m||{};var n=this,u=this.prototype,g,r,j,s;b=true;s=new this();b=false;e(m,u,s);function f(){if(b){return}if(this.constructor!==f&&arguments.length){return arguments.callee.extend.apply(arguments.callee,arguments)}else{return this.Class.newInstance.apply(this.Class,arguments)}}for(g in this){if(this.hasOwnProperty(g)&&d.inArray(g,["prototype","defaults","getObject"])==-1){f[g]=this[g]}}e(p,this,f);if(h){var l=h.split(/\./),r=l.pop(),o=d.Class.getObject(l.join(".")),j=o;o[r]=f}d.extend(f,{prototype:s,namespace:j,shortName:r,constructor:f,fullName:h});f.prototype.Class=f.prototype.constructor=f;var q=f.setup.apply(f,[n].concat(d.makeArray(arguments)));if(f.init){f.init.apply(f,q||[])}return f}});jQuery.Class.prototype.callback=jQuery.Class.callback})(jQuery);(function(d){var c={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowerUpper:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g},b=function(m,l,f){var l=l||window,j=m?m.split(/\./):[],g,h=0;for(;h<j.length-1&&l;h++){l=l[j[h]]}g=l[j[h]];if(f){delete l[j[h]]}return g};var e=(d.String={strip:function(f){return f.replace(/^\s+/,"").replace(/\s+$/,"")},capitalize:function(g,f){return g.charAt(0).toUpperCase()+g.substr(1)},endsWith:function(f,g){var h=f.length-g.length;return h>=0&&f.lastIndexOf(g)===h},camelize:function(g){var h=g.split(c.undHash),f=1;h[0]=h[0].charAt(0).toLowerCase()+h[0].substr(1);for(;f<h.length;f++){h[f]=e.capitalize(h[f])}return h.join("")},classize:function(g){var h=g.split(c.undHash),f=0;for(;f<h.length;f++){h[f]=e.capitalize(h[f])}return h.join("")},niceName:function(g){var h=g.split(c.undHash),f=0;for(;f<h.length;f++){h[f]=e.capitalize(h[f])}return h.join(" ")},underscore:function(f){return f.replace(c.colons,"/").replace(c.words,"$1_$2").replace(c.lowerUpper,"$1_$2").replace(c.dash,"_").toLowerCase()},sub:function(g,h,f){return g.replace(c.replacer,function(l,j){return b(j,h,f).toString()})}})})(jQuery);(function(c){var b=jQuery.cleanData;c.cleanData=function(d){for(var e=0,f;(f=d[e])!==undefined;e++){c(f).triggerHandler("destroyed")}b(d)}})(jQuery);(function(h){var m=function(u,v,y){var x;if(v.indexOf(">")===0){v=v.substr(1);x=function(z){if(z.target===u){y.apply(this,arguments)}else{z.handled=null}}}h(u).bind(v,x||y);return function(){h(u).unbind(v,x||y);u=v=y=x=null}},n=function(v,u,x,y){h(v).delegate(u,x,y);return function(){h(v).undelegate(u,x,y);v=x=y=u=null}},r=function(v,x,y,u){return u?n(v,u,x,y):m(v,x,y)},j=function j(u){return function(){return u.apply(null,[h(this)].concat(Array.prototype.slice.call(arguments,0)))}},g=/\./g,o=/_?controllers?/ig,e=function(u){return h.String.underscore(u.replace("jQuery.","").replace(g,"_").replace(o,""))},p=/[^\w]/,q=/^(>?default\.)|(>)/,d=/\{([^\}]+)\}/g,f=/^(?:(.*?)\s)?([\w\.\:>]+)$/,b;h.Class.extend("jQuery.Controller",{init:function(){if(!this.shortName||this.fullName=="jQuery.Controller"){return}this._fullName=e(this.fullName);this._shortName=e(this.shortName);var u=this,y=this.pluginName||this._fullName,v,x;if(!h.fn[y]){h.fn[y]=function(B){var A=h.makeArray(arguments),C=typeof B=="string"&&h.isFunction(u.prototype[B]),z=A[0];this.each(function(){var E=h.data(this,"controllers"),D=E&&E[y];if(D){if(C){D[z].apply(D,A.slice(1))}else{D.update.apply(D,A)}}else{u.newInstance.apply(u,[this].concat(A))}});return this}}this.actions={};for(v in this.prototype){if(!h.isFunction(this.prototype[v])){continue}if(this._isAction(v)){this.actions[v]=this._getAction(v)}}if(this.onDocument){x=new u(document.documentElement)}},hookup:function(u){return new this(u)},_isAction:function(u){if(p.test(u)){return true}else{var v=u.replace(q,"");return h.inArray(v,this.listensTo)>-1||h.event.special[v]||h.Controller.processors[v]}},_getAction:function(u,v){d.lastIndex=0;if(!v&&d.test(u)){return null}var x=v?h.String.sub(u,v):u,A=x.match(f),z=A[2],y=this.processors[z]||b;return{processor:y,parts:A}},processors:{},listensTo:[],defaults:{}},{setup:function(x,v){var A,z,u=this.Class;x=x.jquery?x[0]:x;this.element=h(x).addClass(u._fullName);(h.data(x,"controllers")||h.data(x,"controllers",{}))[u._fullName]=this;this._bindings=[];this.options=h.extend(h.extend(true,{},u.defaults),v);for(A in u.actions){z=u.actions[A]||u._getAction(A,this.options);this._bindings.push(z.processor(x,z.parts[2],z.parts[1],this.callback(A),this))}this.called="init";var y=j(this.callback("destroy"));this.element.bind("destroyed",y);this._bindings.push(function(B){y.removed=true;h(x).unbind("destroyed",y)});return this.element},bind:function(v,u,x){if(typeof v=="string"){x=u;u=v;v=this.element}return this._binder(v,u,x)},_binder:function(x,v,y,u){if(typeof y=="string"){y=j(this.callback(y))}this._bindings.push(r(x,v,y,u));return this._bindings.length},delegate:function(x,u,v,y){if(typeof x=="string"){y=v;v=u;u=x;x=this.element}return this._binder(x,v,y,u)},update:function(u){h.extend(this.options,u)},destroy:function(){if(this._destroyed){throw this.Class.shortName+" controller instance has been deleted"}var u=this,x=this.Class._fullName;this._destroyed=true;this.element.removeClass(x);h.each(this._bindings,function(y,z){if(h.isFunction(z)){z(u.element[0])}});delete this._actions;var v=this.element.data("controllers");if(v&&v[x]){delete v[x]}h(this).triggerHandler("destroyed");this.element=null},find:function(u){return this.element.find(u)},_set_called:true});b=function(y,z,v,u,x){var A=x.Class;if(A.onDocument&&!/^Main(Controller)?$/.test(A.shortName)){v=v?"#"+A._shortName+" "+v:"#"+A._shortName}return r(y,z,j(u),v)};var l=h.Controller.processors,c=function(x,y,v,u){return r(window,y.replace(/window/,""),j(u))};h.each("change click contextmenu dblclick keydown keyup keypress mousedown mousemove mouseout mouseover mouseup reset windowresize resize windowscroll scroll select submit dblclick focusin focusout load unload ready hashchange mouseenter mouseleave".split(" "),function(x,u){l[u]=b});h.each(["windowresize","windowscroll","load","ready","unload","hashchange"],function(x,u){l[u]=c});l.ready=function(x,y,v,u){h(j(u))};h.fn.mixin=function(){var u=h.makeArray(arguments),v;return this.each(function(){for(var x=0;x<u.length;x++){v=new u[x](this)}})};var s=function(u,x){for(var v=0;v<x.length;v++){if(typeof x[v]=="string"?u.Class._shortName==x[v]:u instanceof x[v]){return true}}return false};h.fn.controllers=function(){var x=h.makeArray(arguments),v=[],u;this.each(function(){u=h.data(this,"controllers");if(!u){return}for(var y in u){var z=u[y];if(!x.length||s(z,x)){v.push(z)}}});return v};h.fn.controller=function(u){return this.controllers.apply(this,arguments)[0]}})(jQuery);(function(){var c=$.String.underscore,g=$.String.classize,f=function(p,l,o,j,n,m){l=$.extend({},l);var h=$.String.sub(p,l,true);$.ajax({url:h,data:l,success:o,error:j,type:m||"post",dataType:"json",fixture:n})},e=function(){return"//"+$.String.underscore(this.fullName).replace(/\.models\..*/,"").replace(/\./g,"/")+"/fixtures/"+$.String.underscore(this.shortName)},d=function(h,j){h=h||{};if(h[this.id]){h["new"+$.String.capitalize(this.id)]=h[this.id];delete h[this.id]}h[this.id]=j;return h},b={create:function(h){return function(l,m,j){f(h,l,m,j,"-restCreate")}},update:function(h){return function(n,l,m,j){f(h,d.call(this,l,n),m,j,"-restUpdate")}},destroy:function(h){return function(n,m,l){var j={};j[this.id]=n;f(h,j,m,l,"-restDestroy")}},findAll:function(h){return function(m,l,j){f(h,m,this.callback(["wrapMany",l]),j,e.call(this)+"s.json","get")}},findOne:function(h){return function(m,l,j){f(h,m,this.callback(["wrap",l]),j,e.call(this)+".json","get")}}};jQuery.Class.extend("jQuery.Model",{setup:function(l,j,m){if(!this.attributes||l.attributes===this.attributes){this.attributes={}}if(!this.associations||l.associations===this.associations){this.associations={}}if(!this.validations||l.validations===this.validations){this.validations={}}if(l.convert!=this.convert){this.convert=$.extend(l.convert,this.convert)}this._fullName=c(this.fullName.replace(/\./g,"_"));if(this.fullName.substr(0,7)=="jQuery."){return}jQuery.Model.models[this._fullName]=this;if(this.listType){this.list=new this.listType([])}for(var h in b){if(typeof this[h]==="string"){this[h]=b[h](this[h])}}},attributes:{},defaults:{},wrap:function(h){if(!h){return null}return new this(h[this.singularName]||h.data||h.attributes||h)},wrapMany:function(n){if(!n){return null}var o=this.List||$.Model.List||Array,m=new o(),h=$.isArray(n),j=h?n:n.data,p=j.length,l=0;m._use_call=true;for(;l<p;l++){m.push(this.wrap(j[l]))}if(!h){for(var q in n){if(q!=="data"){m[q]=n[q]}}}return m},id:"id",addAttr:function(j,h){var l;if(this.associations[j]){return}l=this.attributes[j]||(this.attributes[j]=h);return h},models:{},publish:function(h,j){if(window.OpenAjax){OpenAjax.hub.publish(c(this.shortName)+"."+h,j)}},guessType:function(h){if(typeof h!="string"){if(h===null){return typeof h}if(h.constructor==Date){return"date"}if($.isArray(h)){return"array"}return typeof h}if(h===""){return"string"}if(h=="true"||h=="false"){return"boolean"}if(!isNaN(h)&&isFinite(+h)){return"number"}return typeof h},convert:{date:function(h){return typeof h==="string"?(isNaN(Date.parse(h))?null:Date.parse(h)):h},number:function(h){return parseFloat(h)},"boolean":function(h){return Boolean(h)}}},{setup:function(h){var j;this._initializing=true;j=this.Class.defaults&&this.attrs(this.Class.defaults);this.attrs(h);delete this._initializing},update:function(j,l,h){this.attrs(j);return this.save(l,h)},errors:function(l){if(l){l=$.isArray(l)?l:$.makeArray(arguments)}var n={},j=this,m=function(o,p){$.each(p,function(r,s){var q=s.call(j);if(q){if(!n.hasOwnProperty(o)){n[o]=[]}n[o].push(q)}})};$.each(l||this.Class.validations||{},function(o,p){if(typeof o=="number"){o=p;p=j.Class.validations[o]}m(o,p||[])});for(var h in n){if(n.hasOwnProperty(h)){return n}}return null},attr:function(m,n,o,j){var l=g(m),h="get"+l;if(n!==undefined){this._setProperty(m,n,o,j,l);return this}return this[h]?this[h]():this[m]},bind:function(j,l){var h=$(this);h.bind.apply(h,arguments);return this},unbind:function(j,l){var h=$(this);h.unbind.apply(h,arguments);return this},_setProperty:function(p,o,q,n,l){var m="set"+l,h=this[p],r=this,j=function(u){var s;s=n&&n.call(r,u);$(r).triggerHandler("error."+p,u)};if(this[m]&&(o=this[m](o,this.callback("_updateProperty",p,o,h,q,j),j))===undefined){return}this._updateProperty(p,o,h,q,j)},_updateProperty:function(s,r,l,u,o){var h=this.Class,j,p=h.attributes[s]||h.addAttr(s,h.guessType(r)),n=h.convert[p],q=null,m;j=this[s]=(r===null?null:(n?n.call(h,r):r));if(!this._initializing){q=this.errors(s)}if(q){o(q)}else{if(l!==j&&!this._initializing){$(this).triggerHandler(s,j)}m=u&&u(this)}if(s==h.id&&j!==null&&h.list){if(!l){h.list.push(this)}else{if(l!=j){h.list.remove(l);h.list.push(this)}}}},attrs:function(j){var l;if(!j){j={};for(l in this.Class.attributes){if(this.Class.attributes.hasOwnProperty(l)){j[l]=this.attr(l)}}}else{var h=this.Class.id;for(l in j){if(l!=h){this.attr(l,j[l])}}if(h in j){this.attr(h,j[h])}}return j},isNew:function(){var h=this[this.Class.id];return(h===undefined||h===null)},save:function(l,h){var j;if(this.errors()){return false}j=this.isNew()?this.Class.create(this.attrs(),this.callback(["created",l]),h):this.Class.update(this[this.Class.id],this.attrs(),this.callback(["updated",l]),h);return true},destroy:function(j,h){this.Class.destroy(this[this.Class.id],this.callback(["destroyed",j]),h)},identity:function(){var h=this[this.Class.id];return this.Class._fullName+"_"+(this.Class.escapeIdentity?encodeURIComponent(h):h)},elements:function(h){return $("."+this.identity(),h)},publish:function(h,j){this.Class.publish(h,j||this)},hookup:function(j){var h=c(this.Class.shortName),l=$.data(j,"models")||$.data(j,"models",{});$(j).addClass(h+" "+this.identity());l[h]=this}});$.each(["created","updated","destroyed"],function(h,j){$.Model.prototype[j]=function(l){var m;if(j==="destroyed"&&this.Class.list){this.Class.list.remove(this[this.Class.id])}$(this).triggerHandler(j);m=l&&typeof l=="object"&&this.attrs(l.attrs?l.attrs():l);this.publish(j,this);return[this].concat($.makeArray(arguments))}});$.fn.models=function(l){var n=[],j,h,m;this.each(function(){$.each($.data(this,"models")||{},function(p,o){j=j===undefined?o.Class.List||null:(o.Class.List===j?j:null);n.push(o)})});m=j||$.Model.List||Array;h=new m();h.push.apply(h,$.unique(n));return h};$.fn.model=function(h){if(h&&h instanceof $.Model){h.hookup(this[0]);return this}else{return this.models.apply(this,arguments)[0]}}})(jQuery);(function(d){var e=function(g,f){var h=f.Class.id;g[f[h]]=f},c=function(f){if(f[0]!==undefined&&f[0].length&&typeof f[0]!="string"){return f[0]}else{return d.makeArray(f)}};d.Class.extend("jQuery.Model.List",{init:function(f){this.length=0;this._data={};this.push.apply(this,d.makeArray(f||[]))},slice:function(){return new this.Class(Array.prototype.slice.apply(this,arguments))},match:function(g,f){return this.grep(function(h){return h[g]==f})},grep:function(g,f){return new this.Class(d.grep(this,g,f))},_makeData:function(){var f=this._data={};this.each(function(g,h){f[h[h.Class.id]]=h})},get:function(){if(!this.length){return new this.Class([])}if(this._changed){this._makeData()}var m=[],j=this[0].Class._fullName,f=this[0].Class.id,o=new RegExp(j+"_([^ ]+)"),l,n,g=c(arguments);for(var h=0;h<g.length;h++){if(g[h].nodeName&&(l=g[h].className.match(o))){n=this._data[l[1]]}else{n=this._data[typeof g[h]=="string"||typeof g[h]=="number"?g[h]:g[h][f]]}n&&m.push(n)}return new this.Class(m)},remove:function(p){if(!this.length){return[]}var n=[],m=this[0].Class._fullName,r=this[0].Class.id,o=new RegExp(m+"_([^ ]+)"),l,g;p=c(arguments);var h=0;while(h<this.length){var j=this[h],s=false;for(var q=0;q<p.length;q++){var f=(p[q].nodeName&&(l=p[q].className.match(o))&&l[1])||(typeof p[q]=="string"||typeof p[q]=="number"?p[q]:p[q][r]);if(j[r]==f){n.push.apply(n,this.splice(h,1));p.splice(q,1);s=true;break}}if(!s){h++}}return new this.Class(n)},publish:function(f,g){OpenAjax.hub.publish(this.Class.shortName+"."+f,g)},elements:function(f){var g=d();this.each(function(){g.add("."+this.identity(),f)});return g}});var b={push:[].push,pop:[].pop,shift:[].shift,unshift:[].unshift,splice:[].splice,sort:[].sort};d.each(b,function(f,g){d.Model.List.prototype[f]=function(){this._changed=true;return g.apply(this,arguments)}});d.each(["each","map"],function(g,f){d.Model.List.prototype[f]=function(j,h){return d[f](this,j,h)}})})(jQuery);(function(l){var e=function(r){return r.replace(/^\/\//,"").replace(/[\/\.]/g,"_")},c=1;var n,d,g,f;n=l.View=function(A,x,u,B){var C=A.match(/\.[\w\d]+$/),z,v,s,y,r=A;if(typeof u==="function"){B=u;u=undefined}if(!C){C=l.View.ext;r=r+l.View.ext}s=e(r);if(r.match(/^\/\//)){r=steal.root.join(r.substr(2))}z=l.View.types[C];y=l.View.cached[s]?l.View.cached[s]:((v=document.getElementById(A))?z.renderer(s,v.innerHTML):f(z,s,r,x,u,B));return y&&d(y,z,s,x,u,B)};d=function(x,s,A,v,u,z){var r,y;if(l.View.cache){l.View.cached[A]=x}r=x.call(s,v,u);y=z&&z(r);return r};g=function(s,r){if(!s.match(/[^\s]/)){throw"$.View ERROR: There is no template or an empty template at "+r}};f=function(s,z,r,v,u,y){if(y){l.ajax({url:r,dataType:"text",error:function(){g("",r)},success:function(A){g(A,r);d(s.renderer(z,A),s,z,v,u,y)}})}else{var x=l.ajax({async:false,url:r,dataType:"text",error:function(){g("",r)}}).responseText;g(x,r);return s.renderer(z,x)}};l.extend(l.View,{hookups:{},hookup:function(r){var s=++c;n.hookups[s]=r;return s},cached:{},cache:true,register:function(r){this.types["."+r.suffix]=r},types:{},ext:".ejs",registerScript:function(r,u,s){return"$.View.preload('"+u+"',"+l.View.types["."+r].script(u,s)+");"},preload:function(s,r){l.View.cached[s]=function(v,u){return r.call(v,v,u)}}});var o,p,m,h,q,b;o=function(s){var r=l.fn[s];l.fn[s]=function(){var v=l.makeArray(arguments),y,x,u=this;if(m(v)){if((y=h(v))){x=v[y];v[y]=function(z){p.call(u,[z],r);x.call(u,z)};l.View.apply(l.View,v);return this}v=[l.View.apply(l.View,v)]}return p.call(this,v,r)}};p=function(v,u){var x,y,s;for(var r in jQuery.View.hookups){break}if(r){s=l.View.hookups;l.View.hookups={};v[0]=l(v[0])}x=u.apply(this,v);if(r){q(v[0],s)}return x};m=function(r){var s=typeof r[1];return typeof r[0]=="string"&&(s=="object"||s=="function")&&!r[1].nodeType&&!r[1].jquery};h=function(r){return typeof r[3]==="function"?3:typeof r[2]==="function"&&2};q=function(v,s){var z,r,u=0,y,x;v=v.filter(function(){return this.nodeType!=3});z=v.add("[data-view-id]",v);r=z.length;for(;u<r;u++){if(z[u].getAttribute&&(y=z[u].getAttribute("data-view-id"))&&(x=s[y])){x(z[u],y);delete s[y];z[u].removeAttribute("data-view-id")}}l.extend(l.View.hookups,s)};b=["prepend","append","after","before","replace","text","html","replaceWith"];for(var j=0;j<b.length;j++){o(b[j])}})(jQuery);(function(d){var b=false,c=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,e=function(j,f,h){h=h||j;for(var g in j){h[g]=typeof j[g]=="function"&&typeof f[g]=="function"&&c.test(j[g])?(function(l,m){return function(){var o=this._super,n;this._super=f[l];n=m.apply(this,arguments);this._super=o;return n}})(g,j[g]):j[g]}};jQuery.Class=function(){if(arguments.length){jQuery.Class.extend.apply(jQuery.Class,arguments)}};d.extend(d.Class,{callback:function(g){var h=jQuery.makeArray(arguments),f;g=h.shift();if(!jQuery.isArray(g)){g=[g]}f=this;return function j(){var p=h.concat(jQuery.makeArray(arguments)),l,n=g.length,o=0,m;for(;o<n;o++){m=g[o];if(!m){continue}l=typeof m=="string";if(l&&f._set_called){f.called=m}p=(l?f[m]:m).apply(f,p||[]);if(o<n-1){p=!jQuery.isArray(p)||p._use_call?[p]:p}}return p}},getObject:function(j,h){var h=h||window,g=j?j.split(/\./):[],f=0;for(;f<g.length;f++){h=h[g[f]]||(h[g[f]]={})}return h},newInstance:function(){var g=this.rawInstance(),f;if(g.setup){f=g.setup.apply(g,arguments)}if(g.init){g.init.apply(g,d.isArray(f)?f:arguments)}return g},setup:function(f,g){this.defaults=d.extend(true,{},f.defaults,this.defaults);return arguments},rawInstance:function(){b=true;var f=new this();b=false;return f},extend:function(h,p,m){if(typeof h!="string"){m=p;p=h;h=null}if(!m){m=p;p=null}m=m||{};var n=this,u=this.prototype,g,r,j,s;b=true;s=new this();b=false;e(m,u,s);function f(){if(b){return}if(this.constructor!==f&&arguments.length){return arguments.callee.extend.apply(arguments.callee,arguments)}else{return this.Class.newInstance.apply(this.Class,arguments)}}for(g in this){if(this.hasOwnProperty(g)&&d.inArray(g,["prototype","defaults","getObject"])==-1){f[g]=this[g]}}e(p,this,f);if(h){var l=h.split(/\./),r=l.pop(),o=d.Class.getObject(l.join(".")),j=o;o[r]=f}d.extend(f,{prototype:s,namespace:j,shortName:r,constructor:f,fullName:h});f.prototype.Class=f.prototype.constructor=f;var q=f.setup.apply(f,[n].concat(d.makeArray(arguments)));if(f.init){f.init.apply(f,q||[])}return f}});jQuery.Class.prototype.callback=jQuery.Class.callback})(jQuery);(function(h){var m=function(u,v,y){var x;if(v.indexOf(">")===0){v=v.substr(1);x=function(z){if(z.target===u){y.apply(this,arguments)}else{z.handled=null}}}h(u).bind(v,x||y);return function(){h(u).unbind(v,x||y);u=v=y=x=null}},n=function(v,u,x,y){h(v).delegate(u,x,y);return function(){h(v).undelegate(u,x,y);v=x=y=u=null}},r=function(v,x,y,u){return u?n(v,u,x,y):m(v,x,y)},j=function j(u){return function(){return u.apply(null,[h(this)].concat(Array.prototype.slice.call(arguments,0)))}},g=/\./g,o=/_?controllers?/ig,e=function(u){return h.String.underscore(u.replace("jQuery.","").replace(g,"_").replace(o,""))},p=/[^\w]/,q=/^(>?default\.)|(>)/,d=/\{([^\}]+)\}/g,f=/^(?:(.*?)\s)?([\w\.\:>]+)$/,b;h.Class.extend("jQuery.Controller",{init:function(){if(!this.shortName||this.fullName=="jQuery.Controller"){return}this._fullName=e(this.fullName);this._shortName=e(this.shortName);var u=this,y=this.pluginName||this._fullName,v,x;if(!h.fn[y]){h.fn[y]=function(B){var A=h.makeArray(arguments),C=typeof B=="string"&&h.isFunction(u.prototype[B]),z=A[0];this.each(function(){var E=h.data(this,"controllers"),D=E&&E[y];if(D){if(C){D[z].apply(D,A.slice(1))}else{D.update.apply(D,A)}}else{u.newInstance.apply(u,[this].concat(A))}});return this}}this.actions={};for(v in this.prototype){if(!h.isFunction(this.prototype[v])){continue}if(this._isAction(v)){this.actions[v]=this._getAction(v)}}if(this.onDocument){x=new u(document.documentElement)}},hookup:function(u){return new this(u)},_isAction:function(u){if(p.test(u)){return true}else{var v=u.replace(q,"");return h.inArray(v,this.listensTo)>-1||h.event.special[v]||h.Controller.processors[v]}},_getAction:function(u,v){d.lastIndex=0;if(!v&&d.test(u)){return null}var x=v?h.String.sub(u,v):u,A=x.match(f),z=A[2],y=this.processors[z]||b;return{processor:y,parts:A}},processors:{},listensTo:[],defaults:{}},{setup:function(x,v){var A,z,u=this.Class;x=x.jquery?x[0]:x;this.element=h(x).addClass(u._fullName);(h.data(x,"controllers")||h.data(x,"controllers",{}))[u._fullName]=this;this._bindings=[];this.options=h.extend(h.extend(true,{},u.defaults),v);for(A in u.actions){z=u.actions[A]||u._getAction(A,this.options);this._bindings.push(z.processor(x,z.parts[2],z.parts[1],this.callback(A),this))}this.called="init";var y=j(this.callback("destroy"));this.element.bind("destroyed",y);this._bindings.push(function(B){y.removed=true;h(x).unbind("destroyed",y)});return this.element},bind:function(v,u,x){if(typeof v=="string"){x=u;u=v;v=this.element}return this._binder(v,u,x)},_binder:function(x,v,y,u){if(typeof y=="string"){y=j(this.callback(y))}this._bindings.push(r(x,v,y,u));return this._bindings.length},delegate:function(x,u,v,y){if(typeof x=="string"){y=v;v=u;u=x;x=this.element}return this._binder(x,v,y,u)},update:function(u){h.extend(this.options,u)},destroy:function(){if(this._destroyed){throw this.Class.shortName+" controller instance has been deleted"}var u=this,x=this.Class._fullName;this._destroyed=true;this.element.removeClass(x);h.each(this._bindings,function(y,z){if(h.isFunction(z)){z(u.element[0])}});delete this._actions;var v=this.element.data("controllers");if(v&&v[x]){delete v[x]}h(this).triggerHandler("destroyed");this.element=null},find:function(u){return this.element.find(u)},_set_called:true});b=function(y,z,v,u,x){var A=x.Class;if(A.onDocument&&!/^Main(Controller)?$/.test(A.shortName)){v=v?"#"+A._shortName+" "+v:"#"+A._shortName}return r(y,z,j(u),v)};var l=h.Controller.processors,c=function(x,y,v,u){return r(window,y.replace(/window/,""),j(u))};h.each("change click contextmenu dblclick keydown keyup keypress mousedown mousemove mouseout mouseover mouseup reset windowresize resize windowscroll scroll select submit dblclick focusin focusout load unload ready hashchange mouseenter mouseleave".split(" "),function(x,u){l[u]=b});h.each(["windowresize","windowscroll","load","ready","unload","hashchange"],function(x,u){l[u]=c});l.ready=function(x,y,v,u){h(j(u))};h.fn.mixin=function(){var u=h.makeArray(arguments),v;return this.each(function(){for(var x=0;x<u.length;x++){v=new u[x](this)}})};var s=function(u,x){for(var v=0;v<x.length;v++){if(typeof x[v]=="string"?u.Class._shortName==x[v]:u instanceof x[v]){return true}}return false};h.fn.controllers=function(){var x=h.makeArray(arguments),v=[],u;this.each(function(){u=h.data(this,"controllers");if(!u){return}for(var y in u){var z=u[y];if(!x.length||s(z,x)){v.push(z)}}});return v};h.fn.controller=function(u){return this.controllers.apply(this,arguments)[0]}})(jQuery);(function(c){var b=jQuery.cleanData;c.cleanData=function(d){for(var e=0,f;(f=d[e])!==undefined;e++){c(f).triggerHandler("destroyed")}b(d)}})(jQuery);(function(d){var c={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowerUpper:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g},b=function(m,l,f){var l=l||window,j=m?m.split(/\./):[],g,h=0;for(;h<j.length-1&&l;h++){l=l[j[h]]}g=l[j[h]];if(f){delete l[j[h]]}return g};var e=(d.String={strip:function(f){return f.replace(/^\s+/,"").replace(/\s+$/,"")},capitalize:function(g,f){return g.charAt(0).toUpperCase()+g.substr(1)},endsWith:function(f,g){var h=f.length-g.length;return h>=0&&f.lastIndexOf(g)===h},camelize:function(g){var h=g.split(c.undHash),f=1;h[0]=h[0].charAt(0).toLowerCase()+h[0].substr(1);for(;f<h.length;f++){h[f]=e.capitalize(h[f])}return h.join("")},classize:function(g){var h=g.split(c.undHash),f=0;for(;f<h.length;f++){h[f]=e.capitalize(h[f])}return h.join("")},niceName:function(g){var h=g.split(c.undHash),f=0;for(;f<h.length;f++){h[f]=e.capitalize(h[f])}return h.join(" ")},underscore:function(f){return f.replace(c.colons,"/").replace(c.words,"$1_$2").replace(c.lowerUpper,"$1_$2").replace(c.dash,"_").toLowerCase()},sub:function(g,h,f){return g.replace(c.replacer,function(l,j){return b(j,h,f).toString()})}})})(jQuery);(function(b){b.String.rsplit=function(d,g){var c=g.exec(d),h=[],f,e;while(c!==null){f=c.index;e=g.lastIndex;if(f!==0){h.push(d.substring(0,f));d=d.slice(f)}h.push(c[0]);d=d.slice(c[0].length);c=g.exec(d)}if(d!==""){h.push(d)}return h}})(jQuery);(function(){var c=$.String.underscore,g=$.String.classize,f=function(p,l,o,j,n,m){l=$.extend({},l);var h=$.String.sub(p,l,true);$.ajax({url:h,data:l,success:o,error:j,type:m||"post",dataType:"json",fixture:n})},e=function(){return"//"+$.String.underscore(this.fullName).replace(/\.models\..*/,"").replace(/\./g,"/")+"/fixtures/"+$.String.underscore(this.shortName)},d=function(h,j){h=h||{};if(h[this.id]){h["new"+$.String.capitalize(this.id)]=h[this.id];delete h[this.id]}h[this.id]=j;return h},b={create:function(h){return function(l,m,j){f(h,l,m,j,"-restCreate")}},update:function(h){return function(n,l,m,j){f(h,d.call(this,l,n),m,j,"-restUpdate")}},destroy:function(h){return function(n,m,l){var j={};j[this.id]=n;f(h,j,m,l,"-restDestroy")}},findAll:function(h){return function(m,l,j){f(h,m,this.callback(["wrapMany",l]),j,e.call(this)+"s.json","get")}},findOne:function(h){return function(m,l,j){f(h,m,this.callback(["wrap",l]),j,e.call(this)+".json","get")}}};jQuery.Class.extend("jQuery.Model",{setup:function(l,j,m){if(!this.attributes||l.attributes===this.attributes){this.attributes={}}if(!this.associations||l.associations===this.associations){this.associations={}}if(!this.validations||l.validations===this.validations){this.validations={}}if(l.convert!=this.convert){this.convert=$.extend(l.convert,this.convert)}this._fullName=c(this.fullName.replace(/\./g,"_"));if(this.fullName.substr(0,7)=="jQuery."){return}jQuery.Model.models[this._fullName]=this;if(this.listType){this.list=new this.listType([])}for(var h in b){if(typeof this[h]==="string"){this[h]=b[h](this[h])}}},attributes:{},defaults:{},wrap:function(h){if(!h){return null}return new this(h[this.singularName]||h.data||h.attributes||h)},wrapMany:function(n){if(!n){return null}var o=this.List||$.Model.List||Array,m=new o(),h=$.isArray(n),j=h?n:n.data,p=j.length,l=0;m._use_call=true;for(;l<p;l++){m.push(this.wrap(j[l]))}if(!h){for(var q in n){if(q!=="data"){m[q]=n[q]}}}return m},id:"id",addAttr:function(j,h){var l;if(this.associations[j]){return}l=this.attributes[j]||(this.attributes[j]=h);return h},models:{},publish:function(h,j){if(window.OpenAjax){OpenAjax.hub.publish(c(this.shortName)+"."+h,j)}},guessType:function(h){if(typeof h!="string"){if(h===null){return typeof h}if(h.constructor==Date){return"date"}if($.isArray(h)){return"array"}return typeof h}if(h===""){return"string"}if(h=="true"||h=="false"){return"boolean"}if(!isNaN(h)&&isFinite(+h)){return"number"}return typeof h},convert:{date:function(h){return typeof h==="string"?(isNaN(Date.parse(h))?null:Date.parse(h)):h},number:function(h){return parseFloat(h)},"boolean":function(h){return Boolean(h)}}},{setup:function(h){var j;this._initializing=true;j=this.Class.defaults&&this.attrs(this.Class.defaults);this.attrs(h);delete this._initializing},update:function(j,l,h){this.attrs(j);return this.save(l,h)},errors:function(l){if(l){l=$.isArray(l)?l:$.makeArray(arguments)}var n={},j=this,m=function(o,p){$.each(p,function(r,s){var q=s.call(j);if(q){if(!n.hasOwnProperty(o)){n[o]=[]}n[o].push(q)}})};$.each(l||this.Class.validations||{},function(o,p){if(typeof o=="number"){o=p;p=j.Class.validations[o]}m(o,p||[])});for(var h in n){if(n.hasOwnProperty(h)){return n}}return null},attr:function(m,n,o,j){var l=g(m),h="get"+l;if(n!==undefined){this._setProperty(m,n,o,j,l);return this}return this[h]?this[h]():this[m]},bind:function(j,l){var h=$(this);h.bind.apply(h,arguments);return this},unbind:function(j,l){var h=$(this);h.unbind.apply(h,arguments);return this},_setProperty:function(p,o,q,n,l){var m="set"+l,h=this[p],r=this,j=function(u){var s;s=n&&n.call(r,u);$(r).triggerHandler("error."+p,u)};if(this[m]&&(o=this[m](o,this.callback("_updateProperty",p,o,h,q,j),j))===undefined){return}this._updateProperty(p,o,h,q,j)},_updateProperty:function(s,r,l,u,o){var h=this.Class,j,p=h.attributes[s]||h.addAttr(s,h.guessType(r)),n=h.convert[p],q=null,m;j=this[s]=(r===null?null:(n?n.call(h,r):r));if(!this._initializing){q=this.errors(s)}if(q){o(q)}else{if(l!==j&&!this._initializing){$(this).triggerHandler(s,j)}m=u&&u(this)}if(s==h.id&&j!==null&&h.list){if(!l){h.list.push(this)}else{if(l!=j){h.list.remove(l);h.list.push(this)}}}},attrs:function(j){var l;if(!j){j={};for(l in this.Class.attributes){if(this.Class.attributes.hasOwnProperty(l)){j[l]=this.attr(l)}}}else{var h=this.Class.id;for(l in j){if(l!=h){this.attr(l,j[l])}}if(h in j){this.attr(h,j[h])}}return j},isNew:function(){var h=this[this.Class.id];return(h===undefined||h===null)},save:function(l,h){var j;if(this.errors()){return false}j=this.isNew()?this.Class.create(this.attrs(),this.callback(["created",l]),h):this.Class.update(this[this.Class.id],this.attrs(),this.callback(["updated",l]),h);return true},destroy:function(j,h){this.Class.destroy(this[this.Class.id],this.callback(["destroyed",j]),h)},identity:function(){var h=this[this.Class.id];return this.Class._fullName+"_"+(this.Class.escapeIdentity?encodeURIComponent(h):h)},elements:function(h){return $("."+this.identity(),h)},publish:function(h,j){this.Class.publish(h,j||this)},hookup:function(j){var h=c(this.Class.shortName),l=$.data(j,"models")||$.data(j,"models",{});$(j).addClass(h+" "+this.identity());l[h]=this}});$.each(["created","updated","destroyed"],function(h,j){$.Model.prototype[j]=function(l){var m;if(j==="destroyed"&&this.Class.list){this.Class.list.remove(this[this.Class.id])}$(this).triggerHandler(j);m=l&&typeof l=="object"&&this.attrs(l.attrs?l.attrs():l);this.publish(j,this);return[this].concat($.makeArray(arguments))}});$.fn.models=function(l){var n=[],j,h,m;this.each(function(){$.each($.data(this,"models")||{},function(p,o){j=j===undefined?o.Class.List||null:(o.Class.List===j?j:null);n.push(o)})});m=j||$.Model.List||Array;h=new m();h.push.apply(h,$.unique(n));return h};$.fn.model=function(h){if(h&&h instanceof $.Model){h.hookup(this[0]);return this}else{return this.models.apply(this,arguments)[0]}}})(jQuery);(function(d){var e=function(g,f){var h=f.Class.id;g[f[h]]=f},c=function(f){if(f[0]!==undefined&&f[0].length&&typeof f[0]!="string"){return f[0]}else{return d.makeArray(f)}};d.Class.extend("jQuery.Model.List",{init:function(f){this.length=0;this._data={};this.push.apply(this,d.makeArray(f||[]))},slice:function(){return new this.Class(Array.prototype.slice.apply(this,arguments))},match:function(g,f){return this.grep(function(h){return h[g]==f})},grep:function(g,f){return new this.Class(d.grep(this,g,f))},_makeData:function(){var f=this._data={};this.each(function(g,h){f[h[h.Class.id]]=h})},get:function(){if(!this.length){return new this.Class([])}if(this._changed){this._makeData()}var m=[],j=this[0].Class._fullName,f=this[0].Class.id,o=new RegExp(j+"_([^ ]+)"),l,n,g=c(arguments);for(var h=0;h<g.length;h++){if(g[h].nodeName&&(l=g[h].className.match(o))){n=this._data[l[1]]}else{n=this._data[typeof g[h]=="string"||typeof g[h]=="number"?g[h]:g[h][f]]}n&&m.push(n)}return new this.Class(m)},remove:function(p){if(!this.length){return[]}var n=[],m=this[0].Class._fullName,r=this[0].Class.id,o=new RegExp(m+"_([^ ]+)"),l,g;p=c(arguments);var h=0;while(h<this.length){var j=this[h],s=false;for(var q=0;q<p.length;q++){var f=(p[q].nodeName&&(l=p[q].className.match(o))&&l[1])||(typeof p[q]=="string"||typeof p[q]=="number"?p[q]:p[q][r]);if(j[r]==f){n.push.apply(n,this.splice(h,1));p.splice(q,1);s=true;break}}if(!s){h++}}return new this.Class(n)},publish:function(f,g){OpenAjax.hub.publish(this.Class.shortName+"."+f,g)},elements:function(f){var g=d();this.each(function(){g.add("."+this.identity(),f)});return g}});var b={push:[].push,pop:[].pop,shift:[].shift,unshift:[].unshift,splice:[].splice,sort:[].sort};d.each(b,function(f,g){d.Model.List.prototype[f]=function(){this._changed=true;return g.apply(this,arguments)}});d.each(["each","map"],function(g,f){d.Model.List.prototype[f]=function(j,h){return d[f](this,j,h)}})})(jQuery);(function(l){var e=function(r){return r.replace(/^\/\//,"").replace(/[\/\.]/g,"_")},c=1;var n,d,g,f;n=l.View=function(A,x,u,B){var C=A.match(/\.[\w\d]+$/),z,v,s,y,r=A;if(typeof u==="function"){B=u;u=undefined}if(!C){C=l.View.ext;r=r+l.View.ext}s=e(r);if(r.match(/^\/\//)){r=steal.root.join(r.substr(2))}z=l.View.types[C];y=l.View.cached[s]?l.View.cached[s]:((v=document.getElementById(A))?z.renderer(s,v.innerHTML):f(z,s,r,x,u,B));return y&&d(y,z,s,x,u,B)};d=function(x,s,A,v,u,z){var r,y;if(l.View.cache){l.View.cached[A]=x}r=x.call(s,v,u);y=z&&z(r);return r};g=function(s,r){if(!s.match(/[^\s]/)){throw"$.View ERROR: There is no template or an empty template at "+r}};f=function(s,z,r,v,u,y){if(y){l.ajax({url:r,dataType:"text",error:function(){g("",r)},success:function(A){g(A,r);d(s.renderer(z,A),s,z,v,u,y)}})}else{var x=l.ajax({async:false,url:r,dataType:"text",error:function(){g("",r)}}).responseText;g(x,r);return s.renderer(z,x)}};l.extend(l.View,{hookups:{},hookup:function(r){var s=++c;n.hookups[s]=r;return s},cached:{},cache:true,register:function(r){this.types["."+r.suffix]=r},types:{},ext:".ejs",registerScript:function(r,u,s){return"$.View.preload('"+u+"',"+l.View.types["."+r].script(u,s)+");"},preload:function(s,r){l.View.cached[s]=function(v,u){return r.call(v,v,u)}}});var o,p,m,h,q,b;o=function(s){var r=l.fn[s];l.fn[s]=function(){var v=l.makeArray(arguments),y,x,u=this;if(m(v)){if((y=h(v))){x=v[y];v[y]=function(z){p.call(u,[z],r);x.call(u,z)};l.View.apply(l.View,v);return this}v=[l.View.apply(l.View,v)]}return p.call(this,v,r)}};p=function(v,u){var x,y,s;for(var r in jQuery.View.hookups){break}if(r){s=l.View.hookups;l.View.hookups={};v[0]=l(v[0])}x=u.apply(this,v);if(r){q(v[0],s)}return x};m=function(r){var s=typeof r[1];return typeof r[0]=="string"&&(s=="object"||s=="function")&&!r[1].nodeType&&!r[1].jquery};h=function(r){return typeof r[3]==="function"?3:typeof r[2]==="function"&&2};q=function(v,s){var z,r,u=0,y,x;v=v.filter(function(){return this.nodeType!=3});z=v.add("[data-view-id]",v);r=z.length;for(;u<r;u++){if(z[u].getAttribute&&(y=z[u].getAttribute("data-view-id"))&&(x=s[y])){x(z[u],y);delete s[y];z[u].removeAttribute("data-view-id")}}l.extend(l.View.hookups,s)};b=["prepend","append","after","before","replace","text","html","replaceWith"];for(var j=0;j<b.length;j++){o(b[j])}})(jQuery);(function($){var myEval=function(script){eval(script)};var chop=function(string){return string.substr(0,string.length-1)},extend=$.extend,isArray=$.isArray,EJS=function(options){if(this.constructor!=EJS){var ejs=new EJS(options);return function(data,helpers){return ejs.render(data,helpers)}}if(typeof options=="function"){this.template={};this.template.process=options;return}$.extend(this,EJS.options,options);var template=new EJS.Compiler(this.text,this.type);template.compile(options,this.name);this.template=template},defaultSplitter=/(\[%%)|(%%\])|(\[%=)|(\[%#)|(\[%)|(%\]\n)|(%\])|(\n)/;$.EJS=EJS;EJS.prototype={constructor:EJS,render:function(object,extraHelpers){object=object||{};this._extra_helpers=extraHelpers;var v=new EJS.Helpers(object,extraHelpers||{});return this.template.process.call(object,object,v)},out:function(){return this.template.out}};EJS.text=function(input){if(typeof input=="string"){return input}var myid;if(input===null||input===undefined){return""}if(input instanceof Date){return input.toDateString()}if(input.hookup){myid=$.View.hookup(function(el,id){input.hookup.call(input,el,id)});return"data-view-id='"+myid+"'"}if(typeof input=="function"){return"data-view-id='"+$.View.hookup(input)+"'"}if(isArray(input)){myid=$.View.hookup(function(el,id){for(var i=0;i<input.length;i++){var stub;stub=input[i].hookup?input[i].hookup(el,id):input[i](el,id)}});return"data-view-id='"+myid+"'"}if(input.nodeName||input.jQuery){throw"elements in views are not supported"}if(input.toString){return myid?input.toString(myid):input.toString()}return""};EJS.Scanner=function(source,left,right){extend(this,{leftDelimiter:left+"%",rightDelimiter:"%"+right,doubleLeft:left+"%%",doubleRight:"%%"+right,leftEqual:left+"%=",leftComment:left+"%#"});this.splitRegexp=(left=="["?defaultSplitter:new RegExp("("+[this.doubleLeft,this.doubleRight,this.leftEqual,this.leftComment,this.leftDelimiter,this.rightDelimiter+"\n",this.rightDelimiter,"\n"].join(")|(")+")"));this.source=source;this.lines=0};EJS.Scanner.prototype={scan:function(block){var regex=this.splitRegexp;if(this.source){var source_split=$.String.rsplit(this.source,/\n/);for(var i=0;i<source_split.length;i++){var item=source_split[i];this.scanline(item,regex,block)}}},scanline:function(line,regex,block){this.lines++;var line_split=$.String.rsplit(line,regex),token;for(var i=0;i<line_split.length;i++){token=line_split[i];if(token!==null){try{block(token,this)}catch(e){throw {type:"jQuery.EJS.Scanner",line:this.lines}}}}}};EJS.Buffer=function(pre_cmd,post_cmd){this.line=[];this.script=[];this.post_cmd=post_cmd;this.push.apply(this,pre_cmd)};EJS.Buffer.prototype={push:function(){this.line.push.apply(this.line,arguments)},cr:function(){this.script.push(this.line.join(""),"\n");this.line=[]},close:function(){var stub;if(this.line.length>0){this.script.push(this.line.join(""));this.line=[]}stub=this.post_cmd.length&&this.push.apply(this,this.post_cmd);this.script.push(";");return this.script.join("")}};EJS.Compiler=function(source,left){this.source=source.replace(/\r\n/g,"\n").replace(/\r/g,"\n");left=left||"<";var right=">";switch(left){case"[":right="]";break;case"<":break;default:throw left+" is not a supported deliminator"}this.scanner=new EJS.Scanner(this.source,left,right);this.out=""};EJS.Compiler.prototype={compile:function(options,name){options=options||{};this.out="";var put_cmd="___v1ew.push(",insert_cmd=put_cmd,buff=new EJS.Buffer(["var ___v1ew = [];"],[]),content="",clean=function(content){return content.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/"/g,'\\"')},put=function(content){buff.push(put_cmd,'"',clean(content),'");')},startTag=null;this.scanner.scan(function(token,scanner){if(startTag===null){switch(token){case"\n":content=content+"\n";put(content);buff.cr();content="";break;case scanner.leftDelimiter:case scanner.leftEqual:case scanner.leftComment:startTag=token;if(content.length>0){put(content)}content="";break;case scanner.doubleLeft:content=content+scanner.leftDelimiter;break;default:content=content+token;break}}else{switch(token){case scanner.rightDelimiter:switch(startTag){case scanner.leftDelimiter:if(content[content.length-1]=="\n"){content=chop(content);buff.push(content,";");buff.cr()}else{buff.push(content,";")}break;case scanner.leftEqual:buff.push(insert_cmd,"(jQuery.EJS.text(",content,")));");break}startTag=null;content="";break;case scanner.doubleRight:content=content+scanner.rightDelimiter;break;default:content=content+token;break}}});if(content.length>0){buff.push(put_cmd,'"',clean(content)+'");')}var template=buff.close();this.out="try { with(_VIEW) { with (_CONTEXT) {"+template+" return ___v1ew.join('');}}}catch(e){e.lineNumber=null;throw e;}";myEval.call(this,"this.process = (function(_CONTEXT,_VIEW){"+this.out+"});")}};EJS.options={cache:true,type:"<",ext:".ejs"};EJS.Helpers=function(data,extras){this._data=data;this._extras=extras;extend(this,extras)};EJS.Helpers.prototype={plugin:function(name){var args=$.makeArray(arguments),widget=args.shift();return function(el){var jq=$(el);jq[widget].apply(jq,args)}},view:function(url,data,helpers){helpers=helpers||this._extras;data=data||this._data;return $.View(url,data,helpers)}};$.View.register({suffix:"ejs",script:function(id,src){return"jQuery.EJS(function(_CONTEXT,_VIEW) { "+new EJS({text:src}).out()+" })"},renderer:function(id,text){var ejs=new EJS({text:text,name:id});return function(data,helpers){return ejs.render.call(ejs,data,helpers)}}})})(jQuery);(function(){var f={outputtype:"json",channel:SPI._settings.global.channel_id,siteid:SPI._settings.global.site_id,itemtype:1,itemid:0,pagesize:0,pagenr:1},c={awards:{awardicon_url:"/hs/pb/1/awardicon/",awardlist:"/hs/pb/1/awards/{channel}/{siteid}/{itemtype}/{itemid}"},highscores:{highscorelist:"/hs/pb/1/list/{siteid}/{itemtype}/{itemid}",friendhighscorelist:"/hs/pb/1/listfriend/{channel}/{siteid}/{itemtype}/{itemid}",avatar_url:"/gm/pb/2/preview/{avatar}",userprofile_link:"/user/{username}"}},b=function(h,g){return function(j){if(!j.invalid){h.call(this,j,g)}else{g.call(this,j.data)}}},e=function(o,j,n,h,m,l){var g=$.String.sub(o,$.extend({},j),true);$.ajax({url:g,data:j,success:n,error:h,type:l||"post",dataType:"json",fixture:m})},d=function(){return"//"+$.String.underscore(this.fullName).replace(/\.models\..*/,"").replace(/\./g,"/")+"/fixtures/"+$.String.underscore(this.shortName)};c=$.extend(true,c,SPI._settings.models);$.Model.extend("Award",{findAll:c.awards.awardlist,findAwards:function(j,h,g){return this.findAll($.extend({},f,j),b(h,g),g)},findMyAwards:function(j,h,g){return this.findAwards($.extend({},f,j,{targetuser:$.profilar.forService()["username"],itemid:0}),h,g)},wrapMany:function(h){var g;try{g=$.Model.wrapMany.call(this,h.hyscor.resultset.result);g.total=function(){return h.hyscor.resultset.total}}catch(j){try{if(h.hyscor.errorcode==404){g=$.Model.wrapMany.call(this,[]);g.total=function(){return 0}}else{g={invalid:true,data:h}}}catch(j){g={invalid:true,data:h}}}return g}},{awardIcon:function(){return c.awards.awardicon_url+this.awardid}});$.Model.extend("Highscore",{findAll:c.highscores.highscorelist,findHighscores:function(j,h,g){j=$.extend({},f,j);delete j.pagenr;delete j.channel;return this.findAll(j,b(h,g),g)},findFriendHighscores:function(l,j,h){l=$.extend({},l,{outputtype:f.outputtype},$.profilar.forService());var g=$.String.sub(c.highscores.friendhighscorelist,$.extend({},f,l),true);delete l.itemid;e(g,l,this.callback(["wrapMany",j]),h,d.call(this)+"s.json","GET")},findMyHighscores:function(j,h,g){return this.findHighscores($.extend({},f,j,{targetuser:$.profilar.forService()["username"],itemid:0}),h,g);return this.findHighscores(j,h,g)},wrapMany:function(l){var g;var h=this;var j=function(r,o){var q=function(v,u){var s=parseInt(v.score);var z=parseInt(u.score);return(z-s)};var p=function(u,s){var v=0;for(;v<u.length;++v){if(u[v]==s){return true}}return false};$.each(g,function(u,v){var x=$.Model.wrap.call(h,$.extend({current:function(){return true}},r)),s=[];x.logged=function(){return !this.notLogged};$.each(v,function(z,y){y.current=function(){return false};s.push(y.username)});$.each(v,function(z,y){if(!y.isTop()){if(y.score<=x.score){y.current=x.current;if(x.score>y.lowest){y.isTop=function(){return true}}y.score=x.score;y.timestamp=x.timestamp}return false}if(y.score<x.score){v.push(x);v.sort(q);if(v.length>o){v.pop()}return false}if(y.username==x.username&&y.score==x.score){v[z]=x;return false}if(z==v.length-1&&!p(s,x.username)){if(v.length==o){x.isTop=function(){return false}}v.push(x)}});if(v.length==0){v.push(x)}$.each(v,function(y,z){z.position=y+1})})};var n=function(o,p){var q=p||c.highscores.avatar_url;$.each(this,function(r,s){s.avatarUrl=SPI._settings.avatarImages.anonymousIcon;$.each(o,function(v,u){if(u.username&&u.username.toLowerCase()==s.username.toLowerCase()&&u.avatar&&u.avatar!=""&&u.avatar!=undefined){if(u.avatar){s.avatarUrl=$.String.sub(q,u)}}})})};try{g={};if(!!(parseInt(l.hyscor.length)+1)&&l.hyscor.length==0){g.weekly=$.Model.wrapMany.call(this,[]);$.extend(g.weekly,{addNewScore:j,updateAvatars:n});g.daily=$.Model.wrapMany.call(this,[]);$.extend(g.daily,{addNewScore:j,updateAvatars:n});g.monthly=$.Model.wrapMany.call(this,[]);$.extend(g.monthly,{addNewScore:j,updateAvatars:n})}else{if(!l.hyscor.weekly&&!l.hyscor.monthly&&!l.hyscor.daily){throw"Invalid response"}g.daily=$.Model.wrapMany.call(this,[]);g.weekly=$.Model.wrapMany.call(this,[]);g.monthly=$.Model.wrapMany.call(this,[]);if(l.hyscor.weekly){g.weekly=$.Model.wrapMany.call(this,l.hyscor.weekly.result)}if(l.hyscor.monthly){g.monthly=$.Model.wrapMany.call(this,l.hyscor.monthly.result)}if(l.hyscor.daily){g.daily=$.Model.wrapMany.call(this,l.hyscor.daily.result)}$.extend(g.daily,{addNewScore:j,updateAvatars:n});$.extend(g.weekly,{addNewScore:j,updateAvatars:n});$.extend(g.monthly,{addNewScore:j,updateAvatars:n})}}catch(m){g={invalid:true,data:l}}return g}},{userLink:function(){return $.String.sub(c.highscores.userprofile_link,this)},current:function(){return false},logged:function(){return true},isTop:function(){return true}})})();(function(){var c={siteId:SPI._settings.global.site_id,itemType:0,itemId:0,order:2,outputtype:"json"},b=function(e,d){return function(f){if(!f.invalid){e.call(this,f,d)}else{d.call(this,f.data)}}};$.Model.extend("GalleryImage",{findAll:"/gm/pb/2/list/2/3/{siteId}/{itemType}/{itemId}",findImages:function(f,e,d){return this.findAll($.extend({},c,f),b(e,d),d)},wrapMany:function(f){var d;try{d=$.Model.wrapMany.call(this,f.gamatar.resultset.result);d.total=function(){return f.gamatar.resultset.total}}catch(g){try{if(typeof(f.gamatar.resultset)!="undefined"&&typeof(f.gamatar.resultset.total)!="undefined"&&f.gamatar.resultset.total===0){d=$.Model.wrapMany.call(this,[]);d.total=function(){return 0}}else{d={invalid:true,data:f}}}catch(g){d={invalid:true,data:f}}}return d}},{thumbURL:function(){return"/gm/pb/2/preview/"+this.id},detailsURL:function(){return SPI.sprintf(SPI._langStrings.myGallery.gallerydetaillink,this.id)}})})();(function(){var c={request_params:{data:{body:"",outputtype:"json"}},request_data:{httpheaders:{Accept:"application/json; charset=utf-8","User-Agent":navigator.userAgent},serverenv:{REMOTE_ADDR:"",REQUEST_METHOD:"",REQUEST_URI:"",SERVER_PROTOCOL:"",HTTP_USER_AGENT:""},field:{name:"username",text:"",languagecode:SPI._settings.global.lang_id,channel:SPI._settings.global.channel_id,siteid:SPI._settings.global.site_id,spamcheck:1,profanitycheck:1,blacklistcheck:1,badbehaviorcheck:1}}},b=function(e,d){return function(f){if(!f.invalid){e.call(this,f,d)}else{d.call(this,f.data)}}};$.Model.extend("Filtar",{findAll:function(f,e,d){$.ajax({url:"/fl/pb/1/check",type:"post",dataType:"json",data:f,success:this.callback(["wrapMany",e]),error:d})},checkUsername:function(e,f,d){c.request_data.field=$.extend({},c.request_data.field,e);c.request_params.data.body=this.buildXML(c.request_data);return this.findAll(c.request_params.data,b(f,d),d)},wrapMany:function(f){var d;try{d=$.Model.wrapMany.call(this,f.filtar.field)}catch(g){try{if(typeof(f.filtar.field)=="undefined"){d={invalid:true,data:f}}}catch(g){d={invalid:true,data:f}}}return d},buildXML:function(h){var f='<?xml version="1.0" encoding="UTF-8"?><filtar><httpheaders>%s</httpheaders><serverenv>%s</serverenv><field>%s</field></filtar>';var g=[];var d="";for(var j in h){d="";for(var e in h[j]){d+="<"+e+">"+h[j][e]+"</"+e+">"}g.push(d)}return SPI.sprintf(f,g[0],g[1],g[2])}},{isUsernameProfanity:function(){return this.profanityscore!=undefined?(this.profanityscore>0?true:false):false}})})();_=function(b){if(typeof(SPI.translations[b])!="undefined"&&SPI.translations[b]!==""){str=SPI.translations[b]}else{str="*"+b}return str};var hideGameFlashMessage=function(){var b=$("div#gameFlashMessage");if(b.length>0){b.fadeOut("slow")}};$.Controller("GameAccordion",{defaults:{awards:false,highscores:false,gallery:false,suggestions:false,loggedIn:false,highscoreTab:"weekly",highscoreFilter:"all",highscoreListSize:5,newHighscore:false,locale:SPI._settings.global.lang_id}},{init:function(d,b){this.fallbackActiveIn=[];if(typeof(this.options.gameId)!=="number"){throw"GameAccordion wants gameId and it should be number."}var c=[];if(this.options.gallery){c.push({label:_("Gallery images")});this.galleryIdx=0}if(this.options.awards){c.push({label:_("Awards")});this.awardsIdx=c.length-1}if(this.options.highscores){c.push({label:_("Highscores")});this.highscoresIdx=c.length-1}if(this.options.suggestions){c.push({label:_("Similar games")});this.suggestionsIdx=c.length-1}this.tabsLength=c.length;$(this.element).html("gameAccordionTpl",{tabs:c});var g=(this.options.loggedIn)?0:c.length-1;$(d).accordion({animated:true,autoHeight:false,active:g});if(g>0){$("h3",$(d)).find("a").data("clickForCollapse",true)}if(this.options.awards){this.initAwards($("> div:eq("+this.awardsIdx+") .accordion-tab-content",this.element),{locale:this.options.locale})}if(this.options.highscores){this.initHighscores($("> div:eq("+this.highscoresIdx+") .accordion-tab-content",this.element))}if(this.options.gallery){this.initGallery($("> div:eq("+this.galleryIdx+") .accordion-tab-content",this.element))}if(this.options.suggestions){this.initSuggestions($("> div:eq("+this.suggestionsIdx+") .accordion-tab-content",this.element))}$("body").bind("awardachieved",this.callback("awardAchieved"));$("body").bind("imagecreated",this.callback("imageCreated"));$("body").bind("avatarcreated",this.callback("avatarCreated"));$("body").bind("highscoreachieved",this.callback("highscoreAchieved"));$(this.element).bind("accordionchange",this.callback("accordionChanged"));var e=this.element;$(e).bind("accordionchangestart",function(h,j){j.newHeader.find("a").data("clickForCollapse",false)});var f=this;$(".accordion-tab",$(e)).live("click",function(){var h=$(e).accordion("option","active");if($(this).data("clickForCollapse")===true&&h>0){$(e).accordion("activate",--h)}$("h3",$(e)).find("a").data("clickForCollapse",true)});if(g!=0){$("h3",$(e)).removeClass("ui-state-default")}this.newHighscore=[]},initSuggestions:function(d,c){this.suggestionsElement=d;$(this.suggestionsElement).html("gameAccordionSuggestionsTpl",{});var b=this;$("li",this.suggestionsElement).each(function(f,g){var e={};e.ratingText=$("span.tooltipHiddenRating:first",g).text();e.rating=$("span.tooltipHiddenRating:last",g).text();e.rating=parseInt(parseInt(e.rating)/10)*14;e.originalTitle=$("span.tooltipHiddenOriginalTitle",g).text();e.description=$("span.tooltipHidden:first",g).text();e.subcatname=$("span.tooltipHidden:last",g).text();$(g).dTooltip({eventHandler:"a",displayDiv:"tltleft-accordion",content:".tltcontent-accordion",track:true,position:"left",x:0,y:0,autoOffset:{x:-30,y:10},drawItemCallback:b.callback("drawSuggestionTooltip",e)});$(g).find("img").attr("alt","").attr("title","");$(g).find("a").attr("alt","").attr("title","")})},drawSuggestionTooltip:function(b,d,c){return $.View("gameAccordionSuggestionTooltipTpl",{suggestion:b})},initAwards:function(d,b){this.awardElement=d;var c=6;if(!this.options.loggedIn&&this.tabsLength>2){c=6}Award.findAwards({itemid:this.options.gameId,pagesize:c,locale:this.options.locale},this.callback("loadAchievedAwards"))},loadAchievedAwards:function(b){if(this.options.loggedIn){Award.findAwards({itemid:this.options.gameId,targetuser:this.options.userName,locale:this.options.locale},this.callback("listAwards",b),function(c){})}else{this.listAwards(b,[])}},listAwards:function(b,d){var c=this;b.achievedLength=0;b.map(function(e){e.achieved=false;$.each(d,function(f,g){if(e.tag==g.tag){b.achievedLength+=1;e.achieved=true;return false}})});$(this.awardElement).html("gameAccordionAwardsTpl",{awards:b,tabsLength:this.tabsLength,loggedIn:this.options.loggedIn,userName:this.options.userName},this.callback("awardStyles"));$("li",this.awardElement).each(function(e,f){$(f).dTooltip({eventHandler:"span.award-empty",displayDiv:"tltleft-accordion-awards",content:".tltcontent-accordion",track:true,position:"left",autoOffset:{x:-15,y:15},drawItemCallback:c.callback("drawAwardTooltip",b[e])})});$(this.awardElement).dTooltip({eventHandler:"a.question-mark",displayDiv:"tltleft-accordion-question-mark",content:".tltcontent-accordion",track:true,position:"left",y:15,autoOffset:{x:-125,y:15},drawItemCallback:c.callback("drawQuestionTooltip")})},awardStyles:function(b){this.find(".award-elem-inactive img").load(function(){$(this).fadeTo(0,0.25)})},drawAwardTooltip:function(d,c,b){return $.View("gameAccordionAwardTooltipTpl",{award:d})},drawQuestionTooltip:function(){return $.View("gameAccordionQuestionMarkTooltipTpl",{})},initHighscores:function(d,b){this.options=$.extend(this.options,b);this.highscoreElement=d;var c=5;this.options.highscoreListSize=c;if(this.options.highscoreFilter=="friends"){Highscore.findFriendHighscores({itemid:this.options.gameId,pagesize:c},this.callback("loadHighscores"))}else{Highscore.findHighscores({itemid:this.options.gameId,pagesize:c},this.callback("loadHighscores"))}},loadHighscores:function(b){var d=[];if(this.newHighscore.length>0){for(var c=0;c<this.newHighscore.length;++c){b[this.options.highscoreTab].addNewScore(this.newHighscore[c],this.options.highscoreListSize)}}$.each(b[this.options.highscoreTab],function(e,f){if(f.authenticated=="1"){d.push(f.username)}if(f.username==$.profilar.forService().username){f.myhighscore=true}});$.profilar.loadExternalPrefs(d,this.callback("listHighscores",b),["avatar"])},listHighscores:function(b,f){var d=0,e=this,c=b[this.options.highscoreTab],g=function(){};b[this.options.highscoreTab].updateAvatars(f);for(d=0;d<c.length;++d){if(c[d].current()&&c[d].isTop()){g=function(){e.callback("highlightHighscore")};break}}$(this.highscoreElement).html("gameAccordionHighscoresTpl",{filterLink:this.options.highscoreFilter,activeTab:this.options.highscoreTab,highscores:b[this.options.highscoreTab],tabsLength:this.tabsLength,loggedIn:this.options.loggedIn},this.callback("highlightHighscore"));this.bind($("#filteringSelect").filtering_widget({filter:this.options.highscoreTab}),"filteringChanged","filteringChanged")},highlightHighscore:function(){if(this.options.newHighscore){this.options.newHighscore=false;var c=$(".current",this.highscoreElement),b=c.hasClass("odd");c.addClass("mybesthighscore");c.animate({opacity:0.5},150).animate({opacity:1},100).animate({opacity:0.5},100).animate({opacity:1},100).animate({opacity:0.5},100).animate({opacity:1},100).animate({opacity:0.5},100).animate({opacity:1},350,function(){c.css("opacity","");c.removeClass("current")})}$("li",this.highscoreElement).dEllipsis({overflowElement:"span.username",textElement:"span.username a",shortSteps:false,wrapInWidth:true})},initGallery:function(d,c){this.galleryElement=d;if(this.options.loggedIn){GalleryImage.findImages({username:this.options.userName,hash:this.options.hash,pagesize:2,_:(new Date()).getTime()},this.callback("loadGallery",c))}else{var b=[];b.total=0;this.loadGallery(c,b)}},loadGallery:function(d,b){var c=this;$(this.galleryElement).html("gameAccordionGalleryTpl",{images:b,tabsLength:this.tabsLength,loggedIn:this.options.loggedIn,userName:this.options.userName},this.callback("afterLoadGallery",d));$("li",this.galleryElement).each(function(e,f){if(e<b.length){$(f).dTooltip({eventHandler:".image-background",displayDiv:"tltleft-accordion",content:".tltcontent-accordion",track:true,position:"left",autoOffset:{x:-17,y:5},drawItemCallback:c.callback("drawGalleryTooltip",b[e])})}});$(".image-elem").click(function(){var e=$("a",this).attr("href");window.open(e,"newindow");return false})},afterLoadGallery:function(b){var c;$(".image-background").hover(function(){c=$(this).find(".gallery-hover");$(c).css("visibility","visible");$(c).parent().css("cursor","pointer")},function(){c=$(this).find(".gallery-hover");$(c).css("visibility","hidden")});if(b){$(c).css("visibility","hidden");$(".gallery > li:first > a > span > .gallery-border",this.galleryElement).fadeTo(0,0).css("visibility","visible").fadeTo(1000,1).fadeTo(1000,0).fadeTo(1000,1).fadeTo(1000,0).fadeTo(1000,1).fadeTo(1000,0,function(){$(this).hide()});$(c).css("visibility","visible")}},drawGalleryTooltip:function(d,c,b){d.ratings=parseInt(d.average_rating)*-14;return $.View("gameAccordionGalleryTooltipTpl",{image:d})},".ugc-item mousover":function(){},"a.monthly click":function(b,c){this.initHighscores(this.highscoreElement,{highscoreTab:"monthly"})},"a.weekly click":function(b,c){this.initHighscores(this.highscoreElement,{highscoreTab:"weekly"})},"a.daily click":function(b,c){this.initHighscores(this.highscoreElement,{highscoreTab:"daily"})},filteringChanged:function(c,d,b){this.initHighscores(this.highscoreElement,{highscoreTab:b})},".more-link-friends click":function(b,c){this.initHighscores(this.highscoreElement,{highscoreFilter:"friends"})},".more-link-all click":function(b,c){this.initHighscores(this.highscoreElement,{highscoreFilter:"all"})},"[name=show_login_popup] click":function(b,c){$('.m-user_navigation a[name="show_login_popup"]').click()},accordionChanged:function(b,c){$("li",$(".accordion-highscore-box-content")).dEllipsis({overflowElement:"span.username",textElement:"span.username a",shortSteps:false,wrapInWidth:true})},awardAchieved:function(f){$(this.element).accordion("activate",this.awardsIdx);if(!this.options.loggedIn){this.fallbackAchievement(this.awardElement,{type:"award",icon_url:$(".award-tag-"+f.eData.tage+" img",this.awardElement).attr("src")});return}$(".award-tag-"+f.eData.tage+" img",this.awardElement).fadeTo(500,1);var e=500;var c=$(".award-tag-"+f.eData.tage,this.awardElement);c.removeClass("award-elem-inactive").addClass("award-elem-active").find(".award-border").fadeTo(0,0).css("visibility","visible").fadeTo(e,1).fadeTo(e,0).fadeTo(e,1).fadeTo(e,0).fadeTo(e,1).fadeTo(e,0).fadeTo(e,1).fadeTo(e,0).fadeTo(e,1).fadeTo(e,0).fadeTo(e,1).fadeTo(e,0).fadeTo(e,1).fadeTo(e,0).fadeTo(e,1).fadeTo(e,0).fadeTo(e,1).fadeTo(e,0,function(){$(this).hide()});var d=$(".award-elem-active",this.awardElement).length;var b=$(".awards-counter-container .x-awards-achieved span.bolder-counter:last",this.awardElement).text();$(".x-awards-achieved",this.awardElement).html($.String.sub(_('You have won <span class="bolder-counter">{achieved_awards_count}</span> of <span class="bolder-counter">{all_awards_count}</span> awards'),{achieved_awards_count:d,all_awards_count:b}))},highscoreAchieved:function(c){$(this.element).accordion("activate",this.highscoresIdx);if(!this.options.loggedIn){this.fallbackAchievement(this.highscoreElement,{type:"highscore"});return}var b={notLogged:$.profilar.loggedIn(),timestamp:c.timeStamp,username:$.profilar.forService().username,authenticated:1,score:c.eData.score,gamelevel:"",country:""};this.newHighscore.push(b);this.initHighscores(this.highscoreElement,{newHighscore:true})},imageCreated:function(b){$(this.element).accordion("activate",this.galleryIdx);if(!this.options.loggedIn){this.fallbackAchievement(this.galleryElement,{type:"gallery"});return}this.initGallery(this.galleryElement,true)},avatarCreated:function(d){var b=$("#gameFlashMessage");b.empty().append(SPI._langStrings.avatars.avatar_saved).fadeIn("slow");setTimeout("hideGameFlashMessage()",10000);var e=$.profilar.getPref("avatar");var c=SPI.sprintf(SPI._settings.avatars.small_avatar,e);$(".m-user_navigation-avatarnormal").attr("src",domain_pool.getURL(c),"cimg")},fallbackAchievement:function(b,d){var c=this;if($.inArray(b,this.fallbackActiveIn)>=0){return}this.fallbackActiveIn.push(b);b.children().fadeTo(0,0.3);b.find("li").fadeTo(0,0.3);b.find(".awards-counter-container").children().fadeTo(0,0.3);b.find(".or-login").fadeTo(0,0.3);b.find("div.more-link-container span.more-link a").fadeTo(0,0.3);$("<div></div>").append($.View("gameAccordionFallbackTpl",d)).css({left:0,top:-$(b).height(),position:"absolute"}).appendTo(b).animate({top:"+="+$(b).height()},"slow").delay(8000).animate({top:"-="+$(b).height()},"slow",function(){$(this).remove();b.children().css("opacity","");b.find("li").css("opacity","");b.find(".awards-counter-container").children().css("opacity","");b.find(".or-login").css("opacity","");b.find("div.more-link-container span.more-link a").css("opacity","");c.fallbackActiveIn.splice($.inArray(b,c.fallbackActiveIn),1)});$(".fallback-sign-up-container .sign-in-button").click(function(){sendSpilEvent("register","link-register",window._gaPageType);SPI.sg_register.open_popup();return false})}});$.Controller("FilteringWidget",{init:function(c,b){b=b||{};this.options={filter:"alltime"};this.strings={daily:SPI.translations.Daily,weekly:SPI.translations.Weekly,monthly:SPI.translations["All Time"],alltime:SPI.translations["All Time"]};this.options=$.extend(this.options,b);$(".content li."+this.options.filter,this.element).addClass("active");$(".selectHeader a",this.element).html(this.strings[this.options.filter])},".selectHeader a mouseover":function(b,c){if($(".content",this.element).css("visibility")=="hidden"){$(".content",this.element).css("visibility","visible").show()}c.preventDefault()},"ol.content mouseleave":function(b,c){if($(".content",this.element).css("visibility")=="visible"){$(".content",this.element).css("visibility","hidden").hide()}c.preventDefault()},".content li click":function(b,c){$(".content",this.element).css("visibility","hidden").hide();if(b.hasClass("selectHeader")){return}$("li",this.element).removeClass("active");$(".selectHeader span a").html(this.strings[c.target.className]);if(c.target.className==="alltime"){$(this.element).trigger("filteringChanged",["monthly"])}else{$(this.element).trigger("filteringChanged",[c.target.className])}$(b).addClass("active")},"span.arrow click":function(b,c){$("a",c.target).click()}});(function(b){b("html").addClass("stylish-select");b.fn.extend({getSetSSValue:function(c){if(c){b(this).val(c).change();return this}else{return b(this).find(":selected").val()}},resetSS:function(){var c=b(this).data("ssOpts");$this=b(this);$this.next().remove();$this.unbind().sSelect(c)}});b.fn.sSelect=function(c){return this.each(function(){var l={defaultText:"Please select",animationSpeed:0,ddMaxHeight:""};var o=b.extend(l,c),f=b(this),m=b('<div class="selectedTxt"></div>'),v=b('<div class="newListSelected" tabindex="0"></div>'),E=b('<ul class="newList"></ul>'),y=-1,e=-1,p=[],B=false,A=false,C;b(this).data("ssOpts",c);v.insertAfter(f);m.prependTo(v);E.appendTo(v);f.hide();if(f.children("optgroup").length==0){f.children().each(function(G){var H=b(this).text();var F=b(this).val();p.push(H.charAt(0).toLowerCase());if(b(this).attr("selected")=="selected"){o.defaultText=H;e=G}E.append(b('<li><a href="JavaScript:void(0);">'+H+"</a></li>").data("key",F))});C=E.children().children()}else{f.children("optgroup").each(function(){var F=b(this).attr("label"),H=b('<li class="newListOptionTitle">'+F+"</li>");H.appendTo(E);var G=b("<ul></ul>");G.appendTo(H);b(this).children().each(function(){++y;var J=b(this).text();var I=b(this).val();p.push(J.charAt(0).toLowerCase());if(b(this).attr("selected")=="selected"){o.defaultText=J;e=y}G.append(b('<li><a href="JavaScript:void(0);">'+J+"</a></li>").data("key",I))})});C=E.find("ul li a")}var r=E.height(),q=v.height(),D=C.length;if(e!=-1){j(e,true)}else{m.text(o.defaultText)}function s(){var G=v.offset().top,F=jQuery(window).height(),H=jQuery(window).scrollTop();if(r>parseInt(o.ddMaxHeight)){r=parseInt(o.ddMaxHeight)}G=G-H;if(G+r>=F){E.css({top:"-"+r+"px",height:r});f.onTop=true}else{E.css({top:q+"px",height:r});f.onTop=false}}s();b(window).resize(function(){s()});b(window).scroll(function(){s()});function x(){v.css("position","relative")}function d(){v.css("position","static")}m.click(function(F){F.stopPropagation();b(".rss-page-head h1").click().focus();b(".newList").not(b(this).next()).hide().parent().removeClass("newListSelFocus");E.toggle();x();C.eq(e).focus()});C.click(function(G){var F=b(G.target);e=C.index(F);A=true;j(e);E.hide();v.css("position","static")});C.hover(function(G){var F=b(G.target);F.addClass("newListHover")},function(G){var F=b(G.target);F.removeClass("newListHover")});function j(F,I){C.removeClass("hiLite").eq(F).addClass("hiLite");if(E.is(":visible")){}var H=C.eq(F).text();var G=C.eq(F).parent().data("key");if(I==true){f.val(G);m.text(H);return false}f.val(G);f.change();m.text(H)}f.change(function(F){$targetInput=b(F.target);if(A==true){A=false;return false}$currentOpt=$targetInput.find(":selected");e=$targetInput.find("option").index($currentOpt);j(e,true)});function u(F){F.onkeydown=function(I){var H;if(I==null){H=event.keyCode}else{H=I.which}A=true;switch(H){case 40:case 39:z();return false;break;case 38:case 37:n();return false;break;case 33:case 36:h();return false;break;case 34:case 35:g();return false;break;case 13:case 27:E.hide();d();return false;break}keyPressed=String.fromCharCode(H).toLowerCase();var G=p.indexOf(keyPressed);if(typeof G!="undefined"){++e;e=p.indexOf(keyPressed,e);if(e==-1||e==null||B!=keyPressed){e=p.indexOf(keyPressed)}j(e);B=keyPressed;return false}}}function z(){if(e<(D-1)){++e;j(e)}}function n(){if(e>0){--e;j(e)}}function h(){e=0;j(e)}function g(){e=D-1;j(e)}v.click(function(){u(this)});v.focus(function(){b(this).addClass("newListSelFocus");u(this)});v.blur(function(){b(this).removeClass("newListSelFocus")});b("body").click(function(){v.removeClass("newListSelFocus");E.hide();d()});m.hover(function(G){var F=b(G.target);F.parent().addClass("newListSelHover")},function(G){var F=b(G.target);F.parent().removeClass("newListSelHover")});E.css("left","0").hide()})}})(jQuery);
/*!
 * jQuery UI 1.8.9
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI
 */
(function(b,d){b.ui=b.ui||{};if(b.ui.version){return}b.extend(b.ui,{version:"1.8.9",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}});b.fn.extend({_focus:b.fn.focus,focus:function(e,f){return typeof e==="number"?this.each(function(){var g=this;setTimeout(function(){b(g).focus();if(f){f.call(g)}},e)}):this._focus.apply(this,arguments)},scrollParent:function(){var e;if((b.browser.msie&&(/(static|relative)/).test(this.css("position")))||(/absolute/).test(this.css("position"))){e=this.parents().filter(function(){return(/(relative|absolute|fixed)/).test(b.curCSS(this,"position",1))&&(/(auto|scroll)/).test(b.curCSS(this,"overflow",1)+b.curCSS(this,"overflow-y",1)+b.curCSS(this,"overflow-x",1))}).eq(0)}else{e=this.parents().filter(function(){return(/(auto|scroll)/).test(b.curCSS(this,"overflow",1)+b.curCSS(this,"overflow-y",1)+b.curCSS(this,"overflow-x",1))}).eq(0)}return(/fixed/).test(this.css("position"))||!e.length?b(document):e},zIndex:function(h){if(h!==d){return this.css("zIndex",h)}if(this.length){var f=b(this[0]),e,g;while(f.length&&f[0]!==document){e=f.css("position");if(e==="absolute"||e==="relative"||e==="fixed"){g=parseInt(f.css("zIndex"),10);if(!isNaN(g)&&g!==0){return g}}f=f.parent()}}return 0},disableSelection:function(){return this.bind((b.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});b.each(["Width","Height"],function(g,e){var f=e==="Width"?["Left","Right"]:["Top","Bottom"],h=e.toLowerCase(),l={innerWidth:b.fn.innerWidth,innerHeight:b.fn.innerHeight,outerWidth:b.fn.outerWidth,outerHeight:b.fn.outerHeight};function j(o,n,m,p){b.each(f,function(){n-=parseFloat(b.curCSS(o,"padding"+this,true))||0;if(m){n-=parseFloat(b.curCSS(o,"border"+this+"Width",true))||0}if(p){n-=parseFloat(b.curCSS(o,"margin"+this,true))||0}});return n}b.fn["inner"+e]=function(m){if(m===d){return l["inner"+e].call(this)}return this.each(function(){b(this).css(h,j(this,m)+"px")})};b.fn["outer"+e]=function(m,n){if(typeof m!=="number"){return l["outer"+e].call(this,m)}return this.each(function(){b(this).css(h,j(this,m,true,n)+"px")})}});function c(e){return !b(e).parents().andSelf().filter(function(){return b.curCSS(this,"visibility")==="hidden"||b.expr.filters.hidden(this)}).length}b.extend(b.expr[":"],{data:function(g,f,e){return !!b.data(g,e[3])},focusable:function(g){var l=g.nodeName.toLowerCase(),e=b.attr(g,"tabindex");if("area"===l){var j=g.parentNode,h=j.name,f;if(!g.href||!h||j.nodeName.toLowerCase()!=="map"){return false}f=b("img[usemap=#"+h+"]")[0];return !!f&&c(f)}return(/input|select|textarea|button|object/.test(l)?!g.disabled:"a"==l?g.href||!isNaN(e):!isNaN(e))&&c(g)},tabbable:function(f){var e=b.attr(f,"tabindex");return(isNaN(e)||e>=0)&&b(f).is(":focusable")}});b(function(){var e=document.body,f=e.appendChild(f=document.createElement("div"));b.extend(f.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});b.support.minHeight=f.offsetHeight===100;b.support.selectstart="onselectstart" in f;e.removeChild(f).style.display="none"});b.extend(b.ui,{plugin:{add:function(f,g,j){var h=b.ui[f].prototype;for(var e in j){h.plugins[e]=h.plugins[e]||[];h.plugins[e].push([g,j[e]])}},call:function(e,g,f){var j=e.plugins[g];if(!j||!e.element[0].parentNode){return}for(var h=0;h<j.length;h++){if(e.options[j[h][0]]){j[h][1].apply(e.element,f)}}}},contains:function(f,e){return document.compareDocumentPosition?f.compareDocumentPosition(e)&16:f!==e&&f.contains(e)},hasScroll:function(h,f){if(b(h).css("overflow")==="hidden"){return false}var e=(f&&f==="left")?"scrollLeft":"scrollTop",g=false;if(h[e]>0){return true}h[e]=1;g=(h[e]>0);h[e]=0;return g},isOverAxis:function(f,e,g){return(f>e)&&(f<(e+g))},isOver:function(l,f,j,h,e,g){return b.ui.isOverAxis(l,j,e)&&b.ui.isOverAxis(f,h,g)}})})(jQuery);
/*!
 * jQuery UI Widget 1.8.9
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Widget
 */
(function(c,e){if(c.cleanData){var d=c.cleanData;c.cleanData=function(f){for(var g=0,h;(h=f[g])!=null;g++){c(h).triggerHandler("remove")}d(f)}}else{var b=c.fn.remove;c.fn.remove=function(f,g){return this.each(function(){if(!g){if(!f||c.filter(f,[this]).length){c("*",this).add([this]).each(function(){c(this).triggerHandler("remove")})}}return b.call(c(this),f,g)})}}c.widget=function(g,j,f){var h=g.split(".")[0],m;g=g.split(".")[1];m=h+"-"+g;if(!f){f=j;j=c.Widget}c.expr[":"][m]=function(n){return !!c.data(n,g)};c[h]=c[h]||{};c[h][g]=function(n,o){if(arguments.length){this._createWidget(n,o)}};var l=new j();l.options=c.extend(true,{},l.options);c[h][g].prototype=c.extend(true,l,{namespace:h,widgetName:g,widgetEventPrefix:c[h][g].prototype.widgetEventPrefix||g,widgetBaseClass:m},f);c.widget.bridge(g,c[h][g])};c.widget.bridge=function(g,f){c.fn[g]=function(l){var h=typeof l==="string",j=Array.prototype.slice.call(arguments,1),m=this;l=!h&&j.length?c.extend.apply(null,[true,l].concat(j)):l;if(h&&l.charAt(0)==="_"){return m}if(h){this.each(function(){var n=c.data(this,g),o=n&&c.isFunction(n[l])?n[l].apply(n,j):n;if(o!==n&&o!==e){m=o;return false}})}else{this.each(function(){var n=c.data(this,g);if(n){n.option(l||{})._init()}else{c.data(this,g,new f(l,this))}})}return m}};c.Widget=function(f,g){if(arguments.length){this._createWidget(f,g)}};c.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(g,h){c.data(h,this.widgetName,this);this.element=c(h);this.options=c.extend(true,{},this.options,this._getCreateOptions(),g);var f=this;this.element.bind("remove."+this.widgetName,function(){f.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return c.metadata&&c.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(g,h){var f=g;if(arguments.length===0){return c.extend({},this.options)}if(typeof g==="string"){if(h===e){return this.options[g]}f={};f[g]=h}this._setOptions(f);return this},_setOptions:function(g){var f=this;c.each(g,function(h,j){f._setOption(h,j)});return this},_setOption:function(f,g){this.options[f]=g;if(f==="disabled"){this.widget()[g?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",g)}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(g,h,j){var m=this.options[g];h=c.Event(h);h.type=(g===this.widgetEventPrefix?g:this.widgetEventPrefix+g).toLowerCase();j=j||{};if(h.originalEvent){for(var f=c.event.props.length,l;f;){l=c.event.props[--f];h[l]=h.originalEvent[l]}}this.element.trigger(h,j);return !(c.isFunction(m)&&m.call(this.element[0],h,j)===false||h.isDefaultPrevented())}}})(jQuery);(function(b,c){b.widget("ui.accordion",{options:{active:0,animated:"slide",autoHeight:true,clearStyle:false,collapsible:false,event:"click",fillSpace:false,header:"> li > :first-child,> :not(li):even",icons:{header:"ui-icon-triangle-1-e",headerSelected:"ui-icon-triangle-1-s"},navigation:false,navigationFilter:function(){return this.href.toLowerCase()===location.href.toLowerCase()}},_create:function(){var d=this,e=d.options;d.running=0;d.element.addClass("ui-accordion ui-widget ui-helper-reset").children("li").addClass("ui-accordion-li-fix");d.headers=d.element.find(e.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all").bind("mouseenter.accordion",function(){if(e.disabled){return}b(this).addClass("ui-state-hover")}).bind("mouseleave.accordion",function(){if(e.disabled){return}b(this).removeClass("ui-state-hover")}).bind("focus.accordion",function(){if(e.disabled){return}b(this).addClass("ui-state-focus")}).bind("blur.accordion",function(){if(e.disabled){return}b(this).removeClass("ui-state-focus")});d.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom");if(e.navigation){var f=d.element.find("a").filter(e.navigationFilter).eq(0);if(f.length){var g=f.closest(".ui-accordion-header");if(g.length){d.active=g}else{d.active=f.closest(".ui-accordion-content").prev()}}}d.active=d._findActive(d.active||e.active).addClass("ui-state-default ui-state-active").toggleClass("ui-corner-all").toggleClass("ui-corner-top");d.active.next().addClass("ui-accordion-content-active");d._createIcons();d.resize();d.element.attr("role","tablist");d.headers.attr("role","tab").bind("keydown.accordion",function(h){return d._keydown(h)}).next().attr("role","tabpanel");d.headers.not(d.active||"").attr({"aria-expanded":"false",tabIndex:-1}).next().hide();if(!d.active.length){d.headers.eq(0).attr("tabIndex",0)}else{d.active.attr({"aria-expanded":"true",tabIndex:0})}if(!b.browser.safari){d.headers.find("a").attr("tabIndex",-1)}if(e.event){d.headers.bind(e.event.split(" ").join(".accordion ")+".accordion",function(h){d._clickHandler.call(d,h,this);h.preventDefault()})}},_createIcons:function(){var d=this.options;if(d.icons){b("<span></span>").addClass("ui-icon "+d.icons.header).prependTo(this.headers);this.active.children(".ui-icon").toggleClass(d.icons.header).toggleClass(d.icons.headerSelected);this.element.addClass("ui-accordion-icons")}},_destroyIcons:function(){this.headers.children(".ui-icon").remove();this.element.removeClass("ui-accordion-icons")},destroy:function(){var d=this.options;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role");this.headers.unbind(".accordion").removeClass("ui-accordion-header ui-accordion-disabled ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("tabIndex");this.headers.find("a").removeAttr("tabIndex");this._destroyIcons();var e=this.headers.next().css("display","").removeAttr("role").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-accordion-disabled ui-state-disabled");if(d.autoHeight||d.fillHeight){e.css("height","")}return b.Widget.prototype.destroy.call(this)},_setOption:function(d,e){b.Widget.prototype._setOption.apply(this,arguments);if(d=="active"){this.activate(e)}if(d=="icons"){this._destroyIcons();if(e){this._createIcons()}}if(d=="disabled"){this.headers.add(this.headers.next())[e?"addClass":"removeClass"]("ui-accordion-disabled ui-state-disabled")}},_keydown:function(g){if(this.options.disabled||g.altKey||g.ctrlKey){return}var h=b.ui.keyCode,f=this.headers.length,d=this.headers.index(g.target),e=false;switch(g.keyCode){case h.RIGHT:case h.DOWN:e=this.headers[(d+1)%f];break;case h.LEFT:case h.UP:e=this.headers[(d-1+f)%f];break;case h.SPACE:case h.ENTER:this._clickHandler({target:g.target},g.target);g.preventDefault()}if(e){b(g.target).attr("tabIndex",-1);b(e).attr("tabIndex",0);e.focus();return false}return true},resize:function(){var d=this.options,f;if(d.fillSpace){if(b.browser.msie){var e=this.element.parent().css("overflow");this.element.parent().css("overflow","hidden")}f=this.element.parent().height();if(b.browser.msie){this.element.parent().css("overflow",e)}this.headers.each(function(){f-=b(this).outerHeight(true)});this.headers.next().each(function(){b(this).height(Math.max(0,f-b(this).innerHeight()+b(this).height()))}).css("overflow","auto")}else{if(d.autoHeight){f=0;this.headers.next().each(function(){f=Math.max(f,b(this).height("").height())}).height(f)}}return this},activate:function(d){this.options.active=d;var e=this._findActive(d)[0];this._clickHandler({target:e},e);return this},_findActive:function(d){return d?typeof d==="number"?this.headers.filter(":eq("+d+")"):this.headers.not(this.headers.not(d)):d===false?b([]):this.headers.filter(":eq(0)")},_clickHandler:function(d,h){var o=this.options;if(o.disabled){return}if(!d.target){if(!o.collapsible){return}this.active.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(o.icons.headerSelected).addClass(o.icons.header);this.active.next().addClass("ui-accordion-content-active");var l=this.active.next(),g={options:o,newHeader:b([]),oldHeader:o.active,newContent:b([]),oldContent:l},e=(this.active=b([]));this._toggle(e,l,g);return}var j=b(d.currentTarget||h),m=j[0]===this.active[0];o.active=o.collapsible&&m?false:this.headers.index(j);if(this.running||(!o.collapsible&&m)){return}var f=this.active,e=j.next(),l=this.active.next(),g={options:o,newHeader:m&&o.collapsible?b([]):j,oldHeader:this.active,newContent:m&&o.collapsible?b([]):e,oldContent:l},n=this.headers.index(this.active[0])>this.headers.index(j[0]);this.active=m?b([]):j;this._toggle(e,l,g,m,n);f.removeClass("ui-state-active ui-corner-top").addClass("ui-state-default ui-corner-all").children(".ui-icon").removeClass(o.icons.headerSelected).addClass(o.icons.header);if(!m){j.removeClass("ui-state-default ui-corner-all").addClass("ui-state-active ui-corner-top").children(".ui-icon").removeClass(o.icons.header).addClass(o.icons.headerSelected);j.next().addClass("ui-accordion-content-active")}return},_toggle:function(d,l,h,m,n){var p=this,q=p.options;p.toShow=d;p.toHide=l;p.data=h;var e=function(){if(!p){return}return p._completed.apply(p,arguments)};p._trigger("changestart",null,p.data);p.running=l.size()===0?d.size():l.size();if(q.animated){var g={};if(q.collapsible&&m){g={toShow:b([]),toHide:l,complete:e,down:n,autoHeight:q.autoHeight||q.fillSpace}}else{g={toShow:d,toHide:l,complete:e,down:n,autoHeight:q.autoHeight||q.fillSpace}}if(!q.proxied){q.proxied=q.animated}if(!q.proxiedDuration){q.proxiedDuration=q.duration}q.animated=b.isFunction(q.proxied)?q.proxied(g):q.proxied;q.duration=b.isFunction(q.proxiedDuration)?q.proxiedDuration(g):q.proxiedDuration;var o=b.ui.accordion.animations,f=q.duration,j=q.animated;if(j&&!o[j]&&!b.easing[j]){j="slide"}if(!o[j]){o[j]=function(r){this.slide(r,{easing:j,duration:f||700})}}o[j](g)}else{if(q.collapsible&&m){d.toggle()}else{l.hide();d.show()}e(true)}l.prev().attr({"aria-expanded":"false",tabIndex:-1}).blur();d.prev().attr({"aria-expanded":"true",tabIndex:0}).focus()},_completed:function(d){this.running=d?0:--this.running;if(this.running){return}if(this.options.clearStyle){this.toShow.add(this.toHide).css({height:"",overflow:""})}this.toHide.removeClass("ui-accordion-content-active");if(this.toHide.length){this.toHide.parent()[0].className=this.toHide.parent()[0].className}this._trigger("change",null,this.data)}});b.extend(b.ui.accordion,{version:"1.8.9",animations:{slide:function(n,l){n=b.extend({easing:"swing",duration:300},n,l);if(!n.toHide.size()){n.toShow.animate({height:"show",paddingTop:"show",paddingBottom:"show"},n);return}if(!n.toShow.size()){n.toHide.animate({height:"hide",paddingTop:"hide",paddingBottom:"hide"},n);return}var e=n.toShow.css("overflow"),j=0,f={},h={},g=["height","paddingTop","paddingBottom"],d;var m=n.toShow;d=m[0].style.width;m.width(parseInt(m.parent().width(),10)-parseInt(m.css("paddingLeft"),10)-parseInt(m.css("paddingRight"),10)-(parseInt(m.css("borderLeftWidth"),10)||0)-(parseInt(m.css("borderRightWidth"),10)||0));b.each(g,function(o,q){h[q]="hide";var p=(""+b.css(n.toShow[0],q)).match(/^([\d+-.]+)(.*)$/);f[q]={value:p[1],unit:p[2]||"px"}});n.toShow.css({height:0,overflow:"hidden"}).show();n.toHide.filter(":hidden").each(n.complete).end().filter(":visible").animate(h,{step:function(o,p){if(p.prop=="height"){j=(p.end-p.start===0)?0:(p.now-p.start)/(p.end-p.start)}n.toShow[0].style[p.prop]=(j*f[p.prop].value)+f[p.prop].unit},duration:n.duration,easing:n.easing,complete:function(){if(!n.autoHeight){n.toShow.css("height","")}n.toShow.css({width:d,overflow:e});n.complete()}})},bounceslide:function(d){this.slide(d,{easing:d.down?"easeOutBounce":"swing",duration:d.down?1000:200})}}})})(jQuery);SPI.handlers=(function(){var c={};var b={};c.clear=function(d){if(d===undefined){b={}}else{delete b[d]}};c.add=function(e,d){if(b[e]===undefined){b[e]=[]}b[e].push(d)};c.run=function(l,h,g,d){g=g===undefined?true:g;if(b[l]===undefined){return}for(var f in b[l]){try{b[l][f].apply(this,h===undefined?[]:h)}catch(j){if(d===true){throw j}}}if(g!=false){c.clear(l)}};return c})();var temp_contacts="";var renderContacts=function(){if(temp_contacts!="[]"&&temp_contacts.length>0){SPI.harvester.contactsRecieved(JSON.parse(temp_contacts))}else{SPI.harvester.contactsRecieved([])}};SPI.harvester=(function(e,q){var D={settings:{exposeGivennameMinAge:13,anonymousIcon:"/img/userprofile/dummy_small.gif",availServers:["yahoo","gmail","live"],newContactsPerPage:11,registeredContactsPerPage:6,windowtimeout:300,maxMsgLength:255,registeredAfterCallback:function(E){e(".borderHolder",E).mouseenter(function(){e(this).addClass("borderHolderHovered")}).mouseleave(function(){e(this).removeClass("borderHolderHovered")})},registeredListAfterCallback:function(){},harvestedListAfterCallback:function(){},origin:"default",pageSwitcher:[{stepNr:1,pageName:"firstStep",pageTitle:q._langStrings.harvester.step1_pagetitle,toHide:"#middlePinkBox, .myFriendsSearch,.harvestSecondBody,.harvestThirdBody, .harvestNoFriendsBody",toShow:".harvestContainer, .harvestFirstBody, .singleInviteBox"},{stepNr:2,pageName:"secondStep",pageTitle:q._langStrings.harvester.step2_pagetitle,toHide:".myFriendsSearch,.harvestFirstBody,.harvestThirdBody,.singleInviteBox, .harvestNoFriendsBody",toShow:".harvestContainer, .harvestSecondBody"},{stepNr:3,pageName:"thirdStep",pageTitle:q._langStrings.harvester.step3_pagetitle,toHide:".myFriendsSearch,.harvestFirstBody,.harvestSecondBody,.singleInviteBox, .harvestNoFriendsBody",toShow:".harvestContainer, .harvestThirdBody"},{stepNr:0,pageName:"friendsList",pageTitle:"",toShow:"#middlePinkBox, .myFriendsSearch,.harvestSecondBody,.harvestThirdBody",toHide:".harvestContainer, .harvestFirstBody, .singleInviteBox, .harvestNoFriendsBody"},{stepNr:4,pageName:"noFriends",pageTitle:"",toShow:".harvestNoFriendsBody",toHide:".harvestFirstBody, .singleInviteBox, .myFriendsSearch, .harvestSecondBody, .harvestThirdBody,. harvestListInfo, .harvestListInfo2"},{stepNr:5,pageName:"noFriendsAtAll",pageTitle:"",toShow:".harvestNoFriendsBody, .harvestContainer",toHide:".harvestFirstBody, .singleInviteBox, .myFriendsSearch, .harvestSecondBody, .harvestThirdBody, .harvestListInfo, .harvestListInfo2"}],afterSwitchPageCallback:null}};var f={initialised:false,lastStep:"thirdStep",settings:{},currentAccount:false,contacts:[],origin:D.settings.origin,invitesSent:0,emailsSent:0};var h=0;var o=[],d=[],z=[],c,m;var u=function(E,G,F){if(D.settings.activePageSelector&&e(""+D.settings.activePageSelector).length>0){e(""+D.settings.activePageSelector).removeClass("stepActive");e(""+D.settings.activePageSelector+":lt("+E+")").addClass("stepActive")}else{e(".harvestStepHolder span").removeClass("stepActive");e(".harvestStepHolder span:lt("+E+")").addClass("stepActive")}};var g=function(E){if(c&&!c.closed){m=setTimeout(function(){g(E)},D.settings.windowtimeout)}else{clearTimeout(m);m=false;if(typeof E=="function"){E.call(this)}}};var y=function(H){l();popuptypes={gmail:q._langStrings.harvester.gmail,live:q._langStrings.harvester.live,yahoo:q._langStrings.harvester.yahoo};q.popup.show(q.render(q._templates.harvester.connect,{accountType:H,info:q.sprintf(q._langStrings.harvester.connect,popuptypes[H])}),function(){},{type:"default",title:q._langStrings.harvester.start_importing,beforeCloseCallback:function(){f.currentAccount=false;e("a.harvestLogin").data("canClick",true)},close:true});if(f.origin=="social-game"){e("#sg_harvesting_popup").hide()}f.currentAccount=H;var I=q._settings.harvester.popupLink+"/"+H;if(f.currentAccount=="live"){var G=890,F=600}else{var G=800,F=600}var J=parseInt((screen.width-G)/2),E=parseInt((screen.height-F)/2);c=window.open(I,"import_win","width="+G+",height="+F+",left="+J+",top="+E);m=setTimeout(function(){g(function(){q.popup.close();l()})},D.settings.windowtimeout);return false};var l=function(){f.emailsSent=0;f.invitesSent=0;temp_contacts="";o=[];d=[];z=[];f.currentAccount=false;f.prepareStep("firstStep");e(".harvestAccounts .selectHolder").removeClass("active");e(".harvestAccounts input[type=radio]").removeAttr("checked");e(".harvestLoginToAccount").addClass("buttonDisabled");e("a.harvestLogin").data("canClick",true);e(".harvestMsgHolder p").html(v(e(".harvestMsgHolder textarea").val()))};var x=function(E,F){e.profilar.friendrefer(E,function(J,K){var I=[],G=[],H={};if(e("profilar friendrefer",J).length){e("profilar friendrefer",J).each(function(){H={};if(parseInt(e("referstatus",this).text())==0||parseInt(e("referstatus",this).text())==2){H.email=e("email",this).text()||"";for(var L=0;L<E.length;L++){if(H.email==E[L].Email){H.name=e.trim(E[L].Name)||e.trim(E[L].Email);break}}H.referstatus=parseInt(e("referstatus",this).text());G.push(H)}if(parseInt(e("referstatus",this).text())==3){H.email=e("email",this).text()||"";for(var L=0;L<E.length;L++){if(H.email==E[L].Email){H.name=e.trim(E[L].Name)||e.trim(E[L].Email);break}}H.username=e("username",this).text()||"";if(H.username!=e.profilar.forService()["username"]){d.push(H.username);H.referstatus=parseInt(e("referstatus",this).text());I.push(H)}}})}o=I;z=G;if(typeof F=="function"){F.call(this)}})};f.contactsRecieved=function(E){clearTimeout(m);m=false;if(f.origin=="social-game"){e("#sg_harvesting_popup").show()}o=[],d=[],z=[];f.alienExists=false;if(E.length){x(E,function(){if(o.length>0&&jQuery.profilar.canAddFriends()){f.prepareStep("secondStep");f.switchPage("secondStep");if(z.length>0){f.lastStep="thirdStep";f.alienExists=true}else{f.lastStep="noFriends"}}else{if(z.length>0){f.lastStep="thirdStep";f.prepareStep("thirdStep");f.switchPage("thirdStep");f.alienExists=true}else{if(f.origin=="social-game"){f.switchToFinal(true)}else{f.lastStep="noFriends";f.prepareStep("noFriends");f.switchPage("noFriends")}}}q.popup.close()})}else{if(f.origin=="social-game"){f.switchToFinal(true)}else{f.lastStep="noFriendsAtAll";f.prepareStep("noFriendsAtAll");f.switchPage("noFriendsAtAll")}q.popup.close()}};f.renderHarvestedList=function(){var G=z;e(".harvestNewList table").empty();var F=0;if(G&&G.length>0){for(var F=0;F<G.length;F++){var I={};if(F%2){I.extraClass="odditem"}else{I.extraClass="evenitem"}I.email=e.trim(G[F].email);if(G[F].name!==undefined&&e.trim(G[F].name)!=""){I.name=e.trim(G[F].name)}else{I.name=e.trim(G[F].email)}var E=e(q.render(D.templates.newUser,I));e(E).find("input").data("email",e.trim(G[F].email)).data("displayname",I.name);e(".harvestNewList table").append(E)}}else{var E=e(q.render(D.templates.noContacts,{}));e(".harvestNewList table").append(E)}if(e(".harvestStep3Desc:first").length==1&&D.langStrings.thirdDescription){var H=q.sprintf(D.langStrings.thirdDescription,'<span class="makeBold">'+b()+"</span>",'<span class="makeBold">'+D.langStrings[f.currentAccount+"_step2"]+"</span>");e(".harvestStep3Desc:first").empty().html(H)}if(G.length<D.settings.newContactsPerPage&&f.origin=="default"){e(".harvestNewList").css("overflow","auto");e(".harvestNewList").css("height","auto")}else{f.switchPage(f.lastStep);if(f.origin=="social-game"){e(".harvestNewList").css({"padding-right":"0px","border-right":"none",height:"300px",width:"610px"});e(".harvestNewList").jScrollPane({scrollbarWidth:17,showArrows:true,arrowSize:15})}}e(".harvestListInfo2 p").html(q.sprintf(D.langStrings.friends_found_on_mail,"<span>"+G.length+"</span>"))};var b=function(){var F=parseInt(z.length);if(o&&o.length>0){for(var E=0;E<o.length;E++){if(o[E].correctOne==true){F++}}}return F};f.renderRegisteredListItem=function(H){var I={},G="";for(var F=0;F<o.length;F++){for(var E=0;E<H.length;E++){if(o[F].username==H[E].username){if(H[E].avatar){o[F].avatar=q.sprintf(q._settings.avatarImages.small_avatar,H[E].avatar);o[F].avatar_big=q.sprintf(q._settings.avatarImages.big_avatar,H[E].avatar)}else{o[F].avatar=q._settings.avatarImages.anonymousIcon;o[F].avatar_big=q._settings.avatarImages.anonymousIconBig}o[F].friendstatus=H[E].friendstatus||0;o[F].correctOne=true;break}}if(o[F].correctOne){I={};I.no=o[F].no;I.username=o[F].username;I.userprofilelink=q.sprintf(q._settings.highscore.userprofile_link,I.username);I.name=o[F].name;I.avatar=o[F].avatar;I.avatar_big=o[F].avatar_big;G=e(q.render(D.templates.registeredUserItem,I));e(".harvestRegisteredList ul #hrl_"+o[F].no).empty().append(G);if(typeof D.settings.registeredAfterCallback=="function"){D.settings.registeredAfterCallback.call(this,G)}}else{e(".harvestRegisteredList ul #hrl_"+o[F].no).remove()}}if(e(".harvestRegisteredList ul li").length==0){f.prepareStep(f.lastStep);f.switchPage(f.lastStep);return}if(e(".harvestRegisteredList ul li").length<=parseInt(D.settings.registeredContactsPerPage)&&f.origin=="default"){e(".harvestRegisteredList").css("overflow","auto");e(".harvestRegisteredList").css("height","auto")}else{e(".harvestRegisteredList").css({"padding-right":"0px","border-right":"none"});e("#markAllForInvite").css({"margin-left":"5px"});if(f.origin=="social-game"){e(".harvestRegisteredList").jScrollPane({scrollbarWidth:17,showArrows:true,arrowSize:15})}}e(".harvestSecondDescriptionBold").html(q.sprintf(D.langStrings.contacts_located,D.langStrings[f.currentAccount+"_step2"]));e(".harvestListInfo p").text(q.sprintf(D.langStrings.friends_found_on_portal,q._settings.global.domainname,e(".harvestRegisteredList ul li").length));e(".harvestSecondDescription .description").html(q.sprintf(D.langStrings.secondDescription,'<span class="makeBold">'+b()+"</span>",'<span class="makeBold">'+D.langStrings[f.currentAccount+"_step2"]+"</span>"));if(typeof D.settings.registeredListAfterCallback=="function"){D.settings.registeredListAfterCallback()}};f.renderRegisteredList=function(){var G=o;if(!G.length){return false}e(".harvestRegisteredList ul").empty();var H,E;for(var F=0;F<G.length;F++){H={};H.no=F;G[F].no=F;if(F%2){H.extraClass="odditem"}else{H.extraClass="evenitem"}E=Math.ceil((F+1)/2);if(E%2){H.extraClass+=" oddrow"}else{H.extraClass+=" evenrow"}userelem=e(q.render(D.templates.registeredUser,H));e(".harvestRegisteredList ul").append(userelem)}e.profilar.loadExternalPrefs(d,function(I,J){if(I){f.renderRegisteredListItem(I)}},["avatar","privacy"],"site","channel");return};f.prepareStep=function(F,G){var E=true;e(".harvestMsgHolder p").html(v(e(".harvestMsgHolder textarea").val()));switch(F){case"firstStep":e(".harvestSingleMsgHolder textarea").val(q.sprintf(q._langStrings.friends.prefilled_manual_text,q._settings.global.domainname));e(".harvestSingleMsgHolder textarea").keyup();e(".harvestPagetitle").text(D.settings.pageSwitcher[0].pageTitle).removeClass("sendEmail");e("input[name=emailaccount]").removeAttr("checked");break;case"secondStep":if(f.currentAccount!=false){e(".harvestPagetitle").text(q.sprintf(D.settings.pageSwitcher[1].pageTitle,D.langStrings[f.currentAccount])).removeClass("sendEmail");e("div.accountType").removeClass("gmail").removeClass("yahoo").removeClass("live").addClass(f.currentAccount);e(".harvestListInfo p").text(q.sprintf(D.langStrings.friends_found_on_portal,q._settings.global.domainname,o.length));f.renderRegisteredList()}e(".singleMailSecondStep").hide();e(".emailList").empty();B();e(".harvestMsgHolder textarea").val("");e(".singleMailFirstStep").show();break;case"thirdStep":if(f.currentAccount!=false){if(z.length){e(".harvestPagetitle").text(D.settings.pageSwitcher[2].pageTitle).addClass("sendEmail");e(".harvestListInfo, .harvestFirstAccounts",".harvestThirdBody").show();e(".harvestSendEmail").removeClass("buttonDisabled");e(".harvestSendEmailToNew .bluebutton").data("canClick",true)}else{f.prepareStep("noFriends");f.switchPage("noFriends")}f.renderHarvestedList()}break;case"noFriendsAtAll":e(".noActionForStep").hide();e(".noFriendsAtAll").show();f.switchPage("noFriendsAtAll");E=false;break;case"noFriends":e(".noActionForStep").show();e(".noFriendsAtAll").hide();f.switchPage("noFriends");break}return E};f.switchPage=function(E,G){var F=0;for(F=0;F<D.settings.pageSwitcher.length;F++){if(D.settings.pageSwitcher[F].pageName==E){u(D.settings.pageSwitcher[F].stepNr);e(D.settings.pageSwitcher[F].toHide).css("display","none");e(D.settings.pageSwitcher[F].toShow).show();if(D.settings.afterSwitchPageCallback&&typeof D.settings.afterSwitchPageCallback=="function"){D.settings.afterSwitchPageCallback.call(this,E)}if(G&&typeof G=="function"){G.call(this,E)}return true}}return false};var j=function(){if(f.origin=="social-game"){e(".harvestRegisteredList ul li input[type=checkbox]:checked").each(function(){q.friends.friendInviteWithMailToGame(e(this).attr("id").slice(4),function(F,E){})})}else{e(".harvestRegisteredList ul li input[type=checkbox]:checked").each(function(){q.friends.friendInviteWithMail(e(this).attr("id").slice(4),function(F,E){})})}f.prepareStep(f.lastStep)};var A=function(){q.popup.show(q.render(D.templates.send,{accountType:"gmails",info:D.langStrings.friends_invite_harvest_manualinvite_body}),function(){},{type:"default",title:D.langStrings.friends_invite_harvest_manualinvite_boxtitle,close:false});var E=e.profilar.forService().username,F=e.profilar.get("givenname"),I=E;var H=D.settings.exposeGivennameMinAge;if(e.profilar.get("age")>H&&F!==undefined&&F!=""&&E!=F){I=F}var G=0;e(".harvestNewList table td input[type=checkbox]:checked").each(function(){var K=[],L=[];L=[{name:"displayname",value:e(this).data("displayname")},{name:"username",value:e.profilar.forService()["username"]},{name:"firstname",value:I},{name:"avatar_id",value:e.profilar.getPref("avatar")}];if(e(".harvestMsgHolder textarea").length){var J=e(".harvestMsgHolder textarea").val();L.push({name:"message",value:q.escapeHTML(J)})}K.push({email:e(this).data("email")});if(f.origin=="social-game"){L.push({name:"gamenicename",value:gameNicename});L.push({name:"gametitle",value:gameTitle});L.push({name:"friend_username",value:I});L.push({name:"game_id",value:window.gameHarvestingId})}q.cheetach.sendBulk(C(),K,L,function(){G=G+1;if(G==e(".harvestNewList table td input[type=checkbox]:checked").length){q.popup.close();p(true);if(f.origin=="social-game"){f.switchToFinal()}else{f.switchPage("friendsList");q.notice.renderMessage("","harvestingdone",null,function(M){scroll(0,0)})}}},true)})};var C=function(){if(f.origin=="social-game"){return"gameInviteToPortal"}return"inviteFormHarvest"};var n=function(){if(f.orgin=="social-game"){return[{name:"displayname",value:e(this).data("displayname")},{name:"avatar_id",value:e.profilar.getPref("avatar")},{name:"username",value:e.profilar.forService()["username"]},{name:"firstname",value:e.profilar.forService().username}]}return[{name:"displayname",value:e(this).data("displayname")},{name:"avatar_id",value:e.profilar.getPref("avatar")},{name:"username",value:e.profilar.forService()["username"]},{name:"firstname",value:e.profilar.forService().username}]};var s=function(F){o=[],d=[],z=[];var E=[];e(".emailList li input").each(function(){if((validateEmail(e(this).val()).valid||validateEmail(e(this).val())===true)&&e(this).val()!=""&&e(this).val()!=e.profilar.get("email")){E.push({email:e(this).val()})}});if(E.length){x(E,function(){q.popup.show(q.render(D.templates.send,{accountType:"gmails",info:D.langStrings.friends_invite_harvest_manualinvite_body}),function(){},{type:"default",title:D.langStrings.friends_invite_harvest_manualinvite_boxtitle,close:false});if(d.length){for(var J=0;J<d.length;J++){q.friends.friendInviteWithMail(d[J],function(M,L){})}}if(z.length){var G=e.profilar.forService().username,H=e.profilar.get("givenname"),K=G;var I=D.settings.exposeGivennameMinAge;if(e.profilar.get("age")>I&&H!==undefined&&H!=""&&G!=H){K=H}var J=0;e(z).each(function(M,N){var L=[];_fields=[{name:"displayname",value:N.email},{name:"avatar_id",value:e.profilar.getPref("avatar")},{name:"username",value:e.profilar.forService()["username"]},{name:"firstname",value:K},{name:"message",value:q.escapeHTML(e(".harvestSingleMsgHolder textarea").val())}];L.push({email:N.email});q.cheetach.sendBulk("inviteFormHarvest",L,_fields,function(){J=J+1;if((typeof F=="function")&&(z.length==J)){F.call(this)}},true)})}else{if(typeof F=="function"){F.call(this)}}})}else{if(typeof F=="function"){F.call(this)}}};var B=function(){var E=5;if(e(".emailList li").length<E){var F=e(q.render(D.templates.addEmail,{}));F.find("input").blur(function(){if(e(this).val()!=""){if(validateEmail(e(this).val()).valid||validateEmail(e(this).val())===true){e(this).parent().find(".harvestingEmailOk").show();e(this).parent().find(".harvestingEmailError").hide()}else{e(this).parent().find(".harvestingEmailOk").hide();e(this).parent().find(".harvestingEmailError").show()}}}).focus(function(){e(this).parent().find(".harvestingEmailOk").hide();e(this).parent().find(".harvestingEmailError").hide()});e(".emailList").append(F);if(e(".emailList li").length==E){e("a.addMoreEmails").remove()}}};var r=function(){if(e(".singleMailSecondStep:visible").length){e(".singleMailSecondStep").hide();e(".emailList").empty();B();f.prepareStep("firstStep");e(".singleMailFirstStep").show()}else{e(".singleMailSecondStep").show();e(".singleMailFirstStep").hide()}};var v=function(H,E,G){H=H||"";E=E||D.settings.maxMsgLength;G=G||q._langStrings.harvester.friends_invite_harvest_step3_maxchars;var F=0;if(H.length>=E){F=0}else{F=E-H.length}return q.sprintf(G,F)};f.beginHarvestClickFunction=function(){e("div[noticeaction=harvestingdone]").remove();f.prepareStep("firstStep");f.switchPage("firstStep");return false};f.startAutoHarvesting=function(E){f.beginHarvestClickFunction();e(".selectHolder","ul.harvestAccounts li."+E).addClass("active");e("input[name=emailaccount]","ul.harvestAccounts li."+E).attr("checked","checked");e(".harvestLoginToAccount").removeClass("buttonDisabled");e("a.harvestLogin").data("canClick",false);q.popup.init();y(E)};f.harvestLoginClickFunction=function(){if(e("a.harvestLogin").data("canClick")){e("a.harvestLogin").data("canClick",false);if(e("input[name=emailaccount]:checked").val()&&e.inArray(e("input[name=emailaccount]:checked").val(),D.settings.availServers)!=-1){y(e("input[name=emailaccount]:checked").val())}else{e("a.harvestLogin").data("canClick",true)}}return false};f.init=function(E){if(!f.initialised){q.getAndUpdateConfig("harvester",D);e.extend(true,D.settings,E);f.origin=D.settings.origin;f.initialised=true;f.prepareStep("firstStep");e("a.beginHarvest").click(function(){f.beginHarvestClickFunction()});e("a.harvestLogin").click(function(){f.harvestLoginClickFunction()}).data("canClick",true);e("#markAllForHarvest").click(function(){if(e("#markAllForHarvest:checked").length){e(".harvestNewList table td input[type=checkbox]").attr("checked",true)}else{e(".harvestNewList table td input[type=checkbox]").removeAttr("checked")}});e("#markAllForInvite").click(function(){if(e("#markAllForInvite:checked").length){e(".harvestRegisteredList li input[type=checkbox]").attr("checked",true)}else{e(".harvestRegisteredList li input[type=checkbox]").removeAttr("checked")}});if(f.origin!="social-game"){e(".harvestInviteRegistered a").not(".secondBlue").click(function(){j();f.switchPage(f.lastStep);return false});e(".harvestSendEmailToNew a").not(".secondBlue").click(function(){if(e(this).data("canClick")){var F=e(".harvestNewList input[type=checkbox]:checked").length;if(F>0){A();if(f.origin=="social-game"){f.invitesSent=F}l()}}return false})}e("a.addMoreEmails").click(function(){B();return false});e(".emailList").empty();B();e(".harvestSingleMsgHolder textarea").keyup(function(F){if(e(this).val().length>255){e(this).val(e(this).val().slice(0,255))}e(".harvestSingleMsgHolder p").html(v(e(this).val()))});e(".harvestMsgHolder textarea").not(".harvestSingleMsgHolder").keyup(function(F){if(e(this).val().length>255){e(this).val(e(this).val().slice(0,255))}e(".harvestMsgHolder").not(".harvestSingleMsgHolder").find("p").html(v(e(this).val()))});e(".sendMessageButton a").click(function(){var F=false;e(".emailList li input").each(function(){if((validateEmail(e(this).val())===true||validateEmail(e(this).val()).valid)&&e(this).val()!=""){F=true}});if(!F){return F}s(function(){q.popup.close();r()});return false});e(".sendMessageButtonBack a").click(function(){r();l();return false});e(".singleMailPreview").click(function(){window.open(domain_pool.getURL("/img/_/friends/msgPreview.jpg"),"msgpreview","location=0,status=0,scrollbars=0,width=724,height=696");return false});if(f.origin!="social-game"){e(".harvestInviteRegistered .secondBlue").click(function(){p();f.prepareStep(f.lastStep);f.switchPage(f.lastStep);return false});e(".harvestSendEmailToNew .secondBlue").click(function(){p();l();f.switchPage("friendsList",function(){scroll(0,0)});return false})}if(f.origin=="social-game"){e(".harvestInviteRegistered a").not(".secondBlue").click(function(){j();f.invitesSent=e(".harvestRegisteredList input[type=checkbox]:checked").length;if(f.invitesSent>0){showSGMessage()}if(f.alienExists){f.switchPage("thirdStep")}else{f.switchToFinal()}return false});e(".harvestInviteRegistered .secondBlue").click(function(){e(".harvestRegisteredList input[type=checkbox]:checked").attr("checked",false);f.invitesSent=0;if(!f.alienExists){f.switchToFinal()}else{f.renderHarvestedList();e(".harvestContainer.game .harvestBody").hide();e(".harvestContainer.game .harvestThirdBody.harvestBody").show()}return false});e(".harvestSendEmailToNew a").not(".secondBlue").click(function(){f.emailsSent=e(".harvestNewList table td input[type=checkbox]:checked").length;if(f.emailsSent>0){A("inviteFormSocialgame2")}return false});e(".harvestSendEmailToNew .secondBlue").click(function(){e(".harvestNewList table td input[type=checkbox]:checked").attr("checked",false);f.emailsSent=0;f.switchToFinal();return false})}}};var p=function(E){f.emailsSent=0;f.invitesSent=0;e("input#markAllForHarvest, input#markAllForInvite").attr("checked","checked");if(E==true){l()}};f.switchToFinal=function(F){var G=e(".harvestContainer.game .harvestFinalBody");e(".harvestContainer.game .harvestBody").hide();e(".successMessage",G).hide();e(".no_contacts_message",G).hide();e(".skipMessage",G).hide();var E=e(".harvestRegisteredList input[type=checkbox]:checked").length+e(".harvestNewList table td input[type=checkbox]:checked").length;if(F){e(".noContactsMessage .mailservice").text(f.currentAccount);e(".noContactsMessage").show()}else{if(E){e(".successMessage").show();e(".successMessage h2 span").text(E)}else{e(".skipMessage").show()}}e(".harvestContainer.game .harvestFinalBody.harvestBody").show()};return f})(jQuery,SPI);SPI.avatars=(function(f,p){var A={settings:{itemsPerPage:20,maxPages:4,li_id:"avatar",useravatars_limit:10,timeout:7000,dummy_big:domain_pool.getURL("/img/userprofile/dummy_big.gif","cimg"),dummy_small:domain_pool.getURL("/img/userprofile/dummy_small.gif","cimg")}};p.getAndUpdateConfig("avatars",A);var h={};var g=false;h.avatar="";h.userAvatarsLength=0;var d=150;var b=175;var n=null;var u=[];var e=null;var m=null;h.init=function(B,C){var C=C||null;h.items=B.concat();h.selectedAvatarId=null;x();f("div#avatarslist ul li a").live("click",function(){f("div#avatarslist ul li.active").removeClass("active");var F=f(this).parent("li:first");F.addClass("active");var E=F.attr("avatarid");f("div#avatarslist ul li a.delprogress[avatarid="+E+"]").show();c(E);if(g==false&&E!=""&&E!="DEFAULT"&&E!="avatarid_"+h.avatar){g=true;var D=E.replace(/^[^_]+_/i,"");l(D)}return false});o(function(I){for(var D in B){if(B[D]["sponsored"]==0){break}}sponsored_items=B.slice(0,D);unsponsored_items=B.slice(D);var J=new Array();if(I.gamatar&&I.gamatar.resultset&&I.gamatar.resultset.result&&I.gamatar.resultset.result.length>0){var E=null,H=null;var G=I.gamatar.resultset.result;if(G.length>0){h.userAvatarsLength=G.length;for(var F in G){H=G[F];J.push({id:0,gamatarid:H.id,user:1})}}}h.items=new Array();h.items=sponsored_items.concat(J,unsponsored_items);h.renderList();if(C!=null&&typeof C=="function"){C.call(this)}})};var v=function(C,B){if(C&&C.gamatar){if(C.gamatar&&C.gamatar.errorcode!==undefined){C={gamatar:[]}}this.after_call(C)}};var o=function(B){f.ajax({global:false,cache:false,timeout:A.settings.timeout,url:p.sprintf(A.settings.avatar_url_list,p._settings.global.site_id),type:"GET",dataType:"json",success:v,error:function(E,C,D){if(C=="timeout"){h.renderList()}else{v.call(this,{gamatar:[]},"")}},after_call:B,data:{username:f.profilar.forService().username,hash:f.profilar.forService().hash,outputtype:"json"}})};var r=function(){f("#userAvatar").attr("src",A.settings.dummy_big);f(".m-user_navigation-avatarnormal").show();f("#avatardummy").hide();h.selectedAvatarId=null};var y=function(){if(userLevel>=A.settings.min_upload_level){var B="";if(h.userAvatarsLength>=A.settings.useravatars_limit){B=p._langStrings.avatars.user_avatars_limit_reached;f("div#uploader div.uploadavatar").hide();f("div#uploader div.sorrymessage").hide();f("div#uploader div.sorrymessage_limit").html(B).show()}else{f("div#uploader div.sorrymessage").hide();f("div#uploader div.sorrymessage_limit").hide();f("div#uploader div.uploadavatar").show()}}else{B=p.sprintf(p._langStrings.avatars.min_upload_level_message,A.settings.min_upload_level);f("div#uploader div.uploadavatar").hide();f("div#uploader div.sorrymessage").html(B).show();f("div#uploader div.sorrymessage_limit").hide()}};var j=function(C){var C=parseInt(C);if(C>0){if(h.items&&h.items.length>0){for(var B in h.items){if(parseInt(h.items[B].gamatarid)==C&&h.items[B].user==1){h.items.splice(B,1);h.userAvatarsLength--;if(C==h.avatar){z(function(D){if(D){}else{r()}})}else{if(C==h.selectedAvatarId||h.selectedAvatarId==null){x()}}break}}}}};h.renderList=function(F){if(f("div#avatarslist div.ul_container ul").length==0){f("div#avatarslist div.ul_container").append("<ul></ul>")}f("div#avatarslist ul").empty();var F=F||1;var I=h.items;if(I.length==0){return}var G=Math.ceil(I.length/A.settings.itemsPerPage);var D="";for(var C=(F*A.settings.itemsPerPage)-A.settings.itemsPerPage;C<(F*A.settings.itemsPerPage)&&C<I.length;C++){var J="";if((C+1)%5==0){J=" last"}var H='<a class="avatar" href="#"><img src="'+domain_pool.getURL(p.sprintf(p._settings.global.avatar_url_big,I[C].gamatarid),"cimg")+'" alt="" border="0" width="142" height="142" /><div class="button_group"><span class="button_left"><img src="'+domain_pool.getURL("/img/button_left.png")+'" alt="" /></span><span class="button_middle">'+p._langStrings.avatars.set_as_avatar+'</span><span class="button_right"><img src="'+domain_pool.getURL("/img/button_right.png")+'" alt="" /></span></div></a>';D=I[C].user==1?'<a class="removeAvatar closebtn" avatarid="'+I[C].gamatarid+'" title="'+A.langStrings.avatar_remove+'"></a>':"";indicator='<a class="delprogress" style="display: none;" avatarid="'+I[C].gamatarid+'" title="'+A.langStrings.avatar_remove+'"></a>';f("div#avatarslist ul").append('<li class="'+J+'" id="'+A.settings.li_id+"_"+C+'" avatarid="'+I[C].gamatarid+'">'+D+indicator+H+"</li>")}var B=p.paginatorString(I.length,F,A.settings.itemsPerPage,A.settings.maxPages,h.renderList,{next:A.langStrings.next,prev:A.langStrings.prev,separator:A.langStrings.separator});f(".pagination").empty();if(B!=""){f("#pagination_top").append(B);f("#pagination_bottom").append(B.clone(true))}if(h.selectedAvatarId!=null){f("div#avatarslist ul li[avatarid="+h.selectedAvatarId+"]").addClass("active")}var E=new p.popupper({id:"removeavatar",template:"basicPopup",templateVars:{buttons:{left:'<div class="dbtn dbtnSimple dbtnleft confirm_left"><a class="left popup_blue_button" href="#">'+p._langStrings.avatars.button_yes+'<span class="right">&nbsp;</span></a></div>',right:'<div class="dbtn dbtnSimple dbtnleft confirm_right"><a class="left popup_bottom_button" href="#">'+p._langStrings.avatars.button_no+'<span class="right">&nbsp;</span></a></div>'},title:"",content:p._langStrings.avatars.confirm_delete,titleIcon:"popupper_icon_warning"},autoShow:false,initPopup:function(){var K=this;this.domPopup.find(".confirm_left").click(function(L){L.preventDefault();s(K.avatarId,function(M){if(M===true){j(K.avatarId);h.renderList()}else{f("div#avatarslist ul li a.delprogress[avatarid="+K.avatarId+"]").hide()}});K.hide()});this.domPopup.find(".confirm_right").click(function(L){L.preventDefault();K.hide()});this.domPopup.find(".popup_closelink").click(function(L){L.preventDefault();K.hide()})}});f("div#avatarslist ul li a.removeAvatar").click(function(){E.avatarId=parseInt(f(this).attr("avatarid"));E.show();return false});f("li[avatarid="+h.avatar+"]").addClass("active");attachAvatarHovers()};var s=function(C,B){if(C>0){f.ajax({global:false,cache:false,beforeSend:function(){f("div#avatarslist ul li a.delprogress[avatarid="+C+"]").show()},timeout:A.settings.timeout,url:p.sprintf(A.settings.avatar_url_delete,C),type:"POST",dataType:"json",success:q,error:function(F,D,E){q.call(this,{gamatar:[]},"")},after_call:B,data:{username:f.profilar.forService().username,hash:f.profilar.forService().hash,outputtype:"json"}})}};var q=function(C,B){var D=false;var C=typeof C.gamatar.result!="undefined"&&typeof C.gamatar.result.id!="undefined"?C.gamatar.result.id:0;if(C>0){D=true}this.after_call(D)};var c=function(G){var G=parseInt(G);if(G!=h.selectedAvatarId){var D='<img src="'+domain_pool.getURL(p.sprintf(p._settings.global.avatar_url_big,G),"cimg")+'" border="0" width="%1$s" height="%1$s" alt="" style="display:none;" />';var C='<img src="'+domain_pool.getURL(p.sprintf(p._settings.global.avatar_url_small,G),"cimg")+'" border="0" width="%1$s" height="%1$s" alt="" style="display:none;" />';var B=p.sprintf(D,150);var F=p.sprintf(C,50);var E=p.sprintf(C,20);f("div#avatarselected div.picture1").empty().attr("id","avatarid_"+G).append(""+B);f("div#avatarselected div.picture1 img").fadeIn();f("div#avatarselected div.picture2").empty().append(""+F);f("div#avatarselected div.picture2 img").fadeIn();f("div#avatarselected div.picture3").empty().append(""+E);f("div#avatarselected div.picture3 img").fadeIn()}h.selectedAvatarId=G};var x=function(){var G=f.profilar.getPref("avatar");if(G!=""){h.avatar=parseInt(G);var D='<img src="'+domain_pool.getURL(p.sprintf(p._settings.global.avatar_url_big,G),"cimg")+'" border="0" width="%1$s" height="%1$s" alt="" style="display:none;" />';var C='<img src="'+domain_pool.getURL(p.sprintf(p._settings.global.avatar_url_small,G),"cimg")+'" border="0" width="%1$s" height="%1$s" alt="" style="display:none;" />';var B=p.sprintf(D,150);var F=p.sprintf(C,50);var E=p.sprintf(C,20);f("div#avatarselected div.picture1").empty().attr("id","DEFAULT").append(""+B);f("div#avatarselected div.picture1 img").fadeIn();f("div#avatarselected div.picture2").empty().append(""+F);f("div#avatarselected div.picture2 img").fadeIn();f("div#avatarselected div.picture3").empty().append(""+E);f("div#avatarselected div.picture3 img").fadeIn()}else{r()}};var z=function(B){f.profilar.setPref("avatar","");f.profilar.submitPref(function(C){if(typeof B=="function"){B.call(this,false)}})};var l=function(C){var B=parseInt(C);if(B>0){B=""+B;f.profilar.setPref("avatar",B);f.profilar.submitPref(function(D){if(D){p.flashMessage.set(A.langStrings.error_connection,true)}else{sendSpilEvent("Profile","Select avatar",B,10);p.flashMessage.set(A.langStrings.avatar_saved)}window.top.location.href=A.settings.redirect_url})}};h.calculateDim=function(B,C){ratio=B/C;if(B>d||C>b){x1=d;y1=Math.ceil(d/ratio);y2=b;x2=Math.ceil(b*ratio);if(x1<=d&&y1<=b){newx=x1;newy=y1}else{newx=x2;newy=y2}}else{newx=B;newy=C}return[newx,newy]};h.setCropMask=function(B){n=B};h.cropAvatarHandler=function(B){f("a#cropavatar").click(function(){p.avatars.cropAvatar()});if(B.type==0){p.avatars.init(avatarsArray,function(){p.avatars.hidePopup();f("li[avatarid="+B.message.id+"] a.avatar").click()})}else{p.avatars.showCropError()}f(".cropIndicator").css("display","none");return false};h.cropAvatar=function(){f(".cropIndicator").css("display","block");f("a#cropavatar").unbind("click");url=p.sprintf("/ir/%d/%d/%d/%d/%d",_id,n.x,n.y,n.w,n.h);f.ajax({global:false,cache:false,type:"POST",url:url,dataType:"json",success:p.avatars.cropAvatarHandler,error:p.avatars.showCropError});return false};h.avatarUploadHandler=function(C,B){if(C.type==0){newDim=p.avatars.calculateDim(C.message.width,C.message.height);_newDim=newDim;_id=C.message.id;imgPrev=p.sprintf(p._settings.global.avatar_url_big,C.message.id);f(".avatarImagePreview p,.avatarImagePreview img").css("display","none");f(".avatarImagePreview").append('<div class="avatarImageHolder" style="width:'+newDim[0]+"px;height:"+newDim[1]+'px;"></div>');f("div.avatarImageHolder").css("margin-top",Math.ceil((175-newDim[1])/2)+10+"px");f("div.avatarImageHolder").append('<img class="avatarPreview" width="'+newDim[0]+'" height="'+newDim[1]+'" src="'+domain_pool.getURL(imgPrev,"cimg")+'">');crpsize=Math.floor(Math.min(newDim[0],newDim[1])*0.8);crpx=Math.round((newDim[0]-crpsize)/2);crpy=Math.round((newDim[1]-crpsize)/2);m=[crpx,crpy,crpx+crpsize,crpy+crpsize];e=f.Jcrop("div.avatarImagePreview img.avatarPreview",{aspectRatio:1,maxSize:[C.message.width,C.message.height],sideHandles:false,keySupport:false,allowSelect:false,minSize:[5,5],minSelect:[5,5],trueSize:[C.message.width,C.message.height],onChange:p.avatars.setCropMask,setSelect:m});f(".avatarUpload").hide();f(".avatarCrop").show()}else{if(C.type==413){h.avatarUploadErrorHandler(413)}else{if(C.type==1&&C.message=="Incorrect file"){h.avatarUploadErrorHandler(1)}else{resp=C+"";if(resp.indexOf("413")){h.avatarUploadErrorHandler(413)}else{h.avatarUploadErrorHandler(0)}}}}};h.resetCrop=function(){f("div.avatarCrop").hide();f("div.avatarUpload").show();f("input#avatarFile").before('<input type="file" name="avatar" id="avatarFile">').remove();f("div.avatarImagePreview *").not("p").not("span").not("br").not("img.uploadIndicator").remove();f("div.avatarImagePreview p").show();f("div.avatarImagePreview img").css("display","none")};h.showUploadError=function(B){f(".uploadFileInfo").hide();f(".uploadFileError").html(B);f(".uploadFileError").show()};h.hideUploadError=function(B){f(".uploadFileInfo").show();f(".uploadFileError").html("").hide()};h.showCropError=function(){f(".uploadFileInfo").hide();f(".uploadFileError").html("pierdut").show()};h.hideCropError=function(B){f(".cropFileInfo").show();f(".cropFileError").html("").hide()};h.avatarUploadErrorHandler=function(B){switch(B){case 413:h.showUploadError(p._langStrings.avatars.au_error_file_to_big);break;case 1:h.showUploadError(p._langStrings.avatars.au_error_incorrect_file);break;default:h.showUploadError(p._langStrings.avatars.au_error_connection);break}};h.avatarFileUpload=function(){h.hideUploadError();f(".avatarImagePreview img").ajaxStart(function(){f(this).css("display","block");f("a#uploadavatar").unbind("click")}).ajaxComplete(function(){f(this).css("display","none");f("a#uploadavatar").click(function(){p.avatars.avatarFileUpload();return false})});f.ajaxFileUpload({url:"/iu/",secureuri:false,fileElementId:"avatarFile",dataType:"json",success:p.avatars.avatarUploadHandler,error:function(){p.avatars.avatarUploadErrorHandler(0)}});return false};h.raisePopup=function(){h.hideUploadError();h.hideCropError();h.resetCrop();var C=0,B=0;if(typeof(window.innerWidth)=="number"){C=window.innerWidth;B=window.innerHeight}else{if(document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)){C=document.documentElement.clientWidth;B=document.documentElement.clientHeight}else{if(document.body&&(document.body.clientWidth||document.body.clientHeight)){C=document.body.clientWidth;B=document.body.clientHeight}}}if(f.profilar.loggedIn()){newmargin=Math.round((parseInt(B)-225)/2);if(newmargin<0){newmargin=0}u=f("object:visible").add("#flashobj_mc").add("#gameiframe_js").add("#ap_preroll");f(u).each(function(){f(this).css("visibility","hidden")});f("div.avataruploadWrapper").css("margin-top",newmargin+"px");f("div#avataruploadshadow").css("display","block")}};h.hidePopup=function(){h.resetCrop();f("div#avataruploadshadow").css("display","none");f(u).each(function(){f(this).css("visibility","visible")})};return h})(jQuery,SPI);var updateFlash={startDownload:function(c){var b=c;window.open(b,"Download")},handleResponse:function(b){if(b.PlayerLatest>$.flashdet.version.major){version=b.PlayerLatest;playerUrl=b.PlayerUrl;alertMsg=SPI._langStrings.myGames.upgradeFlashLong+' <a class ="playerLink" href='+playerUrl+' target="_blank"></a>';$(".updatePlayerVersion").css("display","block");$(".updatePlayerText").html(alertMsg);$(".updatePlayerText .playerLink").text(SPI._langStrings.myGames.upgradeFlashShort);$(".updatePlayerText .playerLink").css("color","white");$(".updatePlayerClose").click(function(){$(".updatePlayerVersion").slideUp()})}}};SPI.popupperPluginManager.addPlugin("tooltip",{pluginOptions:{event:false,stickToElement:false,offsetX:-50,offsetY:-50,constraintX:false,constraintY:false},initializePlugin:function(b){this.pluginOptions=b},showPopup:function(){var e=this;var c={"z-index":SPI.popupper_zindexBreed,position:"absolute"},g,f;if(typeof this.pluginOptions.stickToElement!="undefined"){var b=this.pluginOptions.stickToElement.offset();g=b.left+this.pluginOptions.offsetX;f=b.top+this.pluginOptions.offsetY;if(e.pluginOptions.constraintX===true){c.left=100+"px"}else{c.left=g+"px"}c.left=g+"px";c.top=f+"px";this.domPopup.css(c);this.domPopup.show()}else{var d=this.pluginOptions.event;$(d.target).mousemove(function(l){var h={left:l.pageX,top:l.pageY};var j=$(this).offset();g=h.left+e.pluginOptions.offsetX;f=h.top+e.pluginOptions.offsetY;if(e.pluginOptions.constraintY===true){c.top=j.top+e.pluginOptions.offsetY+"px"}else{c.top=f+"px"}if(e.pluginOptions.constraintX===true){c.left=j.left+e.pluginOptions.offsetX+"px"}else{c.left=g+"px"}e.domPopup.css(c);if(e.domPopup.is(":visible")){}else{e.domPopup.show()}})}}});SpilGames(["Cache"],function(j){var h="_lastplayed",g,b={},f,e,d;g=document.getElementsByTagName("meta");for(d=0;d<g.length;d+=1){f=g[d].getAttribute("property")||g[d].getAttribute("itemprop")||"temp";e=g[d].getAttribute("content")||null;if(b[f]){if(b[f] instanceof Array){b[f].push(e)}else{b[f]=[b[f],e]}}else{b[f]=e}}delete b.temp;if(b["game:permalink"]){j.getItem({key:h},function(n){var o=n||[],v,A,u,m,p,z=b["game:id"],x=b["game:title"],r=b["og:description"],y=b["game:permalink"],s=b["game:image"][0],q=b["game:image"][1],l=b["game:image"][2],c=b.ratingValue;A=(function(C,B){for(p=0;p<C.length;p+=1){m=C[p];if(m.id===B){return p}}return false}(o,z));if(A!==false){u=A;v=o.splice(u,1)}if(o.length>7){o.pop()}o.unshift({id:z,title:x,description:r,url:y,thumbnailSmall:l,thumbnailMedium:q,thumbnailLarge:s,rating:c});j.setItem({key:h,value:o,expires:((3600*24)*30)})})}});function checkForFullScreen(){sendSpilEvent("Fullscreen","checkForFullScreen");var b=document.createElement("div");if(b.requestFullscreen||b.webkitRequestFullscreen||b.mozRequestFullScreen){sendSpilEvent("Fullscreen","fullScreenAvailable");var c=document.querySelector("#fullscreen");c.style.display="block";bigScreen();allowFullScreen()}}function bigScreen(){
/*! BigScreen
     * v2.0.3 - 2013-10-18
     * https://github.com/bdougherty/BigScreen
     * Copyright 2013 Brad Dougherty; Apache 2.0 License
     */
(function(m,B,n){var h=typeof Element!=="undefined"&&"ALLOW_KEYBOARD_INPUT" in Element;var p=/i(Pad|Phone|Pod)/.test(navigator.userAgent)&&parseInt(navigator.userAgent.replace(/^.*OS (\d+)_(\d+).*$/,"$1.$2"),10)>=7;var l=function(){var I=B.createElement("video");var H={request:["requestFullscreen","webkitRequestFullscreen","webkitRequestFullScreen","mozRequestFullScreen","msRequestFullscreen"],exit:["exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],enabled:["fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled"],element:["fullscreenElement","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"],change:["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],error:["fullscreenerror","webkitfullscreenerror","mozfullscreenerror","MSFullscreenError"]};var F={};for(var J in H){for(var E=0,G=H[J].length;E<G;E++){if(H[J][E] in I||H[J][E] in B||"on"+H[J][E] in B){F[J]=H[J][E];break}}}return F}();function o(F){var G=null;if(F.tagName==="VIDEO"){G=F}else{var E=F.getElementsByTagName("video");if(E[0]){G=E[0]}}return G}var C=null;var c=null;var v=function(){};var x=[];var e=navigator.userAgent.indexOf("Android")>-1&&navigator.userAgent.indexOf("Chrome")>-1;function u(E){var F=o(E);if(F&&F.webkitEnterFullscreen){try{if(F.readyState<F.HAVE_METADATA){F.addEventListener("loadedmetadata",function H(){F.removeEventListener("loadedmetadata",H,false);F.webkitEnterFullscreen();c=!!F.getAttribute("controls")},false);F.load()}else{F.webkitEnterFullscreen();c=!!F.getAttribute("controls")}C=F}catch(G){return s("not_supported",E)}return true}return s(l.request===undefined?"not_supported":"not_enabled",E)}function q(){if(!b.element){r();y()}}function f(){if(n&&l.change==="webkitfullscreenchange"){m.addEventListener("resize",q,false)}}function y(){if(n&&l.change==="webkitfullscreenchange"){m.removeEventListener("resize",q,false)}}var A=function(E){var F=x[x.length-1];if((E===F.element||E===C)&&F.hasEntered){return}if(E.tagName==="VIDEO"){C=E}if(x.length===1){b.onenter(b.element)}F.enter.call(F.element,E||F.element);F.hasEntered=true};var r=function(){if(C&&!c&&!p){C.setAttribute("controls","controls");C.removeAttribute("controls")}C=null;c=null;var E=x.pop();if(E){E.exit.call(E.element);if(!b.element){x.forEach(function(F){F.exit.call(F.element)});x=[];b.onexit()}}};var s=function(G,E){if(x.length>0){var F=x.pop();E=E||F.element;F.error.call(E,G);b.onerror(E,G)}};var b={request:function(F,H,I,E){F=F||B.body;x.push({element:F,enter:H||v,exit:I||v,error:E||v});if(l.request===undefined){return u(F)}if(n&&B[l.enabled]===false){return u(F)}if(e){return u(F)}if(n&&l.enabled===undefined){l.enabled="webkitFullscreenEnabled";F[l.request]();setTimeout(function(){if(!B[l.element]){B[l.enabled]=false;u(F)}else{B[l.enabled]=true}},250);return}try{if(/5\.1[\.\d]* Safari/.test(navigator.userAgent)){F[l.request]()}else{F[l.request](h&&Element.ALLOW_KEYBOARD_INPUT)}setTimeout(function(){if(!B[l.element]){s(n?"not_enabled":"not_allowed",F)}},100)}catch(G){s("not_enabled",F)}},exit:function(){y();B[l.exit]()},toggle:function(F,G,H,E){if(b.element){b.exit()}else{b.request(F,G,H,E)}},videoEnabled:function(E){if(b.enabled){return true}E=E||B.body;var F=o(E);if(!F||F.webkitSupportsFullscreen===undefined){return false}return F.readyState<F.HAVE_METADATA?"maybe":F.webkitSupportsFullscreen},onenter:v,onexit:v,onchange:v,onerror:v};try{Object.defineProperties(b,{element:{enumerable:true,get:function(){if(C&&C.webkitDisplayingFullscreen){return C}return B[l.element]||null}},enabled:{enumerable:true,get:function(){if(l.exit==="webkitCancelFullScreen"&&!n){return true}if(e){return false}return B[l.enabled]||false}}})}catch(g){b.element=null;b.enabled=false}if(l.change){B.addEventListener(l.change,function D(F){b.onchange(b.element);if(b.element){var E=x[x.length-2];if(E&&E.element===b.element){r()}else{A(b.element);f()}}else{r()}},false)}B.addEventListener("webkitbeginfullscreen",function z(E){x.push({element:E.srcElement,enter:v,exit:v,error:v});b.onchange(E.srcElement);A(E.srcElement)},true);B.addEventListener("webkitendfullscreen",function d(E){b.onchange(E.srcElement);r(E.srcElement)},true);if(l.error){B.addEventListener(l.error,function j(E){s("not_allowed")},false)}m.BigScreen=b})(window,document,self!==top)}function allowFullScreen(){var I,o,x;var P=window,U=document,S=U.getElementById("l-mainContent"),J=S.parentNode,A=U.getElementById("game-integration"),r=U.getElementById("sgAdScGp160x600"),B=U.getElementById("theGame"),F=U.getElementById("iframegame"),C=U.getElementById("backgroundScreen"),p=160,G=B.offsetWidth,D=B.offsetHeight,z=P.screen.width,M=P.screen.height,Q=(p/z)*112,q=(p/M)*112,g=z/100*Q,u=M/100*q,m=z/100*90,O=M/100*90,N=U.querySelector("#fullscreen"),n=function(Z,d,ab,aa){var Y=[ab/Z,aa/d];Y=Math.min(Y[0],Y[1]);return([{width:Z*Y+"px"},{height:d*Y+"px"}])},v=n(G,D,m,O),l=A.style,X=C.style,f=r.style,L=B.style,y=getComputedStyle(A).width,R=getComputedStyle(A).height,c=getComputedStyle(A).overflow,j=getComputedStyle(A).background,h=getComputedStyle(C).width,s=getComputedStyle(C).height,V=getComputedStyle(r)["float"],H=getComputedStyle(r).position,e=getComputedStyle(r).right,W=getComputedStyle(r).marginTop,K=getComputedStyle(r).marginLeft,E=getComputedStyle(B)["float"],b;x=function(){l.width=G+"px";l.height="initial";l.overflow=c;X.width=h;X.height=s};o=function(){l.width=v[0].width};if(F!==null){b=F.style}I=function(){if(BigScreen.onenter){sendSpilEvent("Fullscreen","bigScreenEnter");o();L.width=v[0].width;L.height=v[1].height;BigScreen.toggle(A)}};N.addEventListener("click",I,false);BigScreen.onexit=function(){sendSpilEvent("Fullscreen","bigScreenExit");L.width=G+"px";L.height=D+"px";if(F!==null){b.width=G+"px";b.height=D+"px";F.setAttribute("width",G+"px");F.setAttribute("height",D+"px")}x()}};