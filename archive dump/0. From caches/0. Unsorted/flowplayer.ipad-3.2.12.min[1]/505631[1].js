// Admotion Core v3.5.5.10

if(!document.body){document.write("<body></body>");}
if(!window.AdmotionMod){var AdmotionMod=function(){var _this=this;var _constructors={};var _instances={};var _loading={};var getCurrentId=function(config){config=config||ADM_CONFIG;return''+config.campaign+config.creative+config.channel;};var getUrl=function(id,name){var c=_instances[id].config;return name=="core"?c.jsCore:c.ext[name];};var getConstructor=function(id,name){return _constructors[getUrl(id,name)+'_'+name];};var setConstructor=function(id,name,constructor){_constructors[getUrl(id,name)+'_'+name]=constructor;};var loadModule=function(name,config){var id=_loading[name][0];var url=getUrl(id,name);_this.loadJS(url,config||{dynamic:true});};this.loadModule=function(id,name,config){var constructor=getConstructor(id,name);if(constructor){_instances[id].modules[name]=new constructor(id);if(_instances[id].callback){_instances[id].callback(name);}}
else{if(!_loading[name]){_loading[name]=[];}
_loading[name].push(id);if(_loading[name].length==1){loadModule(name,config);}}};this.registerModule=function(name,constructor){var id=getCurrentId();if(name=="core"){if(!_instances[id]){_instances[id]={config:ADM_CONFIG,modules:{}};setConstructor(id,name,constructor);_this.loadModule(id,name);}
else{_instances[id].config.disabled=true;}}
else{var idList=_loading[name];_loading[name]=[];setConstructor(idList[0],name,constructor);while(id=idList.shift()){_this.loadModule(id,name);}}};this.getConfig=function(id){id=id||getCurrentId();return _instances[id].config;};this.getModule=function(id,name){id=id||getCurrentId();return _instances[id].modules[name];};this.getCore=function(id){return _this.getModule(id,"core");};this.onModuleLoad=function(id,callback){_instances[id].callback=callback;};this.loadJS=function(src,config){if(config&&config.dynamic){var node=config.appendToParentNode&&config.node?config.node:document.body;var script=document.createElement("script");script.src=src;node.insertBefore(script,node.firstChild);}
else{document.write("<script src='"+src+"'></scr"+"ipt>");}};this.loadCSS=function(url,doc){var head=doc.getElementsByTagName('head')[0];var link=doc.createElement('link');link.rel='stylesheet';link.type='text/css';link.href=url;link.media='all';head.appendChild(link);};this.getAllIds=function(){var ids=[];for(var id in _instances){ids[ids.length]=id;}
return ids;};this.registerConfig=function(config){_instances[getCurrentId(config)]={config:config,modules:{}};};this.getCurrentId=getCurrentId;this.getUrl=getUrl;};window.AdmotionMod=AdmotionMod=new AdmotionMod();}
AdmotionMod.registerModule("core",function(instanceId)
{var AdmCore=this;var FSCOMMAND={REPORT_EVENT:'reportEvent',INTERACTION_RESUME:'interactionresume',INTERACTION_STOP:'interactionstop',SET_PANEL_TRACKER:'setPanelTracker',SET:'set',TRYSET:'trySet',RESET:'reset',REMOVE:'remove',SET_STYLE:'setStyle',SAVE_DATA:'saveData',HIDE_PIECE:'hidePiece',SHOW_PIECE:'showPiece',CLICK:'click',POI:'poi',CLOSE:'close',SHOWLAYER:'showLayer',LOCK:'lock',UNLOCK:'unlock'};var ValueType={Number:1,Object:2,Function:4,Array:8,String:16,Boolean:32,Null:64,Undefined:128,Arguments:256,Unknown:512};var Module={Core:"core",Positioning:"positioning",Integration:"integration",Extension:"positioning"};var Lang=new function(){var _this=this;var getType=this.getType=function(o){var type,_typeof;var types=["Number","Object","Function","String","Boolean","Undefined"];try{_typeof=typeof o.valueOf();}catch(_){_typeof=typeof o;}
if(Object.prototype.toString.call(o).indexOf("Array")!=-1){type=ValueType.Array;}
for(var i=0;!type&&i<types.length;i++){type=_typeof==types[i].toLowerCase()?ValueType[types[i]]:null;}
switch(type){case ValueType.Number:type=!isFinite(o)?ValueType.Unknown:type;break;case ValueType.Object:type=!o?ValueType.Null:_this.isNumber(o.length)?ValueType.Arguments|type:type;break;}
return type;};this.testValueType=function(value,types){return!!(getType(value)&types);};this.isNumber=function(value){return _this.testValueType(value,ValueType.Number);};this.isObject=function(value){return _this.testValueType(value,ValueType.Object);};this.isFunction=function(value){return _this.testValueType(value,ValueType.Function);};this.isArray=function(value){return _this.testValueType(value,ValueType.Array);};this.isString=function(value){return _this.testValueType(value,ValueType.String);};};var foreach=function(obj,callback){if(Lang.isFunction(callback)){for(var prop in obj){if(obj.hasOwnProperty(prop)&&!(prop in foreach.ExcludeList)){if(callback(prop,obj[prop])===foreach.Break){break;}}}}};foreach.Break={};foreach.ExcludeList={};var numberCmp=function(num,around,margin)
{return num>=(around-margin)&&num<=(around+margin);};var objectGetFirst=function(obj){var ret=null;foreach(obj,function(prop,value){ret=value;return foreach.Break;});return ret;};var Period=function(){var _this=this;var _timeoutCallbacks={};var _intervalIds=[];var _disposed=false;this.setTimeout=function(callback,delay,forceExecutionOnDispose){var id=-1;if(Lang.isNumber(delay)&&delay!=-1){id=setTimeout(function(){if(_timeoutCallbacks[id]&&!_disposed){_timeoutCallbacks[id]();_this.clearTimeout(id);}},delay);_timeoutCallbacks[id]=callback;_timeoutCallbacks[id].forceExecutionOnDispose=forceExecutionOnDispose;}
else{callback();}
return id;};this.setInterval=function(callback,delay){var id=setInterval(function(){if(!_disposed)
callback();},delay);_intervalIds.push(id);return id;};this.clearTimeout=function(id){clearTimeout(id);delete _timeoutCallbacks[id];};this.clearInterval=function(id){clearInterval(id);removeArrayItem(_intervalIds,id);};this.dispose=function(){_disposed=true;foreach(_timeoutCallbacks,function(id,callback){_this.clearTimeout(id);if(callback.forceExecutionOnDispose)
callback();});for(var i=0;i<_intervalIds.length;i++){_this.clearInterval(_intervalIds[i]);}};};Period=new Period();var delegate=function(obj,methodName){return function(){obj[methodName].apply(obj,arguments);};};var random=function(n){return Math.round(Math.random()*((Math.pow(10,n))-1));};var __rnd={};var uniqueRnd=function(n){var num=random(n);while(__rnd[num]){num=random(n);}
__rnd[num]=1;return num;};var define=function(json){map(AdmCore,json);};var map=function(destination,src,notOverwrite,callbackOrIgnoreUndefined){foreach(src,function(prop,value){var shouldCopy=true;if(callbackOrIgnoreUndefined&&value===undefined){shouldCopy=Lang.isFunction(callbackOrIgnoreUndefined)&&callbackOrIgnoreUndefined(prop,value);}
if(shouldCopy&&(!notOverwrite||!(prop in destination))){destination[prop]=value;}});return destination;};var copy=function(value){var copy;switch(Lang.getType(value)){case ValueType.Object:copy=map({},value);break;case ValueType.Array:copy=map([],value);break;default:copy=value;break;}
return copy;};var removeArrayItem=function(array,item,comparisonFunction){for(var i=0;i<array.length;i++){if(comparisonFunction?comparisonFunction(array[i],item):array[i]==item){return array.splice(i,1);}}
return null;};var convertToArray=function(obj){return Lang.isArray(obj)?obj:[obj];};var capitalizeString=function(str){return str.replace(/^.| .|\-.|_./g,function($0,$1){return $0.toUpperCase();});};var trimString=function(str){return str.replace(/^\s*|\s*$/g,"");};var parsePx=function(n){return n===null||n===undefined?'auto':(n==""||isNaN(n)?n:n+'px');};var getBit=function(decimal,index){return decimal.toString(2).split("").reverse()[index]||0;};var argumentsToArray=function(_i,_f,args){var ret=[],i=_i||0;args=(args||arguments.callee.caller.arguments);var f=_f||args.length;for(;i<f;i++)
ret.push(args[i]);return ret;};var delay=function(callback,condition,period){if(condition)
Period.setTimeout(callback,period||0);else
callback();};var toJSON=function(obj){var json="";var type=Lang.getType(obj);if(type&ValueType.Arguments)
type=ValueType.Array;var first=true;switch(type){case ValueType.Object:json+="{";foreach(obj,function(name,value){toJSON(value);json+=(first?"":",")+"\""+name+"\""+": "+toJSON(value);first=false;});json+="}";break;case ValueType.Array:json+="[";for(var i=0;i<obj.length;i++){json+=(first?"":",")+toJSON(obj[i]);first=false;}
json+="]";break;case ValueType.String:json+="\""+obj+"\"";break;case ValueType.Number:case ValueType.Boolean:json+=obj;break;case ValueType.Null:case ValueType.Undefined:json+=null;break;default:break;}
return json;};var fromJSON=function(json){var obj={};if(json&&json.substring&&json.substring(0,1)=="{"){try{obj=eval("("+json+")");}
catch(e){}}
return obj;};var addHoursToDate=function(date,hours){var hoursFromMidnight=date.getHours()+hours;date.setDate(date.getDate()+Math.floor(hoursFromMidnight/24));date.setHours(hoursFromMidnight%24);return date;};var arraysAreEqual=function(a,b){if(a.length==b.length){for(var i=0;i<a.length;i++){if(a[i]!=b[i])
return false;}
return true;}
return false;};var safeAccess=function(a,b){var result;try{result=a[b];}
catch(e){return null;}
return result;};define(FSCOMMAND);var ExternalDefinition=function(name,module,extendsInstance,scope){this.name=name;this.module=module;this.extendsInstance=extendsInstance;this.scope=scope;};var External=function(definition,args,explicitRequest,baseDefinition){var _event=new EventManager();var _this=this;var _ready=false;this.onExternal=function(callback){_event.add("external",callback);};this.onReady=function(callback){_event.add("ready",callback);};var handleExternalDefinition=function(){var scope=AdmCore;for(var i=0;i<definition.scope.length;i++)
scope=scope[definition.scope[i]];if(definition.extendsInstance&&scope[definition.name]&&scope[definition.name].apply)
scope[definition.name].apply(_this,args||[]);if(explicitRequest)
_event.fire("ready",true);_event.fire("external",true);_ready=true;};if(baseDefinition)
baseDefinition.apply(this);if(!(_ready=ModuleManager.isLoaded(definition.module))){ModuleManager.addEvent(definition.module,function(){handleExternalDefinition();});if(explicitRequest)
ModuleManager.require(definition.module);}
else
handleExternalDefinition();if(!explicitRequest)
_event.fire("ready",true);};External.Sequence=new ExternalDefinition("Sequence",Module.Positioning,true,[]);External.StaticFormat=new ExternalDefinition("StaticFormat",Module.Positioning,true,[]);External.Platform=new ExternalDefinition("Platform",Module.Positioning,false,[]);External.WLHeaderPositionNodeBuilder=new ExternalDefinition("WLHeaderPositionNodeBuilder",Module.Positioning,true,["Platform","WLHotmail"]);External.ElementFinder=new ExternalDefinition("ElementFinder",Module.Positioning,false,[]);External.WLBounding=new ExternalDefinition("WLBounding",Module.Positioning,true,["Platform","WLHotmail"]);External.SafeFrameBounding=new ExternalDefinition("SafeFrameBounding",Module.Positioning,true,["Platform"]);External.Blind=new ExternalDefinition("Blind",Module.Positioning,false,[]);var EventManager=function(obj)
{var _callback={};var _this=this;var getOrCreateEvent=function(eventName,consume,args){if(!_callback[eventName])
_callback[eventName]=[];var event=_callback[eventName];if(consume)
{(_callback[eventName]=[]).consumed=true;_callback[eventName].args=args;}
return event;};var fire=function(callbacks,args){var ret=true;for(var i=0;i<callbacks.length;i++)
{if(Lang.isFunction(callbacks[i])){var retValue=callbacks[i].apply(this,args||[])||{};if(retValue.cancel)
ret=false;if(retValue.stopPropagation)
break;}}
return ret;};this.add=function(eventName,callback){var event=getOrCreateEvent(eventName);if(event.consumed)
fire([callback],event.args);else
event.push(callback);};this.remove=function(eventName,callback){return!!removeArrayItem(getOrCreateEvent(eventName),callback);};this.fire=function(eventName,consume){var args=argumentsToArray(2);var event=getOrCreateEvent(eventName,consume,args);event.consumed=event.consumed||!!consume;event.args=args;var ret=fire(event,args);if(eventName!==null)
arguments.callee.apply(_this,[null,false].concat(argumentsToArray()));return ret;};this.wasFired=function(eventName){return getOrCreateEvent(eventName).consumed;};if(obj)
map(obj,{addEvent:_this.add,removeEvent:_this.remove,fireEvent:_this.fire,wasFired:_this.wasFired});};var Operator={Or:"or",And:"and"};var DefaultCondition=function(func){this.eval=function(){return!!func();};};var ExpirableCondition=function(func,timeout,exitValue)
{if(timeout)
{Period.setTimeout(function(){func=function(){return exitValue;};},timeout);}
this.eval=function()
{return!!func();};};var ConditionEvaluator=function()
{var _this=this;var _conditions={or:[],and:[]};var evalOr=function()
{for(var i=0;i<_conditions.or.length;i++)
{if(_conditions.or[i].eval())
return true;}
return false;};var evalAnd=function()
{for(var i=0;i<_conditions.and.length;i++){if(!_conditions.and[i].eval())
return false;}
return true;};this.getCondition=function(operator,func){var newCondition=new DefaultCondition(func);newCondition.id=ConditionEvaluator.nextID++;return newCondition;};this.addCondition=function(operator,func){var condition=_this.getCondition.apply(_this,arguments);_conditions[operator].push(condition);return condition.id;};this.removeCondition=function(id){var matchesCondition=function(condition,id){return condition.id==id;};removeArrayItem(_conditions.and,id,matchesCondition);removeArrayItem(_conditions.or,id,matchesCondition);};this.clear=function()
{_conditions={or:[],and:[]};};this.eval=function()
{return evalOr()||evalAnd();};};ConditionEvaluator.nextID=0;var TimePreset=function(evaluate,interval)
{var _callback;var _interval;var fireTrue=function()
{Period.clearInterval(_interval);if(Lang.isFunction(_callback)){_callback();}};this.expiration=function(time,forceTrue)
{Period.setTimeout(function()
{Period.clearInterval(_interval);if(forceTrue)
fireTrue();},time);};this.ifTrue=function(callback)
{_callback=callback;if(evaluate())
fireTrue();else if(interval)
{_interval=Period.setInterval(function(){if(evaluate())
fireTrue();},interval);}};};var ConditionControl=function(interval)
{var _cEval=new ConditionEvaluator();_cEval.getCondition=function(operator,func,timeout,exitValue){var newCondition=new ExpirableCondition(func,timeout,exitValue);newCondition.id=ConditionEvaluator.nextID++;return newCondition;};var _tPreset=new TimePreset(function(){return _cEval.eval();},interval||500);this.addCondition=function(operator,func,timeout,exitValue)
{return _cEval.addCondition.apply(_cEval,arguments);};this.removeCondition=function(id){_cEval.removeCondition.apply(_cEval,arguments);};this.expiration=function(time,forceTrue)
{_tPreset.expiration.apply(_tPreset,arguments);};this.ifTrue=function(callback)
{_tPreset.ifTrue.apply(_tPreset,arguments);};};var SiteCompliant=new function()
{var _event=new EventManager();var _actives={};var _procedures={};this.addProcedure=function(procedureName,eventName,browser,func)
{if(!browser||Browser.match(browser))
_procedures[procedureName]={event:eventName,callback:func};};this.activate=function(procedureName,activate){var obj=_procedures[procedureName];if(obj){var params=argumentsToArray(2);_event[activate?"add":"remove"](obj.event,function(){var totalArgs=argumentsToArray(0).concat(params);obj.callback.apply(window,totalArgs);});}};this.fireEvent=_event.fire;};SiteCompliant.fireEvent("init",true);SiteCompliant.addProcedure("myspace_domain","init",null,function(){if(!WindowContext.getWindowAccess(top)){document.domain=document.domain;}});SiteCompliant.addProcedure("msn_menu_zindex","init",null,function(id)
{var node,condition=new ConditionControl(500);condition.addCondition(Operator.And,function(){return node=WindowContext.getTopAccessWindow().document.getElementById(id);});condition.expiration(10000,false);condition.ifTrue(function(){node.style.zIndex=2000000000;});});var Timer=function(period)
{var _event=new EventManager(this);var _sec,_tot=0,_partial=0,_status=false,_startTimes=0,_interval;this.reset=function(){_tot=0;_sec=(new Date).getTime();};this.getElapsedTime=function(){return _status?_tot+((new Date).getTime()-_sec):_tot;};this.getPartialTime=function(){return _status?_partial+((new Date).getTime()-_sec):_partial;};this.start=function(){_startTimes++;if(!_status)
{_partial=0;_sec=(new Date).getTime();_status=true;if(period)
_interval=Period.setInterval(checkTimer,period);}};this.stop=function(full)
{_startTimes--;if(_startTimes<0||full)
_startTimes=0;if(_startTimes==0)
{if(_status)
{checkTimer();Period.clearInterval(_interval);_status=false;_event.fire("timerStopped");}}};var checkTimer=function(){var now=(new Date).getTime();var elapsed=now-_sec;if(period&&elapsed>period*15)
elapsed=period;_tot+=elapsed;_partial+=elapsed;_sec=now;};};var Log=new function()
{var _globalData=[];var _timer=new Timer();var _event=new EventManager();_timer.start();var Log=function(cName)
{var _instance=random(5);var pushData=function(type,messId,args)
{var dat={className:cName,type:type,id:messId,args:args,instance:_instance,timestamp:_timer.getElapsedTime()};_globalData.push(dat);_event.fire('change',false,dat);};var define=function(typeId){return function(cons){pushData(typeId,cons,argumentsToArray(1));};};this.mes=define(0);this.war=define(1);this.err=define(2);this.ver=define(3);};Log.call(Log,'Global');Log.getGlobalData=function(){return[].concat(_globalData);};Log.setOnChange=function(callback){_event.add('change',callback);};Log.removeEvent=function(name,callback){_event.remove(name,callback);};return Log;};if(!AdmotionMod.Log){AdmotionMod.Log=Log;}
var Browser=function(){var _m=new Log("Browser");var _config=AdmotionMod.getConfig(instanceId);var _this=this;var init=function(browser,ver){_m.mes(100,browser,ver);_this.name=browser;if(document.documentMode){_this.version=8;_this.mode=document.documentMode;}
else{_this.version=parseInt(ver);_this.mode=parseInt(ver);}
if(browser in _this)
_this[browser]=true;else{_this.OTHER=true;_m.war(101,browser);}};this.match=function(browser){var ver=_this.version;var bName=!browser.name||_this[browser.name.toUpperCase()];var bVer=ver>=(browser.minVer||0)&&(browser.maxVer?ver<=browser.maxVer:true);return bName&&bVer;};_this.support={};_this.IE=_this.FF=_this.OP=_this.SF=_this.CH=_this.OTHER=undefined;init(_config.platformInfo.Navigator.name,_config.platformInfo.Navigator.ver);};Browser=new Browser();var WindowContext=function(){var _this=this;this.getWindowAccess=function(_window)
{try
{if(_window.location.href)
return true;}
catch(_){}
return false;};var isWindow=this.isWindow=function(win){var isWin=true;try{isWin=Lang.isObject(win)&&Lang.isObject(win.window);}
catch(_){}
return isWin;};var getParent=this.getParent=function(win){win=win||window;return isWindow(win.parent)?win.parent:win;};this.getTop=function()
{var count=0;var w=window;while(w!=getParent(w)&&count<20)
{try
{w=getParent(w);}
catch(_)
{return window;}
count++;}
return w;};this.getTopAccessWindow=function(win)
{var w,lastAccess,count=0;w=lastAccess=win||window;while(w!=getParent(w)&&count<20)
{try
{w=getParent(w);}
catch(_)
{return win||window;}
if(WindowContext.getWindowAccess(w))
lastAccess=w;count++;}
return lastAccess;};this.canAccessOuterIframes=function(win)
{return WindowContext.getTopAccessWindow(win)!=win;};this.getFrameElement=function(win)
{try
{if(_this.getWindowAccess(win.frameElement.contentWindow))
return win.frameElement;}
catch(_){}
return null;};this.getLastParent=function(baseWindow,topWindow)
{var lastParent,nextParent;lastParent=nextParent=baseWindow;while(nextParent!=topWindow&&nextParent!=getParent(nextParent))
{lastParent=nextParent;nextParent=getParent(nextParent);}
return lastParent;};this.findWindowIndex=function(baseWindow,topWindow){var lastParent=WindowContext.getLastParent(baseWindow,topWindow);for(var i=0;i<topWindow.length;i++){if(topWindow[i]==lastParent)
return i;}
return-1;};this.getIFrameElement=function(baseWindow,topWindow){var winIndex=WindowContext.findWindowIndex(baseWindow,topWindow);var iframes=topWindow.document.getElementsByTagName("iframe");var iframe;for(var i=0;i<iframes.length;i++){if(iframes[i].contentWindow==topWindow[winIndex])
iframe=iframes[i];}
return iframe;};this.getViewportSize=function(win){win=win||WindowContext.getTopAccessWindow();var viewPortWidth;var viewPortHeight;if(typeof win.document.documentElement!='undefined'&&typeof win.document.documentElement.clientWidth!='undefined'&&win.document.documentElement.clientWidth!=0&&('CSS1Compat'==win.document.compatMode||Browser.IE)){viewPortWidth=win.document.documentElement.clientWidth;viewPortHeight=win.document.documentElement.clientHeight;}
else{viewPortWidth=win.document.getElementsByTagName('body')[0].clientWidth;viewPortHeight=win.document.getElementsByTagName('body')[0].clientHeight;}
return[viewPortWidth,viewPortHeight];};this.getNextAccessibleWindow=function(win){var w=win;do{if(w==getParent(w))
return null;w=getParent(w);}while(!WindowContext.getWindowAccess(w));return w;};this.getNodeWindow=function(node){var doc=node.ownerDocument;return doc.parentWindow||doc.defaultView;};};WindowContext=new WindowContext;var XWindowObject=function(ownerWindow,classDefinition){var _name="adm_XWindowObject_"+random(4);var _this=this;this.dispose=function(){delete ownerWindow[_name];};var args=[];for(var i=2;i<arguments.length;i++)
args.push(arguments[i]);ownerWindow.eval('window.'+_name+'= new '+classDefinition+'('+toJSON(args).match(/\[(.*?)\]/)[1]+')');foreach(ownerWindow[_name],function(attributeName,value){if(Lang.testValueType(value,ValueType.Function)){_this[attributeName]=function(){ownerWindow.eval('window.'+_name+'.result = window.'+_name+'.'+attributeName+'.apply(window.'+_name+','+toJSON(arguments)+')');return ownerWindow[_name].result;};}});};var Event=new function(){var _m=new Log("Event");var _eMgr=new EventManager();var _isPageLoaded=false;var _isPageUnloaded=false;var _disableOnLoad=false;var _registeredEvents=[];var Event=function(obj)
{this.add=function(event,func){Event.add(obj,event,func);};this.remove=function(event,func){Event.remove(obj,event,func);};};Event.add=function(obj,event,func)
{_registeredEvents.push(arguments);if(obj.attachEvent)
obj.attachEvent('on'+event,func);else if(obj.addEventListener)
obj.addEventListener(event,func,true);else
obj['on'+event]=func;};Event.remove=function(obj,event,func)
{removeArrayItem(_registeredEvents,arguments,arraysAreEqual);if(obj.detachEvent)
obj.detachEvent('on'+event,func);else if(obj.removeEventListener)
obj.removeEventListener(event,func,true);else if(obj['on'+event]==func)
obj['on'+event]=null;};var clearEvents=function(){var e=copy(_registeredEvents);for(var i=0;i<e.length;i++){Event.remove.apply(this,e[i]);}};var fireLoad=function(msg){WindowContext.getTopAccessWindow().ADM_pageLoaded=true;Period.clearTimeout(_timeout);Period.setTimeout(function(){if(!_disableOnLoad){_isPageLoaded=true;_m.mes(201,msg);_eMgr.fire('load',true);}},0);};var fireUnload=function(){if(!_isPageUnloaded)
_eMgr.fire('unload',true);clearEvents();_isPageUnloaded=true;};var eachWindow=function(win,callback){callback(win);for(var i=0;i<win.length;i++){try{eachWindow(win[i],callback);}
catch(_){}}};var countImages=function(){var total=0;var ready=0;eachWindow(WindowContext.getTopAccessWindow(),function(win){var images=win.document.getElementsByTagName('img');total+=images.length;for(var i=0;i<images.length;i++){var complete=images[i].readyState=='complete';if(complete)
ready++;}});return[total,ready];};var detectPageLoad=function(callback){var percentage=1;var tryCount=0;var interval=Period.setInterval(function(){if(_isPageLoaded)
{Period.clearInterval(interval);return;}
var imgCount=countImages();if(percentage<=0||(imgCount[0]>0&&imgCount[1]/imgCount[0]>=percentage))
{Period.clearInterval(interval);callback();}
tryCount++;if(tryCount>10)
percentage-=0.01;},100);};var _timeout;var _topAccessWindow=WindowContext.getTopAccessWindow();if(_topAccessWindow.ADM_pageLoaded){fireLoad("already loaded");}
else{Event.add(_topAccessWindow,'load',function(){fireLoad("onLoad event");});if(_topAccessWindow==WindowContext.getTop()&&Browser.IE){Period.setTimeout(function(){detectPageLoad(function(){fireLoad("img detection");});},1000);}
_timeout=Period.setTimeout(function(){_m.war(200);fireLoad("timeout");},15000);}
Event.add(window,'unload',fireUnload);var statics={onPageLoad:function(callback){_eMgr.add('load',callback);},onPageUnload:function(callback){_eMgr.add('unload',callback);},onCoreFinish:function(callback){_eMgr.add('coreFinish',callback);},isPageLoaded:function(){return!!_isPageLoaded;},disableLoadingPageTimeout:function(){Period.clearTimeout(_timeout);},disablePageLoadEvent:function(){_disableOnLoad=true;},fireCoreFinishedEvent:function(){Log.mes(800);_eMgr.fire('coreFinish',true);},firePageLoadEvent:function(){fireLoad("static method");},firePageUnloadEvent:function(){fireUnload();}};map(Event,statics);return Event;};var InteractionAccumulator=function(maxItemCount)
{var _stock={};var _firsts={};var _totalCount=0;this.add=function(id,eventType,trackerId)
{trackerId=trackerId||PanelTrackerManager.GLOBAL;if(!_stock[id])
_stock[id]={};if(!_stock[id][trackerId]){_stock[id][trackerId]={first:!_firsts[id],eventType:eventType,count:0};_firsts[id]=true;_totalCount++;}
if(_stock[id][trackerId].count<maxItemCount)
_stock[id][trackerId].count++;};this.release=function()
{var ret=_stock;_stock={};_totalCount=0;return ret;};this.getCount=function()
{return _totalCount;};};var InteractionReporting=function(config)
{var _accumulator=new InteractionAccumulator(config.ceiling);var callCallback=function()
{if(Lang.isFunction(config.callback)){config.callback(_accumulator.release());}};Period.setInterval(function()
{if(_accumulator.getCount()>=config.minCount)
callCallback();},config.interval);this.addInteraction=function(id,eventType,trackerId)
{_accumulator.add(id,eventType,trackerId);if(_accumulator.getCount()>=config.maxCount)
callCallback();};this.release=function()
{return _accumulator.release();};};var PanelTrackerManager=function(){var _globalPanelTracker=new PanelTracker(PanelTrackerManager.GLOBAL);var _localPanelTrackers={};this.getGlobal=function(){return _globalPanelTracker;};this.get=function(id){return id==PanelTrackerManager.GLOBAL?_globalPanelTracker:_localPanelTrackers[id];};this.create=function(id){if(!_localPanelTrackers[id]){_localPanelTrackers[id]=new PanelTracker(id);_localPanelTrackers[id].getTimer("ADM_InteractionTime");}};this.each=function(callback){foreach(_localPanelTrackers,callback);callback(PanelTrackerManager.GLOBAL,_globalPanelTracker);};var init=function(){_globalPanelTracker.getTimer("ADM_InteractionTime");_globalPanelTracker.getTimer("ADM_EngagementTime");};init();};PanelTrackerManager.GLOBAL="__global__";var Utility={msToSec:function(ms){return parseInt(Math.round(ms/1000));},validURL:function(u){return u&&u.match(/(http|https):\/\//i)?u:'';},probability:function(percentage){var prob=Math.round(Math.random()*100);return prob<=percentage;},isEscaped:function(str){str=str.replace(/%[0-9a-fA-F]{2}/g,"");return str==escape(str);},doWhen:function(instance,registerHandler,callback){return instance[registerHandler]?instance[registerHandler](callback):callback();},parseUrlTokens:function(url,tokensToReplace,replacedTokens,validateTokens,delimiter){delimiter=delimiter||"\\$\\$";replacedTokens=replacedTokens||{};return url.replace(new RegExp(delimiter+"(.+?)"+delimiter,"g"),function(token,varName){if(!(token in replacedTokens)||!replacedTokens[token]){if(tokensToReplace[varName]&&tokensToReplace[varName].match&&(!validateTokens||!tokensToReplace[varName].match(/%/)))
replacedTokens[token]=tokensToReplace[varName];else
replacedTokens[token]="";}
tokensToReplace[varName]="";return replacedTokens[token]||"";});},replaceRandom:function(url){var tags=["[rnd]","[random]","[timestamp]"];var replacement=random(8);for(var index in tags){if(tags.hasOwnProperty(index)){url=url.replace(tags[index],replacement);}}
return url;},buildQueryString:function(obj,escapeVars){var str="?";foreach(obj,function(param,value){if(Lang.testValueType(value,ValueType.String|ValueType.Number)){str+=param+'='+(escapeVars?escape(value):value)+'&';}});return str.substring(0,str.length-1);},stringEndsWith:function(str,suffix){return str.indexOf(suffix,str.length-suffix.length)!==-1;}};var Reporter=function(URLevent,URLRedirect,URLdefaultOOB,reporterConfig,clickTracking){var _this=this;var _report=[];var _timeout;var _intReporting;var _firstImpression=true;var _panelTrackerManager;var _interaction={};var _reportedClickIds={};reporterConfig.callback=reporterConfig.callback||function(interactions){_this.report(URLevent,{'[events]':buildInteractionEventString(interactions)});};var buildEventString=function(id,type,count,first,value,trackerId){return id+'!'+type+'!'+count+'!'+(first?'1':'0')+'!'+(value||value===0?value:"")+'!'+(trackerId==PanelTrackerManager.GLOBAL?"":(trackerId||""));};var combineEventString=function(){var str="";for(var i=0;i<arguments.length;i++){if(arguments[i]&&arguments[i]!="")
str+=(str=="")?arguments[i]:'|'+arguments[i];}
return(str=="")?null:str;};var buildInteractionEventString=function(interactions){var str="";foreach(interactions,function(id,trackerInteractions){foreach(trackerInteractions,function(trackerId,interaction){str=combineEventString(str,buildEventString(id,interaction.eventType,interaction.count,interaction.first,null,trackerId));});});return str;};var getTimeVars=function(){var str="";var customRates={};var sendAll=Utility.probability(isNaN(reporterConfig.timeRate)||reporterConfig.timeRate==""?10:reporterConfig.timeRate);_panelTrackerManager.each(function(trackerId,panel){panel.eachTimer(function(id,timer){if((sendAll&&!customRates[id])||(customRates[id]&&Utility.probability(customRates[id])))
str=combineEventString(str,buildEventString(id,EventType.Timer.id,1,true,Utility.msToSec(timer.getElapsedTime()),trackerId));});});return str;};this.report=function(url,replacement){if(url){if(!replacement)
replacement={};url=Utility.replaceRandom(url);foreach(replacement,function(tag,value){url=url.replace(tag,value);});_report.push(new Image);_report[_report.length-1].src=url;Period.clearTimeout(_timeout);_timeout=Period.setTimeout(function(){_report=[];},8000);}};this.reportInteractionEvent=function(id,trackerId,immediate){_this.reportInteractedImpression();if(immediate){_this.report(URLevent,{'[events]':buildEventString(id,EventType.Interaction.id,1,true,trackerId)});}
else{_intReporting.addInteraction(id,EventType.Interaction.id,trackerId);}};this.reportAutomaticEvent=function(id,trackerId){_intReporting.addInteraction(id,EventType.Automatic.id,trackerId);};this.reportClickEvent=function(id,trackerId){_this.reportInteractedImpression();id=id||'ADM_Click';_this.report(URLevent,{'[events]':buildEventString(id,EventType.Click.id,1,!_reportedClickIds[id],null,trackerId)});var urls=convertToArray(clickTracking);for(var i=0;i<urls.length;i++)
_this.report(URLRedirect,{"[url]":escape(urls[i])});if(URLdefaultOOB)
_this.report(URLdefaultOOB);_reportedClickIds[id]=true;};this.reportImpressionEvent=function(id,trackerId){_this.report(URLevent,{'[events]':buildEventString(id,EventType.Impression.id,1,_firstImpression,null,trackerId)});_firstImpression=false;};this.reportInteractedImpression=function(trackerId){if(!_interaction[trackerId]){_interaction[trackerId]=true;_this.reportInteractionEvent("ADM_IntImpression",trackerId,true);return true;}
return false;};this.getPanelTrackerManager=function(){return _panelTrackerManager||(_panelTrackerManager=new PanelTrackerManager());};this.getClickTracking=function(){return clickTracking;};this.createEventTracker=function(piece,trackers){return new EventTracker(piece,_this,trackers);};_intReporting=new InteractionReporting(reporterConfig);if(URLevent){Event.onPageUnload(function(){var eventString=combineEventString(getTimeVars(),buildInteractionEventString(_intReporting.release()));if(eventString)
_this.report(URLevent,{'[events]':eventString});});}};AdmCore.Standard=function(globalConfig){var _m=new Log("Standard");var _this=this;var _session="session_id_"+random(8);var _urlClick;var _tagUrlClick;var _panelGroupList=[];var _reporter;var _uniqueId;var _globalParams=globalConfig.parameters||{};var _globalTokens={};var _showRichMediaConditions=new ConditionEvaluator();var parseVersion=function(version){var returnArray=[];var versionString=version+"";versionString.replace(/(\d+)/g,function($0){returnArray.push(parseInt($0));});return returnArray;};var getURLClick=function(tagURL){var parsedUrlClick=Utility.parseUrlTokens(_this.URLclick,window,_globalTokens,true,"%%");parsedUrlClick=Utility.replaceRandom(parsedUrlClick);var tagUrlTokens={ADM_URLCLICK_ENCODED:escape(parsedUrlClick),ADM_URLCLICK_UNENCODED:parsedUrlClick};var parsedTagUrl=Utility.parseUrlTokens(tagURL,tagUrlTokens);return _this.OOBFromTag?parsedUrlClick:parsedTagUrl!=tagURL?parsedTagUrl:tagURL+parsedUrlClick;};var createPanelGroupList=function(){var panelGroupList=[];foreach(globalConfig.creativeFiles,function(behaviorGroupName,behaviorGroup){foreach(behaviorGroup,function(panelGroupName,panelGroup){panelGroupList.push(CommandFactory.getObjectId(behaviorGroupName,panelGroupName));});});return panelGroupList;};var init=function(){var tagId=globalConfig.channel+"_"+globalConfig.placement;TagManager.Instance=new TagManager(WindowContext.getTopAccessWindow(),tagId);map(_this,globalConfig);if(window.ADM_click&&Utility.isEscaped(window.ADM_click)){window.ADM_click=unescape(window.ADM_click);}
_tagUrlClick=Utility.validURL(window.ADM_click);window.ADM_click="";_urlClick=getURLClick(_tagUrlClick);_tagUrlClick=Utility.parseUrlTokens(_tagUrlClick,{});Event.autoResize=_globalParams.autoResize;if(_this.eventValues){_this.eventValues=_this.eventValues.replace(/###tagClickCount###/g,_this.OOBFromTag?'':Utility.parseUrlTokens(_tagUrlClick,{}));}
_panelGroupList=createPanelGroupList();_globalParams.cookieId=_globalParams.cookieId||"<%campaign%><%creative%><%channel%>";_uniqueId=_globalParams.cookieId.replace(/<%([^%]+)%>/g,function(match,value){return globalConfig[value]||match;}).replace(/\W/g,'');if(globalConfig.integrationInfo&&globalConfig.integrationInfo.beacons){foreach(globalConfig.integrationInfo.beacons,function(name,url){Utility.parseUrlTokens(url,window,_globalTokens,true,"%%");});}};this.getUniqueId=function(){return _uniqueId;};this.getSession=function(){return _session;};this.getURLClick=function(){return _urlClick;};this.getURLClickCount=function(){return _this.URLclickCount;};this.getGlobalParams=function(){return _globalParams;};this.getPanelGroupList=function(panelGroup){var panelGroupList=[].concat(_panelGroupList);if(panelGroup){removeArrayItem(panelGroupList,panelGroup);}
return panelGroupList.toString();};this.canShowFlash=function(){return parseInt(Standard.getFlashVersion())>=(_this.flashVerMin||6)||navigator.userAgent.toLowerCase().indexOf("sitecapture")!=-1;};this.canShowHTML5=function(){return!!(!(Browser.IE&&Browser.version<8)&&(window.postMessage));};this.addShowRichMediaCondition=_showRichMediaConditions.addCondition;this.hasMinHResolution=function(){return!_globalParams.minHResRequired||top.window.screen.availWidth>=parseInt(_globalParams.minHResRequired);};_this.addShowRichMediaCondition(Operator.And,function(){if(globalConfig.parameters.mediaType){var supportedMedia=globalConfig.parameters.mediaType.split('-');var returnValue=false;for(var i=0;i<supportedMedia.length;i++){switch(supportedMedia[i]){case'flash':returnValue=returnValue||_this.canShowFlash();break;case'html5':returnValue=returnValue||_this.canShowHTML5();break;}
if(returnValue){break;}}}
else{returnValue=_this.canShowFlash();}
return returnValue;});_this.addShowRichMediaCondition(Operator.And,_this.hasMinHResolution);_this.addShowRichMediaCondition(Operator.And,function(){return _globalParams.backupUserAgentPattern?!new RegExp(_globalParams.backupUserAgentPattern).test(navigator.userAgent):true;});_this.addShowRichMediaCondition(Operator.And,function(){return!_globalParams.backupForIframeContext||WindowContext.getParent(window)==window;});_this.addShowRichMediaCondition(Operator.And,function(){return!_globalParams.backupForChromeNPAPI||!Browser.CH||Standard.isPPAPI();});this.canShowRichMedia=function(){return _showRichMediaConditions.eval();};this.getReporter=function(){if(!_reporter){var reporterConfig={timeRate:_this.timeRate||_this.timeRate,ceiling:_this.ceiling||50,minCount:_this.minCount||1,maxCount:_this.maxCount||5,interval:_this.interval||50000};var clickTracking=(_this.OOBFromTag&&_tagUrlClick)?[_tagUrlClick]:[];_reporter=_this.integrationInfo?new AdmCore.SiteIntegrationReporter(_this.URLevent,_this.URLRedirect,_this.URLdefaultOOB,reporterConfig,clickTracking,_this.integrationInfo,_globalTokens):new Reporter(_this.URLevent,_this.URLRedirect,_this.URLdefaultOOB,reporterConfig,clickTracking);}
return _reporter;};this.getEssentialModules=function(){var modules={};if(_this.integrationInfo)
modules[Module.Integration]=ModuleState.Required;return modules;};this.getPageContentWidth=function(){if(_globalParams.pageContentWidth&&Lang.isString(_globalParams.pageContentWidth)){var node=WindowContext.getTopAccessWindow().document.getElementById(_globalParams.pageContentWidth);if(node&&node.offsetWidth)
return node.offsetWidth;}
return _globalParams.pageContentWidth;};this.getAssets=function(){return globalConfig.assets||'';};this.getAdvertiserKeys=function(){return globalConfig.advKeys;};this.getURLAdvertiserKey=function(){return globalConfig.URLAdvKey;};init();};AdmCore.Standard.getFlashVersion=function(){var ver=0;if(window.ActiveXObject)
{try
{var objAx=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");ver=objAx.GetVariable("$version");ver=ver.replace(/WIN/g,"");}
catch(e){}}
else{if(navigator.plugins&&navigator.plugins["Shockwave Flash"]){var x=navigator.plugins["Shockwave Flash"];ver=x.description;ver=ver.replace("Shockwave Flash ","");}}
return ver;};AdmCore.Standard.isPPAPI=function(){var type='application/x-shockwave-flash';var mimeTypes=navigator.mimeTypes;return(mimeTypes&&mimeTypes[type]&&mimeTypes[type].enabledPlugin&&(mimeTypes[type].enabledPlugin.filename=="pepflashplayer.dll"||mimeTypes[type].enabledPlugin.filename=="libpepflashplayer.so"||Utility.stringEndsWith(mimeTypes[type].enabledPlugin.filename,"Chrome.plugin")));};var globalSettings={tryUseDocumentWrite:true,flashContainerConfig:{nodeName:'div',display:'inline'},anchorConfig:{nodeName:'div',display:'inline-block',altDisplay:'inline'},hidePatterns:null,filterRefreshInterval:1000};var Cookie=function(storeDate)
{var encodeChar=function(c){return"%"+c.charCodeAt(0).toString(16);};var encodeASCII=function(str){return encodeURIComponent(str).replace(/[-_z.]/g,encodeChar).replace(/%/g,"z");};var decodeASCII=function(str){return decodeURIComponent(str.replace(/z/g,"%"));};this.setCookie=function(name,value,date,domain)
{var valueStr=value.toGMTString?value.toGMTString().replace(',',''):value+'';var buffer=name+'='+encodeASCII(valueStr);if(date)
{var dateStr=date.toGMTString?date.toGMTString():date+'';if(storeDate)
document.cookie=name+'Date='+dateStr+';expires='+dateStr+';path=/';buffer+=';expires='+dateStr+';path=/';if(domain){buffer+=';domain='+domain;}}
document.cookie=buffer;};this.getCookie=function(name)
{var cookies=document.cookie.split(';');for(var i=0;i<cookies.length;i++){var cookie=cookies[i].split('=');if(trimString(cookie[0])==name)
return decodeASCII(cookie[1]);}};this.updateCookie=function(name,value,domain)
{var date=this.getCookie(name+'Date');this.setCookie(name,value,date,domain);};};var FrequencyCap=function(id,session,minWait,maxCount,freqCapExpiration,cookieExpiration,cookieDomain)
{var _this=this;var _cookie=new Cookie;var _counterId=id+"Counter";var _sinceDateId=id+"SinceDate";var _lastPrintId=id+"LastPrint";var _lastPrintDate;this.setCounter=function(value,expDate)
{var cookieDate=session?null:addHoursToDate(new Date(),cookieExpiration);_cookie.setCookie(_counterId,value,cookieDate,cookieDomain);_cookie.setCookie(_sinceDateId,expDate,cookieDate,cookieDomain);_cookie.setCookie(_lastPrintId,new Date(),cookieDate,cookieDomain);};this.getSinceDate=function()
{var date=_cookie.getCookie(_sinceDateId);return date?new Date(date):null;};this.getCount=function()
{return parseInt(_cookie.getCookie(_counterId));};this.hasReachedLimit=function()
{return isFinite(maxCount)?this.getCount()>=maxCount:false;};this.hasMinimumTimeElapsed=function()
{if(_lastPrintDate)
{var waitDate=addHoursToDate(new Date(_lastPrintDate),minWait);return(waitDate.getTime()-new Date().getTime())<0;}
else return true;};this.hasExpired=function()
{var sinceDate=_this.getSinceDate();var expDate=sinceDate?addHoursToDate(sinceDate,freqCapExpiration):null;return expDate?(expDate.getTime()-new Date().getTime())<0:true;};this.shouldCap=function()
{return this.hasReachedLimit()||!this.hasMinimumTimeElapsed();};var initialize=function()
{_lastPrintDate=_cookie.getCookie(_lastPrintId);if(!_cookie.getCookie(_counterId)||_this.hasExpired())
_this.setCounter(0,new Date());else if(_this.hasMinimumTimeElapsed())
_this.setCounter(_this.getCount()+1,_cookie.getCookie(_sinceDateId));};initialize();};var Element=function(nodeOrDocument,nodeName)
{var _obj;var _event=new EventManager(this);var _shouldCheck=true;var _m=new Log("Element");if(nodeOrDocument){if(nodeName)
_obj=(nodeOrDocument.createElement?nodeOrDocument:nodeOrDocument.ownerDocument).createElement(nodeName);else
_obj=nodeOrDocument;if(!_obj.id)
_obj.id="node_"+random(10);}
var checkReference=this.checkReference=function(force)
{if((force||_shouldCheck)&&_obj&&safeAccess(_obj,"id"))
{var docObj=_obj.ownerDocument.getElementById(_obj.id);if(docObj!==_obj)
{if(docObj)
{_m.war(23000,_obj.id);_obj=docObj;_event.fire('referenceChanged',false,_obj);}}
_shouldCheck=false;Period.setTimeout(function(){_shouldCheck=true;},1000);}};this.setNode=function(obj){_obj=obj;};this.setSize=function(_width,_height)
{checkReference();if(_width!=null&&_obj)
_obj.style.width=parsePx(_width);if(_height!=null&&_obj)
_obj.style.height=parsePx(_height);};this.getSize=function()
{return _obj?[_obj.offsetWidth,_obj.offsetHeight]:null;};this.insertFirst=function(node)
{node=node||nodeOrDocument;node.insertBefore(_obj,node.firstChild);};this.insertLast=function(node)
{checkReference(true);(node||nodeOrDocument).appendChild(_obj);};this.remove=function()
{checkReference(true);try
{_obj.parentNode.removeChild(_obj);}
catch(_){}};this.getNode=function(unchecked)
{if(!unchecked)
checkReference(true);return _obj;};this.getNodeID=function(){return _obj?_obj.id:null;};};Element.instance=function(node){return!node?null:node instanceof Element?node:node.getNode?new Element(node.getNode()):new Element(node);};var ObjectElement=function(){var _str="<object>";var isNotParam=function(name){var noParamAttributes=['name','type','style','id','data'];for(var i=0;i<noParamAttributes.length;i++){if(name.toLowerCase()==noParamAttributes[i]){return true;}}};this.setAttribute=function(name,value){if(isNotParam(name))
_str=_str.replace("<object","<object "+name+"='"+value+"'");else
_str+="<param name='"+name+"' value='"+value+"'>";};this.toString=function(){return _str+"</object>";};};var EmbedElement=function()
{var _str="<embed";this.setAttribute=function(name,value)
{_str+=" "+name+"='"+value+"'";};this.toString=function(){return _str+" />";};};var FlashBuilder=function(containerConfig,id)
{var _m=new Log("FlashBuilder");var _randomId=random(8);FlashBuilder.containerId+=_randomId;((Browser.IE||Browser.FF)?ObjectElement:EmbedElement).apply(this);this.setAttribute("id",id);this.setAttribute("name",id);this.appendTo=function(node)
{var container=node.ownerDocument.createElement(containerConfig.nodeName);container.id=FlashBuilder.containerId;container.style.display=containerConfig.display;if(node.tagName=='IFRAME')
_m.war(10000);node.insertBefore(container,node.firstChild);container.innerHTML=this.toString();var flashObject=container.firstChild;_m.mes(10010);return flashObject;};this.write=function(node)
{var doc=node.ownerDocument;doc.write(this.toString());var obj=doc.getElementById(id);if(obj)
_m.mes(10020);else
{_m.war(10030);obj=this.appendTo(node);}
return obj;};};FlashBuilder.containerId="admFlashContainer";var PieceCommand=function(cmd,arg,nodeID,parentCmd,parentArg)
{var _m=new Log("PieceCommand");this.args={};this.name=trimString(cmd);this.argString=arg;this.nodeID=nodeID;this.parentCmd=parentCmd;this.parentArg=parentArg;if(Lang.isString(arg)){if(arg.substring(0,1)=="{")
{try
{this.args=eval("("+arg+")");}
catch(e)
{_m.war(16000);}}
else{switch(this.name){case FSCOMMAND.POI:this.args.poi=parseInt(this.argString);break;case FSCOMMAND.LOCK:case FSCOMMAND.UNLOCK:this.args.days=parseInt(this.argString);break;case FSCOMMAND.OPEN_WINDOW:this.args.url=this.argString;break;}}}
else{this.args=arg;}
var match=cmd.match(PieceCommand.regexp);if(match)
{this.event=match[1];this.behaviorGroupName=match[2];this.panelGroup=match[3]||"_default";this.objectId=CommandFactory.getObjectId(this.behaviorGroupName,this.panelGroup);this.isGlobal=true;}
else this.event=cmd;};PieceCommand.regexp=null;var Piece={};Piece.sendCommandCollection=function(piece,commandCollection){commandCollection.arg=commandCollection.arg||"";var commands=commandCollection.cmd.split("|");var args=commandCollection.arg.split("|");for(var i=0;i<commands.length;i++){Piece.sendCommand(piece,{name:commands[i],arg:args[i],nodeId:commandCollection.nodeId||null,originalCmd:commandCollection.cmd,originalArg:commandCollection.arg});}};Piece.sendCommand=function(piece,command){piece.fireEvent("fscommand",false,new PieceCommand(command.name,command.arg||"",command.nodeId,command.originalCmd,command.originalArg));piece.fireEvent(command.name,false,new PieceCommand(command.name,command.arg||"",command.nodeId,command.originalCmd,command.originalArg));};var FlashPiece=function(src,preload,containerConfig){var _this=this;var _m=new Log("FlashPiece");var _timer=new Timer();var _vars={};var _loaded=false;var _progress;var _elem=new Element();var _containerElement=new Element();var _pieceElement=_elem;var _parentNode;var _lastFSCommand;var _event=new EventManager(this);var _interacting=false;var _waitInteraction;var _attemptsCount;var _percentLoaded;var _rendered=false;var _removed=false;var _useDocWrite=false;var _autoRender=false;var _registeredEventHandler;var _disabledFSCommands={};var _originalDisplay;var _unloadedHTML;var _useContainerClipping=false;var _flashId="adm_"+random(8);var _commandFallbackEnabled=false;var _attributes={type:"application/x-shockwave-flash",wmode:"transparent",movie:src,src:src,allowScriptAccess:"always",allowFullscreen:"true",swLiveConnect:"true",style:{'vertical-align':"top",margin:"0px",width:"1px",height:"1px"}};if(!Browser.IE){_attributes.data=src;}
var _renderStyle={clip:"rect(auto, auto, auto, auto)",position:"static"};var _containerConfig={nodeName:containerConfig.nodeName||'div',display:containerConfig.display||'inline'};for(var fix=0;fix<FlashPiece.Fixes.length;fix++){_event.add(FlashPiece.Fixes[fix].event,FlashPiece.Fixes[fix].callback);}
var fireFixes=function(name){_event.fire(name,false,_elem);};var objectToStyle=function(obj){var str="";foreach(obj,function(attribute,value){str+=attribute+": "+value+";";});return str;};var handleReferenceChangedEvent=function(){addFscommandEvent();Event.add(_elem.getNode(),"mousemove",handleMouseMoveEvent);};var strip=function(keys,target){var ret={};target=target||{};for(var i=0;i<keys.length;i++){if(keys[i]in target){ret[keys[i]]=target[keys[i]];delete target[keys[i]]}}
return ret;};var getFSCommandFunctionName=function(id){return id+"_DoFSCommand";};var initVars=function(){if(preload){_vars.preload=true;}
else{if(!(src in FlashPiece.LoadedFiles)){FlashPiece.LoadedFiles[src]=0;}
_vars.instanceCount=FlashPiece.LoadedFiles[src];FlashPiece.LoadedFiles[src]++;}
if(_commandFallbackEnabled){_vars.cmdFallback=getFSCommandFunctionName(_flashId);}};var createFlash=function(src,node){var containerStyle={};if(!_autoRender){map(_attributes.style,{top:"-10000px",left:"-10000px",position:"absolute"});}
else{_this.render();}
var fBuilder=new FlashBuilder(_containerConfig,_flashId);initVars();fBuilder.setAttribute("flashvars",FlashPiece.getFlashvars(_vars));foreach(_attributes,function(prop,value){if(prop=="style"){if(_useContainerClipping){map(containerStyle,value);strip(["position","left","top","clip"],value);}
value=objectToStyle(value);}
fBuilder.setAttribute(prop,value);});_timer.start();var _flash=_useDocWrite?fBuilder.write(node):fBuilder.appendTo(node);_elem.setNode(_flash);_containerElement.setNode(_flash.parentNode);if(_useContainerClipping){map(_containerElement.getNode().style,containerStyle);}
_elem.addEvent("referenceChanged",handleReferenceChangedEvent);addFscommandEvent();Period.setTimeout(function(){fireFixes("onCreated");waitForLoad();Event.add(_flash,"mousemove",handleMouseMoveEvent);_registeredEventHandler={};foreach(FlashPiece.FlashEventHandlers,function(eventName,flashEventHandlerName){_registeredEventHandler[eventName]=function(){_this.callExternalInterface(flashEventHandlerName);};Event.add(_flash,eventName,_registeredEventHandler[eventName]);});},0);};var onLoad=function(){fireFixes("onBeforeOnLoad");_m.mes(11030,_timer.getElapsedTime());_event.fire('load',true);};var loading=function(){_progress++;try{if(!_loaded){_percentLoaded=_elem.getNode().PercentLoaded();if(_attemptsCount==0&&isFinite(_percentLoaded)){_m.mes(11000);}
if(_percentLoaded!=100){_attemptsCount++;throw-1;}
else{_loaded=true;}}
else return;}
catch(_){if(_progress==80){fireFixes("loadNotDetected2");}
if(_attemptsCount==4){fireFixes("loadNotFinish");}
if(_progress<100){Period.setTimeout(arguments.callee,100);}
else{_loaded=true;_m.war(11001);}}
if(_loaded){onLoad();}};var waitForLoad=function(){_percentLoaded=-1;_progress=0;_attemptsCount=0;loading();};var fsCommandFunc=function(cmd,arg){if(!cmd){_m.war(11020);return;}
if(cmd==_lastFSCommand){_m.war(11021,cmd,arg);}
_lastFSCommand=cmd;_m.mes(11022,cmd,arg);if(!_loaded){_loaded=true;_m.mes(11023,cmd,arg);onLoad();}
for(var command in _disabledFSCommands){if(_disabledFSCommands.hasOwnProperty(command)&&_disabledFSCommands[command]){var reg=new RegExp("(\\|?"+command+"\\|?)");cmd=cmd.replace(reg,function($0,$1){return $1.indexOf("|")!=$1.lastIndexOf("|")?"|":"";});}}
Piece.sendCommandCollection(_this,{nodeId:_elem.getNodeID(),cmd:cmd,arg:arg});Period.setTimeout(function(){_lastFSCommand="";},40);};var handleMouseMoveEvent=function(e){_event.fire("mouseMoveOverPiece",false,e);if(!_interacting){_interacting=true;_event.fire("interactionbegin");}
Period.clearTimeout(_waitInteraction);_waitInteraction=Period.setTimeout(function(){_interacting=false;if(!_removed){_event.fire("interactionend");}},1000);};var addFscommandEvent=function(){if(Browser.IE&&!_commandFallbackEnabled){if(_elem.getNode()){_elem.getNode().attachEvent('FSCommand',fsCommandFunc);}}
else{var win=_parentNode.ownerDocument.parentWindow||_parentNode.ownerDocument.defaultView;win[getFSCommandFunctionName(_flashId)]=fsCommandFunc;}};var clearFscommandEvent=function(){if(Browser.IE&&!_commandFallbackEnabled){if(_elem.getNode()){_elem.getNode().detachEvent('FSCommand',fsCommandFunc);}}
else{var win=_parentNode.ownerDocument.parentWindow||_parentNode.ownerDocument.defaultView;win[getFSCommandFunctionName(_flashId)]=null;}};var changeState=function(name,delay,value){if(Lang.isNumber(delay)){_disabledFSCommands[name]=value;Period.setTimeout(function(){_disabledFSCommands[name]=!value;},delay);}
else{_disabledFSCommands[name]=value;}};this.useContainerClipping=function(){_pieceElement=_containerElement;_useContainerClipping=true;};this.useDocWrite=function(use){_useDocWrite=use;};this.setAutoRender=function(autoRender){_autoRender=autoRender;};this.setAttributes=function(attributes){map(_attributes,attributes);};this.setRenderStyle=function(attributes){map(_renderStyle,attributes);};this.setFvars=function(vars){map(_vars,vars);};this.insertFirst=function(node){_parentNode=node;createFlash(src,node);};this.getNode=function(){return _useContainerClipping&&_rendered?_containerElement.getNode():_elem.getNode();};this.getContainerNode=function(){var container=_elem.getNode();if(container&&container.parentNode&&container.parentNode.id==FlashBuilder.containerId){container=container.parentNode;}
return container;};this.getContainerNodeID=function(){return _this.getContainerNode().id;};this.setOnLoad=function(callback){_event.add("load",callback);};this.setPosition=function(_left,_top){map(_renderStyle,{left:parsePx(_left),top:parsePx(_top),position:"absolute"});};this.setSize=function(w,h){map(_attributes.style,{width:parsePx(w),height:parsePx(h)});};this.setClip=function(clipping){if(_rendered){_pieceElement.getNode().style.clip=clipping;}
else{_renderStyle.clip=clipping;}};this.render=function(forceRender){if(!_rendered||forceRender){_rendered=true;_this.setSize=function(width,height){if(_useContainerClipping){_elem.setSize(width,height);}
_pieceElement.setSize(width,height);};_this.setPosition=delegate(_pieceElement,"setPosition");map(_attributes.style,_renderStyle);if(!_autoRender){if(_attributes.style.position=="static"){_elem.getNode().style.position="static";}
else{if(_pieceElement.setPosition){_pieceElement.setPosition(_attributes.style.left,_attributes.style.top);}
else{_elem.getNode().style.left=_attributes.style.left;_elem.getNode().style.top=_attributes.style.top;}}
this.setClip(_attributes.style.clip);this.setSize(_attributes.style.width,_attributes.style.height);}}};this.remove=function(){var container=_elem.getNode()?_elem.getNode().parentNode:null;clearFscommandEvent();if(_elem.getNode()){Event.remove(_elem.getNode(),"mousemove",handleMouseMoveEvent);foreach(_registeredEventHandler,function(p,value){Event.remove(_elem.getNode(),p,value);});Event.remove(_elem.getNode(),'keydown',FlashPiece.stopPropagation);}
_registeredEventHandler=null;_elem.removeEvent('referenceChanged',handleReferenceChangedEvent);_elem.remove();_elem.setNode(null);_removed=true;_event.fire("piece_removed");if(container&&container.parentNode&&container.id==FlashBuilder.containerId){container.parentNode.removeChild(container);}};this.enableFSCommand=function(name,delay){changeState(name,delay,false);};this.disableFSCommand=function(name,delay){changeState(name,delay,true);};this.callExternalInterface=function(methodName,arg){try{var node=_elem.getNode();if(node&&node[methodName]){(arg!=undefined)?node[methodName](arg):node[methodName]();return true;}}
catch(e){return false;}
return false;};this.callExternalInterfaceTillSuccess=function(methodName,arg){var numberOfTrials=0;var intervalID=Period.setInterval(function(){if(_this.callExternalInterface(methodName,arg)||numberOfTrials++>2000)
Period.clearInterval(intervalID);},50);return true;};this.sendMessage=function(methodName,arg){_this.callExternalInterfaceTillSuccess(methodName,arg);};this.hide=function(){if(_elem.getNode()&&_elem.getNode().style.display=="none")
return;_originalDisplay=_elem.getNode().style.display;_elem.getNode().style.display="none";};this.show=function(){if(_elem.getNode()&&_elem.getNode().style.display!="none")
return;_elem.getNode().style.display=_originalDisplay;};this.unload=function(){if(!_unloadedHTML){_unloadedHTML=_parentNode.innerHTML;_parentNode.innerHTML="";}};this.reload=function(){if(_unloadedHTML){_parentNode.innerHTML=_unloadedHTML;_unloadedHTML=null;}
handleReferenceChangedEvent();};this.enableCommandFallback=function(enabled){_commandFallbackEnabled=enabled;};this.getSize=_elem.getSize;this.canSetTrackers=true;};FlashPiece.loadingFix=function(elem)
{var fixValue=10;var node=elem.getNode();if(node){var size=elem.getSize();size[0]=node.style.width||size[0];size[1]=node.style.height||size[1];elem.setSize(fixValue,fixValue);Period.setTimeout(function(){elem.setSize(size[0],size[1]);},0);}};FlashPiece.stopPropagation=function(e){var event=e||window.event;event.stopPropagation?event.stopPropagation():event.cancelBubble=true;};FlashPiece.Fixes=[{event:'loadNotDetected2',callback:FlashPiece.loadingFix},{event:'loadNotFinish',callback:function(elem){if(Browser.OP&&elem.getNode()){var style=elem.getNode().style;style.width=style.left=style.top=style.height="0px";}}},{event:'onCreated',callback:function(element){if(element.getNode()){Event.add(element.getNode(),'keydown',FlashPiece.stopPropagation);}}}];FlashPiece.getFlashvars=function(obj)
{var str='',i;foreach(obj,function(i,value)
{if(!Lang.isFunction(obj[i])){str+=i+'='+value+'&';}});return str.substring(0,str.length-1);};FlashPiece.LoadedFiles={};FlashPiece.FlashEventHandlers={mouseover:"jsHandleRolloverEvent",mouseout:"jsHandleRolloutEvent"};var Empty=function(){return function(){};};var EmptyObject=function()
{this.empty=true;};var createPieceType=function(name){var a=argumentsToArray(1);a.toString=function(){return"["+name+"Piece]";};return a;};var PieceType={Image:createPieceType('Image','jpg','jpeg','gif','png'),Flash:createPieceType('Flash','swf'),HTML:createPieceType('HTML','js','html','htm')};var Panel=function(url,name,fvars,trackers){var type=Panel.getType(url);if(fvars&&type==PieceType.Flash)
url=url+'?'+FlashPiece.getFlashvars(fvars);this.name=name;this.url=url;this.type=type;this.trackers=trackers;};new function(){var _dic={};foreach(PieceType,function(typeName,typeExt){for(var i=0;i<typeExt.length;i++)
{_dic[typeExt[i]]=typeExt;}});Panel.getType=function(url){var ext=(url||'').toLowerCase().split('.').pop();return _dic[ext];};};var PositionLayout=function(panelSelector,position){var _position=position.height?position:panelSelector.contains('backup')?panelSelector.getCurrentPanel('backup'):panelSelector.getCurrentPanel('main');this.width=_position.width;this.height=_position.height;};var CreativeCollection=function(panelSelector,panelGroup,position){var _layouts;var getProperties=function(panel){var _panel=!panel.empty?panel:position;return{width:_panel.width,height:_panel.height,offsetLeft:_panel.left,offsetTop:_panel.top};};var getLayouts=function(){var _layouts={};foreach(panelGroup,function(panelListName,panelList){if(panelListName!="parameters"){_layouts[panelListName]=[];for(var i=0;i<panelList.length;i++){_layouts[panelListName][i]=getProperties(panelSelector.getCurrentPanel(panelListName,i));}}});return _layouts;};_layouts=getLayouts();var mapLayout=function(obj,panelListName,index){var panelList=_layouts[panelListName];var _layout=panelList?_layouts[panelListName][index]:null;if(_layout&&Lang.isObject(obj)){foreach(obj,function(attribute,value){if(Lang.isNumber(value)){_layout[attribute]=value;}});}};this.getLayout=function(panelListName,index){var i=index?index:panelSelector.getIndex(panelListName);return _layouts[panelListName][i];};this.setLayout=function(obj,panelListName,index){if(!Lang.isNumber(index)){var panelList=_layouts[panelListName]||[];for(var i=0;i<panelList.length;i++){mapLayout(obj,panelListName,i);}}
else{mapLayout(obj,panelListName,index);}};};var RotationType={off:'off',custom:'custom'};var RotationCriteria=new function()
{var _criteria={};this.addCriteria=function(name,func)
{_criteria[name]=func;};this.getCriteria=function(name)
{return _criteria[name]||_criteria[RotationType.off];};this.addCriteria(RotationType.off,function(){return 0;});};AdmCore.PanelSelector=function(panelGroup){var _rotationType=panelGroup.parameters?panelGroup.parameters.creativeRotationType:null;var _performCustomRotation=RotationCriteria.getCriteria(RotationType.off);var _indexes={};var getNextIndex=function(index,length){return(_rotationType==RotationType.custom?_performCustomRotation:RotationCriteria.getCriteria(_rotationType))(index,length,!Lang.isNumber(index)||!Lang.isNumber(length));};var getIndex=this.getIndex=function(panelListName){return _indexes[panelListName]||0;};var contains=this.contains=function(panelListName){return panelGroup&&panelGroup[panelListName]&&panelGroup[panelListName].length>0;};this.getMetaData=function(panelListName){var panel=getCurrentPanel(panelListName);return{empty:!!panel.empty,type:Panel.getType(panel.url)};};var getCurrentPanel=this.getCurrentPanel=function(panelListName,index){var panel;if(contains(panelListName)){var i=Lang.isNumber(index)?index:getIndex(panelListName);panel=copy(panelGroup[panelListName][i]);}
else{panel={empty:true,url:""};}
return panel;};this.getNextPanel=function(panelListName){_indexes[panelListName]=contains(panelListName)?getNextIndex(_indexes[panelListName],panelGroup[panelListName].length):getNextIndex(null,null);return getCurrentPanel(panelListName);};this.setRotationCriteria=function(newVal,customRotationCriteria){_rotationType=newVal;if(customRotationCriteria)
_performCustomRotation=customRotationCriteria;};};var PanelGroupConfig=function(std,panelGroup,position,panelGroupId,_panelSelector){var _m=new Log("PanelGroupConfig");var _this=this;this.pieceVars={clickTAG:encodeURIComponent(std.getURLClick()),URLClickCount:encodeURIComponent(std.getURLClickCount()),clicktracking:encodeURIComponent(std.getReporter().getClickTracking().join(",")),sessionId:std.getSession(),assets:encodeURIComponent(std.getAssets()),cookieCount:(FrequencyCap.FlashInstance)?FrequencyCap.FlashInstance.getCount():-1,eventValues:encodeURIComponent(std.eventValues),browser:Browser.name,browserVer:Browser.version,advKeys:encodeURIComponent(std.getAdvertiserKeys()),URLAdvKey:encodeURIComponent(std.getURLAdvertiserKey()),panelGroup:encodeURIComponent(panelGroupId),panelGroupList:encodeURIComponent(std.getPanelGroupList(panelGroupId)),hideOnOrientationChange:panelGroup.parameters?panelGroup.parameters.hideOnOrientationChange:null};this.queryStringFvars=false;var buildPanel=function(panel,panelListName){if(panel.empty)
_m.err(32000,panelListName);return new Panel(panel.url,panel.name,_this.queryStringFvars?_this.pieceVars:null,panel.trackers);};var canShowMain=function(){var _metaData=_panelSelector.getMetaData('main');return!_metaData.empty&&std.canShowRichMedia()&&!(_metaData.type==PieceType.Flash&&!std.canShowFlash());};var canShowBackup=function(){return _panelSelector.contains('backup');};var tryGetPanelListName=function(panelListName){var _metaData=_panelSelector.getMetaData('main');switch(panelListName){case'main':panelListName=canShowMain()?'main':canShowBackup()?'backup':'';break;case'backup':panelListName=canShowBackup()?'backup':canShowMain()?'main':'';break;}
return panelListName;};this.getCurrentPanel=function(panelListName){var panel=_panelSelector.getCurrentPanel.apply(this,arguments);return buildPanel(panel,panelListName);};this.getNextPanel=function(panelListName){var panel=_panelSelector.getNextPanel.apply(this,arguments);return buildPanel(panel,panelListName);};this.tryGetPanel=function(panelListName){var panel=_panelSelector.getNextPanel(tryGetPanelListName(panelListName));return buildPanel(panel,panelListName);};this.setRotationCriteria=_panelSelector.setRotationCriteria;this.std=std;this.position=position;this.selfParams={hAlign:"left",vAlign:"top",defaultZ:1,topZ:20000};this.globalParams={altText:std.alt||""};map(this.selfParams,panelGroup.parameters);map(this.globalParams,std.getGlobalParams());this.getPanelGroup=function(){return panelGroup;};this.getPanelGroupId=function(){return panelGroupId;};this.creatives=new CreativeCollection(_panelSelector,panelGroup,position);this.positionLayout=new PositionLayout(_panelSelector,position);this.containsPanel=_panelSelector.contains;this.canShowMain=canShowMain;};var MouseMoveEvent=function(piece,callback)
{var _lastX,_lastY;var mousemove=function(event)
{var x=Lang.isNumber(event.offsetX)?event.offsetX:event.layerX;var y=Lang.isNumber(event.offsetY)?event.offsetY:event.layerY;if(_lastX!=x||_lastY!=y)
{_lastX=x;_lastY=y;callback(event);}};this.startCapturing=function()
{piece.addEvent("mouseMoveOverPiece",mousemove);};this.stopCapturing=function()
{piece.removeEvent("mouseMoveOverPiece",mousemove);};};var PanelTracker=function(id){var _timers={};var _event=new EventManager(this);this.id=id;this.eachTimer=function(callback){foreach(_timers,callback);};this.stop=function(){foreach(_timers,function(i,timer){timer.stop();});};this.getTimer=function(timerId){if(!_timers[timerId]){_timers[timerId]=new Timer(500);_timers[timerId].addEvent("timerStopped",function(){_event.fire("timerStopped",false,timerId,_timers[timerId]);});}
return _timers[timerId];};};var PanelTimeCounter=function(panels){var _this=this;var _currentPanel;var _starts={};this.startTimer=function(timerId){if(_currentPanel){_starts[timerId]=true;_currentPanel.getTimer(timerId).start();}};this.stopTimer=function(timerId){if(_currentPanel){_starts[timerId]=false;_currentPanel.getTimer(timerId).stop();}};this.resetPanelTracker=function(){if(_currentPanel){foreach(_starts,function(id,value){if(value)
_currentPanel.getTimer(id).stop();});_starts={};}
_currentPanel=null;};this.setPanelTracker=function(panelId){if(_currentPanel){if(panelId==_currentPanel.id)
return;_this.resetPanelTracker();}
if(!panels.get(panelId)){panels.create(panelId);}
_currentPanel=panels.get(panelId);_this.startTimer("ADM_ExposureTime");};};PanelTimeCounter.Empty={startTimer:new Empty(),stopTimer:new Empty(),resetPanelTracker:new Empty(),setPanelTracker:new Empty()};var MouseTracker=function(piece){var _this=this;var _stopInteracting,_stopTimeout;var _interacting=false;var _started=false,_starting=false;var _event=new EventManager(this);var onStopTimeout=function(){if(_started){_event.fire("stopInteraction");_started=false;}};var resetStopTimer=function(){Period.clearTimeout(_stopTimeout);_stopTimeout=Period.setTimeout(onStopTimeout,_this.stopDelay);};var mouseMove=function(){Period.clearTimeout(_stopInteracting);if(_started)
resetStopTimer();_stopInteracting=Period.setTimeout(function()
{_interacting=false;},_this.startDelay/4);if(!_starting&&!_started)
{_starting=true;Period.setTimeout(function(){_starting=false;if(_interacting)
{resetStopTimer();_event.fire("startInteraction");_started=true;}},_this.startDelay);}
_interacting=true;};var mouseMoveEvent=new MouseMoveEvent(piece,mouseMove);mouseMoveEvent.startCapturing();this.reset=function(){if(_stopTimeout){Period.clearTimeout(_stopTimeout);_stopTimeout=null;onStopTimeout();}};this.stop=function(){if(mouseMoveEvent){mouseMoveEvent.stopCapturing();mouseMoveEvent=null;}
_this.reset();};this.startDelay=1000;this.stopDelay=1000;};MouseTracker.Empty={reset:new Empty(),stop:new Empty(),addEvent:new Empty()};var EventType={Click:{id:'1',name:'Click'},Timer:{id:'3',name:'Timer'},Interaction:{id:'2',name:'Interaction'},Automatic:{id:'4',name:'Automatic'},Impression:{id:'5',name:'Impression'}};var EventTracker=function(piece,reporter,trackers){var _this=this;var _m=new Log("EventTracker");var _mouseTracker;var _trackerId;var onClickEvent=function(id){reporter.reportClickEvent(id,_trackerId);};var onInteractionEvent=function(id){reporter.reportInteractionEvent(id);};var onAutomaticEvent=function(id){reporter.reportAutomaticEvent(id);};var onInteractedImpression=function(){reporter.reportInteractedImpression();};var onImpressionEvent=function(){if(_trackerId)
reporter.reportImpressionEvent("ADM_Impression",_trackerId);};var onTimerEvent=function(args){if(args.Action=="start"){_this.startInteraction(args.Identifier);}
else if(args.Action=="stop"){_this.stopInteraction(args.Identifier);}};var setTrackerId=function(trackerId){if(trackerId in trackers){_mouseTracker.reset();piece.localCounter.setPanelTracker(_trackerId=trackerId);if(!!trackers[trackerId])
onImpressionEvent();}
else{_trackerId=null;piece.localCounter.resetPanelTracker();}};var init=function(){trackers=trackers||{};piece.localCounter=piece.globalCounter=null;if(piece.disabledReports){for(var i=0;i<piece.disabledReports.length;i++){switch(piece.disabledReports[i]){case EventType.Click.name:onClickEvent=Empty;break;case EventType.Interaction.name:onInteractionEvent=Empty;onInteractedImpression=Empty;break;case EventType.Timer.name:onTimerEvent=Empty;piece.globalCounter=PanelTimeCounter.Empty;piece.localCounter=PanelTimeCounter.Empty;break;case EventType.Automatic.name:onAutomaticEvent=Empty;break;case EventType.Impression.name:onImpressionEvent=Empty;break;case"mouseTracker":_mouseTracker=MouseTracker.Empty;break;}}}
if(!_mouseTracker)
_mouseTracker=new MouseTracker(piece);if(!piece.globalCounter)
piece.globalCounter=new PanelTimeCounter(reporter.getPanelTrackerManager());if(!piece.localCounter)
piece.localCounter=new PanelTimeCounter(reporter.getPanelTrackerManager());piece.globalCounter.setPanelTracker(PanelTrackerManager.GLOBAL);_mouseTracker.addEvent("startInteraction",function(){onInteractedImpression();_this.startInteraction();});_mouseTracker.addEvent("stopInteraction",function(){_this.stopInteraction();});piece.addEvent(FSCOMMAND.REPORT_EVENT,function(cmd){_m.mes(26000,cmd.nodeID,cmd.args.Type,cmd.args.Identifier);switch(cmd.args.Type){case EventType.Click.name:onClickEvent(cmd.args.Identifier);break;case EventType.Interaction.name:onInteractionEvent(cmd.args.Identifier);break;case EventType.Timer.name:onTimerEvent(cmd.args);break;case EventType.Automatic.name:onAutomaticEvent(cmd.args.Identifier);break;}});piece.addEvent(FSCOMMAND.POI,function(cmd){onInteractionEvent(cmd.args.poi);});piece.addEvent(FSCOMMAND.CLICK,function(cmd){onClickEvent();});piece.addEvent("backup_click",function(cmd){onClickEvent();});piece.addEvent(FSCOMMAND.SET_PANEL_TRACKER,function(cmd){setTrackerId(cmd.args.Identifier);});if(!piece.canSetTrackers){foreach(trackers,function(trackerId){setTrackerId(trackerId);return foreach.Break;});}};this.startInteraction=function(id){id=id||"ADM_InteractionTime";if(id=="ADM_InteractionTime")
{piece.localCounter.startTimer(id);piece.globalCounter.startTimer("ADM_EngagementTime");}
if(id=="ADM_VideoPlayback")
piece.globalCounter.startTimer("ADM_EngagementTime");piece.globalCounter.startTimer(id);};this.stopInteraction=function(id){id=id||"ADM_InteractionTime";if(id=="ADM_InteractionTime")
{piece.localCounter.stopTimer(id);piece.globalCounter.stopTimer("ADM_EngagementTime");}
if(id=="ADM_VideoPlayback")
piece.globalCounter.stopTimer("ADM_EngagementTime");piece.globalCounter.stopTimer(id);};this.startExpansion=function(){piece.globalCounter.startTimer("ADM_ExpandDuration");};this.stopExpansion=function(){piece.globalCounter.stopTimer("ADM_ExpandDuration");};this.stop=function(){_mouseTracker.stop();piece.localCounter.resetPanelTracker();piece.globalCounter.resetPanelTracker();};init();};var Transition=function(previousFormat,format,previousPiece,nextPiece,events,removeDelay,pieceType,keepPrevious)
{var _this=this;var _cancelled=false;var _onSwitch;var _removeTimeout;var _switchDone=false;var removePrevious=function(){var t={transition:true,pieceType:pieceType};_removeTimeout=null;if(previousPiece)
previousPiece.remove(t);else if(previousFormat)
previousFormat.remove(t);};var switchPiece=function(){_switchDone=true;_onSwitch();if(!keepPrevious){removeDelay=removeDelay==undefined||isNaN(removeDelay)?null:removeDelay;if(removeDelay===null)
removePrevious();if(removeDelay!==null){_removeTimeout=Period.setTimeout(removePrevious,removeDelay);}}
format.fireEvent('pieceReadyToRender',false,nextPiece,pieceType);if(events.pieceReadyToRender)
events.pieceReadyToRender(nextPiece,pieceType);};this.cancel=function(){if(!_cancelled){_cancelled=true;if(!_switchDone&&nextPiece){nextPiece.remove();}
if(_removeTimeout){Period.clearTimeout(_removeTimeout);_removeTimeout=null;}}};this.finalize=function(){if(_switchDone&&_removeTimeout){Period.clearTimeout(_removeTimeout);removePrevious();}};this.setOnSwitch=function(callback){_onSwitch=callback;delay(function(){if(!_cancelled){format.fireEvent('pieceCreated',false,nextPiece,pieceType);if(events.pieceCreated)
events.pieceCreated(nextPiece,pieceType);nextPiece.setOnLoad(function(){format.fireEvent('pieceLoaded',false,nextPiece,pieceType);});if(previousPiece||previousFormat)
nextPiece.setOnLoad(function(){if(!_cancelled)
switchPiece();});else
switchPiece();}},Browser.OP&&Event.isPageLoaded());};};var PieceFactory=function(panelGroupConfig){var std=panelGroupConfig.std;this.createFlashPiece=function(node,panel,autoRender){var piece=new FlashPiece(panel.url,false,globalSettings.flashContainerConfig);piece.enableCommandFallback(Browser.IE&&Browser.mode==11);piece.setFvars(panelGroupConfig.pieceVars);piece.setAutoRender(autoRender);if(globalSettings.tryUseDocumentWrite)
piece.useDocWrite(panelGroupConfig.position.canUseDocWriteForNode(node));return piece;};this.createImagePiece=function(node,panel){var piece=new ImagePiece(panel.url,node,std.getURLClick());piece.setAltText(panelGroupConfig.globalParams.altText);return piece;};this.createHTMLPiece=function(node,panel){var piece=new HTMLPiece(panel.url,node);piece.setVars(panelGroupConfig.pieceVars);return piece;};};var Format=function(panelGroupConfig){var _m=new Log("Format");var _this=this;var _std=panelGroupConfig.std;var _event=new EventManager(this);var _piece;var _currentURL=null;var _transition;var _eventTracker;var _cookie=new Cookie();var _pieceFactory;this.createPieceFactory=function(){return new PieceFactory(panelGroupConfig);};this.setPiece=function(panel,node,events,removeDelay){_pieceFactory=_this.createPieceFactory();if(_this.previousFormatRemoveDelay){removeDelay=_this.previousFormatRemoveDelay;}
events=events||{};_this.cancelSwitch();if(_transition)
_transition.finalize();if(panel==_currentURL)
return;_m.mes(12020,panel.type);var newPiece;switch(panel.type)
{case PieceType.Image:newPiece=_pieceFactory.createImagePiece(node,panel);break;case PieceType.Flash:newPiece=_pieceFactory.createFlashPiece(node,panel,!_this.previousFormat&&!_piece);break;case PieceType.HTML:newPiece=_pieceFactory.createHTMLPiece(node,panel);break;}
if(!newPiece)
{_m.err(12021,panel.type,panel.name);return;}
if(events.pieceSettings)
events.pieceSettings(newPiece,panel.type);if(panelGroupConfig.globalParams.notifyPageLoad&&newPiece.sendMessage){Event.onPageLoad(function(){newPiece.sendMessage("jsHandlePageLoadedEvent");});}
_this.fireEvent('pieceSettings',false,newPiece,panel.type);newPiece.insertFirst(node);_transition=new Transition(_this.previousFormat,_this,_piece,newPiece,events,removeDelay,panel.type,_this.keepPrevious);_transition.setOnSwitch(function(){if(_piece)
_m.mes(12030);_currentURL=panel;_this.previousFormat=null;_this.previousFormatRemoveDelay=null;(_piece=newPiece).addEvent(null,function()
{if(_event)
_event.fire.apply(_event,arguments);});if(_eventTracker)
_eventTracker.stop();_eventTracker=_std.getReporter().createEventTracker(_piece,panel.trackers);_this.eventTracker=_eventTracker;});};this.getPosition=function(){return panelGroupConfig.position;};this.getSelfParams=function(){return panelGroupConfig.selfParams;};this.getGlobalParams=function(){return panelGroupConfig.globalParams;};this.cancelSwitch=function(){if(_transition)
_transition.cancel();};this.getPiece=function(){return _piece||EmptyFormat.getPiece();};this.remove=function(transitionData){_this.cancelSwitch();_this.clear();if(_event){_event.fire("formatCleared",true);}
if(_eventTracker)
_eventTracker.stop();Period.setTimeout(function()
{if(_piece)
_piece.remove(transitionData);_this.fireEvent("formatRemoved",true);_event=null;_m.mes(12040);},0,true);};this.onRemove=function(callback){_event.add("formatCleared",callback);};this.setParams=function(params,notOverwrite){map(panelGroupConfig.selfParams,params,!!notOverwrite,function(param){_m.war(12010,param);return false;});};this.clear=this.defaultClear=function(){if(_piece){if(_piece.getNode()){_piece.getNode().style.display="none";}}};this.hide=this.defaultHide=function(){if(_piece&&_piece.hide)
_piece.hide();};this.show=this.defaultShow=function(){if(_piece&&_piece.show)
_piece.show();};this.unload=this.defaultUnload=function(){if(_piece&&_piece.unload)
_piece.unload();};this.reload=this.defaultReload=function(){if(_piece&&_piece.reload)
_piece.reload();};this.init=new Empty();this.getPanelGroupId=panelGroupConfig.getPanelGroupId;this.addEvent(FSCOMMAND.SET_STYLE,function(obj){if(_piece){try{map(_piece.getNode().style,obj.args);}
catch(_){}}});this.addEvent(FSCOMMAND.HIDE_PIECE,function(){if(_piece){try{_piece.hide();}
catch(_){}}});this.addEvent(FSCOMMAND.SHOW_PIECE,function(){if(_piece){try{_piece.show();}
catch(_){}}});var savedDataCookieName='AdmFlashData'+(panelGroupConfig.globalParams.freqCapId||panelGroupConfig.std.getUniqueId());this.addEvent(FSCOMMAND.SAVE_DATA,function(data){var cookieDate=panelGroupConfig.globalParams.freqCapSession?null:addHoursToDate(new Date(),panelGroupConfig.globalParams.freqCapExpiration||24);var cookieDataObject=fromJSON(_cookie.getCookie(savedDataCookieName));var cookieDomain=panelGroupConfig.globalParams.cookieDomain;var id=panelGroupConfig.getPanelGroupId();if(!cookieDataObject[id])
cookieDataObject[id]={};map(cookieDataObject[id],data.args);_cookie.setCookie(savedDataCookieName,toJSON(cookieDataObject),cookieDate,cookieDomain);});this.addEvent('pieceSettings',function(piece){if(piece.setFvars&&_cookie.getCookie(savedDataCookieName))
piece.setFvars({savedData:encodeURIComponent(_cookie.getCookie(savedDataCookieName))});});var cssClassName=_this.getSelfParams().cssClassName;if(cssClassName){var doc=WindowContext.getTopAccessWindow().document;this.addEvent("pieceReadyToRender",function(piece){doc.body.className+=" "+cssClassName;});this.addEvent("formatCleared",function(){doc.body.className=doc.body.className.replace(" "+cssClassName,"");});}};var EmptyFormat=new function(){this.remove=this.onRemove=this.init=this.addEvent=new Empty();this.getPiece=function(){return{setOnLoad:function(c){if(Lang.isFunction(c))c();},addEvent:new Empty(),getNode:new Empty(),remove:new Empty(),callExternalInterface:new Empty(),callExternalInterfaceTillSuccess:new Empty()};};this.New=function(){return new this.constructor;};};var ImagePiece=function(src,node,clickUrl){var _m=new Log("ImagePiece");var _elem=new Element(node,'img');var _elementEvent=new Event(_elem.getNode());var _event=new EventManager(this);var _node=_elem.getNode();var _parentNode;_elementEvent.add("load",function(){_m.mes(22000);_event.fire('load',true);});_elementEvent.add("error",function(){_m.err(22010);_event.fire('load',true);});_elementEvent.add("mousemove",function(e){_event.fire("mouseMoveOverPiece",false,e);});if(clickUrl){_elementEvent.add('click',function()
{_event.fire("backup_click");window.open(clickUrl);});_elem.getNode().style.cursor='pointer';}
_node.style.verticalAlign="top";_node.src=src;this.setOnLoad=function(callback){_event.add('load',callback);};this.setSize=_elem.setSize;this.getSize=_elem.getSize;this.setPosition=function(l,t){_elem.setPosition(l,t);};this.insertFirst=function(node){_parentNode=node;};this.remove=function(){_event.fire("piece_removed");_elem.remove();};this.getNode=_elem.getNode;this.getContainerNodeID=_elem.getNodeID;this.render=function(){_elem.insertFirst(_parentNode);};this.setAltText=function(str){_node.setAttribute("alt",str);};};var PostingDataType={Event:'Event',Command:'Command'};var PostingData=function(type,message,args){this.type=type;this.message=message;this.args=args;};var HTMLPiece=function(src,node){var _m=new Log("HTMLPiece");var _this=this;var _elem=new Element(node,'iframe');var _event=new EventManager(this);var _parentNode;var _iframeOwnerWindow=node.ownerDocument.defaultView?node.ownerDocument.defaultView:node.ownerDocument.parentWindow;var _iframeContentWindow;var _pieceVars={};var _renderStyle={};var _attributes={};var _originalVisibility={};var _postMessage=function(postingData){_iframeContentWindow.postMessage(toJSON(postingData),"*");};var handleOrientationChange=function(){_postMessage(new PostingData(PostingDataType.Event,"orientationchange",window.orientation));};var _consume={"load":true,"SDKReady":true,"orientationchange":false};_event.add("SDKReady",function(){_postMessage(new PostingData(PostingDataType.Command,"setVars",_pieceVars));handleOrientationChange();});Event.add(window,"orientationchange",handleOrientationChange);this.setVars=function(vars){map(_pieceVars,vars);};var postMessageHandler=function(event){var data=fromJSON(event.data);_m.mes(34000,data.type,data.message);_m.mes(11022,data.type,data.message);if(event.source==_iframeContentWindow){switch(data.type){case PostingDataType.Event:_event.fire(data.message,!!_consume[data.message],data.args);break;case PostingDataType.Command:Piece.sendCommand(_this,{name:data.message,arg:data.args,nodeId:_elem.getNodeID(),originalCmd:data.message,originalArg:data.args});break;}}};this.setOnLoad=function(callback){_event.add('load',callback);};this.setSize=function(width,height){_originalVisibility.width=width+'px';_originalVisibility.height=height+'px';_pieceVars.width=width;_pieceVars.height=height;_elem.setSize(width,height);};this.getSize=_elem.getSize;this.setPosition=function(nLeft,nTop,positionType){_elem.setPosition(nLeft,nTop,positionType);};this.getPosition=function(){return _elem.getPosition();};this.insertFirst=function(node){_parentNode=node;};this.remove=function(){Event.remove(window,"orientationchange",handleOrientationChange);_elem.remove();};this.getNode=_elem.getNode;this.getContainerNodeID=_elem.getNodeID;this.setStyle=_elem.setStyle;this.setClip=function(clipping){_elem.getNode().style.clip=clipping;};this.hide=function(){if(_elem.getNode()&&_elem.getNode().style.width=="0px"){return;}
map(_originalVisibility,_elem.getNode().style);_elem.getNode().style.width="0px";_elem.getNode().style.height="0px";};this.show=function(){if(_elem.getNode()&&_elem.getNode().style.width!="0px")
return;map(_elem.getNode().style,_originalVisibility);};this.setAttributes=function(attributes){map(_attributes,attributes);};this.setRenderStyle=function(attributes){map(_renderStyle,attributes);};this.postMessage=_postMessage;this.sendMessage=function(methodName,arg){_this.postMessage(new PostingData(PostingDataType.Command,methodName,arg));};this.render=function(){Event.add(_iframeOwnerWindow,'message',postMessageHandler);var _node=_elem.getNode();var style=_node.style;_this.setAttributes({allowTransparency:"true",frameBorder:0,scrolling:"no"});foreach(_attributes,function(attribute,value){_node.setAttribute(attribute,value);});style.borderStyle="none";map(style,_renderStyle);_elem.insertFirst(_parentNode);_iframeContentWindow=_elem.getNode().contentWindow;var queryString=src.indexOf("?")==-1?map({"HTMLCreativeURL":AdmotionMod.getUrl(instanceId,"htmlcreative")},_pieceVars):{};_node.src=src+Utility.buildQueryString(queryString,true);};this.canSetTrackers=true;};var PrimitiveAd=function(panelGroupConfig,panelListName){Format.apply(this,arguments);var _this=this;var _creativeLayout=panelGroupConfig.creatives.getLayout(panelListName);this.init=function(){_this.setPiece(panelGroupConfig.tryGetPanel(panelListName),panelGroupConfig.position.getNode(),{pieceSettings:function(piece){piece.setSize(_creativeLayout.width,_creativeLayout.height);},pieceReadyToRender:function(piece){piece.render();}});};};PrimitiveAd.needsExtension=function(panelGroupConfig){try{var alignParametersExist=!!(panelGroupConfig.selfParams.posHAlign||panelGroupConfig.selfParams.posVAlign);var mainOffsetsExist=!!(panelGroupConfig.getCurrentPanel('main').left||panelGroupConfig.getCurrentPanel('main').top);var backupExists=panelGroupConfig.containsPanel('backup');var backupOffsetsExist=backupExists?!!(panelGroupConfig.getCurrentPanel('backup').left||panelGroupConfig.getCurrentPanel('backup').top):false;var politeExists=panelGroupConfig.containsPanel('polite');var politeOffsetsExist=politeExists?!!(panelGroupConfig.getCurrentPanel('polite').left||panelGroupConfig.getCurrentPanel('polite').top):false;if(panelGroupConfig.std.canShowRichMedia()){return alignParametersExist||mainOffsetsExist||politeExists&&panelGroupConfig.globalParams.polite&&(alignParametersExist||politeOffsetsExist);}
else{return backupExists&&(alignParametersExist||backupOffsetsExist);}}
catch(e){return false;}};var ExtensiblePrimitiveAd=function(panelGroupConfig,panelListName){PrimitiveAd.apply(this,arguments);External.apply(this,[External.StaticFormat,arguments,PrimitiveAd.needsExtension(panelGroupConfig)]);var _this=this;var _myBase=map({},_this);this.init=function(){_this.onReady(function(){_myBase.init();});};};var Backup=function(panelGroupConfig){ExtensiblePrimitiveAd.apply(this,[panelGroupConfig,'backup']);};var Banner=function(panelGroupConfig){ExtensiblePrimitiveAd.apply(this,[panelGroupConfig,'main']);};var Polite=function(panelGroupConfig){PrimitiveAd.apply(this,[panelGroupConfig,'polite']);};var FormatBinding=function(fileManager){var _this=this;var _formatsInfo={};var _bindingInstances={};var _executeCommand;this.init=function(){fileManager.eachPanelGroup(function(behaviorGroupName,panelGroupName,params){if(params.bindingId){var role=FormatBinding.split(params.bindingType).role;if(!_formatsInfo[params.bindingId]){_formatsInfo[params.bindingId]={};}
if(!_formatsInfo[params.bindingId][role]){_formatsInfo[params.bindingId][role]=[];}
_formatsInfo[params.bindingId][role].push({behaviorGroupName:behaviorGroupName,panelGroupName:panelGroupName});}});};this.setExecuteCommand=function(callback){_executeCommand=callback;};this.addFormat=function(format){var params=format.getSelfParams();var bindingType=params.bindingType;if(bindingType){var bindingInfo=FormatBinding.split(bindingType);FormatBinding.event.add(bindingInfo.bindingName,function(binding){var key=params.bindingId;if(!_bindingInstances[key]){_bindingInstances[key]=new binding(_formatsInfo[key],fileManager,_executeCommand);}
_bindingInstances[key].add(format,bindingInfo.role);});}};};FormatBinding.event=new EventManager();FormatBinding.separator=":";FormatBinding.addBinding=function(bindingName,bindingClass){FormatBinding.event.fire(bindingName,true,bindingClass);};FormatBinding.addBindings=function(bindings){foreach(bindings,FormatBinding.addBinding);};FormatBinding.split=function(bindingType){var split=bindingType.split(FormatBinding.separator);return{bindingName:split[0],role:split[1]};};var FloatingBanner=function(panelGroupConfig){Format.apply(this,arguments);var _m=new Log("FloatingBanner");var _this=this;var _creativeLayout=panelGroupConfig.creatives.getLayout("main");var _positionLayout=panelGroupConfig.positionLayout;var _params=panelGroupConfig.selfParams;var _blind;this.init=function(){var _anchor=panelGroupConfig.position.getAnchor();_this.setPiece(panelGroupConfig.tryGetPanel("main"),_anchor.parentNode,{pieceSettings:function(piece){piece.setSize(_creativeLayout.width,_creativeLayout.height);piece.setPosition("auto","auto");piece.setRenderStyle({"z-index":Lang.isNumber(panelGroupConfig.selfParams.topZ)?panelGroupConfig.selfParams.topZ:20000});},pieceCreated:function(piece){var container=piece.getContainerNode();_anchor.parentNode.insertBefore(container,_anchor);},pieceReadyToRender:function(piece){map(_anchor.style,{width:parsePx(_positionLayout.width),height:parsePx(_positionLayout.height),display:"inline-block"});if(panelGroupConfig.selfParams.useBlind){(new External(External.Blind,[],true)).onExternal(function(){piece.render();_this.addEvent(FSCOMMAND.SET_BLIND_COLOR,function(command){if(!_blind){if(!panelGroupConfig.globalParams.appendToParentNode){var desiredSize=[0,0];var desiredPosition=[0,0];if(_params.blindUsePieceWidth){desiredSize[0]=_creativeLayout.width;desiredPosition[0]=Element.getPosition(piece.getNode())[0];}
else{if(_params.blindUsePieceHeight){desiredSize[1]=_creativeLayout.height;desiredPosition[1]=Element.getPosition(piece.getNode())[1];}}
var zIndex=panelGroupConfig.selfParams.topZ-1;_blind=new AdmCore.Blind();_blind.create(zIndex,command.args.color,command.args.opacity,desiredSize,desiredPosition);}
else{_m.err(33000);return;}}
_blind.doTransition(command.args.color,command.args.duration);});_this.addEvent(FSCOMMAND.CLEAR_BLIND_COLOR,function(command){if(_blind){_blind.clear(command.args.duration);}});_this.addEvent("formatCleared",function(){if(_blind){_blind.remove();}});});}
else{piece.render();}}});};};var AdImplementation=function(){var _m=new Log('AdImplementation');var detectPreDAP=function(pos){var parentWindow=WindowContext.getParent(pos.window);var parentParentWindow=WindowContext.getParent(parentWindow);if(parentWindow&&WindowContext.getWindowAccess(parentWindow)&&WindowContext.getWindowAccess(parentParentWindow)&&parentWindow.frameElement&&parentWindow.frameElement.id){var regex=new RegExp(parentWindow.frameElement.id);return pos.window.frameElement.id.match(regex);}
return false;};var detectDAP=function(pos){var parentWindow=WindowContext.getParent(pos.window);return WindowContext.getWindowAccess(parentWindow)&&pos.window.document.body.id&&pos.window.document.body.id==pos.window.frameElement.id;};var detectIframe=function(pos){var parentWindow=WindowContext.getParent(pos.window);var parentParentWindow=WindowContext.getParent(parentWindow);return!WindowContext.getWindowAccess(parentWindow)&&WindowContext.getWindowAccess(parentParentWindow);};var hasImages=function(node){var ret=false;var nodes=node.getElementsByTagName('img');for(var i=0;i<nodes.length&&!ret;i++){ret=nodes[i].offsetWidth>1&&nodes[i].offsetHeight>1;}
return ret;};var hasTextContent=function(node){var useTextContent=typeof node.textContent!="undefined";var property=useTextContent?"textContent":"innerText";var text=node[property];var scriptNodes=node.ownerDocument.getElementsByTagName("script");var noscriptNodes=node.ownerDocument.getElementsByTagName("noscript");for(var i=0;i<scriptNodes.length;i++){text=text.replace(scriptNodes[i][property],"");}
for(i=0;i<noscriptNodes.length;i++){text=text.replace(noscriptNodes[i][property],"");}
text=text.replace(/[\t\s\n\r]/mg,"");return!(text=="");};var isContentWindow=function(win){var size=WindowContext.getViewportSize(win);var body=win.document.body;return size[0]>1&&size[1]>1&&(hasTextContent(body)||hasImages(body));};var detectGenericIframe=function(possibleAdWindow,adWindowHasBeenDetected){if(!possibleAdWindow||isContentWindow(possibleAdWindow)){return adWindowHasBeenDetected?possibleAdWindow:null;}
else{return detectGenericIframe(WindowContext.getNextAccessibleWindow(possibleAdWindow),true);}};this.init=function(pos){var genericIframeWindow;if(pos.initialized)
return;pos.initialized=true;if((pos.insideIframe||pos.iframeForced)&&WindowContext.canAccessOuterIframes(pos.window)){var parentWindow;if(detectIframe(pos)||pos.iframeForced)
{_m.mes(24030);parentWindow=WindowContext.getParent(pos.window);pos.setMode(true,null,WindowContext.getIFrameElement(pos.window,WindowContext.getParent(parentWindow)));}
else if(detectPreDAP(pos))
{_m.mes(24031);parentWindow=WindowContext.getParent(pos.window);var outer=pos.appendToParentNode?parentWindow.frameElement.parentNode:WindowContext.getParent(parentWindow).document.body;pos.setMode(true,null,null,outer);}
else if(detectDAP(pos))
{_m.mes(24034);pos.setMode(true);}
else if(genericIframeWindow=detectGenericIframe(pos.window))
{_m.war(24032);pos.setMode(true,null,WindowContext.getIFrameElement(pos.window,genericIframeWindow));}
else
{_m.mes(24033);pos.setMode(false);}}
else
{_m.mes(24033);pos.setMode(false);}};};AdImplementation=new AdImplementation();AdmCore.Position=function(name,win,id,positionNodeBuilder,noAutoDisableDocWrite){var _m=new Log('Position');var _event=new EventManager(this);var _this=this;var _canUseDocWrite=true;var _nodeElement;var _targetNode=null;var _bounding=Platform.createDefaultBounding();var _state=false;this.name=name;this.height=null;var detectWindow=function(onWindow){if(win){_this.window=win;_this.document=win.document;onWindow();}
else if(positionNodeBuilder){Utility.doWhen(positionNodeBuilder,"onExternal",function(){positionNodeBuilder.build(function(node,targetNode){_this.document=node.ownerDocument;_this.window=WindowContext.getNodeWindow(node);_this.setNode(node);_targetNode=targetNode;onWindow();});});}
else{_m.err(33000,name);}};var setNodes=function(node,anchor,outerNode)
{_this.setNode(node);_this.anchor=anchor;_this.outerNode=outerNode||(_this.appendToParentNode?_this.anchor.parentNode:_this.anchor.ownerDocument.body);Utility.doWhen(_bounding,"onExternal",function(){_bounding.addEvent("ready",function(){_event.fire("nodeReady",true);});});};var fixDisplay=function(node)
{if(node&&_canUseDocWrite)
node.style.display="inline";};var waitForNode=function(func)
{var node;var condition=new ConditionControl(200);condition.addCondition(Operator.And,function()
{return!!(node=_this.document.getElementById(id));});condition.ifTrue(function()
{func(node);});};this.setMode=function(isIframe,node,anchor,outerNode){if(isIframe)
{setNodes(node||_this.document.body,anchor||_this.window.frameElement,outerNode);}
else
{node=node||_this.getNode();if(!node)
{waitForNode(function(node){setNodes(node,anchor||node,outerNode);});}
else
setNodes(node,anchor||node,outerNode);}};this.getId=function()
{return id;};this.setNode=function(node)
{_nodeElement=Element.instance(node);id=_nodeElement.getNode().id;};this.getNode=function()
{return _nodeElement?_nodeElement.getNode():null;};this.getTargetNode=function()
{return _targetNode;};this.canUseDocWriteForNode=function(node)
{return _canUseDocWrite&&node.ownerDocument==_this.document;};this.disableDocWrite=function()
{_canUseDocWrite=false;};this.init=function()
{if(!_state){_state=true;detectWindow(function()
{_this.insideIframe=WindowContext.getTop()!=_this.window;AdImplementation.init(_this);});}};this.setBounding=function(value){_bounding=value;};this.getBounding=function(){return _bounding;};this.destruct=function(){if(positionNodeBuilder){_event.fire("beforeDestruct",true);positionNodeBuilder.destruct();}};this.setAppendToParentNode=function(){_this.appendToParentNode=true;};this.getAnchor=function(){return _this.anchor;};id=id||null;if(!noAutoDisableDocWrite)
Event.onCoreFinish(this.disableDocWrite);Period.setTimeout(this.disableDocWrite,0);Period.setTimeout(function(){_event.fire("layoutReady",true);},5000);FormatCleanup.watchPositionForFormatCleanup(_this);};AdmCore.Position.prototype.clear=new Empty();var Disposable=function(){this.testAccess=new Empty();};Disposable.hasBeenDisposed=function(disposableObject){if(!disposableObject){return true;}
try{disposableObject.testAccess();return false;}
catch(e){return true;}};var TagManager=function(win,id){Disposable.apply(this);var _event=new EventManager(this);var _m=new Log("TagManager");var _tagDetectionHistory=[];win["ADM_addTAG"+id]=function(immediate,posName,posWindow,id){_m.mes(25000,posName);_tagDetectionHistory.push(arguments);_event.fire('tagDetected',false,immediate,posName,posWindow,id);_event.fire(posName,true);if(posWindow!=WindowContext.getParent(posWindow)){Period.setTimeout(function(){_m.mes(25001,posName);posWindow.document.close();},0);}};this.getTagDetectionHistory=function(){return _tagDetectionHistory;};Event.onPageUnload(function(){win["ADM_addTAG"+id]=null;});win.ADM_addTAG_v3_0_0=function(){win.ADM_addTAG_v3_0_0=null;return win["ADM_addTAG"+id].apply(this,arguments);};};var PositionManager=function(fileManager,nodeConfig){var _defaultPosition;var _uniqueID="nodeID_"+random(8);var _nodeName=nodeConfig.nodeName||'div';var _m=new Log('PositionManager');var _event=new EventManager(this);var _position={};var _zombiePosition={};var setZombiePosition=function(name,createPositionCallback){if(name in _zombiePosition){var pos=_zombiePosition[name].createZombiePosition();pos.createZombiePosition=_zombiePosition[name].createZombiePosition;delete _zombiePosition[name];pos.addEvent("positionEmpty",function(){if(_position[name]){_zombiePosition[name]={createZombiePosition:_position[name].createZombiePosition};_position[name].destruct();delete _position[name];}});return _position[name]=pos;}
else
return _zombiePosition[name]={createZombiePosition:createPositionCallback};};var setAnchorSize=function(position){var panelGroup=fileManager.getPanelGroup(position.name,"_default");if(!panelGroup.empty){var params=panelGroup.parameters||{};var desiredWidth=params.posWidth;var desiredHeight=params.posHeight;var positionLayout=new PositionLayout(new AdmCore.PanelSelector(panelGroup),position);position.width=desiredWidth||positionLayout.width;position.height=desiredHeight||positionLayout.height;if(params.resizePosition&&!params.showAfterPieceCommand){position.disableDocWrite();position.addEvent("nodeReady",function(){var anchor=position.getAnchor();if(anchor){Element.instance(anchor).setSize(position.width,position.height);if(anchor.style.display!="inline-block"&&anchor.clientHeight<position.height){anchor.style.display="inline-block";}}});}}
else{_m.err(29000,position.name);}};this.setDetectedPositions=function(){var setDetectedPosition=function(immediate,posName,posWindow,id){if(!_position[posName]){_position[posName]=new Position(posName,posWindow,id,null,true);if(!immediate){_position[posName].disableDocWrite();}
setAnchorSize(_position[posName]);return true;}
return false;};var handleTagDetectedEvent=function(immediate,posName,posWindow,id){if(setDetectedPosition(immediate,posName,posWindow,id)){_event.fire('delayedDetectedPositionSet',false,_position[posName]);}};TagManager.Instance.addEvent('tagDetected',handleTagDetectedEvent);for(var i=0;i<TagManager.Instance.getTagDetectionHistory().length;i++){setDetectedPosition.apply(this,TagManager.Instance.getTagDetectionHistory()[i]);}};this.setDefaultPosition=function(name){_defaultPosition=name;if(!_position[name]){_position[name]=new Position(name,window,_uniqueID);}
setAnchorSize(_position[name]);return _position[name];};this.setGeneratedPosition=function(name,selectors,nodeRelationship){if(!_position[name]){_position[name]=new Position(name,null,null,new Platform.GeneratedPositionNodeBuilder(selectors,nodeRelationship));setAnchorSize(_position[name]);}
return _position[name];};this.setZombieGeneratedPosition=function(name,selectors,nodeRelationship){return setZombiePosition(name,function(){var pos=new Position(name,null,null,new Platform.GeneratedPositionNodeBuilder(selectors,nodeRelationship));setAnchorSize(pos);return pos;});};this.setWLHeaderPosition=function(name){return setZombiePosition(name,function(){var pos=new Position(name,null,null,new External(External.WLHeaderPositionNodeBuilder,[],true));setAnchorSize(pos);return pos;});};this.getDefaultPositionName=function(){return _defaultPosition;};this.contains=function(name){return(name in _position||name in _zombiePosition);};this.addPosition=function(pos){_position[pos.name]=pos;};this.getPosition=function(name){if(_position[name])
return _position[name];else if(_zombiePosition[name])
return setZombiePosition(name);else
return _position[_defaultPosition]||this.setDefaultPosition('default');};this.getPositions=function(){return _position;};var styleString="display:"+(nodeConfig.display||"block")+";*display:"+(nodeConfig.altDisplay||"block")+";vertical-align:top;padding:0px;margin:0px;";if(AdmCore.referenceNode){var node=document.createElement(_nodeName);node.id=_uniqueID;node.cssText=styleString;if(AdmCore.referenceNode.parentNode.nodeName!="HEAD")
AdmCore.referenceNode.parentNode.insertBefore(node,AdmCore.referenceNode.nextSibling);else
document.body.insertBefore(node,document.body.firstChild);}
else{document.write("<"+_nodeName+" id='"+_uniqueID+"' style='"+styleString+"'><!-- --></"+_nodeName+">");}
ModuleManager.setScriptContainer(document.getElementById(_uniqueID));};var FormatCollection=function()
{var _event=new EventManager(this);var _formats={};var setFormat=function(id,value){_formats[id]=value;_event.fire("formatSet",true,id,value);};var validFormat=function(format)
{return format&&Lang.isFunction(format.remove)&&Lang.isFunction(format.getPiece);};this.add=function(id,format,waitLoad)
{if(validFormat(format)){if(_formats[id]&&waitLoad){format.previousFormat=_formats[id];if(_formats[id].nextFormat)
_formats[id].nextFormat.cancelSwitch();_formats[id].nextFormat=format;}
else
setFormat(id,format);format.onRemove(function(){if(format==_formats[id])
setFormat(id,_formats[id].nextFormat);});}};this.get=function(id)
{return _formats[id];};this.getCollection=function()
{return _formats;};this.contains=function(id)
{return!!_formats[id];};this.clear=function(){foreach(_formats,function(prop,value){if(value&&value.remove)
value.remove();});};};var FileTreeValidator=function(std,polite)
{var _this=this;var _m=new Log('FileTreeValidator');this.validPanel=function(panelList,behaviorName,member)
{var valid=false;var imageExist=false;for(var i=0;i<panelList.length;i++)
{if(panelList[i].url){if(Panel.getType(panelList[i].url)==PieceType.Image)
imageExist=true;valid=true;}
else
_m.err(31010,behaviorName,member,i);}
return{isValid:valid,imageExist:imageExist};};this.validPanelGroup=function(panelGroup,behaviorName,panelGroupName)
{if(!panelGroup)
{_m.mes(31003,behaviorName,panelGroupName);return false;}
var valid=false,validObj;var imageExist=false;var hasValidPolite=false;foreach(panelGroup,function(panelListName,panelList){if(panelListName!="parameters")
{validObj=_this.validPanel(panelList,behaviorName,panelListName);if(validObj.isValid)
{valid=true;if(panelListName=="polite")
hasValidPolite=true;if(validObj.imageExist)
imageExist=true;}}});if(valid)
{if(std.canShowRichMedia()||imageExist)
{if(polite&&!Event.isPageLoaded())
{if(hasValidPolite)
return true;else
_m.war(31001,behaviorName,panelGroupName);}
else
return true;}
else
_m.mes(31000,behaviorName,panelGroupName);}
else
_m.err(31002,behaviorName,panelGroupName);return false;};};var CommandRunner=function(std,polite,fileManager,positionManager,commandFactory,formatBinding)
{var _m=new Log('CommandRunner');var _this=this;var _formats=new FormatCollection();var _panelSelectorCollection={};var _event=new EventManager(this);var _validator=new FileTreeValidator(std,polite);CommandRunner.Collection.push(_formats);var buildConfig=function(cmd,panelGroup){panelGroup=panelGroup||getPanelGroup(cmd);var panelGroupConfig=null;if(panelGroup){if(!_panelSelectorCollection[cmd.objectId])
_panelSelectorCollection[cmd.objectId]=new PanelSelector(panelGroup);panelGroupConfig=new PanelGroupConfig(std,panelGroup,positionManager.getPosition(cmd.positionName),cmd.objectId,_panelSelectorCollection[cmd.objectId]);panelGroupConfig.timer=std.timer;panelGroupConfig.position.iframeForced=std.getGlobalParams().forceIframeMode;map(panelGroupConfig.selfParams,cmd.parameters.self);map(panelGroupConfig.globalParams,cmd.parameters.global);if(panelGroupConfig.globalParams.appendToParentNode){panelGroupConfig.position.setAppendToParentNode();}}
return panelGroupConfig;};var getPanelGroup=function(cmd)
{var panelGroup=fileManager.getPanelGroup(cmd.behaviorGroup.name,cmd.panelGroupName);if(!cmd.panelModifier.empty){panelGroup=panelGroup||{main:[{}]};map(panelGroup.main[0],cmd.panelModifier);}
return cmd.skipValidation||_validator.validPanelGroup(panelGroup,cmd.behaviorGroup.name,cmd.panelGroupName)?panelGroup:null;};var executeFSCommand=function(fscmd,senderId)
{if(fscmd.isGlobal)
{var format=_formats.get(fscmd.objectId);if(format)
format.fireEvent(fscmd.event,false,fscmd);}
if(fscmd.event==FSCOMMAND.SET||fscmd.event==FSCOMMAND.TRYSET||fscmd.event==FSCOMMAND.RESET||fscmd.event==FSCOMMAND.REMOVE)
{_this[fscmd.event](commandFactory.createByObjectId(fscmd.isGlobal?fscmd.objectId:senderId,fscmd.args.commandModifier,fscmd.args.panelModifier,fscmd.args.parameters));}
if(fscmd.event==FSCOMMAND.CLOSE)
{_this.remove(commandFactory.createByObjectId(senderId,fscmd.args.commandModifier,fscmd.args.panelModifier,fscmd.args.parameters));}
if(fscmd.event==FSCOMMAND.SHOWLAYER)
{_this.trySet(commandFactory.createByObjectId("layer:mainLayer",fscmd.args.commandModifier,fscmd.args.panelModifier,fscmd.args.parameters));}
if(fscmd.event==FSCOMMAND.LOCK||fscmd.event==FSCOMMAND.UNLOCK)
{_this.fireEvent(fscmd.event,false,fscmd.objectId||senderId,parseInt(fscmd.args.days,10));}
_this.fscommandProcedure(fscmd);};var waitBehaviorGroup=function(command,callback){if(polite&&!Event.isPageLoaded()){callback();}
else{command.behaviorGroup.addEvent("ready",callback);}};var set=function(command,waitLoad,callback)
{waitBehaviorGroup(command,function(){var panelGroup=getPanelGroup(command);var id=command.objectId;var format;if(panelGroup){var handler="backupHandler";var panelGroupConfig=buildConfig(command,panelGroup);if(std.canShowRichMedia()){if(polite&&!Event.isPageLoaded()){handler="politeHandler";}
else{handler="mainHandler";}}
format=_this[handler](command.behaviorGroup,panelGroup,panelGroupConfig);if(handler=="mainHandler"){formatBinding.addFormat(format);}
if(format&&format.init){_formats.add(id,format,waitLoad);panelGroupConfig.position.addEvent("nodeReady",function(){format.init();});panelGroupConfig.position.init();format.addEvent("formatRemoved",function(){panelGroupConfig.position.fireEvent("positionEmpty",true);});format.addEvent("fscommand",function(fscmd){executeFSCommand(fscmd,id);});}
else{_m.err(20041,command.behaviorGroup.name,handler);format=EmptyFormat;}}
else{format=EmptyFormat;}
if(Lang.isFunction(callback)){callback(format);}});};var _log={0:20000,1:20010,2:20020};var log=function(n,c){_m.mes(_log[n],c.behaviorGroup.name);};this.set=function(command,callback)
{log(0,command);set(command,false,callback);};this.trySet=function(command,callback)
{waitBehaviorGroup(command,function(){log(1,command);if(_formats.contains(command.objectId)){_m.mes(20050,command.objectId);if(Lang.isFunction(callback)){callback(EmptyFormat);}}
else{set(command,false,callback);}});};this.reset=function(command,callback)
{waitBehaviorGroup(command,function(){log(2,command);set(command,true,callback);});};this.remove=function(command)
{var format=_formats.get(command.objectId);if(format){format.remove();}};this.get=function(id){return _formats.get(id.objectId?id.objectId:id);};this.clear=function(){_formats.clear();var positions=positionManager.getPositions();foreach(positions,function(name,position){if(position){position.destruct();position.clear();delete positions[name];}});};this.fscommandProcedure=this.mainHandler=this.politeHandler=this.backupHandler=new Empty();};CommandRunner.Collection=[];var ModuleState={Required:"required",Loading:"loading",Loaded:"loaded"};var ModuleManager=new function(){var _this=this;var _event=new EventManager(this);var _m=new Log('ModuleManager');var _modules={};var _essential={};var _afterLoadRequest=false;var _scriptContainer=null;var _appendToParentNode=false;var modulesPending=function(modules){var result=false;foreach(modules,function(m){if(modules[m]!=ModuleState.Loaded)
result=true;});return result;};var loadModules=function(modules){var config=AdmotionMod.getConfig(instanceId);foreach(modules,function(mod){if(modules[mod]==ModuleState.Required){if(config.ext[mod]){modules[mod]=ModuleState.Loading;AdmotionMod.loadModule(instanceId,mod,{dynamic:true,node:_scriptContainer,appendToParentNode:_appendToParentNode});}
else{_m.err(13030,mod);}}});};this.setScriptContainer=function(node){_scriptContainer=node;};this.setAppendToParentNode=function(appendToParentNode){_appendToParentNode=appendToParentNode;};this.require=function(id){if(id&&!_modules[id]){_modules[id]=ModuleState.Required;if(_afterLoadRequest)
loadModules(_modules);}};this.modulesPending=function(){return modulesPending(_modules)||modulesPending(_essential);};this.isLoaded=function(moduleName){return _modules[moduleName]==ModuleState.Loaded||_essential[moduleName]==ModuleState.Loaded;};this.loadModules=function(){loadModules(_modules);_afterLoadRequest=true;};this.loadEssentialModules=function(modules){return loadModules(_essential=modules);};this.waitEssentialModules=function(callback){if(modulesPending(_essential))
_event.add("essentialModulesLoaded",callback);else
callback();};AdmotionMod.onModuleLoad(instanceId,function(name){if(name in _modules)
_modules[name]=ModuleState.Loaded;if(name in _essential)
_essential[name]=ModuleState.Loaded;_event.fire(name);if(!modulesPending(_essential)&&name in _essential)
_event.fire("essentialModulesLoaded");});_modules[Module.Core]=ModuleState.Loaded;};var Platform=function(){External.apply(this,[External.Platform,arguments,false]);this.WLHotmail=function(){this.getAPIFromWindow=function(win){return win["$WLXRmAd"]||(WindowContext.getWindowAccess(win.parent)&&win.parent["$WLXRmAd"]);};this.isWLHotmailPlatform=function(win){return!!Platform.WLHotmail.getAPIFromWindow(win?win:window);};};this.WLHotmail=new this.WLHotmail();this.Mobile=new function(){this.isAndroid=function(){var userAgent=navigator.userAgent.toLowerCase();return userAgent.indexOf("android")!=-1;};this.isIOS=function(){var userAgent=navigator.userAgent.toLowerCase();return userAgent.indexOf("ipod")!=-1||userAgent.indexOf("iphone")!=-1;};this.isMobile=function(){var userAgent=navigator.userAgent.toLowerCase();return userAgent.indexOf("ipod")!=-1||userAgent.indexOf("iphone")!=-1||userAgent.indexOf("android")!=-1;};};this.FreeBounding=function(){(new EventManager(this)).fire("ready",true);this.init=this.expand=this.collapse=this.resize=Empty;};this.isSafeFrame=function(win){return!!(win?win:window)["$sf"];};this.createDefaultBounding=function(win){var bounding;if(Platform.WLHotmail.isWLHotmailPlatform(win)){bounding=new External(External.WLBounding,[win?win:window],true);}
else if(Platform.isSafeFrame(win)){bounding=new External(External.SafeFrameBounding,[win?win:window],true);}
else{bounding=new Platform.FreeBounding();}
return bounding;};this.GeneratedPositionNodeBuilder=function(selector,nodeRelationship){var _this=this;var _onNodeBuilt;var _convertedSelector;var _elemInterval;var _node;var _canUseNativeStrategy;var _nodeRelationship=nodeRelationship;var createDiv=function(targetNode){var node=targetNode.ownerDocument.createElement('div');node.style.display='inline-block';node.id="adm_generated"+random(5);return node;};var createNode=function(targetNode){if(targetNode){Period.clearInterval(_elemInterval);if(Lang.isString(_nodeRelationship)){switch(_nodeRelationship){case"currentNode":_node=targetNode;_node.style.display='inline-block';break;case"sibling":_node=createDiv(targetNode);targetNode.parentNode.insertBefore(_node,targetNode);break;case"firstChild":_node=createDiv(targetNode);if(targetNode.firstChild){targetNode.insertBefore(_node,targetNode.firstChild);}
else{targetNode.appendChild(_node);}
break;case"lastChild":_node=createDiv(targetNode);targetNode.appendChild(_node);break;default:_node=createDiv(targetNode);targetNode.parentNode.insertBefore(_node,targetNode);}}
else{_node=createDiv(targetNode);targetNode.parentNode.insertBefore(_node,targetNode);}
_onNodeBuilt(_node,targetNode);}};var findTargetNode=function(siblingFoundCallback){_elemInterval=Period.setInterval(function(){var targetNode=null;for(var i=0;i<_convertedSelector.length&&!targetNode;i++){var qb=new AdmCore.ElementFinder.QueryBuilder();qb.setDocument(WindowContext.getTopAccessWindow().document);if(_convertedSelector[i].attribute)qb.setFilter('attribute',_convertedSelector[i].attribute);if(_convertedSelector[i].style)qb.setFilter('style',_convertedSelector[i].style);if(_convertedSelector[i].exclude)qb.setFilter('exclude',_convertedSelector[i].exclude);qb.setType(_convertedSelector[i].type||["*"]);var defaultQuery=qb.getQuery();map(_convertedSelector[i],defaultQuery,true);targetNode=AdmCore.ElementFinder.Finder.multiSelect(_convertedSelector)[0];}
if(targetNode)
siblingFoundCallback(targetNode);},200);};var nativeFindTargetNode=function(siblingFoundCallback){_elemInterval=Period.setInterval(function(){siblingFoundCallback(WindowContext.getTopAccessWindow().document.getElementById(_convertedSelector[0].id));},200);};this.build=function(onNodeBuilt){_onNodeBuilt=onNodeBuilt;if(Lang.isString(selector)){if(selector.charAt(0)=="{"){_convertedSelector=eval("(["+selector+"])");}
else{if(selector.charAt(0)=="["){_convertedSelector=eval("("+selector+")");}
else{_convertedSelector=[{id:selector}];_canUseNativeStrategy=true;}}}
else{_convertedSelector=selector;}
if(_canUseNativeStrategy){nativeFindTargetNode(createNode);}
else{(new External(External.ElementFinder,[],true)).onExternal(function(){findTargetNode(createNode);});}};this.destruct=function(){if(_node)
_node.parentNode.removeChild(_node);};};};Platform=new Platform();var BehaviorGroup=function(definition,std)
{var _this=this;var _event=new EventManager(this);var _copy=copy(definition);var _conditionEval=new ConditionEvaluator();var _modulesReady=false;var _requiredModules={};map(_copy,_copy.concat);this.name=_copy.name;this.commandModifier=_copy;this.addCondition=_conditionEval.addCondition;var onModulesReady=function(){_modulesReady=true;foreach(_requiredModules,function(name,value){_modulesReady=_modulesReady&&value;});_this.eval();};this.areModulesReady=function(){return _modulesReady;};this.eval=function(){if(_conditionEval.eval()){_event.fire("ready",true);}};_conditionEval.addCondition(Operator.And,function(){return _modulesReady;});if(_copy.module&&_copy.module!=Module.Core&&!(_copy.module==Module.Positioning&&!std.canShowRichMedia()&&!_copy.sequenceBackup))
_requiredModules[_copy.module]=false;if(toJSON(_requiredModules)!="{}"){foreach(_requiredModules,function(name,value){ModuleManager.require(name);ModuleManager.addEvent(name,function(){_requiredModules[name]=true;onModulesReady();});});}
else{onModulesReady();}
delete _copy.name;delete _copy.concat;};var BehaviorGroupList=function(std)
{var _list={};var _linkList={};this.define=function(obj){foreach(obj,function(groupName,definition){if(!definition.skip)
_list[groupName]=_linkList[definition.name]=new BehaviorGroup(definition,std);});map(BehaviorGroupList.DEFINED_GROUPS,_list);return _list;};this.get=function(behaviorGroupName){return _linkList[behaviorGroupName];};this.create=function(behaviorGroupName){return new BehaviorGroup({name:behaviorGroupName},std);};};BehaviorGroupList.DEFINED_GROUPS={};var CommandFactory=function(behaviorGroupList,positionMan,fileManager){var _this=this;var getBehaviorGroup=function(name){return behaviorGroupList.get(name)||behaviorGroupList.create(name);};this.createByBehaviorGroupName=function(behaviorGroupName,panelGroupName,commandModifier,panelModifier,parameters){var panelGroupParams=fileManager.getParametersByBehaviorGroupName(behaviorGroupName,panelGroupName);panelModifier=panelModifier||new EmptyObject();parameters=parameters||{};var cmd={sequenceBackup:false,autoInit:true,skipValidation:false,waitForLoad:false,waitPosition:true,freqCap:false,behaviorGroup:getBehaviorGroup(behaviorGroupName),isPosition:panelGroupParams.positionFormat||positionMan.contains(behaviorGroupName),positionName:positionMan.getPosition(behaviorGroupName).name,panelModifier:panelModifier,panelGroupName:panelGroupName,parameters:{self:parameters.self||{},global:parameters.global||{}},preloadPiece:false,preloadOnPageLoad:false,priority:10};cmd.objectId=CommandFactory.getObjectIdFromCommand(cmd);if(fileManager.templateParams[cmd.objectId]){map(cmd.parameters.self,fileManager.templateParams[cmd.objectId].self);map(cmd.parameters.global,fileManager.templateParams[cmd.objectId].global);}
map(cmd,panelGroupParams,false,true);map(cmd,cmd.behaviorGroup.commandModifier,false,true);if(commandModifier){map(cmd,commandModifier,false,true);}
return cmd;};this.createByBehaviorGroup=function(behaviorGroup,panelGroupName,commandModifier,panelModifier,parameters){return _this.createByBehaviorGroupName(behaviorGroup.name,panelGroupName,commandModifier,panelModifier,parameters);};this.createByObject=function(object){return"behaviorGroupName"in object?_this.createByBehaviorGroupName(object.behaviorGroupName,object.panelGroupName,object.commandModifier,object.panelModifier,object.parameters):_this.createByBehaviorGroup(object.behaviorGroup,object.panelGroupName,object.commandModifier,object.panelModifier,object.parameters);};this.createByObjectId=function(objectId,commandModifier,panelModifier,parameters){var data=CommandFactory.split(objectId);return _this.createByBehaviorGroupName(data.behaviorGroupName,data.panelGroupName,commandModifier,panelModifier,parameters);};this.addParameters=function(behaviorGroup,panelGroupName,params){var objectId=CommandFactory.getObjectId(behaviorGroup,panelGroupName);if(!fileManager.templateParams[objectId]){fileManager.templateParams[objectId]={self:{},global:{}};}
map(fileManager.templateParams[objectId].self,params.self);map(fileManager.templateParams[objectId].global,params.global);};};CommandFactory.separator=":";CommandFactory.getObjectId=function(behaviorGroup,panelGroupName){return(Lang.isObject(behaviorGroup)?behaviorGroup.name:behaviorGroup)+CommandFactory.separator+panelGroupName;};CommandFactory.split=function(objectId){var split=objectId.split(CommandFactory.separator);return split.length==2?{behaviorGroupName:split[0],panelGroupName:split[1]}:{};};CommandFactory.getObjectIdFromCommand=function(cmd){return CommandFactory.getObjectId(cmd.behaviorGroup,cmd.panelGroupName);};PieceCommand.regexp=new RegExp("^(\\w+)\\[(\\w+)"+CommandFactory.separator+"(\\w+)?\\]");var WindowFormatCleanup=function(){var _watcher;var hasRotated=function(positionNode,referenceNode){return!positionNode.ownerDocument.body.firstChild||referenceNode&&!referenceNode.ownerDocument.getElementById(referenceNode.id);};this.watch=function(positionNode,referenceNode){if(!_watcher){_watcher=new ConditionControl(50);_watcher.addCondition(Operator.And,function(){return false;});_watcher.ifTrue(Event.firePageUnloadEvent);}
return _watcher.addCondition(Operator.Or,function(){return hasRotated(positionNode,referenceNode);});};this.unwatch=function(id){_watcher.removeCondition(id);};};var XWindowFormatCleanup=function(){var _watcher;this.watch=function(positionNode,referenceNode){if(!_watcher){_watcher=new XWindowObject(WindowContext.getTopAccessWindow(),XWindowFormatCleanup.Watcher);CommandRunner.Collection[0].addEvent("formatSet",function(id,format){if(format){format.addEvent("pieceCreated",function(piece){if(piece.getContainerNodeID){_watcher.addNode(piece.getContainerNodeID());}});}});}
_watcher.addNode(positionNode.id);return _watcher.watch(referenceNode.id);};this.unwatch=function(id){_watcher.unwatch(id);};};XWindowFormatCleanup.Watcher=function(){var _interval;var _nodeIDs=[];var _referenceNodes=[];var hasRotated=function(referenceNode){return referenceNode.nodeName=="IFRAME"&&!referenceNode.contentDocument||referenceNode&&!referenceNode.ownerDocument.getElementById(referenceNode.id);};var checkUnload=function(){try{var rotation=false;for(var i=0;i<_referenceNodes.length;i++){rotation=rotation||hasRotated(_referenceNodes[i]);}
if(rotation){for(var j=0;i<_nodeIDs.length;j++){var element=document.getElementById(_nodeIDs[j]);if(element)
element.parentNode.removeChild(element);}
clearInterval(_interval);}}
catch(e){clearInterval(_interval);}};this.addNode=function(nodeID){_nodeIDs.push(nodeID);};this.watch=function(referenceNodeID){var referenceNode=document.getElementById(referenceNodeID);if(referenceNode){_referenceNodes.push(referenceNode);if(!_interval){_interval=setInterval(checkUnload,50);}}
return referenceNodeID;};this.unwatch=function(referenceNodeID){for(var i=0;i<_referenceNodes.length;i++){if(referenceNodeID==_referenceNodes[i].id){_referenceNodes.splice(i,1);}}};};var FormatCleanup=new function(){if(Browser.OP){XWindowFormatCleanup.apply(this,arguments);}
else{WindowFormatCleanup.apply(this,arguments);}
this.watchPositionForFormatCleanup=function(position){position.addEvent("nodeReady",function(){var referenceNode=WindowContext.getFrameElement(window);var positionNode=position.getNode();if(!referenceNode)
referenceNode=positionNode;if(!referenceNode.id)
referenceNode.id="admReference_"+random(8);var watchID=FormatCleanup.watch(positionNode,referenceNode);position.addEvent("beforeDestruct",function(){FormatCleanup.unwatch(watchID);});});};};var FormatManager=function(std,files,polite)
{var _m=new Log('FormatManager');var _this=this;var _fileManager=new CreativeFileManager(files);var _behaviorGroupList=new BehaviorGroupList(std);var _positionMan=new PositionManager(_fileManager,globalSettings.anchorConfig);var _commandFactory=new CommandFactory(_behaviorGroupList,_positionMan,_fileManager);var _formatBinding=new FormatBinding(_fileManager);var _commandRunner=new CommandRunner(std,polite,_fileManager,_positionMan,_commandFactory,_formatBinding);var _commandSequence=new CommandSequence(_commandFactory,_fileManager);var _sequence=[];var _seqNames={};var _waitPageLoad=std.getGlobalParams().waitPageLoad;var _cookie=new Cookie();var ifSequenceContains=function(pos){return pos.name in _seqNames;};var setPosition=function(pos,immediate)
{var cmd=_commandFactory.createByBehaviorGroupName(pos.name,"_default");if(!immediate){pos.disableDocWrite();}
var politePhase=polite&&!Event.isPageLoaded();if((cmd.autoInit||politePhase)&&(!_waitPageLoad||Event.isPageLoaded())&&!getIsLocked(cmd.objectId)){if(!ifSequenceContains(pos)){if(!cmd.behaviorGroup.areModulesReady()&&!politePhase){pos.disableDocWrite();cmd.behaviorGroup.addEvent("ready",function(){_commandRunner.reset(cmd);});}
else{_commandRunner.reset(cmd);}}
else if((!std.canShowRichMedia()&&!cmd.sequenceBackup)||politePhase){_commandRunner.reset(cmd);}}};var positionInitializer=function(immediate)
{_positionMan.setDetectedPositions();foreach(_positionMan.getPositions(),function(name,pos){setPosition(pos,immediate);});};var setFreqCap=function(id,params)
{if(params.enableCookieCount)
FrequencyCap.FlashInstance=new FrequencyCap('AdmFlash'+(params.freqCapId||id),params.freqCapSession||false,0,null,params.freqCapExpiration||24,params.freqCapExpiration||24,params.cookieDomain);if(params.enableFreqCap)
FrequencyCap.Instance=new FrequencyCap('AdmFormat'+(params.freqCapId||id),params.freqCapSession||false,params.freqCapMinPeriod||0,params.freqCapMaxCount||1,params.freqCapExpiration||24,720,params.cookieDomain);};var runCmd=function(method,behaviorGroup,panelGroupName,commandModifier,panelModifier)
{_commandRunner[method](_commandFactory.createByBehaviorGroup(behaviorGroup,panelGroupName,commandModifier,panelModifier));};var getFormat=this.getFormat=function(behaviorGroup,panelGroupName)
{return _commandRunner.get(CommandFactory.getObjectId(behaviorGroup,panelGroupName));};var init=function()
{var sequence=new External(External.Sequence,[std,_fileManager,_commandRunner,_positionMan],false);sequence.onExternal(function(){for(var i=0;_sequence[i];)
getIsLocked(_sequence[i].objectId)?_sequence.splice(i,1):i++;ModuleManager.waitEssentialModules(function(){sequence.start(_sequence);});});_positionMan.addEvent('delayedDetectedPositionSet',function(pos){setPosition(pos,true);});Event.onPageUnload(_commandRunner.clear);};var lock=this.lock=function(objectId,days)
{var date=new Date();date.setDate(date.getDate()+(isNaN(days)?1:days));_cookie.setCookie(FSCOMMAND.LOCK+objectId,'true',date,std.getGlobalParams().cookieDomain);};var unlock=this.unlock=function(objectId,data)
{var date=new Date();date.setDate(date.getDate()-1);_cookie.setCookie(FSCOMMAND.LOCK+objectId,'false',date,std.getGlobalParams().cookieDomain);};var getIsLocked=this.getIsLocked=function(objectId)
{return _cookie.getCookie(FSCOMMAND.LOCK+objectId)=='true';};_commandRunner.fscommandProcedure=function(fscommand){_this.fscommandProcedure(fscommand);};_commandRunner.mainHandler=function(){return _this.mainHandler.apply(_this,arguments);};_commandRunner.politeHandler=function(){return _this.politeHandler.apply(_this,arguments);};_commandRunner.backupHandler=function(){return _this.backupHandler.apply(_this,arguments);};_commandRunner.addEvent(FSCOMMAND.LOCK,lock);_commandRunner.addEvent(FSCOMMAND.UNLOCK,unlock);var loadStylesAndModules=function(){var css=std.getGlobalParams().css;var doc=WindowContext.getTopAccessWindow().document;if(css){var urls=css.split(',');for(var i=0;i<urls.length;i++){AdmotionMod.loadCSS(urls[i],doc);}}
ModuleManager.loadModules();};this.start=function(){_formatBinding.init();_formatBinding.setExecuteCommand(function(method,object,callback){return _commandRunner[method](_commandFactory.createByObject(object),callback);});setFreqCap(std.getUniqueId(),std.getGlobalParams());ModuleManager.setAppendToParentNode(std.getGlobalParams().appendToParentNode);ModuleManager.loadEssentialModules(std.getEssentialModules());if(!_waitPageLoad){ModuleManager.waitEssentialModules(function(){if(!polite||!Event.isPageLoaded()){positionInitializer(true);}});}
if(polite||_waitPageLoad){Event.onPageLoad(function(){loadStylesAndModules();ModuleManager.waitEssentialModules(function(){positionInitializer();});});}
else{loadStylesAndModules();}
if(window!=WindowContext.getParent(window)&&(polite||!ModuleManager.modulesPending()))
{_m.mes(13020);document.close();}};this.fireEventFor=function(behaviorGroup,panelGroupName,event,consume,param){var format=getFormat(behaviorGroup,panelGroupName);if(format)
format.getPiece().fireEvent(event,consume,param);else
_m.war(13000,event,behaviorGroup,panelGroupName);};this.setCommandExecution=function(commands){_sequence=[].concat(commands||_this.getSequence());for(var i=0;i<_sequence.length;i++){_seqNames[_sequence[i].behaviorGroup.name]=1;}};this.fscommandProcedure=new Empty();this.mainHandler=this.defaultMainHandler=function(behaviorGroup,panelGroup,panelGroupConfig){return new Banner(panelGroupConfig);};this.politeHandler=this.defaultPoliteHandler=function(behaviorGroup,panelGroup,panelGroupConfig){return new Polite(panelGroupConfig);};this.backupHandler=this.defaultBackupHandler=function(behaviorGroup,panelGroup,panelGroupConfig){return new Backup(panelGroupConfig);};this.set=function(behaviorGroup,panelGroupName,commandModifier,panelModifier){runCmd('set',behaviorGroup,panelGroupName,commandModifier,panelModifier);};this.trySet=function(behaviorGroup,panelGroupName,commandModifier,panelModifier){runCmd('trySet',behaviorGroup,panelGroupName,commandModifier,panelModifier);};this.reset=function(behaviorGroup,panelGroupName,commandModifier,panelModifier){runCmd('reset',behaviorGroup,panelGroupName,commandModifier,panelModifier);};this.remove=function(behaviorGroup,panelGroupName,commandModifier,panelModifier){runCmd('remove',behaviorGroup,panelGroupName,commandModifier,panelModifier);};this.defineBehaviorGroup=_behaviorGroupList.define;this.defineCommand=function(obj){var commands={};foreach(obj,function(cmdName,definition){commands[cmdName]=_commandFactory.createByObject(definition);});return commands;};this.setDefaultPosition=_positionMan.setDefaultPosition;this.setGeneratedPosition=_positionMan.setGeneratedPosition;this.setZombieGeneratedPosition=_positionMan.setZombieGeneratedPosition;this.setWLHeaderPosition=_positionMan.setWLHeaderPosition;this.addPosition=_positionMan.addPosition;this.addParameters=_commandFactory.addParameters;this.createCommand=_commandFactory.createByObject;this.getParametersByBehaviorGroupName=_fileManager.getParametersByBehaviorGroupName;this.getSequence=_commandSequence.getSequence;init();};var CreativeFileManager=function(files){var _this=this;var getPanel=function(behaviorGroupName,panelGroupName,panelGroupListName){panelGroupListName=panelGroupListName||"main";var panelGroup=_this.getPanelGroup(behaviorGroupName,panelGroupName);var panelSelector=new PanelSelector(panelGroup);return panelSelector.getCurrentPanel(panelGroupListName);};this.templateParams={};this.getCurrentUrl=function(behaviorGroupName,panelGroupName,panelGroupListName){return getPanel(behaviorGroupName,panelGroupName,panelGroupListName).url;};this.getCurrentArea=function(behaviorGroupName,panelGroupName,panelGroupListName){var panel=getPanel(behaviorGroupName,panelGroupName,panelGroupListName);return{width:panel.width,height:panel.height,left:panel.left,top:panel.top};};this.getPanelGroup=function(behaviorGroupName,panelGroupName){var panelGroup=new EmptyObject();try{if(!panelGroupName){var panelGroupId=CommandFactory.split(behaviorGroupName);behaviorGroupName=panelGroupId.behaviorGroupName;panelGroupName=panelGroupId.panelGroupName;}
panelGroup=copy(files[behaviorGroupName][panelGroupName]);}
catch(_){}
return panelGroup;};this.getParametersByBehaviorGroupName=function(behaviorGroupName,panelGroupName){var parameters={};map(parameters,_this.getPanelGroup(behaviorGroupName,panelGroupName).parameters);if(!_this.templateParams[CommandFactory.getObjectId(behaviorGroupName,panelGroupName)])
_this.templateParams[CommandFactory.getObjectId(behaviorGroupName,panelGroupName)]={self:{},global:{}};map(parameters,_this.templateParams[CommandFactory.getObjectId(behaviorGroupName,panelGroupName)].self);return parameters;};this.getFiles=function(){return copy(files);};this.eachPanelGroup=function(callback){if(Lang.isFunction(callback)){foreach(files,function(behaviorGroupName,behaviorGroup){foreach(behaviorGroup,function(panelGroupName,panelGroup){callback(behaviorGroupName,panelGroupName,_this.getParametersByBehaviorGroupName(behaviorGroupName,panelGroupName));});});}};};var CommandSequence=function(commandFactory,fileManager){var _this=this;var _initSequence=[];var _preloadSequence=[];var _initialized=false;var orderByPriorityAndPosition=function(firstCommand,secondCommand){var priorityDiff=firstCommand.priority-secondCommand.priority;return priorityDiff||(firstCommand.isPosition?-1:1);};this.refreshSequence=function(){fileManager.eachPanelGroup(function(behaviorGroupName,panelGroupName,params){var command=commandFactory.createByObject({behaviorGroupName:behaviorGroupName,panelGroupName:panelGroupName});if(command.autoInit){_initSequence.push(command);}
else if(command.preloadPiece||command.preloadOnPageLoad){_preloadSequence.push(command);}});_initSequence.sort(orderByPriorityAndPosition);_preloadSequence.sort(orderByPriorityAndPosition);while(_initSequence[0]&&_initSequence[0].isPosition){_initSequence.shift();}
_initialized=true;};this.getSequence=function(){if(!_initialized){_this.refreshSequence();}
return _initSequence.concat(_preloadSequence);};};var publish=function(obj,attributes){foreach(attributes,function(publicName,attribute){try{obj[publicName]=attribute;}
catch(e){Log.err(600,publicName,e);}});};var overwrite=function(className,classDefinition){Log.war(500);eval(className+" = classDefinition;");};var Standard=AdmCore.Standard;var PanelSelector=AdmCore.PanelSelector;var Position=AdmCore.Position;publish(AdmCore,{"publish":publish,"overwrite":overwrite,"PieceCommand":PieceCommand,"FSCOMMAND":FSCOMMAND,"ValueType":ValueType,"Lang":Lang,"foreach":foreach,"argumentsToArray":argumentsToArray,"delegate":delegate,"random":random,"define":define,"map":map,"copy":copy,"removeArrayItem":removeArrayItem,"convertToArray":convertToArray,"capitalizeString":capitalizeString,"trimString":trimString,"parsePx":parsePx,"EventManager":EventManager,"Timer":Timer,"Log":Log,"Browser":Browser,"WindowContext":WindowContext,"Event":Event,"Cookie":Cookie,"FrequencyCap":FrequencyCap,"Element":Element,"FlashPiece":FlashPiece,"Empty":Empty,"EmptyObject":EmptyObject,"RotationType":RotationType,"RotationCriteria":RotationCriteria,"PanelSelector":PanelSelector,"PanelGroupConfig":PanelGroupConfig,"Format":Format,"EmptyFormat":EmptyFormat,"ImagePiece":ImagePiece,"Banner":Banner,"Polite":Polite,"Backup":Backup,"FloatingBanner":FloatingBanner,"FormatBinding":FormatBinding,"Panel":Panel,"Position":Position,"PositionManager":PositionManager,"FormatCollection":FormatCollection,"CommandRunner":CommandRunner,"Module":Module,"BehaviorGroupList":BehaviorGroupList,"CommandFactory":CommandFactory,"FormatManager":FormatManager,"CreativeFileManager":CreativeFileManager,"CommandSequence":CommandSequence,"PositionLayout":PositionLayout,"CreativeCollection":CreativeCollection,"ModuleManager":ModuleManager,"TagManager":TagManager,"Period":Period,"PieceType":PieceType,"Piece":Piece,"globalSettings":globalSettings,"SiteCompliant":SiteCompliant,"ConditionControl":ConditionControl,"TimePreset":TimePreset,"ConditionEvaluator":ConditionEvaluator,"Operator":Operator,"numberCmp":numberCmp,"Platform":Platform,"Standard":Standard,"EventType":EventType,"EventTracker":EventTracker,"safeAccess":safeAccess,"Utility":Utility,"Reporter":Reporter,"fromJSON":fromJSON,"toJSON":toJSON,"HTMLPiece":HTMLPiece,"PrimitiveAd":PrimitiveAd});var settingsFromTag=function(config){if(Lang.isFunction(window.ADMotionTAGConfig)){ADMotionTAGConfig(config);window.ADMotionTAGConfig=null;}
var fileProps=['Width','Height','Left','Top'],value;foreach(config.creativeFiles,function(behaviorGroupName,behaviorGroup){for(var i=0;i<fileProps.length;i++){if(value=window["ADMSet"+capitalizeString(behaviorGroupName)+fileProps[i]]){objectGetFirst(behaviorGroup).main[0][fileProps[i].toLowerCase()]=value;}}});};this.Start=function(){var config=AdmotionMod.getConfig(instanceId);settingsFromTag(config);var __debugCookie=new Cookie();if(__debugCookie.getCookie("flashmode")=="disable"){Standard.getFlashVersion=function(){return 0;};}
if(__debugCookie.getCookie("pageloadevent")=="disable"){Event.disablePageLoadEvent();}
if(AdmCore.Main){var std=new Standard(config);if(std.getGlobalParams().disableLoadingPageTimeout){Event.disableLoadingPageTimeout();}
if(__debugCookie.getCookie("probability")=="disable"){Utility.probability=function(){return true;};}
AdmCore.Main(std,std.getGlobalParams());Event.onPageUnload(Period.dispose);AdmCore.Event.fireCoreFinishedEvent();}};AdmCore.Main=null;if(Lang.isFunction(window.admCoreReady)){Period.setTimeout(admCoreReady,0);}});new function(){var config=AdmotionMod.getConfig(null);if(!config.disabled){var core=AdmotionMod.getCore();var moduleConfig={};var scripts=document.getElementsByTagName('script');if(scripts[scripts.length-1].src==config.jsCore&&core.Browser.IE&&core.Browser.version>7){core.referenceNode=scripts[scripts.length-1];moduleConfig={dynamic:true,appendToParentNode:(config.parameters||{}).appendToParentNode,node:core.referenceNode.parentNode};}
AdmotionMod.loadJS(config.jsCreative,moduleConfig);}};