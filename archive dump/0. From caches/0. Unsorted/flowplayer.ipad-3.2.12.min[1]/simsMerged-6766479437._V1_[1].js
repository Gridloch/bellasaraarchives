/* begin callOnVisible/callOnVisible.js */
(function(window,P,amznJQ){var init=function($){if(typeof $.fn.callOnVisible!="undefined"){return;
}var defaultCallDistance=250;
var win=null;
var features=[];
var callOnScrollIfNeeded=null;
$.fn.callOnVisible=function(callback,distance){distance=typeof distance=="undefined"?defaultCallDistance:distance;
if(win===null){win=$(window);
}this.each(function(){features.push({element:$(this),callback:callback,distance:distance});
if(callOnScrollIfNeeded===null){var lastCheck=0;
var callCheckPending=false;
callOnScrollIfNeeded=function(){if(callCheckPending){return;
}var lastCheckDiff=new Date().getTime()-lastCheck;
var checkDelay=(lastCheckDiff<200?200-lastCheckDiff:10);
callCheckPending=true;
var callIfNeeded=function(){var windowOffset=win.scrollTop()+win.height();
for(var i=features.length-1;
i>=0;
i--){if(features[i].element.parents("body").size()===0){features.splice(i,1);
}else{if(windowOffset+features[i].distance>features[i].element.offset().top){features[i].callback.call(features[i].element[0]);
features.splice(i,1);
}}}if(features.length===0){win.unbind("scroll",callOnScrollIfNeeded);
callOnScrollIfNeeded=null;
}callCheckPending=false;
lastCheck=new Date().getTime();
};
setTimeout(callIfNeeded,checkDelay);
};
win.bind("scroll",callOnScrollIfNeeded);
}});
if(callOnScrollIfNeeded!==null){callOnScrollIfNeeded();
}return this;
};
};
if(window.callOnVisibleLoaded){return;
}else{window.callOnVisibleLoaded=true;
}if(typeof P==="object"&&typeof P.when==="function"){P.when("jQuery").register("call-on-visible",function(jQuery){init(jQuery);
return{};
});
}if(typeof amznJQ==="object"){amznJQ.available("jQuery",function(){init(amznJQ.jQuery);
amznJQ.declareAvailable("callOnVisible");
});
}}(window,window.P,window.amznJQ));

/* end callOnVisible/callOnVisible.js */

/* begin simsJS/simsTrackPreview.js */
(function(window,document,P,amznJQ){function initSimsTrackPreview($){var simsTrackPreviewUIMethods={play:function(){return this.each(function(){$(this).removeClass("mp3AsinPaused mp3AsinLoading").addClass("mp3AsinPause").find(".mp3AsinText").text(window.SimsTrackPreviewMp3Interface.strings.playing).end().find(".mp3AsinPlayImg > span").text(window.SimsTrackPreviewMp3Interface.strings.pause);
});
},stop:function(){return this.each(function(){$(this).removeClass("mp3AsinLoading mp3AsinPause mp3AsinPaused").find(".mp3AsinText").text(window.SimsTrackPreviewMp3Interface.strings.sample).end().find(".mp3AsinPlayImg > span").text(window.SimsTrackPreviewMp3Interface.strings.play);
});
},loading:function(){return this.each(function(){$(this).removeClass("mp3AsinPaused mp3AsinPause").addClass("mp3AsinLoading").find(".mp3AsinText").text(window.SimsTrackPreviewMp3Interface.strings.loading).end().find(".mp3AsinPlayImg > span").text(window.SimsTrackPreviewMp3Interface.strings.pause);
});
},pause:function(){return this.each(function(){$(this).removeClass("mp3AsinLoading mp3AsinPause").addClass("mp3AsinPaused").find(".mp3AsinText").text(window.SimsTrackPreviewMp3Interface.strings.paused).end().find(".mp3AsinPlayImg > span").text(window.SimsTrackPreviewMp3Interface.strings.play);
});
}};
$.fn.simsTrackPreviewUI=function(method){if(method in simsTrackPreviewUIMethods){return simsTrackPreviewUIMethods[method].apply(this,Array.prototype.slice.call(arguments,1));
}else{$.error("Method "+method+" does not exist on jQuery.simsTrackPreviewUI");
}};
if(!window.SimsTrackPreviewMp3Interface){var MIN_FLASH_VERSION="9.0.0";
var simsShovelers=["purchaseShvl","trackpurchaseShvl","fallbacksessionShvl"];
var maxTries=20;
var tries=0;
window.SimsTrackPreviewMp3Interface={currentPlayingAsin:undefined,currentShovelerId:undefined,unprocessedUIStates:{},strings:{},ready:false,initShovelersAfterAvailable:function(){if(window.SimsTrackPreviewMp3Interface.ready){return;
}var initializedShovelerCount=0;
for(var i=0;
i<simsShovelers.length;
i++){var success=window.SimsTrackPreviewMp3Interface.initShoveler(simsShovelers[i]);
if(success){initializedShovelerCount=initializedShovelerCount+1;
}}if(initializedShovelerCount>0){var stringsDiv=$(".simsMp3StringsData:first");
window.SimsTrackPreviewMp3Interface.strings.sample=stringsDiv.attr("data-sample");
window.SimsTrackPreviewMp3Interface.strings.paused=stringsDiv.attr("data-paused");
window.SimsTrackPreviewMp3Interface.strings.loading=stringsDiv.attr("data-loading");
window.SimsTrackPreviewMp3Interface.strings.playing=stringsDiv.attr("data-playing");
window.SimsTrackPreviewMp3Interface.strings.play=stringsDiv.attr("data-play");
window.SimsTrackPreviewMp3Interface.strings.pause=stringsDiv.attr("data-pause");
window.SimsTrackPreviewMp3Interface.ready=true;
}else{setTimeout(function(){if(tries<maxTries){window.SimsTrackPreviewMp3Interface.initShovelersAfterAvailable();
tries=tries+1;
}},500);
}},init:function(){if("ontouchstart" in window||(jQuery.browser.msie&&jQuery.browser.version<7)){return;
}if(!swfobject||!swfobject.hasFlashPlayerVersion(MIN_FLASH_VERSION)){return;
}window.SimsTrackPreviewMp3Interface.initShovelersAfterAvailable();
},initShoveler:function(shovelerId){var shovelerElement=$("#"+shovelerId);
var wrapper=shovelerElement.parents(".simsWrapper");
if(wrapper.length>0){if(!wrapper.attr("data-mp3-bound")){wrapper.attr("data-mp3-bound",true);
wrapper.addClass("simsMp3Enabled");
this.attachBehaviorsAndUpdateUI(shovelerElement);
return true;
}}else{return false;
}},attachBehaviorsAndUpdateUI:function(shovelerElement){var thisPlayer=this;
shovelerElement.find("li").each(function(){var cell=jQuery(this);
if(!cell.attr("data-mp3-bound")){cell.attr("data-mp3-bound",true);
thisPlayer.clickActionHandler(cell);
}});
shovelerElement.find(".simsMp3AsinContainer").each(function(){var cellId=$(this).attr("id");
if(thisPlayer.unprocessedUIStates[cellId]){$(this).simsTrackPreviewUI(thisPlayer.unprocessedUIStates[cellId]);
delete thisPlayer.unprocessedUIStates[cellId];
}});
},callback:function(event){if(event=="onPlayerInit"){SimsTrackPreviewMp3Interface.init();
return;
}var currentPlayingAsinElement=$("#"+this.currentShovelerId+" .simsMp3AsinContainer[data-asin="+this.currentPlayingAsin+"]");
var processCallback=(currentPlayingAsinElement.length>0);
var mp3ContainerId=this.currentShovelerId+"_"+this.currentPlayingAsin+"_mp3";
switch(event){case"onComplete":if(processCallback){currentPlayingAsinElement.simsTrackPreviewUI("stop");
}else{this.unprocessedUIStates[mp3ContainerId]="stop";
}this.currentPlayingAsin=undefined;
this.currentShovelerId=undefined;
break;
case"onLoad":if(processCallback){currentPlayingAsinElement.simsTrackPreviewUI("loading");
}else{this.unprocessedUIStates[mp3ContainerId]="loading";
}break;
case"onPlay":if(processCallback){currentPlayingAsinElement.simsTrackPreviewUI("play");
}else{this.unprocessedUIStates[mp3ContainerId]="play";
}break;
case"onPause":if(processCallback){currentPlayingAsinElement.simsTrackPreviewUI("pause");
}else{this.unprocessedUIStates[mp3ContainerId]="pause";
}break;
case"onStop":this.reset();
break;
case"onIOError":this.reset();
break;
case"onInvalidUrl":this.reset();
break;
default:this.reset();
break;
}},clickActionHandler:function(element){var thisPlayer=this;
element.bind("click",function(event){var playButton=$(event.target);
if(playButton.hasClass("simsMp3AsinContainer")||playButton.hasClass("mp3AsinPlayImg")||playButton.hasClass("mp3AsinText")){event.preventDefault();
if(playButton.hasClass("mp3AsinPlayImg")||playButton.hasClass("mp3AsinText")){playButton=playButton.parent();
}var asin=playButton.attr("data-asin");
var shovelerId=playButton.parents(".shoveler").attr("id");
if(typeof thisPlayer.currentPlayingAsin==="undefined"){thisPlayer.currentShovelerId=shovelerId;
thisPlayer.currentPlayingAsin=asin;
Mp3Interface.playSong(playButton.attr("data-playbackurl"),thisPlayer);
}else{if(thisPlayer.currentPlayingAsin==asin&&thisPlayer.currentShovelerId==shovelerId){Mp3Interface.pauseSong(thisPlayer);
}else{var currentPlayingAsinElement=$("#"+thisPlayer.currentShovelerId+" .simsMp3AsinContainer[data-asin="+thisPlayer.currentPlayingAsin+"]");
if(currentPlayingAsinElement.length>0){currentPlayingAsinElement.simsTrackPreviewUI("stop");
}else{var mp3ContainerId=thisPlayer.currentShovelerId+"_"+thisPlayer.currentPlayingAsin+"_mp3";
thisPlayer.unprocessedUIStates[mp3ContainerId]="stop";
}thisPlayer.currentShovelerId=shovelerId;
thisPlayer.currentPlayingAsin=asin;
Mp3Interface.playSong(playButton.attr("data-playbackurl"),thisPlayer);
var newCurrentPlayingAsinElement=$("#"+thisPlayer.currentShovelerId+" .simsMp3AsinContainer[data-asin="+thisPlayer.currentPlayingAsin+"]");
newCurrentPlayingAsinElement.simsTrackPreviewUI("loading");
}}}});
},reset:function(){for(var i=0;
i<simsShovelers.length;
i++){this.resetShoveler(simsShovelers[i]);
}this.currentShovelerId=undefined;
this.currentPlayingAsin=undefined;
},resetShoveler:function(shovelerId){var found=$("#"+shovelerId).parents(".simsWrapper").find(".simsMp3AsinContainer");
found.each(function(e){$(this).removeClass("mp3AsinLoading mp3AsinPause mp3AsinPaused").find(".mp3AsinText").text(window.SimsTrackPreviewMp3Interface.strings.sample);
});
},setVolume:function(volumeLevel){},toggleMute:function(){}};
amznJQ.declareAvailable("simsTrackPreviewControllerReady");
}}if(typeof amznJQ==="object"){amznJQ.available("jQuery",function(){initSimsTrackPreview(amznJQ.jQuery);
});
}})(window,document,window.P,window.amznJQ);
(function(window,document,P,amznJQ){var initSimsJs=function initSimsJs($){window.sims_initShovelerFeature=function(feature){var dataEl=$("#"+feature+"SimsData");
var widgetName=dataEl.attr("data-widgetName");
var shoveler=null;
var onShovelerInitialized=function(){};
var metricsUpdateUIHandler=function(){};
var initFunc=function(){widgetName=dataEl.attr("data-widgetName");
var asinList=dataEl.text().split(",");
var pageId=dataEl.attr("data-pageId");
var reftag=dataEl.attr("data-reftag");
var statekey=pageId+widgetName+"pageValue";
var wdg=dataEl.attr("data-wdg");
var showPopunders=dataEl.attr("data-popunder");
var serverAUI=dataEl.attr("data-isAUI");
var deviceType=dataEl.attr("data-deviceType");
var shovelerElement=$("#"+widgetName+"Shvl");
var showMp3Samples=dataEl.attr("data-showMp3Samples");
var showHMD=dataEl.attr("data-showHMD");
var showSwatchColors=dataEl.attr("data-showSwatches");
var onUpdateUI;
var attachMp3Hovers;
var attachPopunderHovers;
var swatchRefreshID=undefined;
if(showHMD){amznJQ.available("simsHMD",function(){window.simsHMD.enableLink();
});
}if(showMp3Samples){var maxPlayerRegistrationTries=20;
var playerRegistrationTries=0;
function registerPlayerAfterAvailable(){if(window.SimsTrackPreviewMp3Interface.playerRegistered){return;
}if(window.Mp3Interface){Mp3Interface.registerPlayer(window.SimsTrackPreviewMp3Interface);
window.SimsTrackPreviewMp3Interface.playerRegistered=true;
}else{setTimeout(function(){if(playerRegistrationTries<maxPlayerRegistrationTries){registerPlayerAfterAvailable();
playerRegistrationTries=playerRegistrationTries+1;
}},500);
}}amznJQ.onReady("simsTrackPreviewControllerReady",function(){registerPlayerAfterAvailable();
});
attachMp3Hovers=function(){amznJQ.onReady("simsTrackPreviewControllerReady",function(){if(window.SimsTrackPreviewMp3Interface.ready){window.SimsTrackPreviewMp3Interface.attachBehaviorsAndUpdateUI(shovelerElement);
}});
};
}var fetchATCData=false;
var atcData=null;
if("ontouchstart" in window||($.browser.msie&&$.browser.version<7)){showPopunders=false;
}else{if(showPopunders){var pendingShowFunction=null;
fetchATCData=true;
function loadATCData(){if(fetchATCData){fetchATCData=false;
var asins=asinList.slice(0,6).join(",");
$.ajax({url:"/gp/product/features/similarities/shoveler/atc-render.html/?ref="+reftag+"&id="+asins,dataType:"json",success:function(data){atcData=data;
if(typeof pendingShowFunction==="function"){pendingShowFunction();
pendingShowFunction=null;
}}});
}shovelerElement.unbind("mouseenter",loadATCData);
}shovelerElement.bind("mouseenter",loadATCData);
var wrapper=shovelerElement.parents(".simsWrapper");
attachPopunderHovers=function(){wrapper.children(".sims-popunder:visible").hide();
shovelerElement.find("li").each(function(){var cell=$(this);
if(!cell.attr("data-hover-bound")){cell.attr("data-hover-bound",true);
cell.bind("mouseenter",function(){var elem=$(this).find(".new-faceout");
if(elem.size()==0){return;
}var simId=elem[0].id;
var popunder=$("#popunder_"+simId,wrapper);
function popIn(){var offset=elem.offset();
var previouslyVisible=wrapper.children(".sims-popunder:visible").not(popunder);
popunder.css({top:offset.top,left:offset.left-22}).fadeIn(150,function(){previouslyVisible.hide();
});
}function createPopunder(){popunder=$('<div id="popunder_'+simId+'" class="sims-popunder" style="display:none"></div>').append(elem.clone().attr("id",""));
popunder.find(".hmd-per-asin").remove();
popunder.appendTo(wrapper);
var atcExists=elem.find(".sims-atc");
if(atcExists.size()===0){var asin=elem[0].id.substr(elem[0].id.length-10,10);
if(atcData&&atcData[asin]){popunder.find(".new-faceout").append(atcData[asin]);
show=true;
}}popunder.bind("mouseleave",function(){popunder.fadeOut(150);
});
popIn();
}if(popunder.size()){if(!popunder.is(":visible")){popIn();
}}else{var atcExists=elem.find(".sims-atc");
if(atcExists.size()>0||atcData){createPopunder();
}else{pendingShowFunction=createPopunder;
}}});
}});
};
}}var onUpdateUI=function(){if(typeof attachPopunderHovers!=="undefined"){attachPopunderHovers();
}if(typeof attachMp3Hovers!=="undefined"){attachMp3Hovers();
}if(showSwatchColors){initSwatches();
}metricsUpdateUIHandler();
};
function revertSwatchOnMouseOut(swatchParent){var imageURL=swatchParent.attr("selectedImageURL"),productURL=swatchParent.attr("selectedProductURL"),paddingStyle=swatchParent.attr("selectedPaddingStyle"),imageHeight=swatchParent.attr("selectedImageHeight"),imageWidth=swatchParent.attr("selectedImageWidth");
var $cell=swatchParent.parents("div.p13nimp");
var $image=$cell.find("img");
$image.attr({"src":imageURL,"width":imageWidth,"height":imageHeight});
$cell.find(".sim-img-title").attr("href",productURL);
$cell.find(".product-image").attr("style",paddingStyle);
}var swatchInitialization=function(){shovelerElement.find(".variationalColorSwatchBorder").each(function(){var swatch=$(this);
swatch.removeClass("disabledSwatch");
if(!swatch.attr("data-hover-bound")){swatch.attr("data-hover-bound",true);
swatch.parents(".shoveler-cell").bind("mouseenter",function(){$(this).find(".variationalColorSwatch").each(function(){var $this=$(this);
(new Image).src=$this.attr("data-imageurl");
});
});
swatch.bind("mouseenter",function(){var $this=$(this),$swatchElement=$this.find(".variationalColorSwatch"),imageURL=$swatchElement.attr("data-imageUrl"),productURL=$swatchElement.attr("data-productURL"),paddingStyle=$swatchElement.attr("data-padding"),imageHeight=$swatchElement.attr("data-imageheight"),imageWidth=$swatchElement.attr("data-imagewidth");
$cell=$this.parents("div.p13nimp");
var $image=$cell.find("img");
$image.attr({"src":imageURL,"width":imageWidth,"height":imageHeight});
$cell.find(".sim-img-title").attr("href",productURL);
$cell.find(".product-image").attr("style",paddingStyle);
});
swatch.bind("click",function(){var $this=$(this),$swatchElement=$this.find(".variationalColorSwatch"),imageURL=$swatchElement.attr("data-imageUrl"),productURL=$swatchElement.attr("data-productURL"),paddingStyle=$swatchElement.attr("data-padding"),imageHeight=$swatchElement.attr("data-imageheight"),imageWidth=$swatchElement.attr("data-imagewidth");
$cell=$this.parents("div.p13nimp");
var $image=$cell.find("img");
$image.attr({"src":imageURL,"width":imageWidth,"height":imageHeight});
$cell.find(".sim-img-title").attr("href",productURL);
$cell.find(".product-image").attr("style",paddingStyle);
var $variation=$this.parents("ul.variationalColors");
$variation.attr("selectedImageURL",imageURL);
$variation.attr("selectedProductURL",productURL);
$variation.attr("selectedPaddingStyle",paddingStyle);
$variation.attr("selectedImageHeight",imageHeight);
$variation.attr("selectedImageWidth",imageWidth);
$variation.find("li.variationalColorSwatchBorder").removeClass("variationalColorSwatchSelected");
$this.addClass("variationalColorSwatchSelected");
});
var hasPendingCells=0;
shovelerElement.find("li.shoveler-cell").each(function(){if($(this).find("div.variation").length==0){hasPendingCells++;
}});
if(hasPendingCells===0&&swatchRefreshID!=undefined){clearInterval(swatchRefreshID);
swatchRefreshID=undefined;
}shovelerElement.find(".variationalColors").each(function(){var swatchParent=$(this);
swatchParent.bind("mouseleave",function(){revertSwatchOnMouseOut(swatchParent);
});
});
shovelerElement.find(".variationsMore").each(function(){var swatchParent=$(this).parents(".variationalColors");
$(this).bind("mouseenter",function(){revertSwatchOnMouseOut(swatchParent);
});
});
}});
};
function initSwatches(){if(swatchRefreshID===undefined){swatchRefreshID=setInterval(swatchInitialization,200);
}swatchInitialization();
}var generatorFunction=function(cellStart,numCells){var param="";
if(showPopunders){param+="&showATC=1";
}if(showMp3Samples){param+="&showMp3=1";
}if(showHMD){param+="&showHMD=1";
}if(fetchATCData&&cellStart==6){fetchATCData=false;
param+="&atc="+asinList.slice(0,6).join(",");
}if(serverAUI==1){param+="&isAUI="+serverAUI;
}if(deviceType){param+="&deviceType="+deviceType;
}var asinargs=asinList.slice(cellStart,cellStart+numCells).join(",");
return"/gp/product/features/similarities/shoveler/cell-render.html/ref="+reftag+"?id="+asinargs+"&pos="+(cellStart+1)+"&refTag="+reftag+"&wdg="+wdg+"&shovelerName="+widgetName+param;
};
var cellTransformer=function(cell){return(cell==null)?"":cell.content;
};
var ajaxResultTransformer=function(data){if(data[data.length-1].atc){atcData=data[data.length-1];
data.splice(data.length-1,1);
}return data;
};
var stateSerializer;
var useSessionStorage=false;
try{sessionStorage.setItem("simSt","simSt");
sessionStorage.removeItem("simSt");
useSessionStorage=true;
}catch(err){}if(useSessionStorage){stateSerializer={ready:function(){return true;
},get:function(){try{return parseInt(sessionStorage.getItem(statekey));
}catch(err){}},set:function(value){try{sessionStorage.removeItem(statekey);
sessionStorage.setItem(statekey,value);
}catch(err){}}};
}else{var stateElementSelector="input#"+widgetName+"ShvlState";
stateSerializer={ready:function(){return $(stateElementSelector).val().length>0;
},get:function(){return parseInt($(stateElementSelector).val());
},set:function(value){$(stateElementSelector).val(value);
}};
}window[widgetName]=shoveler=shovelerElement.shoveler(generatorFunction,asinList.length,{cellTransformer:cellTransformer,ajaxResultTransformer:ajaxResultTransformer,cellChangeSpeedInMs:30,preloadNextPage:true,prevButtonSelector:"a.back-button",nextButtonSelector:"a.next-button",startOverSelector:"span.start-over",startOverLinkSelector:"a",horizPadding:14,state:stateSerializer,onUpdateUIHandler:onUpdateUI});
var prevWidth=0;
var shovelerDPResize=function(){var curWidth=$(window).width();
if(prevWidth!=curWidth){window[widgetName].updateUI();
prevWidth=curWidth;
}};
var resizeTimer=null;
shovelerElement.resize(function(){if(resizeTimer){clearTimeout(resizeTimer);
}resizeTimer=setTimeout(shovelerDPResize,100);
});
onShovelerInitialized();
};
if(dataEl.length==1){var containerEl=$("#"+widgetName+"Shvl");
var asinList=dataEl.text().split(",");
containerEl.callOnVisible(initFunc);
if(dataEl.attr("data-vt")){onShovelerInitialized=function(){var loggingStarted=false;
var featureId=dataEl.attr("data-featureId");
var isEventComplete=function(){return containerEl.find("li.shoveler-cell.shoveler-progress").size()==0;
};
var shovelerLog=function(eventData){amznJQ.onReady("p13nlogger",function(){var commonData={featureElement:containerEl,channel:"similarities",widget:featureId,isEventComplete:isEventComplete,meta:{numsims:asinList.length}};
p13n.logAsyncEvent($.extend(true,{},commonData,eventData));
});
loggingStarted=true;
};
containerEl.callOnVisible(function(){shovelerLog({action:"view",page:shoveler.getCurrentPage()+1});
},0);
containerEl.find(".back-button").click(function(){shovelerLog({action:"shovel_left",page:shoveler.getCurrentPage()+1});
});
containerEl.find(".next-button").click(function(){shovelerLog({action:"shovel_right",page:shoveler.getCurrentPage()+1});
});
containerEl.find(".start-over-link").mousedown(function(){shovelerLog({action:"start_over",page:1,meta:{"op":(shoveler.getCurrentPage()+1)}});
});
metricsUpdateUIHandler=function(){if(!loggingStarted||typeof window.p13n=="undefined"||p13n.eventPending(featureId)){return;
}shovelerLog({action:"resize",page:(shoveler.getCurrentPage()+1),logOnlyOnNew:true,initialDelay:2000});
};
};
}return true;
}else{return false;
}};
var simsShovelerFeatures=["session","purchase","trackpurchase","consumption","view_to_purchase"];
function initShovelerFeatures(){var attachedFeatures=[];
for(var i=simsShovelerFeatures.length-1;
i>=0;
i--){if(sims_initShovelerFeature(simsShovelerFeatures[i])){simsShovelerFeatures.splice(i,1);
}}}amznJQ.available("amazonShoveler",function(){initShovelerFeatures();
$(initShovelerFeatures);
});
amznJQ.declareAvailable("simsJS");
};
if(typeof amznJQ==="object"){amznJQ.available("callOnVisible",function(){initSimsJs(amznJQ.jQuery);
});
}else{throw new Error("simsJS requires amznJQ");
}})(window,document,window.P,window.amznJQ);

/* end simsJS/simsTrackPreview.js */

/* begin fbtJS/fbt.js */
amznJQ.available("jQuery",function(){var $=jQuery;
var checkboxSelector="#fbt_x_check,#fbt_y_check,#fbt_z_check";
var sellerInfoSelector="#xInfoWrapper,#yInfoWrapper,#zInfoWrapper";
var fbt_data=null;
function checked(){return $(checkboxSelector).map(function(i,el){return $(el).is(":checked");
});
}function format_price(num){var fraction=num-parseInt(num);
fraction=fraction.toFixed(2);
if(num==fraction){return fraction.toString();
}var str=fraction.toString();
str=str.replace("0.",".");
var n=parseInt(num);
var i=0;
while(n>0){var d=n%10;
n=parseInt(n/10);
str=d.toString()+str;
i++;
if((i%3==0)&&(n>0)){str=","+str;
}}if(fbt_data.currencyCode=="EUR"){str=str.replace(/,/,"+");
str=str.replace(/\./,",");
str=str.replace(/\+/,".");
}else{if(fbt_data.currencyCode=="JPY"){str=str.replace(".00","");
}}return str;
}function update_price(){var priceBlock=$("#fbt_price_block");
var buyingPriceT=$("#fbt_bpt");
var buyingPrice=$("#fbt_buying_price");
var pointsT=$("#fbt_ptt");
var points=$("#fbt_pt");
var isChecked=checked();
var cartCount=0;
var totalBuyingPrice=0;
var mapItemChecked=false;
var totalPoints=0;
var totalPointsValue=0;
for(var i=0;
i<fbt_data.itemData.length;
i++){if(isChecked[i]){cartCount++;
totalBuyingPrice+=fbt_data.itemData[i].buyingPrice;
mapItemChecked=mapItemChecked||fbt_data.itemData[i].priceBreaksMAP;
if(fbt_data.itemData[i].points){totalPoints+=fbt_data.itemData[i].points;
totalPointsValue+=fbt_data.itemData[i].pointsValue;
}}}buyingPrice.html(buyingPrice.html().replace(/([0-9\.,]*[0-9][0-9\.,]*)/,format_price(totalBuyingPrice)));
buyingPriceT.html(fbt_data.strings.priceLabel[cartCount-1]);
if(mapItemChecked){$("#fbt_map_text").text((cartCount==1)?fbt_data.strings.mapSingle:fbt_data.strings.mapMultiple);
}buyingPrice[mapItemChecked?"hide":"show"]();
$("#fbt_map")[mapItemChecked?"show":"hide"]();
if(totalPoints>0){var pointsString=totalPoints+fbt_data.strings.pointsSuffix;
var pointsPercent=parseInt((totalPointsValue*100/totalBuyingPrice)+0.5);
if(pointsPercent>0){pointsString+="&nbsp;("+pointsPercent+"%)";
}points.html(pointsString);
pointsT.show();
}else{pointsT.hide();
}}function update_buttons(){var isChecked=checked();
var cartAddButton=$("#fbt_cartadd_button");
var wlButton=$("#fbt_wladd_button");
var cartCount=0;
var allArePreorder=true;
for(var i=0;
i<fbt_data.itemData.length;
i++){if(isChecked[i]){cartCount++;
allArePreorder=allArePreorder&&fbt_data.itemData[i].isPreorder;
}}if(cartCount>0){cartAddButton.removeClass().addClass("button-margin dpSprite "+(allArePreorder?fbt_data.sprites.preorder:fbt_data.sprites.addToCart)[cartCount-1]).attr("alt",(allArePreorder?fbt_data.strings.preorder:fbt_data.strings.addToCart)[cartCount-1]);
wlButton.removeClass().addClass("wl-button-sprite button-margin "+fbt_data.sprites.addToWishlist[cartCount-1]).attr("alt",fbt_data.strings.addToWishlist[cartCount-1]);
}}function update_seller_text(showingDetails){var isChecked=checked();
var detailsKey="";
var cartCount=0;
for(var i=0;
i<fbt_data.itemData.length;
i++){if(isChecked[i]){detailsKey+=fbt_data.tags[i];
cartCount++;
}}var shippingMessage;
var detailsLinkText;
if(fbt_data.shippingDetails[detailsKey]=="sellers"){shippingMessage=fbt_data.strings["differentSellers"];
detailsLinkText=fbt_data.strings[showingDetails?"hideDetails":"showDetails"];
}else{if(fbt_data.shippingDetails[detailsKey]=="availability"){shippingMessage=(cartCount==2)?fbt_data.strings["differentAvailability"]:fbt_data.strings["differentAvailabilityAll"];
detailsLinkText=fbt_data.strings[showingDetails?"hideDetails":"showDetails"];
}else{shippingMessage="";
detailsLinkText=fbt_data.strings[showingDetails?"hideDetailsDefault":"showDetailsDefault"];
}}var el=$("#fbt_shipping_details");
el.find("span").text(shippingMessage);
el.find("a").text(detailsLinkText);
}function toggle_seller_info(){var sellerInfos=$(sellerInfoSelector);
var show=sellerInfos.is(":hidden");
update_seller_text(show);
if(show){var infoBlock=$("#fbt_item_details");
var count=0;
sellerInfos.show(200,function(){if(++count<sellerInfos.size()){return;
}var scrollTop=$(document).scrollTop();
var diff=(infoBlock.offset().top+infoBlock.outerHeight())-(scrollTop+$(window).height());
if(diff>0){$(document).scrollTop(scrollTop+diff);
}$(".shoveler:first").trigger("resize");
});
if(sellerInfos.eq(0).find("p.bxgySellerInfo").size()==0){sellerInfos.text(" ").removeClass("bxgySellerError").addClass("bxgySellerLoading");
$.ajax({url:"/gp/fbt-ajax/shipping/shipping-handler.html/ref=pd_bxgy_ship?id="+fbt_data.shippingId+"&refTag=pd_bxgy_shipping",dataType:"json",timeout:self.ajaxTimeout,cache:false,error:function(XMLHttpRequest,textStatus,errorThrown){for(var i=0;
i<fbt_data.itemData.length;
i++){$("#"+fbt_data.tags[i]+"InfoWrapper").removeClass("bxgySellerLoading").addClass("bxgySellerError").text(bxgy.strings.errorString);
}},success:function(data,status){for(var i=0;
i<fbt_data.itemData.length;
i++){$("#"+fbt_data.tags[i]+"InfoWrapper").removeClass("bxgySellerLoading").html(data["bxgy"+fbt_data.itemData[i]["ASIN"]]);
}var isChecked=checked();
for(var i=0;
i<fbt_data.itemData.length;
i++){if(!isChecked[i]){sellerInfos.eq(i).find(" > p").addClass("unselected");
}}}});
}}else{sellerInfos.hide();
$(".shoveler:first").trigger("resize");
}}function on_checkbox_change(checking){var isChecked=checked();
var sellerInfos=$(sellerInfoSelector);
var titles=$("#fbt_x_title, #fbt_y_title, #fbt_z_title");
var images=$("#fbt_x_img, #fbt_y_img, #fbt_z_img");
var cartCount=0;
for(var i=0;
i<fbt_data.itemData.length;
i++){if(isChecked[i]){cartCount++;
titles.eq(i).removeClass();
sellerInfos.eq(i).find(" > p").removeClass("unselected");
}else{titles.eq(i).addClass("unselected");
sellerInfos.eq(i).find(" > p").addClass("unselected");
}}var showYPlus=isChecked[1]&&isChecked[0];
var showZPlus=isChecked[2]&&(isChecked[1]||isChecked[0]);
var delay=300;
var fadeElements=$("#fbt_price_block");
if(!checking){for(var i=0;
i<isChecked.length;
i++){if(!isChecked[i]){fadeElements=fadeElements.add(images[i]);
}}if(!showYPlus){fadeElements=fadeElements.add("#fbt_y_plus");
}if(!showZPlus){fadeElements=fadeElements.add("#fbt_z_plus");
}}var count=0;
fadeElements.fadeOut(delay,function(){if(++count<fadeElements.size()){return;
}update_price();
update_buttons();
var showing=!sellerInfos.is(":hidden");
update_seller_text(showing);
if(cartCount>0){var fadeInElements=$("#fbt_price_block");
if(checking){for(var i=0;
i<isChecked.length;
i++){if(isChecked[i]){fadeInElements=fadeInElements.add(images[i]);
}}if(showYPlus){fadeInElements=fadeInElements.add("#fbt_y_plus");
}if(showZPlus){fadeInElements=fadeInElements.add("#fbt_z_plus");
}}fadeInElements.fadeIn(delay);
}});
}var initialized=false;
function init(){var dataEl=$("#fbt_item_data");
if(dataEl.size()==0||initialized){return;
}initialized=true;
function deserializeData(){if(fbt_data==null){fbt_data=typeof window.JSON!="undefined"?JSON.parse(dataEl.html()):eval("("+dataEl.html()+")");
}}$(checkboxSelector).attr("checked",true).show().click(function(){deserializeData();
on_checkbox_change(this.checked);
});
$("#fbt_ship_details_link").show().click(function(){deserializeData();
toggle_seller_info();
$("#fbt_item_details").focus();
return false;
});
}window.sims_initFBT=function(){fbt_data=null;
initialized=false;
init();
};
init();
$(init);
if(typeof amznJQ!="undefined"){amznJQ.declareAvailable("fbtJS");
}});

/* end fbtJS/fbt.js */
